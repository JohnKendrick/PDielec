<!doctype html>
<html class="no-js" lang="en" data-content_root="../../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

    <!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>PDielec.GUI.ViewerTab - PDielec: John Kendrick &amp; Andrew Burnett</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../../../_static/table_styling.css?v=a1a2a898" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css?v=2e0a580d" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">PDielec: John Kendrick & Andrew Burnett</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  
  <span class="sidebar-brand-text">PDielec: John Kendrick & Andrew Burnett</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Software</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pdgui.html">PDGui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../software.html">Other Software Components</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Theory</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../theory_powder.html">Theory for Light Scattering from Powders</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../theory_single_crystal.html">Theory for Single Crystal Optics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../analysis.html">Phonon Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../application_notes_1.html">Applications of Effective Medium Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../application_notes_2.html">Single Crystal Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../application_notes_3.html">Phonopy Examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../autoapi/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../autoapi/PDielec/index.html">PDielec</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of PDielec</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/AbinitOutputReader/index.html">PDielec.AbinitOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/Calculator/index.html">PDielec.Calculator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/CastepOutputReader/index.html">PDielec.CastepOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/Constants/index.html">PDielec.Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/CrystalOutputReader/index.html">PDielec.CrystalOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/DielectricFunction/index.html">PDielec.DielectricFunction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/ExperimentOutputReader/index.html">PDielec.ExperimentOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/GTMcore/index.html">PDielec.GTMcore</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/PDielec/GUI/index.html">PDielec.GUI</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of PDielec.GUI</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/AnalysisTab/index.html">PDielec.GUI.AnalysisTab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/App/index.html">PDielec.GUI.App</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/FitterTab/index.html">PDielec.GUI.FitterTab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/MainTab/index.html">PDielec.GUI.MainTab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/NoteBook/index.html">PDielec.GUI.NoteBook</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/OpenGLWidget/index.html">PDielec.GUI.OpenGLWidget</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/PlottingTab/index.html">PDielec.GUI.PlottingTab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/PowderScenarioTab/index.html">PDielec.GUI.PowderScenarioTab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/ScenarioTab/index.html">PDielec.GUI.ScenarioTab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/SettingsTab/index.html">PDielec.GUI.SettingsTab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/SingleCrystalLayer/index.html">PDielec.GUI.SingleCrystalLayer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html">PDielec.GUI.SingleCrystalScenarioTab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/SpreadSheetManager/index.html">PDielec.GUI.SpreadSheetManager</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html">PDielec.GUI.ViewerTab</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/GenericOutputReader/index.html">PDielec.GenericOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/GulpOutputReader/index.html">PDielec.GulpOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/HelperRoutines/index.html">PDielec.HelperRoutines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/IO/index.html">PDielec.IO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/Materials/index.html">PDielec.Materials</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/Mie/index.html">PDielec.Mie</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/PhonopyOutputReader/index.html">PDielec.PhonopyOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/Plotter/index.html">PDielec.Plotter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/PrimitiveCell/index.html">PDielec.PrimitiveCell</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/QEOutputReader/index.html">PDielec.QEOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/SuperCell/index.html">PDielec.SuperCell</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/UnitCell/index.html">PDielec.UnitCell</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/Utilities/index.html">PDielec.Utilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/VaspOutputReader/index.html">PDielec.VaspOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/checkcsv/index.html">PDielec.checkcsv</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/checkexcel/index.html">PDielec.checkexcel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/graphdatagenerator/index.html">PDielec.graphdatagenerator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/p1reader/index.html">PDielec.p1reader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/p2cif/index.html">PDielec.p2cif</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/pdcompare/index.html">PDielec.pdcompare</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/pdgui/index.html">PDielec.pdgui</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/pdmake/index.html">PDielec.pdmake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/phonopy_pdielec_born/index.html">PDielec.phonopy_pdielec_born</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/pickled_reader/index.html">PDielec.pickled_reader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/preader/index.html">PDielec.preader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/vibanalysis/index.html">PDielec.vibanalysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/PDielec/pdgui/index.html">PDielec.pdgui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/PDielec/preader/index.html">PDielec.preader</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/PDielec/pdmake/index.html">PDielec.pdmake</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../zreferences.html">References</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>Source code for PDielec.GUI.ViewerTab</h1><div class="highlight"><pre>
<span></span><span class="c1">#</span>
<span class="c1"># Copyright 2024 John Kendrick &amp; Andrew Burnett</span>
<span class="c1">#</span>
<span class="c1"># This file is part of PDielec</span>
<span class="c1">#</span>
<span class="c1"># This program is free software; you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the MIT License</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the MIT License along with this program, if not see https://opensource.org/licenses/MIT</span>
<span class="c1">#</span>
<span class="sd">&quot;&quot;&quot;ViewerTab module.&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">deque</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qtpy.QtCore</span><span class="w"> </span><span class="kn">import</span> <span class="n">Qt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qtpy.QtWidgets</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">QApplication</span><span class="p">,</span>
    <span class="n">QColorDialog</span><span class="p">,</span>
    <span class="n">QComboBox</span><span class="p">,</span>
    <span class="n">QDialog</span><span class="p">,</span>
    <span class="n">QDialogButtonBox</span><span class="p">,</span>
    <span class="n">QDoubleSpinBox</span><span class="p">,</span>
    <span class="n">QFormLayout</span><span class="p">,</span>
    <span class="n">QHBoxLayout</span><span class="p">,</span>
    <span class="n">QLabel</span><span class="p">,</span>
    <span class="n">QLineEdit</span><span class="p">,</span>
    <span class="n">QMessageBox</span><span class="p">,</span>
    <span class="n">QPushButton</span><span class="p">,</span>
    <span class="n">QSizePolicy</span><span class="p">,</span>
    <span class="n">QSpinBox</span><span class="p">,</span>
    <span class="n">QTableWidget</span><span class="p">,</span>
    <span class="n">QTableWidgetItem</span><span class="p">,</span>
    <span class="n">QTabWidget</span><span class="p">,</span>
    <span class="n">QVBoxLayout</span><span class="p">,</span>
    <span class="n">QWidget</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">PDielec</span><span class="w"> </span><span class="kn">import</span> <span class="n">Calculator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PDielec.Constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">elemental_colours</span><span class="p">,</span> <span class="n">jmol_elemental_colours</span><span class="p">,</span> <span class="n">vesta_elemental_colours</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PDielec.GUI.OpenGLWidget</span><span class="w"> </span><span class="kn">import</span> <span class="n">OpenGLWidget</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PDielec.PrimitiveCell</span><span class="w"> </span><span class="kn">import</span> <span class="n">PrimitiveCell</span>

<span class="c1"># Need the SuperCell &amp; PrimitiveCell classes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PDielec.SuperCell</span><span class="w"> </span><span class="kn">import</span> <span class="n">SuperCell</span>

<span class="c1"># Import plotting requirements</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PDielec.Utilities</span><span class="w"> </span><span class="kn">import</span> <span class="n">Debug</span>


<div class="viewcode-block" id="ViewerTab">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ViewerTab</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class representing a viewer tab in a graphical user interface, specifically for visualizing molecular structures and vibrational modes.</span>

<span class="sd">    This class integrates several widgets to enable the selection and visualization of various </span>
<span class="sd">    parameters relevant to molecular structures and their vibrational modes. It allows for </span>
<span class="sd">    interactive change of settings like atom scaling, super cell configuration, and visualization </span>
<span class="sd">    options such as showing arrows for vibrational modes or animation. It also includes functionalities</span>
<span class="sd">    to save the visualization in different formats.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parent : QWidget</span>
<span class="sd">        The parent widget to which this widget belongs.</span>
<span class="sd">    debug : bool, optional</span>
<span class="sd">        Flag to enable debugging messages, by default False.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    debug : bool</span>
<span class="sd">        If debug mode is enabled.</span>
<span class="sd">    refreshRequired : bool</span>
<span class="sd">        Indicates if a refresh of the visualization is needed due to settings changes.</span>
<span class="sd">    UVW : deque</span>
<span class="sd">        A deque containing the vibrational mode vectors.</span>
<span class="sd">    settings : dict</span>
<span class="sd">        Stores various visualization settings such as selected mode, atom scaling, cell color, etc.</span>
<span class="sd">    light_switches : list of bool</span>
<span class="sd">        A list indicating the state (on or off) of up to 8 light switches for visualization.</span>
<span class="sd">    plot_types : list of str</span>
<span class="sd">        Available types of plots for visualization.</span>
<span class="sd">    plot_type_index : int</span>
<span class="sd">        The index of the currently selected plot type.</span>
<span class="sd">    number_of_molecules : int</span>
<span class="sd">        The number of molecules in the visualization.</span>
<span class="sd">    standard_cell, unit_cell, super_cell, cell_edges, cell_corners : Various</span>
<span class="sd">        Attributes related to the molecular/crystalline structure and its visualization.</span>
<span class="sd">    element_colours : dict</span>
<span class="sd">        A mapping of elements to their colors used in the visualization.</span>
<span class="sd">    element_names : list of str</span>
<span class="sd">        Names of the elements present in the visualization.</span>
<span class="sd">    species : list of str</span>
<span class="sd">        The species of the elements/molecules considered in the visualization.</span>
<span class="sd">    image_filename : str</span>
<span class="sd">        The filename where the visualization can be saved.</span>
<span class="sd">    notebook : QWidget</span>
<span class="sd">        The parent notebook widget containing this ViewerTab.</span>
<span class="sd">    reader : Reader</span>
<span class="sd">        The reader object used for reading structural information.</span>
<span class="sd">    frequencies_cm1 : list</span>
<span class="sd">        List of frequencies of the vibrational modes in cm^-1.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    There are multiple methods for event handling (e.g., on_filename_le_return, on_super_cell_changed_a),</span>
<span class="sd">    methods for recalculating visualization parameters (e.g., calculate, calculatePhasePositions),</span>
<span class="sd">    and methods for changing visualization settings interactively and programatically (e.g., setColour, refresh).</span>
<span class="sd">    Each method typically adjusts the ViewerTab&#39;s state or visualization output accordingly based on user interaction or programmatic changes.</span>

<span class="sd">    calculate</span>
<span class="sd">        Obtains frequencies, normal modes, unit cell of whole molecules and supercell</span>
<span class="sd">    calculatePhasePositions</span>
<span class="sd">        Calculates the positions of atoms during a vibration</span>
<span class="sd">    on_arrow_radius_changed</span>
<span class="sd">        Handles the change in arrow radius widget</span>
<span class="sd">    on_atom_scaling_changed</span>
<span class="sd">        Handles the change in atom scaling widget</span>
<span class="sd">    on_bond_radius_changed</span>
<span class="sd">        Handles the change in bond radius widget</span>
<span class="sd">    on_cell_radius_changed</span>
<span class="sd">        Handle the change in unit cell radius widget</span>
<span class="sd">    on_coloured_button_clicked</span>
<span class="sd">        Handles a click on the coloured button</span>
<span class="sd">    on_coloured_element_clicked</span>
<span class="sd">        Changes the colour of an element</span>
<span class="sd">    on_edit_button_clicked</span>
<span class="sd">        Edit the transform matrix in the GUI</span>
<span class="sd">    on_filename_button_clicked</span>
<span class="sd">        Handles a click on the file name button</span>
<span class="sd">    on_filename_le_changed</span>
<span class="sd">        Handles a change to the file name</span>
<span class="sd">    on_filename_le_return</span>
<span class="sd">        Handles a return press in the file name widget</span>
<span class="sd">    on_guess_button_clicked</span>
<span class="sd">        Guess the transform to a primitive cell</span>
<span class="sd">    on_light_switches_cb_activated</span>
<span class="sd">        Activates the light switch combobox</span>
<span class="sd">    on_maximum_displacement_changed</span>
<span class="sd">        Handles a change in the maximum displace allowed in following molecular vibrations</span>
<span class="sd">    on_plottype_cb_changed</span>
<span class="sd">        Handles a change in the plot type combobox</span>
<span class="sd">    on_selected_mode_changed</span>
<span class="sd">        Handles a change in the vibrational mode which is being displayed</span>
<span class="sd">    on_super_cell_changed_a</span>
<span class="sd">        Handles the change in the a supercell parameter</span>
<span class="sd">    on_super_cell_changed_b</span>
<span class="sd">        Handles the change in the b supercell parameter</span>
<span class="sd">    on_super_cell_changed_c</span>
<span class="sd">        Handles the change in the c supercell parameter</span>
<span class="sd">    on_reset_button_clicked</span>
<span class="sd">        Changes the transform back to a unit matrix</span>
<span class="sd">    plot</span>
<span class="sd">        Plot the 3D view of the molecule</span>
<span class="sd">    plot_animation</span>
<span class="sd">        Plot an animated 3D view of the vibration being studied</span>
<span class="sd">    plot_arrows</span>
<span class="sd">        Plot an 3D view of the vibration being studied using arrows</span>
<span class="sd">    plot_none</span>
<span class="sd">        Plots the molecule only, no vibrations</span>
<span class="sd">    refresh</span>
<span class="sd">        Refresh the GUI with the latest information</span>
<span class="sd">    requestRefresh</span>
<span class="sd">        Something has changed in the GUI that will need a refresh</span>
<span class="sd">    save_as_cif</span>
<span class="sd">        Write out a cif file</span>
<span class="sd">    save_mode_as_cif</span>
<span class="sd">        Write out a cif file with the mode displacememnt information</span>
<span class="sd">    setColour</span>
<span class="sd">        Set the colour of the specified element</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span> <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the viewer tab with default settings, UI components, and signal connections.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parent : QWidget</span>
<span class="sd">            The parent widget to which this widget belongs.</span>
<span class="sd">        debug : bool, optional</span>
<span class="sd">            Flag to enable debugging messages, by default False.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This method sets up various UI components such as spin boxes for selecting visualization mode,</span>
<span class="sd">        super cell size, atom scaling, bond radius, cell radius, arrow radius, maximum displacement,</span>
<span class="sd">        and options for plotting type and light switches. It initializes default settings for visualization,</span>
<span class="sd">        sets up connections for UI component signals to their respective slot methods, and arranges all UI components</span>
<span class="sd">        using layout managers. Also, it sets up OpenGL widget for rendering.</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="nb">super</span><span class="p">(</span><span class="n">QWidget</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span> <span class="o">=</span> <span class="n">Debug</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span><span class="s2">&quot;ViewerTab&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Start:: initialisation&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Viewer&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UVW</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Selected mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Atom scaling&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Maximum displacement&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Bond colour&quot;</span><span class="p">]</span>           <span class="o">=</span> <span class="p">[</span>  <span class="mi">80</span><span class="p">,</span>  <span class="mi">80</span><span class="p">,</span>  <span class="mi">80</span><span class="p">,</span> <span class="mi">255</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Bond radius&quot;</span><span class="p">]</span>           <span class="o">=</span> <span class="mf">0.1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Cell colour&quot;</span><span class="p">]</span>           <span class="o">=</span> <span class="p">[</span> <span class="mi">255</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Cell radius&quot;</span><span class="p">]</span>           <span class="o">=</span> <span class="mf">0.1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Text colour&quot;</span><span class="p">]</span>           <span class="o">=</span> <span class="p">[</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Text size&quot;</span><span class="p">]</span>             <span class="o">=</span> <span class="s2">&quot;24&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Background colour&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="p">[</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">255</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Arrow colour&quot;</span><span class="p">]</span>          <span class="o">=</span> <span class="p">[</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Arrow radius&quot;</span><span class="p">]</span>          <span class="o">=</span> <span class="mf">0.07</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Number of phase steps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">41</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Super Cell&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Transform&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span> <span class="p">[</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span> <span class="p">],</span> <span class="p">[</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span> <span class="p">],</span> <span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">,</span><span class="s2">&quot;1&quot;</span><span class="p">]</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;hkl&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;uvw&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Element colours&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Element palette&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Jmol&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">light_switches</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span><span class="o">*</span><span class="mi">8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">light_switches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">light_switches</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Animation&quot;</span><span class="p">,</span><span class="s2">&quot;Arrows&quot;</span><span class="p">,</span><span class="s2">&quot;No arrows or animation&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_type_index</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_molecules</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">standard_cell</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">super_cell</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_edges</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_corners</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># element_colours is a dictionary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_colours</span> <span class="o">=</span> <span class="n">elemental_colours</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species</span>       <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_coloured_buttons</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bond_cell_background_arrow_buttons</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bond_cell_background_arrow_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Background&quot;</span><span class="p">,</span><span class="s2">&quot;Cell&quot;</span><span class="p">,</span><span class="s2">&quot;Bonds&quot;</span><span class="p">,</span><span class="s2">&quot;Arrows&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_filename</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform_tab_entry</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transformed_cell</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hkl_tab_entry</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toggle_names</span> <span class="o">=</span>  <span class="p">[</span><span class="s2">&quot;Show cell labels&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;Show cell&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;Show orientation&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;Show bonds&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;Show atoms&quot;</span><span class="p">,</span>
                             <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Toggle states&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="kc">True</span><span class="p">,</span>
                               <span class="kc">True</span><span class="p">,</span>
                               <span class="kc">True</span><span class="p">,</span>
                               <span class="kc">True</span><span class="p">,</span>
                               <span class="kc">True</span><span class="p">,</span>
                             <span class="p">]</span>
        <span class="c1"># store the notebook</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="c1"># get the reader from the main tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">mainTab</span><span class="o">.</span><span class="n">reader</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequencies_cm1</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">frequencies_cm1</span>
        <span class="c1"># Create last tab - ViewerTab</span>
        <span class="n">vbox</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">QFormLayout</span><span class="p">()</span>
        <span class="c1">#</span>
        <span class="c1"># The selected mode</span>
        <span class="c1"># Mode numbering starts at 1</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_mode_sb</span> <span class="o">=</span> <span class="n">QSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies_cm1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies_cm1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected_mode_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies_cm1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected_mode_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_mode_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Selected mode&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_mode_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Set the mode to be visualised&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_mode_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_selected_mode_changed</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Select phonon mode&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Set the mode to be visualised&quot;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_mode_sb</span><span class="p">)</span>
        <span class="c1"># Add frequency of mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_le</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_le</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_le</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mf">0.0</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Frequency (cm-1)&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_le</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># The transform window popup</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform_tab_entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createTransformTabEntry</span><span class="p">()</span>
        <span class="c1">#</span>
        <span class="c1"># The hkl tab entry</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hkl_tab_entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createHKLTabEntry</span><span class="p">()</span>
        <span class="c1">#</span>
        <span class="c1"># The super-cell widget</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">super_cell_widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">super_cell_widget</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Generate a super-cell</span><span class="se">\n</span><span class="s2">The super-cell is a multiple of the DFT cell, not the transformed cell&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">super_cell_hbox</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">super_cell_spinBoxes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">super_cell_changed</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">on_super_cell_changed_a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_super_cell_changed_b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_super_cell_changed_c</span><span class="p">]</span>
        <span class="n">super_cell_tooltip</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Size in a&quot;</span><span class="p">,</span> <span class="s2">&quot;Size in b&quot;</span><span class="p">,</span> <span class="s2">&quot;Size in c&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">change_function</span><span class="p">,</span><span class="n">tip</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">super_cell_changed</span><span class="p">,</span><span class="n">super_cell_tooltip</span><span class="p">):</span>
            <span class="n">spinBox</span> <span class="o">=</span> <span class="n">QSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">spinBox</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="n">tip</span><span class="p">)</span>
            <span class="n">spinBox</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">spinBox</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">spinBox</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">change_function</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">super_cell_spinBoxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spinBox</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">super_cell_hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">spinBox</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">super_cell_widget</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">super_cell_hbox</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># The atom scaling</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_scaling_sb</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_scaling_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">5.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_scaling_sb</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_scaling_sb</span><span class="o">.</span><span class="n">setDecimals</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_scaling_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Atom scaling&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_scaling_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Scale the covalent radii to determine the size of the atomic spheres&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_scaling_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_atom_scaling_changed</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># The bond width</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bond_radius_sb</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bond_radius_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bond_radius_sb</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bond_radius_sb</span><span class="o">.</span><span class="n">setDecimals</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bond_radius_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Bond radius&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bond_radius_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Determines the size of the bonds drawn&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bond_radius_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_bond_radius_changed</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># The cell width</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_radius_sb</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_radius_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_radius_sb</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_radius_sb</span><span class="o">.</span><span class="n">setDecimals</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_radius_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Cell radius&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_radius_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Determines the radius of the cell outline&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_radius_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_cell_radius_changed</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># The arrow radius</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrow_radius_sb</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrow_radius_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrow_radius_sb</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrow_radius_sb</span><span class="o">.</span><span class="n">setDecimals</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrow_radius_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Arrow radius&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrow_radius_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Determines the radius of the arrow outline&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrow_radius_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_arrow_radius_changed</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># The maximum displacement</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maximum_displacement_sb</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maximum_displacement_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">10.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maximum_displacement_sb</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maximum_displacement_sb</span><span class="o">.</span><span class="n">setDecimals</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maximum_displacement_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Maximum displacement&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maximum_displacement_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Set the size of the maximum displacement&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maximum_displacement_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_maximum_displacement_changed</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Add a combo box to select which type of plot</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plottype_cb</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plottype_cb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;The plot can either be an animation or the modes can be shown by arrow&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">choice</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_types</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plottype_cb</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">choice</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plottype_cb</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_type_index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plottype_cb</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_plottype_cb_changed</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Choose the plot type&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;The plot can either be an animation or the modes can be shown by arrow&quot;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plottype_cb</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Toggle switches</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toggles_cb</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toggles_cb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;The toggles switches&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">toggle</span><span class="p">,</span><span class="n">state</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_names</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Toggle states&quot;</span><span class="p">]):</span>
            <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">toggle</span><span class="si">}</span><span class="s2"> is on&quot;</span> <span class="k">if</span> <span class="n">state</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">toggle</span><span class="si">}</span><span class="s2"> is off&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toggles_cb</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toggles_cb</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_toggles_cb_activated</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Light switches</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">light_switches_cb</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">light_switches_cb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Toogle the light switches on or off&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">light</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">light_switches</span><span class="p">):</span>
            <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;switch light </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> off&quot;</span> <span class="k">if</span> <span class="n">light</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;switch light </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> on&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">light_switches_cb</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">light_switches_cb</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_light_switches_cb_activated</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Colours list of buttons with element colours</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coloured_elements_widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_coloured_buttons</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_coloured_hbox</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
            <span class="n">r</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_colours</span><span class="p">[</span><span class="n">el</span><span class="p">]</span>
            <span class="n">button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
            <span class="n">button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;background-color:rgba( </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">g</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">);&quot;</span><span class="p">)</span>
            <span class="n">button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_coloured_element_clicked</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">element_coloured_buttons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">element_coloured_hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coloured_elements_widget</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element_coloured_hbox</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coloured_elements_widget</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Change the colour of the elements&quot;</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Colours list of buttons with colours</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coloured_buttons_widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bond_cell_background_arrow_buttons</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">hbox</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">button_colours</span> <span class="o">=</span> <span class="p">[</span>  <span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Background colour&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Cell colour&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Bond colour&quot;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Arrow colour&quot;</span><span class="p">]]</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bond_cell_background_arrow_buttons</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">button_colours</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_cell_background_arrow_names</span><span class="p">):</span>
            <span class="n">button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color:rgba( </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">);&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">col</span><span class="p">))</span>
            <span class="n">button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_coloured_button_clicked</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bond_cell_background_arrow_buttons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>
            <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coloured_buttons_widget</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Change the colours of the background, cell, bonds and arrows&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coloured_buttons_widget</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">hbox</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Add a tab widget for the settings</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settingsTab</span> <span class="o">=</span> <span class="n">QTabWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coloured_elements_widget</span><span class="p">,</span> <span class="s2">&quot;Elements&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coloured_buttons_widget</span><span class="p">,</span> <span class="s2">&quot;Colours&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_scaling_sb</span><span class="p">,</span> <span class="s2">&quot;Atom Size&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">super_cell_widget</span><span class="p">,</span> <span class="s2">&quot;Super Cell&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_tab_entry</span><span class="p">,</span> <span class="s2">&quot;Transform&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hkl_tab_entry</span><span class="p">,</span> <span class="s2">&quot;Surface&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">light_switches_cb</span><span class="p">,</span> <span class="s2">&quot;Lighting&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggles_cb</span><span class="p">,</span> <span class="s2">&quot;Toggles&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maximum_displacement_sb</span><span class="p">,</span> <span class="s2">&quot;Displacement&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bond_radius_sb</span><span class="p">,</span> <span class="s2">&quot;Bond Radius&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_radius_sb</span><span class="p">,</span> <span class="s2">&quot;Cell Radius&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arrow_radius_sb</span><span class="p">,</span> <span class="s2">&quot;Arrow Radius&quot;</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Settings&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">label</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">settingsTab</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Add buttons to save a png or movie</span>
        <span class="c1">#</span>
        <span class="n">hbox</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename_le</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename_le</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Give a file name in which to save the image.</span><span class="se">\n</span><span class="s2">If a return is pressed the filename is scanned to see whatyoe of file has been requested.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename_le</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename_le</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_filename_le_changed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename_le</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_filename_le_return</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">png_filename_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Save as png&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">png_filename_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_filename_button_clicked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">png_filename_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Save the image as a png file with arrows&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mp4_filename_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Save as mp4&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mp4_filename_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_filename_button_clicked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mp4_filename_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Save the animation as an mp4/avi file&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gif_filename_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Save as gif&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gif_filename_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_filename_button_clicked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gif_filename_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Save the animation as a gif file&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cif_filename_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Save as cif or mcif&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cif_filename_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_filename_button_clicked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cif_filename_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Save the structure as cif. Save the mode animation as mcif&quot;</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Image file name&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Give a file name in which to save the image.</span><span class="se">\n</span><span class="s2">If a return is pressed the filename is scanned to see whatyoe of file has been requested.&quot;</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_le</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">png_filename_button</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mp4_filename_button</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gif_filename_button</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cif_filename_button</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">hbox</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Add the opengl figure to the bottom</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span> <span class="o">=</span> <span class="n">OpenGLWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">setFocusPolicy</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">StrongFocus</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">))</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
        <span class="c1"># finalise the layout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">vbox</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Finished:: initialisation&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="ViewerTab.convert_transform">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.convert_transform">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">convert_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the transform stored as strings in settings to an np.array.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Modifies</span>
<span class="sd">        --------</span>
<span class="sd">        transform</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;convert_transform&quot;</span><span class="p">)</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Transform&quot;</span><span class="p">]:</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">eval</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">row</span> <span class="p">]</span>
            <span class="n">transform</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;convert_transform&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">transform</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span></div>

       
<div class="viewcode-block" id="ViewerTab.on_reset_button_clicked">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.on_reset_button_clicked">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_reset_button_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span> <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle a push of the reset transform button.</span>

<span class="sd">        When the button is pushed the transform is set to unity.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        item : bool</span>
<span class="sd">            ignored</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on_reset_button_clicked&quot;</span><span class="p">,</span><span class="n">item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Transform&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span> <span class="p">[</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span> <span class="p">],</span> <span class="p">[</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span> <span class="p">],</span> <span class="p">[</span><span class="s2">&quot;0&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">,</span><span class="s2">&quot;1&quot;</span><span class="p">]</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on_guess_button_clicked transform&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Transform&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span></div>


<div class="viewcode-block" id="ViewerTab.on_guess_button_clicked">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.on_guess_button_clicked">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_guess_button_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Guess the primitive transform button click.</span>

<span class="sd">        The primitive transform is guessed from the spacegroup</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        item : bool</span>
<span class="sd">            ignored</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Modifies</span>
<span class="sd">        --------</span>
<span class="sd">        Modifies primitive unit cell</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on_guess_button_clicked&quot;</span><span class="p">,</span><span class="n">item</span><span class="p">)</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">standard_cell</span><span class="o">.</span><span class="n">guess_primitive_transform</span><span class="p">()</span>
        <span class="n">new</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">transform</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">col</span><span class="si">:</span><span class="s2">.9f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">row</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Transform&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on_guess_button_clicked transform&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Transform&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span></div>


<div class="viewcode-block" id="ViewerTab.on_edit_button_clicked">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.on_edit_button_clicked">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_edit_button_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Edit the transform.</span>

<span class="sd">        The transform window dialog is shown and any edits applied</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        item : bool</span>
<span class="sd">            ignored</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Modifies</span>
<span class="sd">        --------</span>
<span class="sd">        Modifies primitive unit cell</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on_edit_button_clicked&quot;</span><span class="p">,</span><span class="n">item</span><span class="p">)</span>
        <span class="n">transform_window</span> <span class="o">=</span> <span class="n">TransformWindow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Transform&quot;</span><span class="p">],</span>
                                           <span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">state</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">transform_window</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
            <span class="c1"># The &#39;Ok&#39; button was pressed</span>
            <span class="c1"># get the new transform and replace the old one</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Transform&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transform_window</span><span class="o">.</span><span class="n">getTransform</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on_edit_button_clicked transform&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Transform&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span></div>


<div class="viewcode-block" id="ViewerTab.on_primitive_button_clicked">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.on_primitive_button_clicked">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_primitive_button_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">item</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle a push of the primitive transform button.</span>

<span class="sd">        When the button is pushed the primitive transform is loaded from phonopy.yaml</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        item : bool</span>
<span class="sd">            ignored</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Modifies</span>
<span class="sd">        --------</span>
<span class="sd">        self.settings[&quot;Primitive transform&quot;]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on_primitive_button_clicked&quot;</span><span class="p">,</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">primitive_transformation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Primitive transform&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">primitive_transformation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on_primtive_button_clicked transform&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Primitive transform&quot;</span><span class="p">])</span>
        <span class="c1"># change the primitive transform window popup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span></div>


<div class="viewcode-block" id="ViewerTab.createHKLTabEntry">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.createHKLTabEntry">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">createHKLTabEntry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a one line entry to allow an entry of the hkl for a surface.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        a widget</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;CreateHKLTabEntry&quot;</span><span class="p">)</span>
        <span class="c1"># unique direction (hkl)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_sb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_sb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">l_sb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hkl_spin_boxes</span><span class="p">()</span>
        <span class="c1"># unique direction (uvw)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u_sb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_sb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_sb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uvw_spin_boxes</span><span class="p">()</span>
        <span class="n">container</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">QFormLayout</span><span class="p">()</span>
        <span class="n">hbox</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_sb</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_sb</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">l_sb</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;    hkl:&quot;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">hbox</span><span class="p">)</span>
        <span class="n">container</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">QFormLayout</span><span class="p">()</span>
        <span class="n">hbox</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u_sb</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_sb</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w_sb</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;    uvw:&quot;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">hbox</span><span class="p">)</span>
        <span class="n">container</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
        <span class="n">widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Define a surface of the transformed cell using (hkl) &amp; [uvw]&quot;</span><span class="p">)</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">widget</span></div>


<div class="viewcode-block" id="ViewerTab.hkl_spin_boxes">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.hkl_spin_boxes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">hkl_spin_boxes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the spin boxes for hkl.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        a set of spin boxes</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">infostring</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The surface (hkl) is displayed using the keyboard shortcuts &#39;s&#39; or &#39;S&#39;.</span><span class="se">\n</span><span class="s2">&#39;s&#39; shows the surface in the plane of the screen.</span><span class="se">\n</span><span class="s2">&#39;S&#39; shows the surface edge on.</span><span class="se">\n</span><span class="s2"> [uvw] defines a perpendicular to the surface normal.</span><span class="se">\n</span><span class="s2">(hkl) takes precedence unless it is (000).</span><span class="se">\n</span><span class="s2">If hkl is (000) &#39;s&#39; shows [uvw] perpendicular to the screen </span><span class="se">\n</span><span class="s2">and &#39;S&#39; shows [uvw] vertical on the screen&quot;</span>
        <span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;hkl&quot;</span><span class="p">]</span>
        <span class="n">h_sb</span> <span class="o">=</span> <span class="n">QSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">h_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Define the h dimension of the surface&quot;</span><span class="o">+</span><span class="n">infostring</span><span class="p">)</span>
        <span class="n">h_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">h_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="n">h_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_hkl_sb_changed</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">k_sb</span> <span class="o">=</span> <span class="n">QSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">k_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Define the k dimension of the surface&quot;</span><span class="o">+</span><span class="n">infostring</span><span class="p">)</span>
        <span class="n">k_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">k_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">k_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_hkl_sb_changed</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">l_sb</span> <span class="o">=</span> <span class="n">QSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">l_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Define the l dimension of the surface&quot;</span><span class="o">+</span><span class="n">infostring</span><span class="p">)</span>
        <span class="n">l_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">l_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="n">l_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_hkl_sb_changed</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">h_sb</span><span class="p">,</span> <span class="n">k_sb</span><span class="p">,</span> <span class="n">l_sb</span></div>


<div class="viewcode-block" id="ViewerTab.uvw_spin_boxes">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.uvw_spin_boxes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">uvw_spin_boxes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the spin boxes for uvw.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        a set of spin boxes</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">infostring</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The surface (hkl) is displayed using the keyboard shortcuts &#39;s&#39; or &#39;S&#39;.</span><span class="se">\n</span><span class="s2">&#39;s&#39; shows the surface in the plane of the screen.</span><span class="se">\n</span><span class="s2">&#39;S&#39; shows the surface edge on.</span><span class="se">\n</span><span class="s2"> [uvw] defines a perpendicular to the surface normal.</span><span class="se">\n</span><span class="s2">(hkl) takes presidence unless it is (000).</span><span class="se">\n</span><span class="s2">In this case &#39;s&#39; shows [uvw] perpendicular to the screen and &#39;S&#39; show [uvw] vertical on the screen</span><span class="se">\n</span><span class="s2"> &quot;</span>
        <span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;uvw&quot;</span><span class="p">]</span>
        <span class="n">h_sb</span> <span class="o">=</span> <span class="n">QSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">h_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Define the u dimension of the surface&quot;</span><span class="o">+</span><span class="n">infostring</span><span class="p">)</span>
        <span class="n">h_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">h_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="n">h_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_uvw_sb_changed</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">k_sb</span> <span class="o">=</span> <span class="n">QSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">k_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Define the v dimension of the surface&quot;</span><span class="o">+</span><span class="n">infostring</span><span class="p">)</span>
        <span class="n">k_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">k_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">k_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_uvw_sb_changed</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">l_sb</span> <span class="o">=</span> <span class="n">QSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">l_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Define the w dimension of the surface&quot;</span><span class="o">+</span><span class="n">infostring</span><span class="p">)</span>
        <span class="n">l_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">l_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="n">l_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_uvw_sb_changed</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">h_sb</span><span class="p">,</span> <span class="n">k_sb</span><span class="p">,</span> <span class="n">l_sb</span></div>


<div class="viewcode-block" id="ViewerTab.on_uvw_sb_changed">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.on_uvw_sb_changed">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_uvw_sb_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle a change in a value of u,v or, w.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : int</span>
<span class="sd">            The value of u,v or w</span>

<span class="sd">        index : integer</span>
<span class="sd">          1, 2, or 3 for u, v or w</span>

<span class="sd">        Modifies</span>
<span class="sd">        --------</span>
<span class="sd">        settings[&quot;uvw&quot;]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on_uvw_sb_changed&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;uvw&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">value</span>
        <span class="c1">#</span>
        <span class="c1"># Do not allow 0,0,0</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">w</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">u_sb</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v_sb</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">w_sb</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">u_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">w_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">u_sb</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v_sb</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">w_sb</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;uvw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">w</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">define_surface_orientations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformed_cell</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;hkl&quot;</span><span class="p">],</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;uvw&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on_uvw_sb_changed uvw=&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;uvw&quot;</span><span class="p">])</span>
        <span class="k">return</span> </div>

    
<div class="viewcode-block" id="ViewerTab.on_hkl_sb_changed">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.on_hkl_sb_changed">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_hkl_sb_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle a change in a value of h,k or, l.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : int</span>
<span class="sd">            The value of h,k or l</span>

<span class="sd">        index : integer</span>
<span class="sd">          1, 2, or 3 for h, k or l</span>

<span class="sd">        Modifies</span>
<span class="sd">        --------</span>
<span class="sd">        settings[&quot;hkl&quot;]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on_hkl_sb_changed&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;hkl&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;hkl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">define_surface_orientations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformed_cell</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;hkl&quot;</span><span class="p">],</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;uvw&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on_hkl_sb_changed hkl=&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;hkl&quot;</span><span class="p">])</span>
        <span class="k">return</span> </div>

    

<div class="viewcode-block" id="ViewerTab.createTransformTabEntry">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.createTransformTabEntry">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">createTransformTabEntry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a one line entry to modify the cell transformation matrix.</span>

<span class="sd">        Add buttons to reset, edit and if possible read the transformation matrix</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        a widget</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;createTransformTabEntry&quot;</span><span class="p">)</span>
        <span class="n">hbox</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Reset transformation matrix&quot;</span><span class="p">)</span>
        <span class="n">button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Reset the transformation to a unit matrix&quot;</span><span class="p">)</span>
        <span class="n">button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_reset_button_clicked</span><span class="p">)</span>
        <span class="n">button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_reset_button_clicked</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">primitive_transformation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Give a button to load the primitive transformation </span>
            <span class="n">button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Load transformation from phonopy&quot;</span><span class="p">)</span>
            <span class="n">button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Set the transformation to the primitive transformation matrix in phonopy.yaml&quot;</span><span class="p">)</span>
            <span class="n">button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_primitive_button_clicked</span><span class="p">)</span>
            <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>
        <span class="n">button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Guess transformation matrix&quot;</span><span class="p">)</span>
        <span class="n">button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Guess the transformation and generate a new cell&quot;</span><span class="p">)</span>
        <span class="n">button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_guess_button_clicked</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>
        <span class="n">button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Edit transformation matrix&quot;</span><span class="p">)</span>
        <span class="n">button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Edit the transformation and generate a new cell&quot;</span><span class="p">)</span>
        <span class="n">button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_edit_button_clicked</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>
        <span class="n">widget</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">widget</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">hbox</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">widget</span></div>


        
<div class="viewcode-block" id="ViewerTab.on_filename_le_return">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.on_filename_le_return">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_filename_le_return</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the event triggered by the return key press within the filename input field.</span>

<span class="sd">        This method is typically invoked when the return (or enter) key is pressed while inputting a filename. It primarily invokes the filename button click event handler, simulating a click operation on the associated button.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on filename le return pressed&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_filename_button_clicked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="ViewerTab.on_filename_le_changed">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.on_filename_le_changed">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_filename_le_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle changes to the filename line edit.</span>

<span class="sd">        This method is triggered when the text in the filename line edit changes. It updates the internal state to reflect the new filename.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        text : str</span>
<span class="sd">            The new text from the filename line edit.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on filename le changed&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_filename</span> <span class="o">=</span> <span class="n">text</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="ViewerTab.on_filename_button_clicked">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.on_filename_button_clicked">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_filename_button_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">boolean</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the action triggered by clicking the filename button.</span>

<span class="sd">        This method checks if the selected filename has a valid extension and exists. If any </span>
<span class="sd">        checks fail, it alerts the user and aborts the operation. Otherwise, it proceeds to </span>
<span class="sd">        save the current state or image of the OpenGL widget in the specified file format.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        boolean : any</span>
<span class="sd">            This is a dummy parameter.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        QMessageBox</span>
<span class="sd">            Shows an alert if the filename is empty or has an invalid extension, indicating that the file name for the image is not valid.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The valid file extensions are .mp4, .avi, .png, .gif, and .cif. The method modifies the `plot_type_index` </span>
<span class="sd">        attribute of the caller object, saves the data or image into the specified file format, and ensures </span>
<span class="sd">        the application&#39;s cursor is restored to its default state after the operation completes.</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on filename button clicked&quot;</span><span class="p">)</span>
        <span class="c1">#button = self.sender()</span>
        <span class="c1">#text = button.text()</span>
        <span class="c1">#</span>
        <span class="c1"># Check to see if the filename has been set</span>
        <span class="c1">#</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_filename</span>
        <span class="n">root</span><span class="p">,</span><span class="n">extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">extension</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;.mp4&quot;</span><span class="p">,</span> <span class="s2">&quot;.avi&quot;</span><span class="p">,</span> <span class="s2">&quot;.png&quot;</span><span class="p">,</span> <span class="s2">&quot;.gif&quot;</span><span class="p">,</span> <span class="s2">&quot;.cif&quot;</span><span class="p">,</span> <span class="s2">&quot;.mcif&quot;</span> <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Aborting on filename button clicked&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">about</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;Image file name&quot;</span><span class="p">,</span> <span class="s2">&quot;The file name for the image is not valid &quot;</span><span class="o">+</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1">#</span>
        <span class="c1"># The filename will be opened in the directory of the output file which was read in mainTab</span>
        <span class="c1">#</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">mainTab</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># We need to remember the visualisation settings</span>
        <span class="c1">#</span>
        <span class="n">old_plot_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_type_index</span>
        <span class="n">QApplication</span><span class="o">.</span><span class="n">setOverrideCursor</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">WaitCursor</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">extension</span> <span class="o">==</span> <span class="s2">&quot;.png&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">snapshot</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">extension</span> <span class="ow">in</span> <span class="p">(</span> <span class="s2">&quot;.avi&quot;</span><span class="p">,</span> <span class="s2">&quot;.mp4&quot;</span><span class="p">,</span> <span class="s2">&quot;.gif&quot;</span> <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">save_movie</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">extension</span> <span class="o">==</span> <span class="s2">&quot;.cif&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_as_cif</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">extension</span> <span class="o">==</span> <span class="s2">&quot;.mcif&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_mode_as_cif</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_type_index</span> <span class="o">=</span> <span class="n">old_plot_type</span>
        <span class="n">QApplication</span><span class="o">.</span><span class="n">restoreOverrideCursor</span><span class="p">()</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="ViewerTab.on_super_cell_changed_a">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.on_super_cell_changed_a">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_super_cell_changed_a</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">newa</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the &#39;a&#39; parameter of the &#39;Super Cell&#39; setting and refresh the object state.</span>

<span class="sd">        This function takes a new value for &#39;a&#39;, updates the &#39;Super Cell&#39; setting of the object</span>
<span class="sd">        accordingly (while keeping &#39;b&#39; and &#39;c&#39; parameters unchanged), marks the object as</span>
<span class="sd">        requiring refresh, and finally calls the refresh method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        newa : int</span>
<span class="sd">            The new value for the &#39;a&#39; parameter to be set in the &#39;Super Cell&#39; setting.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Super Cell&quot;</span><span class="p">]</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">newa</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Super Cell&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="ViewerTab.on_super_cell_changed_b">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.on_super_cell_changed_b">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_super_cell_changed_b</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">newb</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the &#39;b&#39; component of the &#39;Super Cell&#39; setting and trigger a refresh.</span>

<span class="sd">        This function takes a new value for &#39;b&#39;, updates the &#39;Super Cell&#39; setting of the object</span>
<span class="sd">        accordingly (while keeping &#39;a&#39; and &#39;c&#39; parameters unchanged), marks the object as</span>
<span class="sd">        requiring refresh, and finally calls the refresh method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        newb : int</span>
<span class="sd">            The new value for the &#39;b&#39; component of the &#39;Super Cell&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Super Cell&quot;</span><span class="p">]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">newb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Super Cell&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="ViewerTab.on_super_cell_changed_c">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.on_super_cell_changed_c">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_super_cell_changed_c</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">newc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the &#39;c&#39; component of the &#39;Super Cell&#39; setting and refresh the object.</span>

<span class="sd">        This function takes a new value for &#39;c&#39;, updates the &#39;Super Cell&#39; setting of the object</span>
<span class="sd">        accordingly (while keeping &#39;a&#39; and &#39;b&#39; parameters unchanged), marks the object as</span>
<span class="sd">        requiring refresh, and finally calls the refresh method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        newc : int</span>
<span class="sd">            The new value to set for the &#39;c&#39; component of the &#39;Super Cell&#39; setting.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Super Cell&quot;</span><span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">newc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Super Cell&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="ViewerTab.on_coloured_element_clicked">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.on_coloured_element_clicked">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_coloured_element_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">boolean</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle a click event on an element with colour functionality.</span>

<span class="sd">        A colour dialogue is invoked and the chosen colour is assigned to the element in question</span>
<span class="sd">        The settings dictionary is updated with the new colours and a refresh requested</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        boolean : any</span>
<span class="sd">            This parameter is a dummy parameters</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on coloured elements clicked&quot;</span><span class="p">)</span>
        <span class="n">button</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">button</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">colourChooser</span> <span class="o">=</span> <span class="n">QColorDialog</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">colourChooser</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span> <span class="o">!=</span> <span class="n">QColorDialog</span><span class="o">.</span><span class="n">Accepted</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">colour</span> <span class="o">=</span> <span class="n">colourChooser</span><span class="o">.</span><span class="n">currentColor</span><span class="p">()</span>
        <span class="n">rgba</span> <span class="o">=</span> <span class="p">[</span> <span class="n">colour</span><span class="o">.</span><span class="n">red</span><span class="p">(),</span> <span class="n">colour</span><span class="o">.</span><span class="n">green</span><span class="p">(),</span> <span class="n">colour</span><span class="o">.</span><span class="n">blue</span><span class="p">(),</span> <span class="n">colour</span><span class="o">.</span><span class="n">alpha</span><span class="p">()</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_colours</span><span class="p">[</span><span class="n">text</span><span class="p">]</span> <span class="o">=</span> <span class="n">rgba</span>
        <span class="c1">#</span>
        <span class="c1"># This is a setting based on the element, there is a colour for each element</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Element colours&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_colours</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="ViewerTab.on_coloured_button_clicked">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.on_coloured_button_clicked">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_coloured_button_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">boolean</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the event when a coloured button is clicked.</span>

<span class="sd">        This function triggers a color dialog upon the click of a designated button. It captures the selected color and applies it to a specific setting based on the button&#39;s label (e.g., Background, Cell, Bonds, Arrows). The settings are modified to include the chosen color, and a refresh is triggered to apply the changes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        boolean : bool</span>
<span class="sd">            This parameter is not used in the function.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on coloured button clicked&quot;</span><span class="p">)</span>
        <span class="n">button</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">button</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="n">colourChooser</span> <span class="o">=</span> <span class="n">QColorDialog</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">colourChooser</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span> <span class="o">!=</span> <span class="n">QColorDialog</span><span class="o">.</span><span class="n">Accepted</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">colour</span> <span class="o">=</span> <span class="n">colourChooser</span><span class="o">.</span><span class="n">currentColor</span><span class="p">()</span>
        <span class="n">rgba</span> <span class="o">=</span> <span class="p">[</span> <span class="n">colour</span><span class="o">.</span><span class="n">red</span><span class="p">(),</span> <span class="n">colour</span><span class="o">.</span><span class="n">green</span><span class="p">(),</span> <span class="n">colour</span><span class="o">.</span><span class="n">blue</span><span class="p">(),</span> <span class="n">colour</span><span class="o">.</span><span class="n">alpha</span><span class="p">()</span> <span class="p">]</span>
        <span class="k">if</span> <span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;Background&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Background colour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rgba</span>
        <span class="k">elif</span> <span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;Cell&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Cell colour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rgba</span>
        <span class="k">elif</span> <span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;Bonds&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Bond colour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rgba</span>
        <span class="k">elif</span> <span class="n">text</span> <span class="o">==</span> <span class="s2">&quot;Arrows&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Arrow colour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rgba</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="ViewerTab.on_toggles_cb_activated">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.on_toggles_cb_activated">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_toggles_cb_activated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Activate or deactivate the various toglles based on the current state and updates the GUI accordingly.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int</span>
<span class="sd">            Index of the toggle in `self.toggle_name` list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on_toggles_cb_activated&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Toggle states&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Toggle states&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Toggle states&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
        <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_names</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="si">}</span><span class="s2"> is on&quot;</span> <span class="k">if</span> <span class="n">state</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_names</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="si">}</span><span class="s2"> is off&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toggles_cb</span><span class="o">.</span><span class="n">setItemText</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="ViewerTab.on_light_switches_cb_activated">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.on_light_switches_cb_activated">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_light_switches_cb_activated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Activate or deactivate the light switch based on the current state and updates the GUI accordingly.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int</span>
<span class="sd">            Index of the light switch in `self.light_switches` list that needs to be toggled.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on_light_switches_cb_activated&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">light_switches</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_switches</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;switch light </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> off&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_switches</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;switch light </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> on&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">light_switches_cb</span><span class="o">.</span><span class="n">setItemText</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">defineLights</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="ViewerTab.on_maximum_displacement_changed">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.on_maximum_displacement_changed">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_maximum_displacement_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle changes to the displacement setting.</span>

<span class="sd">        This method updates the &#39;Displacement&#39; setting, recalculates based on the new value, and then replots the relevant data or figures.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The new value for the displacement setting.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on maximum_displacement changed &quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Maximum displacement&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="ViewerTab.on_atom_scaling_changed">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.on_atom_scaling_changed">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_atom_scaling_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle changes to atom scaling settings.</span>

<span class="sd">        This method updates the atom scaling setting based on a new value,</span>
<span class="sd">        recalculates relevant data, and triggers a plot update.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The new value for atom scaling.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on atom_scaling changed &quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Atom scaling&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="ViewerTab.on_arrow_radius_changed">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.on_arrow_radius_changed">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_arrow_radius_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the event where the arrow&#39;s radius value is changed.</span>

<span class="sd">        This method updates the setting for the arrow&#39;s radius, recalculates, and replots based on the new value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The new value for the arrow radius.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on arrow_radius changed &quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Arrow radius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="ViewerTab.on_cell_radius_changed">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.on_cell_radius_changed">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_cell_radius_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the event when the cell radius setting is changed.</span>

<span class="sd">        This method updates the &#39;Cell radius&#39; setting with the new value, recalculates </span>
<span class="sd">        the necessary data, and then replots the results.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The new value for the cell radius.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on cell_radius changed &quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Cell radius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="ViewerTab.on_bond_radius_changed">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.on_bond_radius_changed">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_bond_radius_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle bond radius change events.</span>

<span class="sd">        This method updates the &#39;Bond radius&#39; setting with the new value, recalculates </span>
<span class="sd">        the necessary data, and then replots the results.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The new value for the bond radius.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on_bond_radius_changed&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Bond radius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="ViewerTab.on_selected_mode_changed">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.on_selected_mode_changed">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_selected_mode_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the changes when a new vibrational mode is selected in the UI.</span>

<span class="sd">        This function updates the application state based on the newly selected vibrational mode. It</span>
<span class="sd">        updates the displayed frequency, removes existing arrows from the OpenGL widget, </span>
<span class="sd">        computes maximum displacement for scaling, and plots new arrows with updated settings. </span>
<span class="sd">        It also invokes the calculate and plot functions to reflect changes in the UI.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on_selected_mode_changed&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies_cm1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies_cm1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on_selected_mode_changed aborting&quot;</span><span class="p">)</span>
           <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on selected_mode change mode was &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Selected mode&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Selected mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_mode_sb</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on selected_mode change mode is now &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Selected mode&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_le</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies_cm1</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Selected mode&quot;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">deleteArrows</span><span class="p">()</span>
        <span class="n">maxR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UVW</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Selected mode&quot;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
        <span class="k">if</span> <span class="n">maxR</span> <span class="o">&lt;</span> <span class="mf">1.0E-8</span><span class="p">:</span>
            <span class="n">maxR</span> <span class="o">=</span> <span class="mf">1.0E-8</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_type_index</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">arrow_scaling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Maximum displacement&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">maxR</span>
        <span class="k">for</span> <span class="n">uvw</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UVW</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Selected mode&quot;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">addArrows</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Arrow colour&quot;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Arrow radius&quot;</span><span class="p">],</span> <span class="n">uvw</span><span class="p">,</span> <span class="n">arrow_scaling</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="ViewerTab.on_plottype_cb_changed">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.on_plottype_cb_changed">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_plottype_cb_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the change in plot type selection.</span>

<span class="sd">        This method updates the plot type index based on the user&#39;s selection and then</span>
<span class="sd">        re-plots the data according to the new plot type.</span>
<span class="sd">        Plot types can be: &#39;Animation&#39;, &#39;Arrows&#39;, or &#39;No arrows or animation&#39;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int</span>
<span class="sd">            The index of the newly selected plot type.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on_plottype_cb_changed&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_type_index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Plot type index changed to &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_type_index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="ViewerTab.calculate">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.calculate">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">calculate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform calculations related to the ViewerTab instance, including processing program, file name, calculating frequencies, super cells, normal modes, bonds, center of mass, bounding box, element names, species, covalent radii, and updating the UI with calculated values.</span>

<span class="sd">        In addition, calculate the transformed cell if a transformation is given.</span>
<span class="sd">        The supercell is calculated from the dft cell.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Start:: calculate&quot;</span><span class="p">)</span>
        <span class="c1"># Assemble the mainTab settings</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">mainTab</span><span class="o">.</span><span class="n">settings</span>
        <span class="n">program</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Program&quot;</span><span class="p">]</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">mainTab</span><span class="o">.</span><span class="n">getFullFileName</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;calculate program file name&quot;</span><span class="p">,</span><span class="n">program</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">reader</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Finished:: calculate - reader is None&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">program</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Finished:: calculate - program is blank&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Finished:: calculate - filename is blank&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">QApplication</span><span class="o">.</span><span class="n">setOverrideCursor</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">WaitCursor</span><span class="p">)</span>
        <span class="c1"># Assemble the settingsTab settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequencies_cm1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">frequencies_cm1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_mode_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies_cm1</span><span class="p">))</span>
        <span class="c1">#</span>
        <span class="c1"># Define a standard cell as read by the reader</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">standard_cell</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">get_unit_cell</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">standard_cell</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1">#</span>
        <span class="c1"># Transform the standard cell </span>
        <span class="c1"># this involves folding the cell into itself and applying the transformation</span>
        <span class="c1"># In the process there is a reordering of the atoms which is kept track of in the transformed cell</span>
        <span class="c1"># NOTE: The transformed cell may have fewer atoms than the standard cell</span>
        <span class="c1">#</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">standard_cell</span><span class="p">)</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_transform</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transformed_cell</span> <span class="o">=</span> <span class="n">PrimitiveCell</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span><span class="n">transformation</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">define_orientations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformed_cell</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">define_surface_orientations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformed_cell</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;hkl&quot;</span><span class="p">],</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;uvw&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">set_orientation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">orientation</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Calculate the whole molecule content of the DFT cell</span>
        <span class="c1">#</span>
        <span class="n">tolerance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">analysisTab</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Bonding tolerance&quot;</span><span class="p">]</span>
        <span class="n">scale</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">analysisTab</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Covalent radius scaling&quot;</span><span class="p">]</span>
        <span class="n">radii</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">analysisTab</span><span class="o">.</span><span class="n">element_radii</span>
        <span class="n">cell</span><span class="o">.</span><span class="n">calculate_molecular_contents</span><span class="p">(</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
                                           <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">,</span>
                                           <span class="n">radii</span><span class="o">=</span><span class="n">radii</span><span class="p">)</span>
        <span class="n">atom_masses</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">get_atomic_masses</span><span class="p">()</span>
        <span class="n">mass_weighted_normal_modes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">mass_weighted_normal_modes</span>
        <span class="n">normal_modes</span> <span class="o">=</span> <span class="n">Calculator</span><span class="o">.</span><span class="n">normal_modes</span><span class="p">(</span><span class="n">atom_masses</span><span class="p">,</span><span class="n">mass_weighted_normal_modes</span><span class="p">)</span>
        <span class="c1"># Generate a super cell</span>
        <span class="n">imageSpecifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Super Cell&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">super_cell</span> <span class="o">=</span> <span class="n">SuperCell</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span><span class="n">imageSpecifier</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normal_modes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">super_cell</span><span class="o">.</span><span class="n">calculateNormalModes</span><span class="p">(</span><span class="n">normal_modes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">super_cell</span><span class="o">.</span><span class="n">calculateBonds</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nbonds</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">XYZ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">super_cell</span><span class="o">.</span><span class="n">calculateXYZ</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">natoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">XYZ</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_modes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">normal_modes</span><span class="p">)</span>
        <span class="c1"># get the cell edges for the bounding box, shifted to the centre of mass origin</span>
        <span class="n">totalMass</span><span class="p">,</span><span class="n">centreOfMassXYZ</span><span class="p">,</span><span class="n">centreOfMassABC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">super_cell</span><span class="o">.</span><span class="n">calculateCentreOfMass</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="nb">all</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_corners</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_edges</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformed_cell</span><span class="o">.</span><span class="n">getBoundingBox</span><span class="p">(</span><span class="n">originABC</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">])</span>
        <span class="c1">#</span>
        <span class="c1"># self.element_names is a list of element names for each atom</span>
        <span class="c1"># self.species is just a unique list of species</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">super_cell</span><span class="o">.</span><span class="n">getElementNames</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">getSpecies</span><span class="p">()</span>
        <span class="n">covalent_radii</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">analysisTab</span><span class="o">.</span><span class="n">element_radii</span>
        <span class="c1">#</span>
        <span class="c1"># Overwrite the element colours from the settings entry</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Element colours&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;refresh - processing colours &quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">el</span><span class="p">,</span><span class="n">colour</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Element colours&quot;</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">element_colours</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="o">=</span> <span class="n">colour</span>
        <span class="c1">#</span>
        <span class="c1"># Define the radius and colour for every atom from the element_names</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radii</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Atom scaling&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">covalent_radii</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_names</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colours</span> <span class="o">=</span> <span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_colours</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_names</span> <span class="p">]</span>
        <span class="c1">#</span>
        <span class="c1"># reorder the displacement info in the normal modes into U,V and W lists</span>
        <span class="c1"># Using deque here rather than a simple list as the memory allocation doesn&#39;t have to be contiguous</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UVW</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">displacements</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal_modes</span><span class="p">:</span>
            <span class="n">uvw</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">displacements</span><span class="p">),</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">uvw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">displacements</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UVW</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">uvw</span><span class="p">)</span>
        <span class="c1"># CalculatePhasePositions stores all the sphere and bond information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculatePhasePositions</span><span class="p">()</span>
        <span class="c1"># Add the arrows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;calculate: Selected mode&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Selected mode&quot;</span><span class="p">])</span>
        <span class="n">maxR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UVW</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Selected mode&quot;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
        <span class="k">if</span> <span class="n">maxR</span> <span class="o">&lt;</span> <span class="mf">1.0E-8</span><span class="p">:</span>
            <span class="n">maxR</span> <span class="o">=</span> <span class="mf">1.0E-8</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_type_index</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">arrow_scaling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Maximum displacement&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">maxR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">deleteArrows</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">uvw</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UVW</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Selected mode&quot;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">addArrows</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Arrow colour&quot;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Arrow radius&quot;</span><span class="p">],</span> <span class="n">uvw</span><span class="p">,</span> <span class="n">arrow_scaling</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">setRotationCentre</span><span class="p">(</span> <span class="n">centreOfMassXYZ</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">setImageSize</span><span class="p">()</span>
        <span class="n">QApplication</span><span class="o">.</span><span class="n">restoreOverrideCursor</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Finished:: calculate&quot;</span><span class="p">)</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="ViewerTab.setColour">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.setColour">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setColour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">colour</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the colour of a specified element in the interface.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        element : str</span>
<span class="sd">            The element whose colour is to be set. Can be &#39;Background&#39;, &#39;Cell&#39;, &#39;Arrow&#39;, or any other custom element defined in `element_colours`.</span>
<span class="sd">        colour : str</span>
<span class="sd">            The new colour to be set for the element. This should be a string describing the colour.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        ```python</span>
<span class="sd">        myObject.setColour(&#39;Background&#39;, &#39;#FFFFFF&#39;)  # Sets the background colour to white</span>
<span class="sd">        myObject.setColour(&#39;Cell&#39;, &#39;red&#39;)            # Sets the cell colour to red</span>
<span class="sd">        myObject.setColour(&#39;customElement&#39;, &#39;blue&#39;)  # Sets a custom element&#39;s colour to blue</span>
<span class="sd">        ```</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;setcolour&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">element</span> <span class="ow">in</span> <span class="p">(</span> <span class="s2">&quot;Background&quot;</span> <span class="p">,</span> <span class="s2">&quot;background&quot;</span> <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Background colour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colour</span>
        <span class="k">elif</span> <span class="n">element</span> <span class="ow">in</span> <span class="p">(</span> <span class="s2">&quot;Cell&quot;</span> <span class="p">,</span> <span class="s2">&quot;cell&quot;</span> <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Cell colour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colour</span>
        <span class="k">elif</span> <span class="n">element</span> <span class="ow">in</span> <span class="p">(</span> <span class="s2">&quot;Arrow&quot;</span> <span class="p">,</span> <span class="s2">&quot;arrow&quot;</span> <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Arrow colour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colour</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">element_colours</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="n">colour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="ViewerTab.calculatePhasePositions">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.calculatePhasePositions">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">calculatePhasePositions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate and update the phase positions for the normal mode of a molecular structure visualization.</span>

<span class="sd">        This function calculates the phase positions for all atoms in a molecular structure over a range of phase steps. It updates the visualization by adding spheres and cylinders to represent atoms and bonds in different phase positions. The phase steps are adjusted to be odd in number, ensuring symmetry around zero phase. The function directly modifies the OpenGL widget used for visualization by deleting existing graphical representations and creating new ones based on the calculated positions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;calculatePhasePositions&quot;</span><span class="p">)</span>
        <span class="c1"># we need the number of phase steps to be odd</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Number of phase steps&quot;</span><span class="p">]</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Number of phase steps&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">UVW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">UVW</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Selected mode&quot;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">maxR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">UVW</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">maxR</span> <span class="o">&lt;</span> <span class="mf">1.0E-8</span><span class="p">:</span>
            <span class="n">maxR</span> <span class="o">=</span> <span class="mf">1.0E-8</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_type_index</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_vibrations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Maximum displacement&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">maxR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newXYZ</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Number of phase steps&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">natoms</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Number of phase steps&quot;</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span>
        <span class="n">phases</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">+</span><span class="n">delta</span><span class="o">-</span><span class="mf">1.0E-10</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">phase_index</span><span class="p">,</span><span class="n">phase</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">phases</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">newXYZ</span><span class="p">[</span><span class="n">phase_index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XYZ</span><span class="o">+</span><span class="n">phase</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_vibrations</span><span class="o">*</span><span class="n">UVW</span>
        <span class="c1"># end for phase_index</span>
        <span class="c1">#</span>
        <span class="c1"># Store the results in the opengl widget</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">deleteSpheres</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">deleteCylinders</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">createArrays</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">phases</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;calculatePhasePositions - adding spheres and cylinders&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_toggle_state</span><span class="p">(</span><span class="s2">&quot;Show debug information&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span> <span class="o">=</span> <span class="n">Debug</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="s2">&quot;ViewerTab&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Debug is on:: toggle&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Debug is off:: toggle&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span> <span class="o">=</span> <span class="n">Debug</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span><span class="s2">&quot;ViewerTab&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_toggle_state</span><span class="p">(</span><span class="s2">&quot;Show orientation&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">show_orientation</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">show_orientation</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">phase_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">phases</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">rad</span><span class="p">,</span> <span class="n">xyz</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colours</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radii</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">newXYZ</span><span class="p">[</span><span class="n">phase_index</span><span class="p">]):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_toggle_state</span><span class="p">(</span><span class="s2">&quot;Show atoms&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">addSphere</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">rad</span><span class="p">,</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="n">phase_index</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_corners</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_labels</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_toggle_state</span><span class="p">(</span><span class="s2">&quot;Show cell&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">addSphere</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Cell colour&quot;</span><span class="p">],</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Cell radius&quot;</span><span class="p">],</span>
                                                 <span class="n">p</span><span class="p">,</span>
                                                 <span class="n">phase</span><span class="o">=</span><span class="n">phase_index</span> <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_toggle_state</span><span class="p">(</span><span class="s2">&quot;Show cell labels&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_toggle_state</span><span class="p">(</span><span class="s2">&quot;Show cell&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">addText</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> 
                                               <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Text colour&quot;</span><span class="p">],</span> 
                                               <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Text size&quot;</span><span class="p">],</span> 
                                               <span class="n">p</span><span class="p">,</span> 
                                               <span class="n">phase</span><span class="o">=</span><span class="n">phase_index</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_toggle_state</span><span class="p">(</span><span class="s2">&quot;Show bonds&quot;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
                    <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="o">=</span> <span class="n">bond</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">addCylinder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Bond colour&quot;</span><span class="p">],</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Bond radius&quot;</span><span class="p">],</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">newXYZ</span><span class="p">[</span><span class="n">phase_index</span><span class="p">,</span><span class="n">i</span><span class="p">],</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">newXYZ</span><span class="p">[</span><span class="n">phase_index</span><span class="p">,</span><span class="n">j</span><span class="p">],</span>
                                                   <span class="n">phase</span><span class="o">=</span><span class="n">phase_index</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_toggle_state</span><span class="p">(</span><span class="s2">&quot;Show cell&quot;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">p1</span><span class="p">,</span><span class="n">p2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_edges</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">addCylinder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Cell colour&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Cell radius&quot;</span><span class="p">],</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="n">phase_index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;calculatePhasePositions - exiting&quot;</span><span class="p">)</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="ViewerTab.save_as_cif">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.save_as_cif">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save_as_cif</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the crystallographic information file (CIF) for the structure phases.</span>

<span class="sd">        The cell is wrtten out</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            The name of the file where the CIF data will be saved.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">standard_cell</span><span class="o">.</span><span class="n">write_cif</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViewerTab.save_mode_as_cif">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.save_mode_as_cif">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save_mode_as_cif</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span>
        <span class="c1">#</span>
        <span class="c1"># Write a single cif file containing all the phase information for displacement along a mode</span>
        <span class="c1"># First transform to abc coordinates from xyz</span>
        <span class="c1">#</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the crystallographic information file (CIF) for different phases.</span>

<span class="sd">        A copy is made of the current unit cell and a cell is wrtten out for each phase of the vibration</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            The name of the file where the CIF data will be saved.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This method relies on the `self.standard_cell` object, which should have a method `set_xyz_coordinates` and `write_cif`. It also uses `self.settings` to retrieve the number of phase steps and the selected mode for CIF generation. The function iterates over a calculated range of phases, updates the unit cell coordinates for each phase, and writes the CIF data to the provided filename. The function assumes that `self.newXYZ` is an iterable object containing new XYZ coordinates for each phase. The CIF files are saved with a description that includes the mode and phase.</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
        <span class="n">unitcell</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">standard_cell</span><span class="p">)</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Number of phase steps&quot;</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span>
        <span class="n">phases</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">+</span><span class="n">delta</span><span class="o">-</span><span class="mf">1.0E-10</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">phase_index</span><span class="p">,</span><span class="n">phase</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">phases</span><span class="p">):</span>
                <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;mode_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Selected mode&quot;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;_phase_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>
                <span class="n">unitcell</span><span class="o">.</span><span class="n">set_xyz_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">newXYZ</span><span class="p">[</span><span class="n">phase_index</span><span class="p">])</span>
                <span class="n">unitcell</span><span class="o">.</span><span class="n">write_cif</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span><span class="n">filedescriptor</span><span class="o">=</span><span class="n">fd</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViewerTab.plot">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.plot">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot data based on the instance&#39;s current plot type.</span>
<span class="sd">    </span>
<span class="sd">        This method selects a plotting routine based on the value of `self.plot_type_index`.</span>
<span class="sd">        It does an early return if `self.reader` is None, indicating there might be no data</span>
<span class="sd">        to plot. It logs the method&#39;s progress using a debugger&#39;s print function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Start:: plot&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Finished:: plot reader is None&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_type_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_animation</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_type_index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_arrows</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_none</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Finished:: plot&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViewerTab.plot_none">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.plot_none">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_none</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Hides arrow visuals, stops any ongoing animation, and updates the Open GL widget.</span>

<span class="sd">        This method is intended to reset or clear the current state of the Open GL widget by disabling any arrow visuals, stopping any animations that might be running, and then updating the widget to reflect these changes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Start:: plot_animation&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">showArrows</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">stopAnimation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Finished:: plot_animation&quot;</span><span class="p">)</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="ViewerTab.plot_animation">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.plot_animation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initiate and display an animation of a vibrational mode in an OpenGL widget.</span>

<span class="sd">        This method controls the display of a predefined animation within </span>
<span class="sd">        an OpenGL widget. It hides any arrows, triggers a visual update, </span>
<span class="sd">        and starts the animation process. Debug messages are logged at the </span>
<span class="sd">        start and completion of the animation process.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Start:: plot_animation&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">showArrows</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">startAnimation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Finished:: plot_animation&quot;</span><span class="p">)</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="ViewerTab.plot_arrows">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.plot_arrows">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_arrows</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot arrows showing the vibrational mode of a molecule.</span>

<span class="sd">        This method enables the display of arrows on an associated OpenGL widget, halts any ongoing animations, and triggers a refresh of the widget to ensure the changes are visualized.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Start:: plot_arrows&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">showArrows</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">stopAnimation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opengl_widget</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Finished:: plot_arrows&quot;</span><span class="p">)</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="ViewerTab.requestRefresh">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.requestRefresh">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">requestRefresh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initiate a refresh request.</span>

<span class="sd">        This method sets an internal flag to indicate that a refresh is required.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Start:: requestRefresh&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Finished:: requestRefresh&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViewerTab.refresh">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.refresh">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Refresh the state of the object, optionally forcing the refresh.</span>

<span class="sd">        This method updates the object&#39;s state by recalculating and refreshing its components. It checks whether a refresh is necessary or if it has been forced. It iterates through child widgets to block signals, updates settings from a notebook, adjusts visual elements based on these settings, and ultimately recalculates and replots data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        force : bool, optional</span>
<span class="sd">            If True, the refresh proceeds regardless of whether it is deemed necessary based on the object state. Default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - The function begins by checking if a refresh is required or has been forced. If neither condition is met, it aborts the refresh.</span>
<span class="sd">        - It temporarily changes the cursor to a waiting cursor to indicate processing.</span>
<span class="sd">        - It blocks signals from all child widgets to prevent any unintended interaction during the refresh process.</span>
<span class="sd">        - It updates various widget properties and settings based on attributes of the notebook associated with the object.</span>
<span class="sd">        - The function finally recalculates and re-plots based on the latest data and settings, then restores the standard cursor and marks the refresh as complete.</span>
<span class="sd">        - Debug statements are interspersed throughout for tracking the refresh process&#39;s progress.</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Start:: refresh&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Finished:: refresh aborted&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span><span class="p">,</span><span class="n">force</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;refresh widget&quot;</span><span class="p">,</span><span class="n">force</span><span class="p">)</span>
        <span class="n">QApplication</span><span class="o">.</span><span class="n">setOverrideCursor</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">WaitCursor</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;vesta&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Element palette&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">element_colours</span> <span class="o">=</span> <span class="n">vesta_elemental_colours</span>
        <span class="k">elif</span> <span class="s2">&quot;jmol&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Element palette&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">element_colours</span> <span class="o">=</span> <span class="n">jmol_elemental_colours</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">element_colours</span> <span class="o">=</span> <span class="n">elemental_colours</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="p">()</span>
        <span class="c1">#</span>
        <span class="c1"># Block signals during refresh</span>
        <span class="c1">#</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">findChildren</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
            <span class="n">w</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequencies_cm1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">frequencies_cm1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequencies_cm1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies_cm1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected_mode_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies_cm1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected_mode_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Selected mode&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frequency_le</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies_cm1</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Selected mode&quot;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;refresh: selected mode is now&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_mode_sb</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,(</span><span class="n">toggle</span><span class="p">,</span><span class="n">state</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_names</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Toggle states&quot;</span><span class="p">])):</span>
            <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">toggle</span><span class="si">}</span><span class="s2"> is on&quot;</span> <span class="k">if</span> <span class="n">state</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">toggle</span><span class="si">}</span><span class="s2"> is off&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toggles_cb</span><span class="o">.</span><span class="n">setItemText</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">string</span><span class="p">)</span>
        <span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;hkl&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;uvw&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_scaling_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Atom scaling&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bond_radius_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Bond radius&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_radius_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Cell radius&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maximum_displacement_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Maximum displacement&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plottype_cb</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_type_index</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">light</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">light_switches</span><span class="p">):</span>
            <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;switch light </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> off&quot;</span> <span class="k">if</span> <span class="n">light</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;switch light </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> on&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">light_switches_cb</span><span class="o">.</span><span class="n">setItemText</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">string</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Colours list of buttons with element colours</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">mainTab</span><span class="o">.</span><span class="n">reader</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;reader is none &quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">element_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">standard_cell</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">element_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">standard_cell</span><span class="o">.</span><span class="n">element_names</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">getSpecies</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;refresh - species &quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Element colours&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_colours</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="p">]</span>
        <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_coloured_hbox</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;initialising element colours widget&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">element_coloured_buttons</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
                <span class="n">r</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_colours</span><span class="p">[</span><span class="n">el</span><span class="p">]</span>
                <span class="n">button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
                <span class="n">button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;background-color:rgba( </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">g</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">);&quot;</span><span class="p">)</span>
                <span class="n">button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_coloured_element_clicked</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">element_coloured_buttons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">element_coloured_hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;update element colours widget&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">el</span><span class="p">,</span><span class="n">button</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">element_coloured_buttons</span><span class="p">):</span>
                <span class="n">r</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_colours</span><span class="p">[</span><span class="n">el</span><span class="p">]</span>
                <span class="n">button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;background-color:rgba( </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">g</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">);&quot;</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Colours list of buttons with colours</span>
        <span class="c1">#</span>
        <span class="n">button_colours</span> <span class="o">=</span> <span class="p">[</span>  <span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Background colour&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Cell colour&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Bond colour&quot;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Arrow colour&quot;</span><span class="p">]]</span> <span class="p">]</span>
        <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">button</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">button_colours</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bond_cell_background_arrow_buttons</span><span class="p">):</span>
            <span class="n">button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;background-color:rgba( </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">);&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">col</span><span class="p">))</span>
        <span class="c1">#</span>
        <span class="c1"># Filename</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename_le</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_filename</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Unlock signals after refresh</span>
        <span class="c1">#</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">findChildren</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
            <span class="n">w</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">QApplication</span><span class="o">.</span><span class="n">restoreOverrideCursor</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Finished:: refresh&quot;</span><span class="p">)</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="ViewerTab.get_toggle_state">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.ViewerTab.get_toggle_state">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_toggle_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">toggle</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the state of the given toggle.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        toggle : str</span>
<span class="sd">            The toggle name</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;get_toggle_state: &quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">toggle</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggle_names</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toggle_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">toggle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;get_toggle_state: </span><span class="si">{index}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Toggle states&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">]</span></div>
</div>


<div class="viewcode-block" id="TransformWindow">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.TransformWindow">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TransformWindow</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A GUI window for displaying and editing the transform matrix.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    transform : 3x3 array of floats</span>
<span class="sd">        The current transformation matrix</span>
<span class="sd">    message : str</span>
<span class="sd">        Message to displayed</span>
<span class="sd">    parent : QWidget, optional</span>
<span class="sd">        The parent widget of this window. The default is None.</span>
<span class="sd">    debug : bool, optional</span>
<span class="sd">        Flag to enable or disable debug mode. The default is False.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    transform : 3x3 array of strs</span>
<span class="sd">        The transform matrix</span>
<span class="sd">    message : str</span>
<span class="sd">        The message displayed at the top of the window.</span>
<span class="sd">    layout : QVBoxLayout</span>
<span class="sd">        The main layout of the window.</span>
<span class="sd">    buttonBox : QDialogButtonBox</span>
<span class="sd">        The dialog box containing Ok and Cancel buttons.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    reDrawTransformTable</span>
<span class="sd">        draw the transform table</span>
<span class="sd">    getTransform</span>
<span class="sd">        Return the transform matrix</span>
<span class="sd">    on_transform_table_itemChanged</span>
<span class="sd">        Handles a change in the transform table</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Cell Transform&quot;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span> <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a Transform Window instance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        transform : a 3x3 list of strs</span>
<span class="sd">            The transformation matrix</span>
<span class="sd">        message : str, optional</span>
<span class="sd">            Custom message to display in the window. The default is an empty string.</span>
<span class="sd">        parent : QWidget, optional</span>
<span class="sd">            The parent widget of this window. The default is None.</span>
<span class="sd">        debug : bool, optional</span>
<span class="sd">            Flag to enable or disable debug mode. The default is False.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This constructor initializes the showTransformationWindow by setting up the UI elements</span>
<span class="sd">        including buttons and the layout. It also configures the debug mode according</span>
<span class="sd">        to the provided argument.</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span> <span class="o">=</span> <span class="n">Debug</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span><span class="s2">&quot;TransformWindow&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Start:: initialiser&quot;</span><span class="p">)</span>
        <span class="c1"># Set up the buttons of the button box</span>
        <span class="n">QBtn</span> <span class="o">=</span> <span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Cancel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttonBox</span> <span class="o">=</span> <span class="n">QDialogButtonBox</span><span class="p">(</span><span class="n">QBtn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">accepted</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">rejected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reject</span><span class="p">)</span>
        <span class="c1"># Initialize the transform as a 3x3 array of strings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform_as_str</span> <span class="o">=</span> <span class="n">transform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;transform:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_as_str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="c1"># The dialog will have a vertical layout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># Create the transfom table widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform_table</span> <span class="o">=</span> <span class="n">QTableWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform_table</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Transformation for a cell&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform_table</span><span class="o">.</span><span class="n">setShowGrid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform_table</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform_table</span><span class="o">.</span><span class="n">setColumnCount</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reDrawTransformTable</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform_table</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_transform_table_itemChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_table</span><span class="p">)</span>
        <span class="c1"># Add the button box</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buttonBox</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Finished:: initialiser&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="TransformWindow.on_transform_table_itemChanged">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.TransformWindow.on_transform_table_itemChanged">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_transform_table_itemChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">item</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle a change to the transform table.</span>

<span class="sd">        The item which has changed is ignored and the whole table is rebuilt</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        item : the item changed</span>
<span class="sd">            The item which has changed</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Modifies</span>
<span class="sd">        --------</span>
<span class="sd">        self.settings[&quot;Transform&quot;]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on_transform_table_itemChanged: &quot;</span><span class="p">,</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transform_as_str</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_table</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;New transform&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_as_str</span><span class="p">)</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="TransformWindow.reDrawTransformTable">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.TransformWindow.reDrawTransformTable">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">reDrawTransformTable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Redraw the 3x3 table representing the cell transformation.</span>

<span class="sd">        The table is generated from the strings stored in self.transform_as_str</span>
<span class="sd">        If a number is stored it is converted to a string.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Modifies</span>
<span class="sd">        --------</span>
<span class="sd">        transform_table</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;reDrawPrimtiveTable: &quot;</span><span class="p">)</span>
        <span class="n">tw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_table</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">tw</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">,</span><span class="n">QTableWidgetItem</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_as_str</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="TransformWindow.getTransform">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html#PDielec.GUI.ViewerTab.TransformWindow.getTransform">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">getTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the primtive transformation matrix.</span>

<span class="sd">        The transformation is stored as a 3x3 list of strings.</span>
<span class="sd">        The strings are treated as python commands to return a value.:w</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        3x3 array of floats</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;getTransform: &quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_as_str</span></div>
</div>

</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, John Kendrick and Andrew Burnett
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../../_static/documentation_options.js?v=0b13d40c"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>