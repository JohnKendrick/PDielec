<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

    <!-- Generated with Sphinx 7.1.2 and Furo 2024.01.29 -->
        <title>PDielec.GUI.FitterTab - PDielec: John Kendrick &amp; Andrew Burnett</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/table_styling.css?v=a1a2a898" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css?v=2e0a580d" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">PDielec: John Kendrick & Andrew Burnett</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  
  <span class="sidebar-brand-text">PDielec: John Kendrick & Andrew Burnett</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Software</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pdgui.html">PDGui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../software.html">Other Software Components</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Theory</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../theory_powder.html">Theory for Light Scattering from Powders</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../theory_single_crystal.html">Theory for Single Crystal Optics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../analysis.html">Phonon Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../application_notes_1.html">Applications of Effective Medium Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../application_notes_2.html">Single Crystal Applications</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../autoapi/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../autoapi/PDielec/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of PDielec</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/PDielec/GUI/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of PDielec.GUI</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/AnalysisTab/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.AnalysisTab</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/App/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.App</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/FitterTab/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.FitterTab</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/MainTab/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.MainTab</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/NoteBook/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.NoteBook</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/OpenGLWidget/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.OpenGLWidget</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/PlottingTab/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.PlottingTab</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/PowderScenarioTab/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.PowderScenarioTab</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/ScenarioTab/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.ScenarioTab</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/SettingsTab/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.SettingsTab</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/SingleCrystalLayer/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.SingleCrystalLayer</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.SingleCrystalScenarioTab</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/SpreadSheetManager/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.SpreadSheetManager</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.ViewerTab</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/AbinitOutputReader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.AbinitOutputReader</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/Calculator/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.Calculator</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/CastepOutputReader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.CastepOutputReader</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/Constants/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.Constants</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/CrystalOutputReader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.CrystalOutputReader</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/DielectricFunction/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.DielectricFunction</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/ExperimentOutputReader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.ExperimentOutputReader</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/GTMcore/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GTMcore</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/GenericOutputReader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GenericOutputReader</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/GulpOutputReader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GulpOutputReader</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/HelperRoutines/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.HelperRoutines</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/IO/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.IO</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/Materials/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.Materials</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/Mie/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.Mie</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/PhonopyOutputReader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.PhonopyOutputReader</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/Plotter/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.Plotter</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/QEOutputReader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.QEOutputReader</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/SuperCell/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.SuperCell</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/UnitCell/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.UnitCell</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/Utilities/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.Utilities</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/VaspOutputReader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.VaspOutputReader</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/checkcsv/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.checkcsv</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/checkexcel/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.checkexcel</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/graphdatagenerator/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.graphdatagenerator</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/p1reader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.p1reader</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/p2cif/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.p2cif</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/pdcompare/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.pdcompare</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/pdgui/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.pdgui</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/pdmake/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.pdmake</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/pickled_reader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.pickled_reader</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/preader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.preader</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/vibanalysis/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.vibanalysis</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/PDielec/pdgui/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.pdgui</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/PDielec/preader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.preader</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/PDielec/pdmake/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.pdmake</span></code></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../zreferences.html">References</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for PDielec.GUI.FitterTab</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf8 -*-</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">FitterTab.py</span>

<span class="sd">The MIT License (MIT)</span>

<span class="sd">Copyright (c) 2024 John Kendrick</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in all</span>
<span class="sd">copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
<span class="sd">SOFTWARE.</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">PDielec.Calculator</span> <span class="k">as</span> <span class="nn">Calculator</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span>    <span class="kn">import</span>  <span class="n">QPushButton</span><span class="p">,</span> <span class="n">QWidget</span><span class="p">,</span> <span class="n">QProgressBar</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span>    <span class="kn">import</span>  <span class="n">QComboBox</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">,</span> <span class="n">QDoubleSpinBox</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span>    <span class="kn">import</span>  <span class="n">QVBoxLayout</span><span class="p">,</span> <span class="n">QHBoxLayout</span><span class="p">,</span> <span class="n">QFormLayout</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span>    <span class="kn">import</span>  <span class="n">QSpinBox</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span>    <span class="kn">import</span>  <span class="n">QFileDialog</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span>    <span class="kn">import</span>  <span class="n">QTableWidgetItem</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span>    <span class="kn">import</span>  <span class="n">QSizePolicy</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span>    <span class="kn">import</span>  <span class="n">QCheckBox</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span>    <span class="kn">import</span>  <span class="n">QTabWidget</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span>       <span class="kn">import</span>  <span class="n">Qt</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span>       <span class="kn">import</span>  <span class="n">QCoreApplication</span>
<span class="kn">from</span> <span class="nn">PDielec.Utilities</span>   <span class="kn">import</span>  <span class="n">Debug</span>
<span class="kn">from</span> <span class="nn">PDielec.GUI.SettingsTab</span> <span class="kn">import</span>  <span class="n">FixedQTableWidget</span>
<span class="c1"># Import plotting requirements</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.figure</span>
<span class="kn">from</span> <span class="nn">matplotlib.backends.backend_qt5agg</span> <span class="kn">import</span> <span class="n">FigureCanvasQTAgg</span> <span class="k">as</span> <span class="n">FigureCanvas</span>
<span class="kn">from</span> <span class="nn">matplotlib.backends.backend_qt5agg</span> <span class="kn">import</span> <span class="n">NavigationToolbar2QT</span> <span class="k">as</span> <span class="n">NavigationToolbar</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>

<div class="viewcode-block" id="FitterTab"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab">[docs]</a><span class="k">class</span> <span class="nc">FitterTab</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class for managing and displaying a spectroscopic fitting interface within a QWidget.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    parent : QWidget</span>
<span class="sd">        The parent QWidget within which this `FitterTab` is contained.</span>
<span class="sd">    debug : bool, optional</span>
<span class="sd">        A flag to activate debug mode which provides additional output for development and troubleshooting. Defaults to False.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This class is designed to provide a user interface for spectral fitting tasks, allowing for adjustments of various fitting parameters and visualization of fitting results. It leverages Qt widgets for the graphical user interface components and matplotlib for plotting.</span>

<span class="sd">    The class initializes with customizable settings related to spectral fitting including file names, fitting types, iterations, scaling factors, and baseline correction options. It supports reading experimental data from .xlsx or .csv files, setting fitting parameters through a dynamically generated form, and presenting the fitting results graphically with options to adjust the view.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    __init__(self, parent, debug=False)</span>
<span class="sd">        Constructor to initialize the spectroscopic fitting interface with the given parent and debug settings.</span>
<span class="sd">    on_iterations_sb_changed(self)</span>
<span class="sd">        Handles changes to the number of iterations spinbox value.</span>
<span class="sd">    on_independent_yaxes_cb_changed(self, value)</span>
<span class="sd">        Handles changes to the independent y-axes checkbox state.</span>
<span class="sd">    on_optimise_frequency_scaling_cb_changed(self, value)</span>
<span class="sd">        Handles changes to the optimise frequency scaling checkbox state.</span>
<span class="sd">    on_spectrum_scaling_cb_changed(self, value)</span>
<span class="sd">        Handles changes to the spectrum scaling checkbox state.</span>
<span class="sd">    on_hpfilter_lambda_sb_changed(self, value)</span>
<span class="sd">        Handles changes to the HP filter lambda spinbox value.</span>
<span class="sd">    on_spectrum_scaling_factor_sb_changed(self, value)</span>
<span class="sd">        Handles changes to the spectrum scaling factor spinbox value.</span>
<span class="sd">    on_baseline_cb_changed(self, value)</span>
<span class="sd">        Handles changes to the baseline correction checkbox state.</span>
<span class="sd">    on_spectral_difference_threshold_sb_changed(self, value)</span>
<span class="sd">        Handles changes to the spectral difference threshold spinbox value.</span>
<span class="sd">    on_frequency_scaling_factor_sb_changed(self, value)</span>
<span class="sd">        Handles changes to the frequency scaling factor spinbox value.</span>
<span class="sd">    replotButton1Clicked(self)</span>
<span class="sd">        Handles the event when the first replot button is clicked.</span>
<span class="sd">    replotButton2Clicked(self)</span>
<span class="sd">        Handles the event when the second replot button with frequency shift is clicked.</span>
<span class="sd">    plot(self, experiment, xs, ys, legends, label)</span>
<span class="sd">        Plots the fitting results with optional experiment data overlay.</span>
<span class="sd">    fittingButtonClicked(self)</span>
<span class="sd">        Initiates the fitting process when the fitting button is clicked.</span>
<span class="sd">    optimiseFit(self)</span>
<span class="sd">        Optimises the fitting parameters.</span>
<span class="sd">    optimiseFunction(self, variables)</span>
<span class="sd">        Function to be optimised during the fitting process.</span>
<span class="sd">    calculateSpectralDifference(self, scaling_factor)</span>
<span class="sd">        Calculates the spectral difference between experimental and calculated spectra.</span>
<span class="sd">    calculateCrossCorrelation(self, scaling_factor)</span>
<span class="sd">        Calculates the cross-correlation between experimental and calculated spectra.</span>
<span class="sd">    redraw_sigmas_tw(self)</span>
<span class="sd">        Redraws the table widget for sigma values based on current settings.</span>
<span class="sd">    on_fitting_type_cb_activated(self, index)</span>
<span class="sd">        Handles changes to the fitting type combo box selection.</span>
<span class="sd">    on_scenario_cb_activated(self, index)</span>
<span class="sd">        Handles selection changes in the scenario combo box.</span>
<span class="sd">    on_spectrafile_le_return(self)</span>
<span class="sd">        Handles actions to take when the spectra file line edit has a return event.</span>
<span class="sd">    is_float(self, element)</span>
<span class="sd">        Tests if the given element can be converted to a float.</span>
<span class="sd">    find_delimiter(self, filename)</span>
<span class="sd">        Finds the delimiter used in a given CSV file.</span>
<span class="sd">    read_experimental_file(self)</span>
<span class="sd">        Reads experimental spectrum data from a specified file.</span>
<span class="sd">    on_spectrafile_le_changed(self, text)</span>
<span class="sd">        Handles changes to the spectra file line edit text.</span>
<span class="sd">    on_sigmas_tw_itemChanged(self, item)</span>
<span class="sd">        Responds to item changes in the sigmas table widget.</span>
<span class="sd">    print_settings(self)</span>
<span class="sd">        Prints the current settings to the debugger.</span>
<span class="sd">    replot(self)</span>
<span class="sd">        Handles the replotting of spectra.</span>
<span class="sd">    refresh(self, force=False)</span>
<span class="sd">        Refreshes the interface based on current settings and data.</span>
<span class="sd">    requestRefresh(self)</span>
<span class="sd">        Requests a refresh of the interface.</span>
<span class="sd">    resample_experimental_spectrum(self)</span>
<span class="sd">        Resamples the experimental spectrum to match the calculated spectrum frequency points.</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the main widget with its components and connect signals to slots.</span>

<span class="sd">        This constructor sets up the UI for a spectral analysis widget, initializing all the GUI components such as buttons, combo boxes, spin boxes, and plotting canvases. It also sets up the initial state for various attributes related to the spectral analysis settings and data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parent : QWidget</span>
<span class="sd">            The parent widget.</span>
<span class="sd">        debug : bool, optional</span>
<span class="sd">            Flag to indicate whether debugging messages should be printed, by default False.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The function initializes a complex UI for spectral analysis, handling settings such as file names for experimental data, fitting types, frequency scaling, and more. It also prepares the UI for user interactions, setting up signals and slots for UI components like buttons, line edits, and combo boxes. Additionally, it initializes data structures for storing spectral data and analysis results.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="nb">super</span><span class="p">(</span><span class="n">QWidget</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">global</span> <span class="n">debugger</span>
        <span class="n">debugger</span> <span class="o">=</span> <span class="n">Debug</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span><span class="s1">&#39;FitterTab:&#39;</span><span class="p">)</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Start:: Initialising&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculationInProgress</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Experimental file name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Plot title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Experimental and Calculated Spectral Comparison&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Fitting type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Minimise x-correlation&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitting_type_definitions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Minimise x-correlation&#39;</span><span class="p">,</span> <span class="s1">&#39;Minimise spectral difference&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Number of iterations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Frequency scaling factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Optimise frequency scaling&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Spectrum scaling&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Spectrum scaling factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Independent y-axes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Spectral difference threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.05</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;HPFilter lambda&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">7.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Baseline removal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Scenario index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">scenarios</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scenario_legends</span> <span class="o">=</span> <span class="p">[</span> <span class="n">scenario</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Legend&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">scenarios</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastButtonPressed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replotButton1Clicked</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_frequency_shift</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xcorr0</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xcorr1</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lag</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">experimental_file_has_been_read</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_cm1</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modes_fitted</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modes_selected</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">experimental_frequencies</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">experimental_spectrum</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resampled_experimental_spectrum</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_units</span> <span class="o">=</span> <span class="s1">&#39;wavenumber&#39;</span>
        <span class="c1"># Create a tab</span>
        <span class="n">vbox</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">QFormLayout</span><span class="p">()</span>
        <span class="c1">#</span>
        <span class="c1"># Ask for the experimental spread sheet</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectrafile_le</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectrafile_le</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;Provide the name of an .xlsx or a .csv file containing the experimental spectrum.</span><span class="se">\n</span><span class="s1">The spreadsheet should have two columns, with at most a one line heading.</span><span class="se">\n</span><span class="s1">The first column contains the frequencies in cm-1.  The second contains the experimental spectrum.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectrafile_le</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Experimental file name&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectrafile_le</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_spectrafile_le_return</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectrafile_le</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_spectrafile_le_changed</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Select the type of fitting we are going to use</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitting_type_cb</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitting_type_cb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;What type of fitting?&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitting_type_cb</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitting_type_definitions</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitting_type_cb</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_fitting_type_cb_activated</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitting_type_cb</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitting_type_definitions</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Fitting type&#39;</span><span class="p">]))</span>
        <span class="c1">#</span>
        <span class="c1"># Select the type of plot we are going to use</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scenario_cb</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scenario_cb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;Which scenario will be used in the fit?&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scenario_cb</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario_legends</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scenario_cb</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_scenario_cb_activated</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scenario_cb</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Scenario index&#39;</span><span class="p">])</span>
        <span class="c1">#</span>
        <span class="c1"># See if we want frequency scaling</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_scaling_factor_sb</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_scaling_factor_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;Frequency scaling factor&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_scaling_factor_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mf">0.000001</span><span class="p">,</span><span class="mf">10000000.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_scaling_factor_sb</span><span class="o">.</span><span class="n">setDecimals</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_scaling_factor_sb</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_scaling_factor_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Frequency scaling factor&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_scaling_factor_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;Set the value for scaling the frequency axis of the calculated spectrum&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_scaling_factor_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_frequency_scaling_factor_sb_changed</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># See if we want base line removal</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseline_cb</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseline_cb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;Apply base line correction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseline_cb</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseline_cb</span><span class="o">.</span><span class="n">setLayoutDirection</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">RightToLeft</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Baseline removal&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">baseline_cb</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">baseline_cb</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseline_cb</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_baseline_cb_changed</span><span class="p">)</span>

        <span class="c1"># Hodrick-Prescott Filter Lambda</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hpfilter_lambda_sb</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hpfilter_lambda_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">10000000.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hpfilter_lambda_sb</span><span class="o">.</span><span class="n">setDecimals</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hpfilter_lambda_sb</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hpfilter_lambda_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;HPFilter lambda&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hpfilter_lambda_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;The Hodrick-Prescott filter lambda value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hpfilter_lambda_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_hpfilter_lambda_sb_changed</span><span class="p">)</span>
        <span class="c1"># Spectral difference threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectral_difference_threshold_sb</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectral_difference_threshold_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mf">0.000001</span><span class="p">,</span><span class="mf">10.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectral_difference_threshold_sb</span><span class="o">.</span><span class="n">setDecimals</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectral_difference_threshold_sb</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectral_difference_threshold_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Spectral difference threshold&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectral_difference_threshold_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;Set the value the spectral difference threshold&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectral_difference_threshold_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_spectral_difference_threshold_sb_changed</span><span class="p">)</span>
        <span class="c1"># Add the number of iterations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iterations_sb</span> <span class="o">=</span> <span class="n">QSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iterations_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">900</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iterations_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Number of iterations&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iterations_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;Set the number of iterations to be used to optimise the cross-correlation coefficient&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iterations_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_iterations_sb_changed</span><span class="p">)</span>
        <span class="c1"># Independent y-axes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">independent_yaxes_cb</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">independent_yaxes_cb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;Check to use indpendent y-axes in the plot&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">independent_yaxes_cb</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">independent_yaxes_cb</span><span class="o">.</span><span class="n">setLayoutDirection</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">RightToLeft</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Independent y-axes&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">independent_yaxes_cb</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">independent_yaxes_cb</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">independent_yaxes_cb</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_independent_yaxes_cb_changed</span><span class="p">)</span>
        <span class="c1"># Optimise frequency scaling?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimise_frequency_scaling_cb</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimise_frequency_scaling_cb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;Use frequency scaling in optimisation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimise_frequency_scaling_cb</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimise_frequency_scaling_cb</span><span class="o">.</span><span class="n">setLayoutDirection</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">RightToLeft</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Optimise frequency scaling&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimise_frequency_scaling_cb</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimise_frequency_scaling_cb</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimise_frequency_scaling_cb</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_optimise_frequency_scaling_cb_changed</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Add a tab widget for the settings ######################################################################################</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settingsTab</span> <span class="o">=</span> <span class="n">QTabWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectrafile_le</span><span class="p">,</span> <span class="s1">&#39;Experimental spectrum&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario_cb</span><span class="p">,</span> <span class="s1">&#39;Scenario&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_scaling_factor_sb</span><span class="p">,</span> <span class="s1">&#39;Frequency scaling factor&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterations_sb</span><span class="p">,</span> <span class="s1">&#39;No. of iterations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">independent_yaxes_cb</span><span class="p">,</span> <span class="s1">&#39;Independent y-axes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitting_type_cb</span><span class="p">,</span> <span class="s1">&#39;Fitting type&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimise_frequency_scaling_cb</span><span class="p">,</span> <span class="s1">&#39;Optimise scaling&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectral_difference_threshold_sb</span><span class="p">,</span> <span class="s1">&#39;Spectral difference threshold&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline_cb</span><span class="p">,</span> <span class="s1">&#39;Baseline removal?&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hpfilter_lambda_sb</span><span class="p">,</span> <span class="s1">&#39;HP Filter Lambda&#39;</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Options:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">label</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">settingsTab</span><span class="p">)</span>
        <span class="c1"># END OF THE SETTINGS TAB #################################################################################################</span>
        <span class="c1"># Add Lorentzian widths table</span>
        <span class="c1"># get initial sigmas from the settings tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_cm1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">sigmas_cm1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modes_selected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">modes_selected</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequencies_cm1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">frequencies_cm1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">intensities</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes_fitted</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes_selected</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modes_selected</span> <span class="o">=</span> <span class="p">[</span> <span class="kc">False</span>  <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes_selected</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_tw</span> <span class="o">=</span> <span class="n">FixedQTableWidget</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span><span class="n">rows</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
        <span class="c1">#jk sizePolicy = QSizePolicy(QSizePolicy.Minimum,QSizePolicy.Minimum)</span>
        <span class="c1">#jk self.sigmas_tw.setSizePolicy(sizePolicy)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_tw</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;Choose the sigmas which will be used in the fitting&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_tw</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_sigmas_tw_itemChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_tw</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sigmas_cm1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_tw</span><span class="o">.</span><span class="n">setColumnCount</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_tw</span><span class="o">.</span><span class="n">setHorizontalHeaderLabels</span><span class="p">([</span><span class="s1">&#39;   Sigma   </span><span class="se">\n</span><span class="s1">(cm-1)&#39;</span><span class="p">,</span> <span class="s1">&#39; Frequency </span><span class="se">\n</span><span class="s1">(cm-1)&#39;</span><span class="p">,</span> <span class="s1">&#39;  Intensity  </span><span class="se">\n</span><span class="s1">(Debye2/Å2/amu)&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redraw_sigmas_tw</span><span class="p">()</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Lorentzian widths:&#39;</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;The Lorentzian widths can be edited here.  If checked they will also be used in the optimisation of the cross-correlation between the experiment and calculated spectra&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">label</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sigmas_tw</span><span class="p">)</span>
        <span class="c1"># Add a replot and recalculate button</span>
        <span class="n">hbox</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replotButton1</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Replot&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replotButton1</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;Recalculate the spectrum with the new sigma values&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replotButton1</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">replotButton1Clicked</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">replotButton1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replotButton2</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Replot with frequency shift&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replotButton2</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;Recalculate the spectrum with the new sigma values, including a shft in the frequencies to maximise the cross-correlation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replotButton2</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">replotButton2Clicked</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">replotButton2</span><span class="p">)</span>
        <span class="c1"># Add a fitting button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fittingButton</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Perform fitting&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fittingButton</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;Attempt to fit the calculated spectrum to the experimental one&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fittingButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fittingButtonClicked</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fittingButton</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">hbox</span><span class="p">)</span>
        <span class="c1"># Add a progress bar</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Calculation progress&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;Show the progress of any calculations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progressbar</span> <span class="o">=</span> <span class="n">QProgressBar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">label</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">progressbar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">progressbars_add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">progressbar</span><span class="p">)</span>
        <span class="c1"># Add output of the cross correlation coefficient</span>
        <span class="n">hbox</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cross_correlation_le</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cross_correlation_le</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cross_correlation_le</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lag_frequency_le</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lag_frequency_le</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lag_frequency_le</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_scaling_le</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_scaling_le</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_scaling_le</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Frequency scaling factor&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rmse_le</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rmse_le</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rmse_le</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cross_correlation_le</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lag_frequency_le</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency_scaling_le</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rmse_le</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;X-correlation, shift/lag, frequency scale and rmse&#39;</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;The highest cross-correlation value and its associated frequency shift is shown followed by the spectral error&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">hbox</span><span class="p">)</span>
        <span class="c1"># Add the matplotlib figure to the bottom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">FigureCanvas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span> <span class="o">=</span> <span class="n">NavigationToolbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">,</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">))</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
        <span class="c1"># finalise the layout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">vbox</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Finished:: Initialising&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="FitterTab.on_iterations_sb_changed"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.on_iterations_sb_changed">[docs]</a>    <span class="k">def</span> <span class="nf">on_iterations_sb_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle changes in the iterations spin box value.</span>

<span class="sd">        This method is called when the iterations spin box value is changed. It updates the &#39;Number of iterations&#39; setting with the new value and flags that a refresh is required.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;on_iterations_sb_changed&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Number of iterations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterations_sb</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="FitterTab.on_independent_yaxes_cb_changed"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.on_independent_yaxes_cb_changed">[docs]</a>    <span class="k">def</span> <span class="nf">on_independent_yaxes_cb_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the change of state for the independent Y-axes checkbox.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : bool</span>
<span class="sd">            The new state of the checkbox. The actual value might not be used in the function but represents the change.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This function is triggered upon the change of the &#39;independent_yaxes_cb&#39; checkbox state. It updates the settings dictionary with the new state of the &#39;Independent y-axes&#39; option and sets the &#39;refreshRequired&#39; flag to True, indicating that a refresh is needed to reflect the changes in the UI or data visualization.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;independent_yaxes_cb_changed&#39;</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Independent y-axes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">independent_yaxes_cb</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="FitterTab.on_optimise_frequency_scaling_cb_changed"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.on_optimise_frequency_scaling_cb_changed">[docs]</a>    <span class="k">def</span> <span class="nf">on_optimise_frequency_scaling_cb_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles changes in the frequency scaling optimization option.</span>

<span class="sd">        This method updates the &#39;Optimise frequency scaling&#39; setting based on the state of a checkbox and marks that a refresh is required based on the new setting.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : bool</span>
<span class="sd">            The value or state that triggered the change. This parameter is logged but not directly used to set the &#39;Optimise frequency scaling&#39; option.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;optimise_frequency_scaling_cb_changed&#39;</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Optimise frequency scaling&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimise_frequency_scaling_cb</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="FitterTab.on_spectrum_scaling_cb_changed"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.on_spectrum_scaling_cb_changed">[docs]</a>    <span class="k">def</span> <span class="nf">on_spectrum_scaling_cb_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the change event of the spectrum scaling checkbox.</span>

<span class="sd">        This method is triggered whenever the spectrum scaling checkbox&#39;s state changes. It updates the settings to reflect the current state of the checkbox and flags that a refresh is required.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : bool</span>
<span class="sd">            The new value of the spectrum scaling checkbox. The specific type and significance can vary depending on the implementation details of the checkbox and its handlers.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;on_spectrum_scaling_cb_changed&#39;</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Spectrum scaling&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrum_scaling_cb</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="FitterTab.on_hpfilter_lambda_sb_changed"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.on_hpfilter_lambda_sb_changed">[docs]</a>    <span class="k">def</span> <span class="nf">on_hpfilter_lambda_sb_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle changes to the high-pass filter lambda scrollbar value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : str</span>
<span class="sd">            The new value from the high-pass filter lambda scrollbar, intended to be converted to float.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;hpfilter_lambda_sb_changed&#39;</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;HPFilter lambda&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Failed to convert to float&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="FitterTab.on_spectrum_scaling_factor_sb_changed"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.on_spectrum_scaling_factor_sb_changed">[docs]</a>    <span class="k">def</span> <span class="nf">on_spectrum_scaling_factor_sb_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the change in spectrum scaling factor.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : str</span>
<span class="sd">            The new value for the spectrum scaling factor. Expected to be convertible to float.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This function attempts to update the &#39;Spectrum scaling factor&#39; setting with the new value after converting it to float. If the conversion fails, a message is printed indicating the failure.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;on_spectrum_scaling_factor_cb_changed&#39;</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Spectrum scaling factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Failed to convert to float&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="FitterTab.on_baseline_cb_changed"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.on_baseline_cb_changed">[docs]</a>    <span class="k">def</span> <span class="nf">on_baseline_cb_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle the change event of the baseline checkbox.</span>

<span class="sd">        This method is called when the baseline checkbox state changes. It updates the setting for baseline removal and marks refresh as required.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : str</span>
<span class="sd">            The new value or state of the baseline checkbox. The actual data type and use of this parameter depend on the specific implementation and could vary.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;on_baseline_cb_changed&#39;</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Baseline removal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseline_cb</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="FitterTab.on_spectral_difference_threshold_sb_changed"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.on_spectral_difference_threshold_sb_changed">[docs]</a>    <span class="k">def</span> <span class="nf">on_spectral_difference_threshold_sb_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle changes in spectral difference threshold setting.</span>

<span class="sd">        This function is called when the &#39;Spectral difference threshold&#39; setting is changed.</span>
<span class="sd">        It updates the setting value, converting it to a float, and sets a flag indicating that a refresh is required.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : str</span>
<span class="sd">            The new value for the &#39;Spectral difference threshold&#39; setting. The function attempts to convert this to a float.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;on_spectral_difference_threshold_sb_changed&#39;</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Spectral difference threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Failed to convert to float&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="FitterTab.on_frequency_scaling_factor_sb_changed"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.on_frequency_scaling_factor_sb_changed">[docs]</a>    <span class="k">def</span> <span class="nf">on_frequency_scaling_factor_sb_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle changes in the frequency scaling factor setting.</span>

<span class="sd">        This function changes the frequency scaling factor setting. It updates the setting with the new value and marks a refresh as necessary. It also handles conversion errors gracefully.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : str</span>
<span class="sd">            The new value for the frequency scaling factor setting. The function attempts to convert this to a float.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - The `self.refreshRequired` flag is set to True regardless of whether the conversion succeeds.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;on_frequency_scaling_factor_cb_changed&#39;</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Frequency scaling factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Failed to convert to float&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="FitterTab.replotButton1Clicked"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.replotButton1Clicked">[docs]</a>    <span class="k">def</span> <span class="nf">replotButton1Clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle the click event on the replot button.</span>

<span class="sd">        This method is triggered when the replot button is clicked. It sets up the necessary flags for the replot operation and invokes the refresh method to update the plot.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This method modifies the instance attributes to reflect that a replot is required without a frequency shift, and it bookmarks the last button pressed as &#39;replotButton1Clicked&#39;. It also calls the `self.refresh` method to initiate the replotting process.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Start:: replotButton1Clicked&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_frequency_shift</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastButtonPressed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replotButton1Clicked</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Finished:: replotButton1Clicked&#39;</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="FitterTab.replotButton2Clicked"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.replotButton2Clicked">[docs]</a>    <span class="k">def</span> <span class="nf">replotButton2Clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle the event when the second replot button is clicked.</span>

<span class="sd">        This method updates various attributes to indicate that a refresh of the plot is required,</span>
<span class="sd">        specifically with a frequency shift. It records that this button was the last one pressed</span>
<span class="sd">        and then initiates the refresh process.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Start:: replotButton2Clicked&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_frequency_shift</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastButtonPressed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replotButton2Clicked</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Finished:: replotButton2Clicked&#39;</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="FitterTab.plot"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">experiment</span><span class="p">,</span><span class="n">xs</span><span class="p">,</span><span class="n">ys</span><span class="p">,</span><span class="n">legends</span><span class="p">,</span><span class="n">label</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot experimental and calculated data on the same or separate y-axes.</span>

<span class="sd">        This method plots provided experimental and calculated data sets using Matplotlib. It supports plotting</span>
<span class="sd">        data with independent y-axes and applying frequency shift and scaling to the x-axis. The plot appearance,</span>
<span class="sd">        including color mapping, line width, and labels, is customizable.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        experiment : array_like</span>
<span class="sd">            The experimental data to be plotted. If empty, no experimental data is plotted.</span>
<span class="sd">        xs : list of array_like</span>
<span class="sd">            A list containing the x-axis data for each data set.</span>
<span class="sd">        ys : list of array_like</span>
<span class="sd">            A list containing the y-axis data for each data set to be plotted alongside the x data.</span>
<span class="sd">        legends : list of str</span>
<span class="sd">            A list containing the labels for each data set.</span>
<span class="sd">        label : str</span>
<span class="sd">            The label for the plot, typically used as a part of y-axis label.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If `xs`, `ys`, and `legends` lists do not have the same length.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="c1"># Plot the experimental values on the left y-axis</span>
        <span class="c1"># Plot all the others in xs, ys on the right x-axis</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Start:: plot&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot1</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;tab10&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_units</span> <span class="o">==</span> <span class="s1">&#39;wavenumber&#39;</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Frequency $\mathdefault{(cm^{-1})}$&#39;</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;THz&#39;</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="mf">0.02998</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Independent y-axes&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subplot2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subplot2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot1</span>
        <span class="n">cmap_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_frequency_shift</span><span class="p">:</span>
            <span class="n">lag</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lag_frequency_le</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">scale_calc</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Frequency scaling factor&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lag</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="c1"># scale_calc = scale</span>
            <span class="n">scale_calc</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Frequency scaling factor&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">legend</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">ys</span><span class="p">,</span><span class="n">legends</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
               <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
               <span class="n">line</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lag</span><span class="o">+</span><span class="n">scale_calc</span><span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">cmap_index</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="n">legend</span> <span class="p">)</span>
               <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
               <span class="n">cmap_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">experiment</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Use the x variables from the previous xs, ys</span>
            <span class="n">line</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subplot2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">scale</span><span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="n">experiment</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">cmap_index</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Experiment&#39;</span> <span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Independent y-axes&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subplot2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Experiment&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subplot2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subplot1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Calculated &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_label</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subplot1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_label</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subplot1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Plot title&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Finished:: plot&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FitterTab.fittingButtonClicked"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.fittingButtonClicked">[docs]</a>    <span class="k">def</span> <span class="nf">fittingButtonClicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the click event on the fitting button.</span>

<span class="sd">        This method toggles the fitting process on and off. When clicked,</span>
<span class="sd">        it changes the button&#39;s text accordingly to reflect the current</span>
<span class="sd">        state - either &quot;Perform fitting&quot; or &quot;Interrupt fitting&quot;. It also</span>
<span class="sd">        triggers re-plotting and refreshes the UI. If the fitting process</span>
<span class="sd">        starts, it performs optimization and then resets the button&#39;s state</span>
<span class="sd">        to allow a new fitting process.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Start:: fittingButtonClicked&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculationInProgress</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fittingButton</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Perform fitting&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculationInProgress</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fittingButton</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Interupt fitting&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculationInProgress</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;replotButton2Clicked&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replot</span><span class="p">()</span>
        <span class="n">final_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimiseFit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fittingButton</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Perform fitting&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculationInProgress</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Finished:: fittingButtonClicked&#39;</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="FitterTab.optimiseFit"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.optimiseFit">[docs]</a>    <span class="k">def</span> <span class="nf">optimiseFit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Optimise the fit of the first scenario to the experimental data</span>
        <span class="c1"># First determine who many variables we have</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Optimise the fit based on the initial and adjusted sigmas and potential frequency scaling.</span>

<span class="sd">        Instructions for determining the best fitting parameters for the model are conducted</span>
<span class="sd">        within the constraints of predefined modes. The function iterates to minimize the discrepancy</span>
<span class="sd">        between modeled and experimental data. It employs the Nelder-Mead optimization method for</span>
<span class="sd">        solving the problem.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list or OptimizeResult</span>
<span class="sd">            The final optimization point as a list if no sigma has been selected for optimisation,</span>
<span class="sd">            or as an `OptimizeResult` object returned by `scipy.optimize.minimize`. The return type</span>
<span class="sd">            depends on whether the optimization process is executed.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The function uses several attributes of the class instance it belongs to:</span>
<span class="sd">        - `modes_fitted` to determine which modes are fitted.</span>
<span class="sd">        - `sigmas_cm1` as initial sigma points for optimization.</span>
<span class="sd">        - `settings` to check if frequency scaling should be optimised and to determine the number of iterations for the optimization.</span>
<span class="sd">        - `optimiseFunction` as the function to be minimized.</span>

<span class="sd">        It modifies the `functionCalls` attribute by setting it to 0 at the beginning and uses</span>
<span class="sd">        `fit_list` to store the indexes of modes that are being fitted.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Start:: optimiseFit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">functionCalls</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">mode</span><span class="p">,</span><span class="n">fitted</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes_fitted</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">fitted</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fit_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
        <span class="n">initial_point</span> <span class="o">=</span> <span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_cm1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_list</span> <span class="p">]</span>
        <span class="c1"># Append a scaling option</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Optimise frequency scaling&#39;</span><span class="p">]:</span>
            <span class="n">initial_point</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Frequency scaling factor&#39;</span><span class="p">])</span>
        <span class="n">nvariables</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">initial_point</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nvariables</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">final_point</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimiseFunction</span><span class="p">,</span> <span class="n">initial_point</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nelder-mead&#39;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;xatol&#39;</span><span class="p">:</span><span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;disp&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;maxfev&#39;</span><span class="p">:</span><span class="n">nvariables</span><span class="o">+</span><span class="n">nvariables</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Number of iterations&#39;</span><span class="p">]}</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No sigmas have been selected for optimisation&#39;</span><span class="p">)</span>
            <span class="n">final_point</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Finished:: optimiseFit&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">final_point</span></div>

<div class="viewcode-block" id="FitterTab.optimiseFunction"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.optimiseFunction">[docs]</a>    <span class="k">def</span> <span class="nf">optimiseFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">variables</span><span class="p">)</span> <span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Optimise the fitting function based on given variables.</span>

<span class="sd">        This method adjusts internal settings based on an array of variables to</span>
<span class="sd">        optimise the fitting function according to the predefined criteria</span>
<span class="sd">        (e.g., minimize cross-correlation or spectral difference). It updates</span>
<span class="sd">        GUI components and recalculates the function value based on the new</span>
<span class="sd">        configuration.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        variables : list or array-like</span>
<span class="sd">            The variables used for optimization. This could include sigma values</span>
<span class="sd">            for each element to be fitted and optionally a scaling factor for</span>
<span class="sd">            frequency scaling, depending on the configuration.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The function value after optimization, which is either the negative</span>
<span class="sd">            cross-correlation or the root mean square error (RMSE), based on the</span>
<span class="sd">            fitting type setting.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - `calculationInProgress` is a boolean attribute of the</span>
<span class="sd">          object that indicates whether a calculation can proceed.</span>
<span class="sd">        - Manipulates GUI components such as `fittingButton` and elements within</span>
<span class="sd">          `notebook.settingsTab`, thus requires the GUI to be in a responsive state.</span>
<span class="sd">        - Uses global `debugger` object for logging progress and results.</span>
<span class="sd">        - The method updates the internal state of the object, such as the</span>
<span class="sd">          `functionCalls` counter and sigma values for elements being fitted.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        Exception</span>
<span class="sd">            If the calculation is not in progress (indicated by</span>
<span class="sd">            `calculationInProgress` being `False`), it immediately returns a</span>
<span class="sd">            predefined extremely negative value (e.g., -9.9e+99).</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculationInProgress</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mf">9.9E99</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Start:: optimiseFunction&#39;</span><span class="p">,</span><span class="n">variables</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">functionCalls</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">nvariables</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fittingButton</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Interrupt fitting (</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">functionCalls</span><span class="p">,</span><span class="n">nvariables</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">nvariables</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Number of iterations&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Optimise frequency scaling&#39;</span><span class="p">]:</span>
            <span class="n">sigmas</span> <span class="o">=</span> <span class="n">variables</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">scaling_factor</span> <span class="o">=</span> <span class="n">variables</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Frequency scaling factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaling_factor</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sigmas</span> <span class="o">=</span> <span class="n">variables</span>
            <span class="n">scaling_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Frequency scaling factor&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">sigma</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_list</span><span class="p">,</span><span class="n">sigmas</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_cm1</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redraw_sigmas_tw</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">sigmas_cm1</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">redraw_output_tw</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">requestRefresh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replot</span><span class="p">()</span>
        <span class="c1"># Returning the best correlation but made negative because we need to minimise</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Fitting type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Minimise x-correlation&#39;</span><span class="p">:</span>
            <span class="n">function_value</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xcorr0</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Fitting type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Minimise spectral difference&#39;</span><span class="p">:</span>
            <span class="n">function_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmse</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;optimiseFunction - xcorr0,rmse&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">xcorr0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">rmse</span><span class="p">)</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Finished:: optimiseFunction&#39;</span><span class="p">,</span><span class="n">function_value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">function_value</span></div>

<div class="viewcode-block" id="FitterTab.calculateSpectralDifference"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.calculateSpectralDifference">[docs]</a>    <span class="k">def</span> <span class="nf">calculateSpectralDifference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">scaling_factor</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the root mean square error (RMSE) between a resampled experimental spectrum and a calculated spectrum after applying a scaling factor.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        scaling_factor : float</span>
<span class="sd">            The factor by which to scale the experimental spectrum before comparing with the calculated spectrum.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The root mean square error between the resampled experimental spectrum and the scaled calculated spectrum.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - This method modifies the spectra by scaling, normalization, and thresholding before calculating the RMSE.</span>
<span class="sd">        - If the resampled experimental spectrum is empty, the method returns 0.0 immediately.</span>
<span class="sd">        - The method assumes that `self.resampled_experimental_spectrum` and `self.calculated_spectrum` are accessible and properly formatted.</span>
<span class="sd">        - Assumes `self.settings[&#39;Spectral difference threshold&#39;]` is defined and accessible, and is used to filter out values below this threshold.</span>
<span class="sd">        - Uses cubic interpolation for scaling the calculated spectrum.</span>
<span class="sd">        - Normalization is performed based on the maximum value in the experimental spectrum.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        - This function implicitly depends on the correctness of external variables and the environment (e.g., `self.resampled_experimental_spectrum`, `self.calculated_spectrum`, `self.settings`, and `self.xaxis`). Errors related to these dependencies are not explicitly handled by this function.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;calculateSpectralDifference&#39;</span><span class="p">,</span><span class="n">scaling_factor</span><span class="p">)</span>
        <span class="c1"># Calculate the spectral difference  between the experimental and the first scenario</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resampled_experimental_spectrum</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Start:: optimiseFunction&#39;</span><span class="p">)</span>
        <span class="c1"># col1 contains the resampled_experimental spectrum</span>
        <span class="n">col1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resampled_experimental_spectrum</span><span class="p">)</span>
        <span class="n">maxcol1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">col1</span><span class="p">)</span>
        <span class="n">col1</span> <span class="o">=</span> <span class="n">col1</span> <span class="o">/</span> <span class="n">maxcol1</span>
        <span class="n">col1</span><span class="p">[</span> <span class="n">col1</span><span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Spectral difference threshold&#39;</span><span class="p">]</span> <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="c1">#        for i,val in enumerate(col1):</span>
<span class="c1">#            if val &lt; self.settings[&#39;Spectral difference threshold&#39;]:</span>
<span class="c1">#                col1[i] = 0.0</span>
        <span class="c1"># col2 contains the calculated spectrum</span>
        <span class="n">col2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calculated_spectrum</span><span class="p">)</span>
        <span class="c1"># The new xaxis for the calculated spectrum is scaling_factor*xaxis</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">scaling_factor</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xaxis</span><span class="p">),</span> <span class="n">col2</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">,</span><span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
        <span class="n">col2</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xaxis</span><span class="p">)</span>
        <span class="n">col2</span> <span class="o">=</span> <span class="n">col2</span> <span class="o">/</span> <span class="n">maxcol1</span>
        <span class="n">col1</span><span class="p">[</span> <span class="n">col1</span><span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Spectral difference threshold&#39;</span><span class="p">]</span> <span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">col1</span> <span class="o">-</span> <span class="n">col2</span>
        <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span><span class="n">diff</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">col2</span><span class="p">))</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;rmse&#39;</span><span class="p">,</span><span class="n">rmse</span><span class="p">)</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Finished:: optimiseFunction&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rmse</span></div>

<div class="viewcode-block" id="FitterTab.calculateCrossCorrelation"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.calculateCrossCorrelation">[docs]</a>    <span class="k">def</span> <span class="nf">calculateCrossCorrelation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">scaling_factor</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the cross-correlation between the experimental spectrum and a calculated spectrum, with an applied scaling factor.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        scaling_factor : float</span>
<span class="sd">            The factor by which the x-axis of the calculated spectrum is scaled.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple</span>
<span class="sd">            A tuple containing:</span>
<span class="sd">            - lag: The lag at which the maximum correlation occurs.</span>
<span class="sd">            - max_corr: The maximum correlation value.</span>
<span class="sd">            - center_corr: The correlation value at the center (zero lag).</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The calculated spectrum&#39;s x-axis is rescaled according to the `scaling_factor`. The correlation is performed on the normalized (zero-mean unit-variance) spectra. Interpolation of the calculated spectrum onto the experimental spectrum&#39;s x-axis is performed using cubic interpolation.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Start:: calculateCrossCorrelation&#39;</span><span class="p">,</span><span class="n">scaling_factor</span><span class="p">)</span>
        <span class="c1"># Calculate the cross correlation coefficient between the experimental and the first scenario</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resampled_experimental_spectrum</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;calculateCrossCorrelation resampled_experimental_spectrum is not defined&#39;</span><span class="p">)</span>
            <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Finshed:: calculateCrossCorrelation&#39;</span><span class="p">,</span><span class="n">scaling_factor</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="c1"># col1 contains the experimental spectrum</span>
        <span class="n">col1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resampled_experimental_spectrum</span><span class="p">)</span>
        <span class="n">col1</span> <span class="o">=</span> <span class="p">(</span> <span class="n">col1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">col1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">col1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col1</span><span class="p">))</span> <span class="p">)</span>
        <span class="c1"># col2 contains the calculated spectrum</span>
        <span class="n">col2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calculated_spectrum</span><span class="p">)</span>
        <span class="c1"># The new xaxis for the calculated spectrum is scaling_factor*xaxis</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">scaling_factor</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xaxis</span><span class="p">),</span> <span class="n">col2</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">,</span><span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
        <span class="n">col2</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xaxis</span><span class="p">)</span>
        <span class="n">col2</span> <span class="o">=</span> <span class="p">(</span> <span class="n">col2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">col2</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">col2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col2</span><span class="p">))</span> <span class="p">)</span>
        <span class="n">correlation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">,</span>  <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">)</span>
        <span class="n">lag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">correlation</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">correlation</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">lag</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xaxis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">xaxis</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">lag</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;lag , max(corr), index&#39;</span><span class="p">,</span> <span class="n">lag</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">correlation</span><span class="p">),</span><span class="n">correlation</span><span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">correlation</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)])</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Finshed:: calculateCrossCorrelation&#39;</span><span class="p">,</span><span class="n">scaling_factor</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">lag</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">correlation</span><span class="p">),</span><span class="n">correlation</span><span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">correlation</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)])</span></div>


<div class="viewcode-block" id="FitterTab.redraw_sigmas_tw"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.redraw_sigmas_tw">[docs]</a>    <span class="k">def</span> <span class="nf">redraw_sigmas_tw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Redraw the table widget for sigmas.</span>

<span class="sd">        This method updates the table widget `sigmas_tw` used for displaying sigma, frequency, and intensity</span>
<span class="sd">        information. It checks if the data lists (`sigmas_cm1`, `frequencies_cm1`, and `intensities`) are non-empty</span>
<span class="sd">        and then proceeds to populate the table. Each row in the table corresponds to a unique sigma, frequency,</span>
<span class="sd">        and intensity value. The method also handles item selection and editing properties based on the state of</span>
<span class="sd">        `modes_selected` and `modes_fitted` attributes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - `sigmas_cm1`, `frequencies_cm1`, and `intensities` are lists that store sigma, frequency, and intensity data, respectively.</span>
<span class="sd">        - `modes_selected` and `modes_fitted` are lists that store boolean values indicating whether a mode is selected and</span>
<span class="sd">          whether it is fitted, respectively.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Start:: redraw_sigmas_tw&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sigmas_cm1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Finished:: redraw_sigmas_tw&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_tw</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_tw</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sigmas_cm1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">f</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">intensity</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies_cm1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_cm1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span><span class="p">)):</span>
            <span class="c1"># Sigma and check / unchecked column</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">itemFlags</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">QTableWidgetItem</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes_selected</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes_fitted</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
                <span class="n">itemFlags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">item</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">Qt</span><span class="o">.</span><span class="n">NoItemFlags</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsUserCheckable</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsSelectable</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEditable</span> <span class="p">)</span>
                <span class="n">otherFlags</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">Qt</span><span class="o">.</span><span class="n">NoItemFlags</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#itemFlags.append( item.flags() | Qt.ItemIsUserCheckable | Qt.ItemIsEnabled &amp; ~Qt.ItemIsSelectable &amp; ~Qt.ItemIsEditable )</span>
                <span class="n">itemFlags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">item</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">Qt</span><span class="o">.</span><span class="n">NoItemFlags</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsUserCheckable</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span> <span class="p">)</span>
                <span class="n">item</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
                <span class="n">otherFlags</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">flags</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">Qt</span><span class="o">.</span><span class="n">NoItemFlags</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="c1"># Frequency column cm-1</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">itemFlags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">otherFlags</span> <span class="p">)</span>
            <span class="c1"># Intensity column Debye2/Angs2/amu</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QTableWidgetItem</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">intensity</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">itemFlags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">otherFlags</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,(</span><span class="n">item</span><span class="p">,</span><span class="n">flag</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">items</span><span class="p">,</span><span class="n">itemFlags</span><span class="p">)):</span>
                <span class="n">item</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
                <span class="n">item</span><span class="o">.</span><span class="n">setTextAlignment</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignHCenter</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">AlignVCenter</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_tw</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">item</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_tw</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>
        <span class="c1"># Release the block on signals for the frequency output table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_tw</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Finished:: redraw_sigmas_tw&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FitterTab.on_fitting_type_cb_activated"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.on_fitting_type_cb_activated">[docs]</a>    <span class="k">def</span> <span class="nf">on_fitting_type_cb_activated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="p">):</span>
        <span class="c1"># Change in fitting type</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle the activation of a fitting type option.</span>

<span class="sd">        This method updates the current settings to reflect the selected fitting type based on the provided index. It also marks the state as requiring a refresh.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int</span>
<span class="sd">            The index of the selected fitting type in the fitting type definitions list.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;on_fitting_type_cb_activated&#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Fitting type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitting_type_definitions</span><span class="p">[</span><span class="n">index</span><span class="p">]</span></div>

<div class="viewcode-block" id="FitterTab.on_scenario_cb_activated"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.on_scenario_cb_activated">[docs]</a>    <span class="k">def</span> <span class="nf">on_scenario_cb_activated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="p">):</span>
        <span class="c1"># Change in Scenario to be used for fitting</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle scenario combobox activation.</span>

<span class="sd">        This function is triggered when a scenario combobox option is selected. It logs the activation with the selected index, marks that a refresh is required, and updates the settings to reflect the new scenario.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int</span>
<span class="sd">            The index of the activated scenario.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;on_scenario_cb_activated&#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Scenario index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span></div>

<div class="viewcode-block" id="FitterTab.on_spectrafile_le_return"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.on_spectrafile_le_return">[docs]</a>    <span class="k">def</span> <span class="nf">on_spectrafile_le_return</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Handle a return in the experimental file name line editor</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle file selection for experimental spectra.</span>

<span class="sd">        This method is executed when an action associated with the `spectrafile_le` widget is performed. It prompts the user to select a file if the currently specified file does not exist or cannot be found. It updates the application&#39;s settings with the new file name, if a file is selected.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The method first checks if the file specified in the `spectrafile_le` widget exists. If it does not, a file dialog is opened for the user to select a file. If a file is selected, the method updates the application&#39;s settings and the text of the `spectrafile_le` widget to reflect the new file name. Additionally, it sets a flag indicating that a refresh is required and that the experimental file needs to be read again. Finally, it triggers the last button pressed action.</span>

<span class="sd">        This method utilizes `os.path.isfile` to check file existence, `QFileDialog` for file selection. </span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Start:: on_spectrafile_le_return&#39;</span><span class="p">)</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrafile_le</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
            <span class="n">qfd</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">qfd</span><span class="o">.</span><span class="n">setDirectory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">mainTab</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
            <span class="n">file_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">qfd</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Open the experimental file&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;Excel (*.xlsx);; Csv (*.csv);; All Files (*)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
            <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Finished:: on_spectrafile_le_return&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Experimental file name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectrafile_le</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Experimental file name&#39;</span><span class="p">])</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;new file name&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Experimental file name&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">experimental_file_has_been_read</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># redo the plot if a return is pressed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastButtonPressed</span><span class="p">()</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Finished:: on_spectrafile_le_return&#39;</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="FitterTab.is_float"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.is_float">[docs]</a>    <span class="k">def</span> <span class="nf">is_float</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test to see if element is a float.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        element : Any</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if the element is a float, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#If you expect None to be passed:</span>
        <span class="k">if</span> <span class="n">element</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="FitterTab.find_delimiter"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.find_delimiter">[docs]</a>    <span class="k">def</span> <span class="nf">find_delimiter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the delimiter used in a CSV file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            The path to the file for which the delimiter is to be determined.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The detected delimiter character.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This function uses the `csv.Sniffer` class to deduce the delimiter of</span>
<span class="sd">        the given file by analyzing the first 5000 bytes of the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="kn">import</span> <span class="nn">csv</span>
        <span class="n">sniffer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">Sniffer</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">delimiter</span> <span class="o">=</span> <span class="n">sniffer</span><span class="o">.</span><span class="n">sniff</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">5000</span><span class="p">))</span><span class="o">.</span><span class="n">delimiter</span>
        <span class="k">return</span> <span class="n">delimiter</span></div>

<div class="viewcode-block" id="FitterTab.read_experimental_file"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.read_experimental_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_experimental_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read an experimental file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self.experimental_frequencies</span>
<span class="sd">        self.experimental_spectrum</span>
<span class="sd">        &quot;&quot;&quot;</span> 
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Start:: read_experimental_file&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Experimental file name&#39;</span><span class="p">])</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Experimental file name&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
            <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Finished:: read_experimental_file does not exist&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Experimental file name&#39;</span><span class="p">])</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">experimental_file_has_been_read</span><span class="p">:</span>
            <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Finished:: read_experimental_file has been read&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">experimental_frequencies</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">experimental_spectrum</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">file_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">):</span>
            <span class="c1"># Read in a csv file, discard alphanumerics</span>
            <span class="kn">import</span> <span class="nn">csv</span>
            <span class="n">delimiter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_delimiter</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
                <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Reading csv file::&#39;</span><span class="p">)</span>
                <span class="n">csv_reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">csv_reader</span><span class="p">:</span>
                   <span class="c1"># attempt to convert string to float</span>
                   <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">experimental_frequencies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">experimental_spectrum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Read in a xlsx file, discard alphanumerics</span>
            <span class="kn">from</span> <span class="nn">openpyxl</span> <span class="kn">import</span> <span class="n">load_workbook</span>
            <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Reading xlsx file::&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wb</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Experimental file name&#39;</span><span class="p">],</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wb</span><span class="o">.</span><span class="n">worksheets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">experimental_frequencies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">experimental_spectrum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">experimental_file_has_been_read</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Finished:: read_experimental_file&#39;</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="FitterTab.on_spectrafile_le_changed"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.on_spectrafile_le_changed">[docs]</a>    <span class="k">def</span> <span class="nf">on_spectrafile_le_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle changes to the spectra file input field.</span>

<span class="sd">        This method is triggered when the text of the spectrum file input field changes. It updates the &#39;Experimental file name&#39; setting with the new text, marks the current experimental file as unread, and indicates that a refresh is required.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        text : str</span>
<span class="sd">            The new text from the spectra file input field. Not directly used after method update.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The actual text used in processing is fetched directly from the `spectrafile_le` attribute, not from the `text` argument.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;on_spectrafile_le_changed&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrafile_le</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Experimental file name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">experimental_file_has_been_read</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="FitterTab.on_sigmas_tw_itemChanged"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.on_sigmas_tw_itemChanged">[docs]</a>    <span class="k">def</span> <span class="nf">on_sigmas_tw_itemChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle item changed event in a table widget for sigma values.</span>

<span class="sd">        This method updates mode fitting status and sigma values based on changes in a table widget,</span>
<span class="sd">        redraws the table widget, and refreshes output based on the modifications. It also handles error</span>
<span class="sd">        for invalid numeric input for sigma values. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        item : QTableWidgetItem</span>
<span class="sd">            The table widget item that has been changed.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Side Effects</span>
<span class="sd">        ------------</span>
<span class="sd">        - Updates internal data structures storing mode fitting statuses and sigma values.</span>
<span class="sd">        - Triggers UI update methods to reflect changes in the table widget and other dependent UI components.</span>
<span class="sd">        - Blocks and unblocks signals from the table widget to prevent recursive item change events during updates.</span>
<span class="sd">        - Processes all pending events for the application to ensure UI updates are immediately applied.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Start:: on_sigmas_tw_itemChanged&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_tw</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;on_sigmas_tw_itemChanged)&#39;</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">row</span><span class="p">(),</span> <span class="n">item</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="p">)</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">column</span><span class="p">()</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">row</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># If this is the first column alter the check status but reset the sigma value</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">modes_fitted</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">modes_fitted</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">new_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_cm1</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_value</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">redraw_sigmas_tw</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">sigmas_cm1</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_value</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">requestRefresh</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">redraw_output_tw</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                 <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Failed to convert to float&#39;</span><span class="p">,</span><span class="n">item</span><span class="o">.</span><span class="n">txt</span><span class="p">())</span>
        <span class="k">elif</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redraw_sigmas_tw</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redraw_sigmas_tw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Finished:: on_sigmas_tw_itemChanged&#39;</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="FitterTab.print_settings"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.print_settings">[docs]</a>    <span class="k">def</span> <span class="nf">print_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints the settings attributes of the instance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Prints the key and value of each setting in the instance&#39;s `settings` attribute, with the help of the `debugger` print method.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;print_settings&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">:</span>
            <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="FitterTab.replot"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.replot">[docs]</a>    <span class="k">def</span> <span class="nf">replot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replots the experimental spectrum along with calculated frequencies and spectra.</span>

<span class="sd">        This method will initially check if there is a resampled experimental spectrum. If such a spectrum exists, the spectrum is resampled. Subsequently, it calls the plot method with the updated data along with other related information such as legends and labels.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Start:: replot&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resampled_experimental_spectrum</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resample_experimental_spectrum</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resampled_experimental_spectrum</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">calculated_frequencies</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">calculated_spectra</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario_legends</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_label</span><span class="p">)</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Finished:: replot&#39;</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="FitterTab.refresh"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.refresh">[docs]</a>    <span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Refreshes the state of the application based on user-defined conditions and settings.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        force : bool, optional</span>
<span class="sd">            If True, the refresh proceeds regardless of whether it is deemed necessary based on the internal state. Defaults to False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The refresh process involves several key steps including checking if a refresh is required, updating plotting data from settings, reading an experimental file, setting GUI components based on notebook scenarios, and recalculating spectra. If the refresh is aborted either due to being unnecessary or because there are no frequencies, it returns early. Additionally, if `force` is True, it ignores the check for whether a refresh is required and proceeds with the refresh.</span>

<span class="sd">        After updating relevant class attributes and GUI components, the function recalculates cross-correlation, root-mean-square error (RMSE) between experimental and calculated spectra, and updates the display with these metrics.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Start:: refresh&#39;</span><span class="p">,</span> <span class="n">force</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
            <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;refresh aborted&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span><span class="p">,</span><span class="n">force</span><span class="p">)</span>
            <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Finished:: refresh&#39;</span><span class="p">,</span> <span class="n">force</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequencies_cm1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">frequencies_cm1</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies_cm1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0E-10</span><span class="p">:</span>
            <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;refresh aborted there are no frequencies&#39;</span><span class="p">)</span>
            <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Finished:: refresh&#39;</span><span class="p">,</span> <span class="n">force</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1">#</span>
        <span class="c1"># Flag all the scenarios as needing an update</span>
        <span class="c1">#</span>
        <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">scenarios</span><span class="p">:</span>
            <span class="n">scenario</span><span class="o">.</span><span class="n">requestRefresh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">requestRefresh</span><span class="p">()</span>
        <span class="c1">#</span>
        <span class="c1"># Now refresh the plotting tab </span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">plottingTab</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="c1">#</span>
        <span class="c1"># Block signals during refresh</span>
        <span class="c1"># </span>
        <span class="c1">#for w in self.findChildren(QWidget):</span>
        <span class="c1">#    w.blockSignals(True)</span>
        <span class="c1"># </span>
        <span class="c1"># use the settings values to initialise the widgets</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectrafile_le</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Experimental file name&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_experimental_file</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">plottingTab</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Plot type&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scenario_legends</span> <span class="o">=</span> <span class="p">[</span> <span class="n">scenario</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Legend&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">scenarios</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scenario_cb</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scenario_cb</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario_legends</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scenario_cb</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Scenario index&#39;</span><span class="p">])</span>
        <span class="n">vs_cm1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">plottingTab</span><span class="o">.</span><span class="n">vs_cm1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculated_spectra</span> <span class="o">=</span> <span class="p">[</span> <span class="n">scenario</span><span class="o">.</span><span class="n">get_result</span><span class="p">(</span><span class="n">vs_cm1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_label</span><span class="p">)</span> <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">scenarios</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculated_spectrum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculated_spectra</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Scenario index&#39;</span><span class="p">]]</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;refresh scenario index&#39;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Scenario index&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iterations_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Number of iterations&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_scaling_factor_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Frequency scaling factor&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Independent y-axes&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">independent_yaxes_cb</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">independent_yaxes_cb</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
        <span class="c1"># </span>
        <span class="c1"># If the sigmas are not set return</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigmas_cm1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">sigmas_cm1</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sigmas_cm1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modes_selected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">modes_selected</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intensities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">intensities</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes_fitted</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modes_selected</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modes_fitted</span> <span class="o">=</span> <span class="p">[</span> <span class="kc">False</span>  <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes_selected</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redraw_sigmas_tw</span><span class="p">()</span>
        <span class="c1"># Resample the spectrum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculated_frequencies</span> <span class="o">=</span> <span class="p">[</span> <span class="n">vs_cm1</span> <span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">scenarios</span> <span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">experimental_spectrum</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resample_experimental_spectrum</span><span class="p">()</span>
        <span class="n">scaling_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Frequency scaling factor&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lag</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">xcorr0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">xcorr1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculateCrossCorrelation</span><span class="p">(</span><span class="n">scaling_factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rmse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculateSpectralDifference</span><span class="p">(</span><span class="n">scaling_factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cross_correlation_le</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:6.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xcorr0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lag_frequency_le</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:8.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lag</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_scaling_le</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:8.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Frequency scaling factor&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rmse_le</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:.2e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rmse</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replot</span><span class="p">()</span>
        <span class="c1">#</span>
        <span class="c1"># Unblock signals after refresh</span>
        <span class="c1"># </span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">findChildren</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
            <span class="n">w</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Finished:: refresh&#39;</span><span class="p">,</span> <span class="n">force</span><span class="p">)</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="FitterTab.requestRefresh"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.requestRefresh">[docs]</a>    <span class="k">def</span> <span class="nf">requestRefresh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Request a refresh of the interface.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Start:: requestRefresh&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Finished:: requestRefresh&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FitterTab.resample_experimental_spectrum"><a class="viewcode-back" href="../../../autoapi/PDielec/GUI/FitterTab/index.html#PDielec.GUI.FitterTab.FitterTab.resample_experimental_spectrum">[docs]</a>    <span class="k">def</span> <span class="nf">resample_experimental_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1">#</span>
    <span class="c1">#  The experimental spectrum needs to be in the same range as the calculated spectrum</span>
    <span class="c1">#  It also needs to be calculated at the same frequencies as the calculated spectrum</span>
    <span class="c1">#</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resample the experimental spectrum to match calculated frequencies and optionally apply baseline removal.</span>

<span class="sd">        This method modifies the experimental spectrum to align with the calculated </span>
<span class="sd">        frequencies. It pads the spectrum at both ends with zeros outside the calculated</span>
<span class="sd">        frequencies range, then uses cubic interpolation over the whole range. </span>
<span class="sd">        If the &#39;Baseline removal&#39; setting is enabled, applies the Hodrick-Prescott filter </span>
<span class="sd">        for baseline removal on the resampled spectrum.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None </span>
<span class="sd">        - self.experimental_frequencies : array_like (The original frequency values of the experimental spectrum.)</span>
<span class="sd">        - self.experimental_spectrum : array_like (The original intensity values of the experimental spectrum.)</span>
<span class="sd">        - self.calculated_frequencies : array_like (The frequency values of the calculated spectrum.)</span>
<span class="sd">        - self.settings : dict (A dictionary of settings, which may include keys for &#39;Baseline removal&#39; and &#39;HPFilter lambda&#39;.)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Modifies the instance&#39;s resampled_experimental_spectrum in place.</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Start:: Resample_experimental_spectrum&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xaxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calculated_frequencies</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># If the experimental frequencies starts at a higher frequency </span>
        <span class="c1"># than the calculated frequencies then add new frequencies to pad the range out</span>
        <span class="c1">#indices = np.where (self.xaxis &lt; self.experimental_frequencies[0])</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xaxis</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">experimental_frequencies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">padded_xaxis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xaxis</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
        <span class="n">padded_yaxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span> <span class="k">if</span> <span class="n">index</span> <span class="p">])</span>
        <span class="c1"># Add the experimental frequencies</span>
        <span class="n">padded_xaxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">padded_xaxis</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">experimental_frequencies</span><span class="p">)</span>
        <span class="n">padded_yaxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">padded_yaxis</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">experimental_spectrum</span><span class="p">)</span>
        <span class="c1"># If the experimental frequencies ends at a lower frequency </span>
        <span class="c1"># than the calculated frequencies then add new frequencies to pad the range out</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xaxis</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">experimental_frequencies</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">padded_xaxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">padded_xaxis</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">xaxis</span><span class="p">[</span><span class="n">indices</span><span class="p">])</span>
        <span class="n">padded_yaxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">padded_yaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span> <span class="k">if</span> <span class="n">index</span> <span class="p">])</span> <span class="p">)</span>
        <span class="c1"># </span>
        <span class="c1"># Create a function using the padded frequencies to calculate the spectrum at the calculated frequencies</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">padded_xaxis</span><span class="p">,</span> <span class="n">padded_yaxis</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">,</span><span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
        <span class="c1"># Store the experimental spectrum at the calculated frequencies</span>
        <span class="n">resampled_experimental_spectrum</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xaxis</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Baseline removal&#39;</span><span class="p">]:</span>
            <span class="c1"># Apply a Hodrick-Prescott filter to remove the background</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resampled_experimental_spectrum</span> <span class="o">=</span> <span class="n">Calculator</span><span class="o">.</span><span class="n">hodrick_prescott_filter</span><span class="p">(</span>
                                          <span class="n">resampled_experimental_spectrum</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;HPFilter lambda&#39;</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resampled_experimental_spectrum</span> <span class="o">=</span> <span class="n">resampled_experimental_spectrum</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Finished:: Resample_experimental_spectrum&#39;</span><span class="p">)</span>
        <span class="k">return</span></div></div>

</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, John Kendrick and Andrew Burnett
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=01b4f342"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../../_static/scripts/furo.js?v=32e29ea5"></script>
    </body>
</html>