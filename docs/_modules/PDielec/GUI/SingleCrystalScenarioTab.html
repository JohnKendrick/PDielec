<!doctype html>
<html class="no-js" lang="en" data-content_root="../../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

    <!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>PDielec.GUI.SingleCrystalScenarioTab - PDielec: John Kendrick &amp; Andrew Burnett</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../../../_static/table_styling.css?v=a1a2a898" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css?v=2e0a580d" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">PDielec: John Kendrick & Andrew Burnett</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  
  <span class="sidebar-brand-text">PDielec: John Kendrick & Andrew Burnett</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Software</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pdgui.html">PDGui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../software.html">Other Software Components</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Theory</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../theory_powder.html">Theory for Light Scattering from Powders</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../theory_single_crystal.html">Theory for Single Crystal Optics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../analysis.html">Phonon Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../application_notes_1.html">Applications of Effective Medium Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../application_notes_2.html">Single Crystal Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../application_notes_3.html">Phonopy Examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../autoapi/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../autoapi/PDielec/index.html">PDielec</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of PDielec</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/AbinitOutputReader/index.html">PDielec.AbinitOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/Calculator/index.html">PDielec.Calculator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/CastepOutputReader/index.html">PDielec.CastepOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/Constants/index.html">PDielec.Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/CrystalOutputReader/index.html">PDielec.CrystalOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/DielectricFunction/index.html">PDielec.DielectricFunction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/ExperimentOutputReader/index.html">PDielec.ExperimentOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/GTMcore/index.html">PDielec.GTMcore</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../autoapi/PDielec/GUI/index.html">PDielec.GUI</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of PDielec.GUI</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/AnalysisTab/index.html">PDielec.GUI.AnalysisTab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/App/index.html">PDielec.GUI.App</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/FitterTab/index.html">PDielec.GUI.FitterTab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/MainTab/index.html">PDielec.GUI.MainTab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/NoteBook/index.html">PDielec.GUI.NoteBook</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/OpenGLWidget/index.html">PDielec.GUI.OpenGLWidget</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/PlottingTab/index.html">PDielec.GUI.PlottingTab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/PowderScenarioTab/index.html">PDielec.GUI.PowderScenarioTab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/ScenarioTab/index.html">PDielec.GUI.ScenarioTab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/SettingsTab/index.html">PDielec.GUI.SettingsTab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/SingleCrystalLayer/index.html">PDielec.GUI.SingleCrystalLayer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html">PDielec.GUI.SingleCrystalScenarioTab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/SpreadSheetManager/index.html">PDielec.GUI.SpreadSheetManager</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/PDielec/GUI/ViewerTab/index.html">PDielec.GUI.ViewerTab</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/GenericOutputReader/index.html">PDielec.GenericOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/GulpOutputReader/index.html">PDielec.GulpOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/HelperRoutines/index.html">PDielec.HelperRoutines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/IO/index.html">PDielec.IO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/Materials/index.html">PDielec.Materials</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/Mie/index.html">PDielec.Mie</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/PhonopyOutputReader/index.html">PDielec.PhonopyOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/Plotter/index.html">PDielec.Plotter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/PrimitiveCell/index.html">PDielec.PrimitiveCell</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/QEOutputReader/index.html">PDielec.QEOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/SuperCell/index.html">PDielec.SuperCell</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/UnitCell/index.html">PDielec.UnitCell</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/Utilities/index.html">PDielec.Utilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/VaspOutputReader/index.html">PDielec.VaspOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/checkcsv/index.html">PDielec.checkcsv</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/checkexcel/index.html">PDielec.checkexcel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/graphdatagenerator/index.html">PDielec.graphdatagenerator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/p1reader/index.html">PDielec.p1reader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/p2cif/index.html">PDielec.p2cif</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/pdcompare/index.html">PDielec.pdcompare</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/pdgui/index.html">PDielec.pdgui</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/pdmake/index.html">PDielec.pdmake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/phonopy_pdielec_born/index.html">PDielec.phonopy_pdielec_born</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/pickled_reader/index.html">PDielec.pickled_reader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/preader/index.html">PDielec.preader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/PDielec/vibanalysis/index.html">PDielec.vibanalysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/PDielec/pdgui/index.html">PDielec.pdgui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/PDielec/preader/index.html">PDielec.preader</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/PDielec/pdmake/index.html">PDielec.pdmake</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../zreferences.html">References</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>Source code for PDielec.GUI.SingleCrystalScenarioTab</h1><div class="highlight"><pre>
<span></span><span class="c1">#</span>
<span class="c1"># Copyright 2024 John Kendrick &amp; Andrew Burnett</span>
<span class="c1">#</span>
<span class="c1"># This file is part of PDielec</span>
<span class="c1">#</span>
<span class="c1"># This program is free software; you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the MIT License</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the MIT License along with this program, if not see https://opensource.org/licenses/MIT</span>
<span class="c1">#</span>
<span class="sd">&quot;&quot;&quot;SingleCrystalScenarioTab module.&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">product</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qtpy.QtCore</span><span class="w"> </span><span class="kn">import</span> <span class="n">QCoreApplication</span><span class="p">,</span> <span class="n">QSize</span><span class="p">,</span> <span class="n">Qt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">qtpy.QtWidgets</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">QApplication</span><span class="p">,</span>
    <span class="n">QComboBox</span><span class="p">,</span>
    <span class="n">QDoubleSpinBox</span><span class="p">,</span>
    <span class="n">QFormLayout</span><span class="p">,</span>
    <span class="n">QFrame</span><span class="p">,</span>
    <span class="n">QHBoxLayout</span><span class="p">,</span>
    <span class="n">QHeaderView</span><span class="p">,</span>
    <span class="n">QLabel</span><span class="p">,</span>
    <span class="n">QLineEdit</span><span class="p">,</span>
    <span class="n">QMessageBox</span><span class="p">,</span>
    <span class="n">QPushButton</span><span class="p">,</span>
    <span class="n">QSizePolicy</span><span class="p">,</span>
    <span class="n">QSpacerItem</span><span class="p">,</span>
    <span class="n">QSpinBox</span><span class="p">,</span>
    <span class="n">QStyle</span><span class="p">,</span>
    <span class="n">QTableWidget</span><span class="p">,</span>
    <span class="n">QVBoxLayout</span><span class="p">,</span>
    <span class="n">QWidget</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">signal</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">PDielec.GTMcore</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">GTM</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PDielec</span><span class="w"> </span><span class="kn">import</span> <span class="n">Materials</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PDielec.Constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">speed_light_si</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PDielec.GUI.ScenarioTab</span><span class="w"> </span><span class="kn">import</span> <span class="n">ScenarioTab</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PDielec.GUI.SingleCrystalLayer</span><span class="w"> </span><span class="kn">import</span> <span class="n">ShowLayerWindow</span><span class="p">,</span> <span class="n">SingleCrystalLayer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PDielec.Materials</span><span class="w"> </span><span class="kn">import</span> <span class="n">MaterialsDataBase</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PDielec.Utilities</span><span class="w"> </span><span class="kn">import</span> <span class="n">Debug</span>

<span class="n">thickness_conversion_factors</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ang&quot;</span><span class="p">:</span><span class="mf">1.0E-10</span><span class="p">,</span> <span class="s2">&quot;nm&quot;</span><span class="p">:</span><span class="mf">1.0E-9</span><span class="p">,</span> <span class="s2">&quot;um&quot;</span><span class="p">:</span><span class="mf">1.0E-6</span><span class="p">,</span> <span class="s2">&quot;mm&quot;</span><span class="p">:</span><span class="mf">1.0E-3</span><span class="p">,</span> <span class="s2">&quot;cm&quot;</span><span class="p">:</span><span class="mf">1.0E-2</span><span class="p">}</span>
<span class="n">thickness_units</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">thickness_conversion_factors</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="c1"># incoherentOptions = [&#39;Coherent&#39;,&#39;Incoherent (intensity)&#39;,&#39;Incoherent (phase cancelling)&#39;,&#39;Incoherent (phase averaging)&#39;,&#39;Incoherent (non-reflective)&#39;] </span>
<span class="n">incoherentOptions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Coherent&quot;</span><span class="p">,</span><span class="s2">&quot;Incoherent (intensity)&quot;</span><span class="p">,</span><span class="s2">&quot;Incoherent (phase averaging)&quot;</span><span class="p">,</span><span class="s2">&quot;Incoherent (non-reflective)&quot;</span><span class="p">]</span> 
<span class="n">gtmMethods</span> <span class="o">=</span><span class="p">{</span><span class="s2">&quot;Coherent&quot;</span><span class="p">:</span><span class="n">GTM</span><span class="o">.</span><span class="n">CoherentLayer</span><span class="p">,</span>
             <span class="s2">&quot;Incoherent (intensity)&quot;</span><span class="p">:</span><span class="n">GTM</span><span class="o">.</span><span class="n">IncoherentIntensityLayer</span><span class="p">,</span>
             <span class="s2">&quot;Incoherent (phase cancelling)&quot;</span><span class="p">:</span><span class="n">GTM</span><span class="o">.</span><span class="n">IncoherentPhaseLayer</span><span class="p">,</span>
             <span class="s2">&quot;Incoherent (phase averaging)&quot;</span><span class="p">:</span><span class="n">GTM</span><span class="o">.</span><span class="n">IncoherentAveragePhaseLayer</span><span class="p">,</span>
             <span class="s2">&quot;Incoherent (non-reflective)&quot;</span><span class="p">:</span><span class="n">GTM</span><span class="o">.</span><span class="n">IncoherentThickLayer</span><span class="p">}</span> 

<div class="viewcode-block" id="solve_single_crystal_equations">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.solve_single_crystal_equations">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">solve_single_crystal_equations</span><span class="p">(</span> 
        <span class="n">layers</span>                        <span class="p">,</span>
        <span class="n">mode</span>                          <span class="p">,</span>
        <span class="n">theta</span>                         <span class="p">,</span>
        <span class="n">phi</span>                           <span class="p">,</span>
        <span class="n">psi</span>                           <span class="p">,</span>
        <span class="n">angleOfIncidence</span>              <span class="p">,</span>
        <span class="n">exponent_threshold</span>            <span class="p">,</span>
        <span class="n">v</span>                             <span class="p">,</span>
        <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Solve single crystal equations, system is a GTM system.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    layers : list</span>
<span class="sd">        A list of material layers (their permittivity functions).</span>
<span class="sd">    mode : {&#39;Transfer matrix&#39;, &#39;Scattering matrix&#39;}</span>
<span class="sd">        The mode of calculation.</span>
<span class="sd">    theta : float</span>
<span class="sd">        The theta angle of the slab.</span>
<span class="sd">    phi : float</span>
<span class="sd">        The phi angle of the slab.</span>
<span class="sd">    psi : float</span>
<span class="sd">        The psi angle of the slab.</span>
<span class="sd">    angleOfIncidence : float</span>
<span class="sd">        The angle of incidence.</span>
<span class="sd">    exponent_threshold : float</span>
<span class="sd">        The largest exponent allowed in the calculation of the propagation matrix.</span>
<span class="sd">    v : float</span>
<span class="sd">        The frequency of the light in cm^-1.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        A tuple of :</span>
<span class="sd">            - v                 : the frequency</span>
<span class="sd">            - r                 : the reflectance coefficients</span>
<span class="sd">            - R                 : the reflectance </span>
<span class="sd">            - t                 : the transmittance coefficients</span>
<span class="sd">            - T                 : the transmittance </span>
<span class="sd">            - epsilon           : the DFT permittivity</span>
<span class="sd">            - errors            : a list of errors</span>
<span class="sd">            - largest_exponent  : the largest exponent</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create superstrate from the first layer</span>
    <span class="n">superstrate</span>      <span class="o">=</span> <span class="n">GTM</span><span class="o">.</span><span class="n">SemiInfiniteLayer</span><span class="p">(</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">exponent_threshold</span><span class="o">=</span><span class="n">exponent_threshold</span><span class="p">)</span>
    <span class="c1"># Create substrate from the last layer</span>
    <span class="n">substrate</span>        <span class="o">=</span> <span class="n">GTM</span><span class="o">.</span><span class="n">SemiInfiniteLayer</span><span class="p">(</span><span class="n">layers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">exponent_threshold</span><span class="o">=</span><span class="n">exponent_threshold</span><span class="p">)</span>
    <span class="n">selectedLayers</span> <span class="o">=</span> <span class="n">layers</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">gtmLayers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Create layers from all the layers between first and last</span>
    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">selectedLayers</span><span class="p">:</span>
        <span class="n">incoherentOption</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">getIncoherentOption</span><span class="p">()</span>
        <span class="n">gtmLayers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gtmMethods</span><span class="p">[</span><span class="n">incoherentOption</span><span class="p">](</span><span class="n">layer</span><span class="p">,</span> <span class="n">exponent_threshold</span><span class="o">=</span><span class="n">exponent_threshold</span><span class="p">))</span>
    <span class="c1"># Creat the system with the layers </span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;Scattering matrix&quot;</span><span class="p">:</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">GTM</span><span class="o">.</span><span class="n">ScatteringMatrixSystem</span><span class="p">(</span><span class="n">substrate</span><span class="o">=</span><span class="n">substrate</span><span class="p">,</span> <span class="n">superstrate</span><span class="o">=</span><span class="n">superstrate</span><span class="p">,</span> <span class="n">layers</span><span class="o">=</span><span class="n">gtmLayers</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">GTM</span><span class="o">.</span><span class="n">TransferMatrixSystem</span><span class="p">(</span><span class="n">substrate</span><span class="o">=</span><span class="n">substrate</span><span class="p">,</span> <span class="n">superstrate</span><span class="o">=</span><span class="n">superstrate</span><span class="p">,</span> <span class="n">layers</span><span class="o">=</span><span class="n">gtmLayers</span><span class="p">)</span>
    <span class="c1"># Rotate the dielectric constants to the laboratory frame</span>
    <span class="c1"># This is a global rotation of all the layers.</span>
    <span class="n">system</span><span class="o">.</span><span class="n">substrate</span><span class="o">.</span><span class="n">set_euler</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">psi</span><span class="p">)</span>
    <span class="n">system</span><span class="o">.</span><span class="n">superstrate</span><span class="o">.</span><span class="n">set_euler</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">psi</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">system</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">set_euler</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">psi</span><span class="p">)</span>
    <span class="c1"># </span>
    <span class="c1"># convert cm-1 to frequency</span>
    <span class="c1">#</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="n">speed_light_si</span> <span class="o">*</span> <span class="mf">1e2</span>
    <span class="n">system</span><span class="o">.</span><span class="n">initialize_sys</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
    <span class="n">zeta_sys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angleOfIncidence</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">superstrate</span><span class="o">.</span><span class="n">epsilon</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">system</span><span class="o">.</span><span class="n">calculate_GammaStar</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">zeta_sys</span><span class="p">)</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">calculate_r_t</span><span class="p">(</span><span class="n">zeta_sys</span><span class="p">)</span>
    <span class="n">epsilon</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">epsilon</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">layers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">system</span><span class="o">.</span><span class="n">substrate</span><span class="o">.</span><span class="n">epsilon</span>
    <span class="n">errors</span><span class="p">,</span><span class="n">largest_exponent</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">overflowErrors</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">v</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">epsilon</span><span class="p">,</span><span class="n">errors</span><span class="p">,</span><span class="n">largest_exponent</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SingleCrystalScenarioTab</span><span class="p">(</span><span class="n">ScenarioTab</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A tab class for handling a single crystal scenario.</span>

<span class="sd">    This class extends a generic scenario tab (:class:`~PDielec.GUI.ScenarioTab.ScenarioTab`) with functionalities specific to handling single crystal scenarios, including setting up the scenario environment, defining the crystal orientation, layer information, and calculation modes (e.g., using Transfer Matrix or Scattering Matrix methods). It supports incoherence effects through partial incoherence simulations and provides tools for fine-tuning simulation parameters such as incidence angles, layer materials, thicknesses, and orientations.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parent : QWidget</span>
<span class="sd">        The parent widget (typically a main window or a larger container) to which this tab will belong.</span>
<span class="sd">    debug : bool, optional</span>
<span class="sd">        A flag to indicate whether debugging information should be printed to the console. Default is False.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    refreshRequired : bool</span>
<span class="sd">        Flag indicating whether the widget&#39;s data needs to be refreshed.</span>
<span class="sd">    calculationRequired : bool</span>
<span class="sd">        Flag indicating whether a new calculation is required based on changes in parameters or settings.</span>
<span class="sd">    scenarioType : str</span>
<span class="sd">        A string representing the type of scenario. For this class, it is set to &#39;Single crystal&#39;.</span>
<span class="sd">    refreshRequired : bool</span>
<span class="sd">        Indicates whether the scenario settings have been changed and thus require the scenario to be redrawn or recalculated.</span>
<span class="sd">    noCalculationsRequired : int</span>
<span class="sd">        The number of calculations required for the simulation. This value may change depending on the specifics of the scenario configuration (e.g., the inclusion of incoherent effects requiring multiple sample calculations).</span>
<span class="sd">    settings : dict</span>
<span class="sd">        A dictionary holding various scenario parameters and their values, which include settings for the type of analysis, material layers, angles, and method-specific parameters.</span>
<span class="sd">    materialNames : list</span>
<span class="sd">        A list of names for materials that can be used in the scenario layers.</span>
<span class="sd">    p_reflectance, s_reflectance, p_transmittance, s_transmittance, p_absorbtance, s_absorbtance : list</span>
<span class="sd">        Lists holding computed values for reflectance, transmittance, and absorbance for both P and S polarization modes.</span>
<span class="sd">    epsilon : list</span>
<span class="sd">        A list of dielectric function values computed during simulation.</span>
<span class="sd">    layers : list</span>
<span class="sd">        A list of layer configurations used in the simulation, each containing information about the material, thickness, orientation, and other layer-specific properties.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    There are several methods within the class for handling events (e.g., button clicks, combo box activations), performing calculations, redrawing tables, and managing layer settings. These include methods for adding, deleting, or altering layers; opening material databases; changing simulation settings; calculating and displaying results; and initializing the user interface components relevant to the single crystal scenario.</span>

<span class="sd">    angleOfIncidenceWidget</span>
<span class="sd">        Create a widget to set the angle of incidence</span>
<span class="sd">    average_incoherent_calculator</span>
<span class="sd">        Calculates the incoherent light reflectance and transmittance</span>
<span class="sd">    calculate</span>
<span class="sd">        Perform the calculations as define in the GUI</span>
<span class="sd">    coherent_calculator</span>
<span class="sd">        Calculate the coherent light reflectance and transmittance</span>
<span class="sd">    createToolBar</span>
<span class="sd">         Create the tool bar used for the material layer</span>
<span class="sd">    createToolBarDeleteButton</span>
<span class="sd">         Create the delete button in the tool bar</span>
<span class="sd">    createToolBarMoveDownButton</span>
<span class="sd">         Create the move down button in the tool bar</span>
<span class="sd">    createToolBarMoveUpButton</span>
<span class="sd">         Create the move up button in the tool bar</span>
<span class="sd">    deleteLayer</span>
<span class="sd">         Delete a layer from the list of layers</span>
<span class="sd">    drawLayerTable</span>
<span class="sd">         Draw the layer table widget, each layer has a line in the table</span>
<span class="sd">    generateLayerSettings</span>
<span class="sd">         Generate the settings dictionary with an item for each layer</span>
<span class="sd">    getDielectricLayerIndex</span>
<span class="sd">         Get the index of the dielectric layer</span>
<span class="sd">    getMaterialFromDataBase</span>
<span class="sd">         Get a material from the database, or define the material from the given permittivity</span>
<span class="sd">    get_result</span>
<span class="sd">         Return the request information</span>
<span class="sd">    get_results</span>
<span class="sd">         Calculate all the reflectance, transmittance and absorptance information</span>
<span class="sd">    globalAzimuthalWidget</span>
<span class="sd">         Set the global azimuthal angle</span>
<span class="sd">    greyed_out</span>
<span class="sd">         Grey out menu items according to the GUI settings</span>
<span class="sd">    moveLayerDown</span>
<span class="sd">         Move a layer up the layer table</span>
<span class="sd">    moveLayerUp</span>
<span class="sd">         Move a layer down the layer table</span>
<span class="sd">    newLayerWidget</span>
<span class="sd">         Create a combox widget for adding a new layer</span>
<span class="sd">    on_angle_of_incidence_sb_changed</span>
<span class="sd">         Handle a change to the angle of incidence spin box</span>
<span class="sd">    on_azimuthal_angle_sb_changed</span>
<span class="sd">         Handle a change to the azimuthal spin box</span>
<span class="sd">    on_film_thickness_sb_changed</span>
<span class="sd">         Handle a change to the film thickness spin box</span>
<span class="sd">    on_global_azimuthal_angle_sb_changed</span>
<span class="sd">         Handle a change to the global azimuthal angle spin box</span>
<span class="sd">    on_hkl_sb_changed</span>
<span class="sd">         Handle a change to the h,k or l spin boxes</span>
<span class="sd">    on_layerTable_itemChanged</span>
<span class="sd">         Handle a change to an item in the layer table</span>
<span class="sd">    on_layer_button_clicked</span>
<span class="sd">         Handle a click on a layer name</span>
<span class="sd">    on_mode_cb_activated</span>
<span class="sd">         Handle a click on the mode combobox</span>
<span class="sd">    on_newLayer_cb_activated</span>
<span class="sd">         Handle a click on the new combobox</span>
<span class="sd">    on_option_cb_activated</span>
<span class="sd">         Handle a change to the incoherent option comobox</span>
<span class="sd">    on_partially_incoherent_kernel_sb_changed</span>
<span class="sd">         Handle a change to the incoherent kernel spinbox</span>
<span class="sd">    on_partially_incoherent_polynomial_sb_changed</span>
<span class="sd">         Handle a change to the length of incoherent polynomial spinbox</span>
<span class="sd">    on_partially_incoherent_samples_sb_changed</span>
<span class="sd">         Handle a change to the number of samples in the averaged incoherent method</span>
<span class="sd">    on_percentage_partial_incoherence_sb_changed</span>
<span class="sd">         Handle a change to the maximum percentage incoherence</span>
<span class="sd">    on_print_button_clicked</span>
<span class="sd">         Handle a print button click</span>
<span class="sd">    on_thickness_units_cb_activated</span>
<span class="sd">         Activate the thickness units combobox</span>
<span class="sd">    openDB_button_clicked</span>
<span class="sd">         Handle a click on the opend database button</span>
<span class="sd">    partialIncoherenceWidget</span>
<span class="sd">         Create a partialIncoherence widget</span>
<span class="sd">    partially_incoherent_calculator</span>
<span class="sd">         Calculate incoherent light scattering using a partially incoherent method</span>
<span class="sd">    printLayerSettings</span>
<span class="sd">         Print out the layer settings dictionary</span>
<span class="sd">    redrawLayerTable</span>
<span class="sd">         Redraw the layer table</span>
<span class="sd">    redrawLayerTableRow</span>
<span class="sd">         Redraw a row of the layer table</span>
<span class="sd">    refresh</span>
<span class="sd">         Perform a refresh of the GUI</span>
<span class="sd">    setMaterialNames</span>
<span class="sd">         Read the material names from the database</span>
<span class="sd">    set_noCalculationsRequired</span>
<span class="sd">         Calculate the number of calculations required</span>
<span class="sd">    settings2Layers</span>
<span class="sd">         Read the settings dictionary and create the necessary layers</span>
<span class="sd">    smoothingWidget</span>
<span class="sd">         A widget to handle the smoothing information</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span> <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the Single Crystal Scenario Tab.</span>

<span class="sd">        This initializer sets up the GUI components, populates settings with default values, </span>
<span class="sd">        and prepares the tab for interaction. It inherits from a parent scenario, initializes</span>
<span class="sd">        a debug mode if required, and sets various default parameters for the single crystal </span>
<span class="sd">        scenario, including layer information and calculation modes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parent : QWidget</span>
<span class="sd">            The parent widget or window, typically the main application window or a central widget</span>
<span class="sd">            that this tab will be a part of.</span>
<span class="sd">        debug : bool, optional</span>
<span class="sd">            A boolean flag to indicate whether debug messages should be printed to the console</span>
<span class="sd">            or log. Defaults to False if not specified.</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        refreshRequired : bool</span>
<span class="sd">            Indicates if the view needs refreshing.</span>
<span class="sd">        calculationRequired : bool</span>
<span class="sd">            Indicates if a new calculation is required based on changed parameters.</span>
<span class="sd">        scenarioType : str</span>
<span class="sd">            The type of scenario, hardcoded as &#39;Single crystal&#39;.</span>
<span class="sd">        noCalculationsRequired : int</span>
<span class="sd">            Number of calculations required, initialized to 1.</span>
<span class="sd">        settings : dict</span>
<span class="sd">            A dictionary of settings for the simulation, initialized with default values.</span>
<span class="sd">        materialNames : list</span>
<span class="sd">            List of material names used in the layers.</span>
<span class="sd">        p_reflectance, s_reflectance, p_transmittance, s_transmittance, p_absorbtance, s_absorbtance : list</span>
<span class="sd">            Lists for storing calculations results.</span>
<span class="sd">        epsilon : list</span>
<span class="sd">            List for storing dielectric constants.</span>
<span class="sd">        layers : list</span>
<span class="sd">            List containing layer information.</span>
<span class="sd">        notebook : QWidget</span>
<span class="sd">            Reference to the parent notebook or main application window.</span>
<span class="sd">        reader : Object</span>
<span class="sd">            Reference to an object capable of reading input data (e.g., unit cells, materials).</span>
<span class="sd">        cell : Object or None</span>
<span class="sd">            The last read unit cell, if any.</span>
<span class="sd">        exponent_threshold : int</span>
<span class="sd">            Threshold for exponent values in calculations, initialized to 11000.</span>
<span class="sd">        DataBase : MaterialsDataBase</span>
<span class="sd">            Reference to a materials database object.</span>
<span class="sd">        number_of_average_incoherent_layers : int</span>
<span class="sd">            Counter for the average incoherent layers, initialized to 0.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The initializer also connects UI elements with corresponding event handlers, sets up</span>
<span class="sd">        a QVBoxLayout for the tab, and adds UI components systematically to form a structured </span>
<span class="sd">        layout for the user interface.</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">ScenarioTab</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">global</span> <span class="n">debugger</span>
        <span class="n">debugger</span> <span class="o">=</span> <span class="n">Debug</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span><span class="s2">&quot;SingleCrystalScenarioTab:&quot;</span><span class="p">)</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Start:: initialiser&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculationRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scenarioType</span> <span class="o">=</span> <span class="s2">&quot;Single crystal&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noCalculationsRequired</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Scenario type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Single crystal&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Global azimuthal angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Angle of incidence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Transfer matrix&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Scattering matrix&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Frequency units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;wavenumber&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Partially incoherent samples&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Percentage partial incoherence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Filter kernel size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Filter polynomial size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="c1"># Define a default superstrate/dielectric/substrate system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer material names&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;air&quot;</span><span class="p">,</span>     <span class="s2">&quot;Dielectric layer&quot;</span><span class="p">,</span><span class="s2">&quot;air&quot;</span>     <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer hkls&quot;</span><span class="p">]</span>               <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>  <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>           <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>   <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer azimuthals&quot;</span><span class="p">]</span>         <span class="o">=</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>         <span class="mi">0</span><span class="p">,</span>                 <span class="mi">0</span>        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer thicknesses&quot;</span><span class="p">]</span>        <span class="o">=</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span>         <span class="mi">1</span><span class="p">,</span>                 <span class="mi">1</span>        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer thickness units&quot;</span><span class="p">]</span>    <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;um&quot;</span><span class="p">,</span>      <span class="s2">&quot;um&quot;</span><span class="p">,</span>              <span class="s2">&quot;um&quot;</span>      <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer incoherent options&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Coherent&quot;</span><span class="p">,</span><span class="s2">&quot;Coherent&quot;</span><span class="p">,</span>        <span class="s2">&quot;Coherent&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer dielectric flags&quot;</span><span class="p">]</span>   <span class="o">=</span> <span class="p">[</span> <span class="kc">False</span><span class="p">,</span>     <span class="kc">True</span><span class="p">,</span>              <span class="kc">False</span>    <span class="p">]</span>
        <span class="c1"># The maximum allowed thickness of a layer in metres</span>
        <span class="c1"># used to subdivide thicker films into many thinner films</span>
        <span class="c1"># if zero no subdivision is performed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Percentage average incoherence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Number of average incoherence samples&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_average_incoherent_layers</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materialNames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_reflectance</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s_reflectance</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_transmittance</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s_transmittance</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_absorbtance</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s_absorbtance</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># store the notebook</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="c1"># get the reader from the main tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">mainTab</span><span class="o">.</span><span class="n">reader</span>
        <span class="c1"># Get the last unit cell in the reader</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">get_unit_cell</span><span class="p">()</span>
        <span class="c1"># Set the exponent threshold to be used by GTM</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exponent_threshold</span> <span class="o">=</span> <span class="mi">11000</span>    
        <span class="c1"># Open the database and get the material names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DataBase</span> <span class="o">=</span> <span class="n">MaterialsDataBase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Materials database&quot;</span><span class="p">],</span><span class="n">debug</span><span class="o">=</span><span class="n">debugger</span><span class="o">.</span><span class="n">state</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Materials database&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DataBase</span><span class="o">.</span><span class="n">getFileName</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materialNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setMaterialNames</span><span class="p">()</span>
        <span class="c1"># Create the layers - superstrate / dielectric / substrate from the defaults layer settings</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings2Layers</span><span class="p">()</span>
        <span class="c1"># Create last tab - SingleCrystalTab</span>
        <span class="n">vbox</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">form</span> <span class="o">=</span> <span class="n">QFormLayout</span><span class="p">()</span>
        <span class="c1">#</span>
        <span class="c1"># Option to open a database of permittivities for the support</span>
        <span class="c1"># label and button are defined the parent class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">openDB_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">openDB_button</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Add a name for the database</span>
        <span class="c1"># label and button are defined the parent class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database_le_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_le</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Chose mode of operation</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_cb</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_cb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Set the method for calculating light transmission and reflectanceb;</span><span class="se">\n</span><span class="s2"> Transfer matrix.  This method is fast but can be numerically unstable.</span><span class="se">\n</span><span class="s2"> Scattering matrix. This method is slow but is numerically stable&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_cb</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span> <span class="p">[</span><span class="s2">&quot;Transfer matrix&quot;</span><span class="p">,</span><span class="s2">&quot;Scattering matrix&quot;</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_cb</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">],</span> <span class="n">Qt</span><span class="o">.</span><span class="n">MatchFixedString</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_cb</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_cb</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_mode_cb_activated</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Single crystal methodology&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Set the method for calculating light transmission and reflectanceb;</span><span class="se">\n</span><span class="s2"> Transfer matrix.  This method is fast but can be numerically unstable.</span><span class="se">\n</span><span class="s2"> Scattering matrix. This method is slow but is numerically stable&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_cb</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Define the global azimuthal angle widget</span>
        <span class="c1">#</span>
        <span class="n">label</span><span class="p">,</span><span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">globalAzimuthalWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">layout</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Define the angle of incidence widget</span>
        <span class="c1">#</span>
        <span class="n">label</span><span class="p">,</span> <span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angleOfIncidenceWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">label</span><span class="p">,</span><span class="n">layout</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Layer information widget</span>
        <span class="c1">#</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Layer information&quot;</span><span class="p">)</span>
        <span class="n">line</span>  <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
        <span class="n">line</span><span class="o">.</span><span class="n">setFrameShape</span><span class="p">(</span><span class="n">QFrame</span><span class="o">.</span><span class="n">HLine</span><span class="p">)</span>
        <span class="n">hbox</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignVCenter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">label</span><span class="p">,</span><span class="n">hbox</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">drawLayerTable</span><span class="p">())</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;    &quot;</span><span class="p">)</span>
        <span class="n">line</span>  <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
        <span class="n">line</span><span class="o">.</span><span class="n">setFrameShape</span><span class="p">(</span><span class="n">QFrame</span><span class="o">.</span><span class="n">HLine</span><span class="p">)</span>
        <span class="n">hbox</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignVCenter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">label</span><span class="p">,</span><span class="n">hbox</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Partial incoherence widget</span>
        <span class="c1">#</span>
        <span class="n">label</span><span class="p">,</span><span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partialIncoherenceWidget</span><span class="p">()</span>
        <span class="c1">#jk self.form.addRow(label, layout)</span>
        <span class="c1">#</span>
        <span class="c1"># Smoothing widget</span>
        <span class="c1">#</span>
        <span class="n">label</span><span class="p">,</span><span class="n">layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smoothingWidget</span><span class="p">()</span>
        <span class="c1">#jk self.form.addRow(label, layout)</span>
        <span class="c1">#</span>
        <span class="c1"># Add a legend option</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">legend_le</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">legend_le</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;The legend will be used to describe the results in the plot&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">legend_le</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">legend_le</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_legend_le_changed</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Scenario legend&quot;</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;The legend will be used to describe the results in the plot&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">legend_le</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="c1"># Final buttons for changing/deleting and switching the scenarios</span>
        <span class="c1">#</span>
        <span class="n">hbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_scenario_buttons</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">addRow</span><span class="p">(</span><span class="n">hbox</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Spacer item to soak up space</span>
        <span class="c1">#</span>
        <span class="n">verticalSpacer</span> <span class="o">=</span> <span class="n">QSpacerItem</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Minimum</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">verticalSpacer</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>
        <span class="c1"># finalise the layout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">vbox</span><span class="p">)</span>
        <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Finished:: initialiser&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="SingleCrystalScenarioTab.redrawLayerTable">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.redrawLayerTable">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">redrawLayerTable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Redraw the layer table widget.</span>

<span class="sd">        Adds a row for each layer in the gadget.</span>
<span class="sd">        The row is drawn using redrawLayerTableRow()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layerTable_tw</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rowCount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">sequenceNumber</span><span class="p">,</span><span class="n">layer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">):</span>
            <span class="n">rowCount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">firstLayer</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">lastLayer</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">layer</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">firstLayer</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">layer</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">lastLayer</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layerTable_tw</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">rowCount</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redrawLayerTableRow</span><span class="p">(</span><span class="n">sequenceNumber</span><span class="p">,</span><span class="n">layer</span><span class="p">,</span><span class="n">rowCount</span><span class="p">,</span><span class="n">firstLayer</span><span class="p">,</span><span class="n">lastLayer</span><span class="p">)</span>
        <span class="c1"># Add a &#39;create new layer&#39; button</span>
        <span class="n">rowCount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">newLayer_cb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">newLayerWidget</span><span class="p">()</span>
        <span class="n">newLayer_cb</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;Text-align:left&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layerTable_tw</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="n">rowCount</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layerTable_tw</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">rowCount</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">newLayer_cb</span><span class="p">)</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.redrawLayerTableRow">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.redrawLayerTableRow">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">redrawLayerTableRow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sequenceNumber</span><span class="p">,</span><span class="n">layer</span><span class="p">,</span><span class="n">rowCount</span><span class="p">,</span><span class="n">firstLayer</span><span class="p">,</span><span class="n">lastLayer</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw a row of the layer table.</span>

<span class="sd">        Each row has a material name, a thickness (and unit), an h, k, l option and a toolbar</span>
<span class="sd">        to move or delete the layer in the list.</span>
<span class="sd">        Needed a separate routine for this as there are problems with the lambda code only keeping the last in a list.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sequenceNumber : int</span>
<span class="sd">            The sequence number of the layer in the list</span>
<span class="sd">        layer : layer object</span>
<span class="sd">            The layer itself</span>
<span class="sd">        rowCount : int</span>
<span class="sd">            The row count</span>
<span class="sd">        firstLayer : bool</span>
<span class="sd">            True if this is the first layer in the list</span>
<span class="sd">        lastLayer : bool</span>
<span class="sd">            True if this is the last layer in the list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create a layer button</span>
        <span class="n">material</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">getMaterial</span><span class="p">()</span>
        <span class="n">materialName</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
        <span class="n">layer_button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="n">materialName</span><span class="p">)</span>
        <span class="n">layer_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Show the material properties in a new window&quot;</span><span class="p">)</span>
        <span class="n">layer_button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;Text-align:left&quot;</span><span class="p">)</span>
        <span class="n">layer_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_layer_button_clicked</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">layer</span><span class="p">,</span><span class="n">sequenceNumber</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layerTable_tw</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">sequenceNumber</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">layer_button</span><span class="p">)</span>
        <span class="c1"># Handle thickness </span>
        <span class="n">materialThickness</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">getThickness</span><span class="p">()</span>
        <span class="n">thicknessUnit</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">getThicknessUnit</span><span class="p">()</span>
        <span class="n">film_thickness_sb</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">film_thickness_sb</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
        <span class="n">film_thickness_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Define the thin film thickness in the defined thickness units&quot;</span><span class="p">)</span>
        <span class="n">film_thickness_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100000</span><span class="p">)</span>
        <span class="n">film_thickness_sb</span><span class="o">.</span><span class="n">setDecimals</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">film_thickness_sb</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
        <span class="n">film_thickness_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">materialThickness</span><span class="p">)</span>
        <span class="n">film_thickness_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_film_thickness_sb_changed</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">layer</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layerTable_tw</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">sequenceNumber</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">film_thickness_sb</span><span class="p">)</span>
        <span class="c1"># thickness unit</span>
        <span class="n">thickness_unit_cb</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">thickness_unit_cb</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
        <span class="n">thickness_unit_cb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Set the units to be used for thickness; either angs nm, um, mm or cm&quot;</span><span class="p">)</span>
        <span class="n">thickness_unit_cb</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span> <span class="n">thickness_units</span> <span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">thickness_unit_cb</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="n">thicknessUnit</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">MatchFixedString</span><span class="p">)</span>
        <span class="n">thickness_unit_cb</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="n">thickness_unit_cb</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_thickness_units_cb_activated</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">layer</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layerTable_tw</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">sequenceNumber</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">thickness_unit_cb</span><span class="p">)</span>
        <span class="c1"># define hkl</span>
        <span class="n">h_sb</span> <span class="o">=</span> <span class="n">QSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">h_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Define the h dimension of the unique direction&quot;</span><span class="p">)</span>
        <span class="n">h_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">h_sb</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">h_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">getHKL</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">h_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_hkl_sb_changed</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">layer</span><span class="p">))</span>
        <span class="n">h_sb</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
        <span class="n">k_sb</span> <span class="o">=</span> <span class="n">QSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">k_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Define the k dimension of the unique direction&quot;</span><span class="p">)</span>
        <span class="n">k_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">k_sb</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">k_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">getHKL</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">k_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_hkl_sb_changed</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">layer</span><span class="p">))</span>
        <span class="n">k_sb</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
        <span class="n">l_sb</span> <span class="o">=</span> <span class="n">QSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">l_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Define the l dimension of the unique direction&quot;</span><span class="p">)</span>
        <span class="n">l_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">l_sb</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">getHKL</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">l_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_hkl_sb_changed</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">layer</span><span class="p">))</span>
        <span class="n">l_sb</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layerTable_tw</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">sequenceNumber</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">h_sb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layerTable_tw</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">sequenceNumber</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">k_sb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layerTable_tw</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">sequenceNumber</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">l_sb</span><span class="p">)</span>
        <span class="c1"># define azimuthal angle</span>
        <span class="n">azimuthal</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">getAzimuthal</span><span class="p">()</span>
        <span class="n">azimuthal_angle_sb</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">azimuthal_angle_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Define the slab azimuthal angle (rotation of the crystal about the lab Z-axis).</span><span class="se">\n</span><span class="s2">The orientation of the crystal in the laboratory frame can be seen in the laboratory frame information below&quot;</span><span class="p">)</span>
        <span class="n">azimuthal_angle_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span><span class="mi">360</span><span class="p">)</span>
        <span class="n">azimuthal_angle_sb</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">azimuthal_angle_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">azimuthal</span><span class="p">)</span>
        <span class="n">azimuthal_angle_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_azimuthal_angle_sb_changed</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">layer</span><span class="p">))</span>
        <span class="n">azimuthal_angle_sb</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layerTable_tw</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">sequenceNumber</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="n">azimuthal_angle_sb</span><span class="p">)</span>
        <span class="c1"># Create a checkbox for coherence/incoherence</span>
        <span class="n">option_cb</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">option_cb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Change optional settings for the layer&quot;</span><span class="p">)</span>
        <span class="n">option_cb</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span> <span class="n">incoherentOptions</span> <span class="p">)</span>
        <span class="c1"># We can&#39;t use incoherent intensity method with the scattering matrix method</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Scattering matrix&quot;</span> <span class="ow">and</span> <span class="n">layer</span><span class="o">.</span><span class="n">getIncoherentOption</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Incoherent (intensity)&quot;</span><span class="p">:</span>
            <span class="n">layer</span><span class="o">.</span><span class="n">setIncoherentOption</span><span class="p">(</span><span class="s2">&quot;Coherent&quot;</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">option_cb</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">getIncoherentOption</span><span class="p">(),</span> <span class="n">Qt</span><span class="o">.</span><span class="n">MatchFixedString</span><span class="p">)</span>
        <span class="n">option_cb</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="n">option_cb</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_option_cb_activated</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">layer</span><span class="p">))</span>
        <span class="n">option_cb</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
        <span class="c1"># Disable the intensity incoherence option if it is using scattering</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Scattering matrix&quot;</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">option_cb</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="s2">&quot;Incoherent (intensity)&quot;</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">MatchFixedString</span><span class="p">)</span>
            <span class="n">option_cb</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layerTable_tw</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">sequenceNumber</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="n">option_cb</span><span class="p">)</span>
        <span class="c1"># Create a toolbar for up down delete</span>
        <span class="n">toolbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createToolBar</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span><span class="n">sequenceNumber</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layerTable_tw</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">sequenceNumber</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="n">toolbar</span><span class="p">)</span>
        <span class="c1"># Add a Print option if debug is on</span>
        <span class="k">if</span> <span class="n">debugger</span><span class="o">.</span><span class="n">state</span><span class="p">():</span>
            <span class="n">printButton</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Print&quot;</span><span class="p">)</span>
            <span class="n">printButton</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Print the permittivity&quot;</span><span class="p">)</span>
            <span class="n">printButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_print_button_clicked</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">layer</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layerTable_tw</span><span class="o">.</span><span class="n">setCellWidget</span><span class="p">(</span><span class="n">sequenceNumber</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="n">printButton</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">isScalar</span><span class="p">():</span>
            <span class="n">h_sb</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">k_sb</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">l_sb</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">azimuthal_angle_sb</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">firstLayer</span> <span class="ow">or</span> <span class="n">lastLayer</span><span class="p">:</span>
            <span class="n">film_thickness_sb</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">thickness_unit_cb</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.drawLayerTable">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.drawLayerTable">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">drawLayerTable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw a table with all the layers in it.</span>

<span class="sd">        Each layer has a row in the table showing, name, thickness, h,k,l, azimuthal angle, options and a toolbar</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layerTable_tw</span> <span class="o">=</span> <span class="n">QTableWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layerTable_tw</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Define the layers in the system</span><span class="se">\n</span><span class="s2">The layer at the top of the list is the superstrate</span><span class="se">\n</span><span class="s2">The layer at the bottom is the substrate</span><span class="se">\n</span><span class="s2">The calculated, DFT, permittivity is called the &#39;Dielectric layer&#39;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layerTable_tw</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_layerTable_itemChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layerTable_tw</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;QTableWidget::item {padding-left: 0px; border; 0px}&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layerTable_tw</span><span class="o">.</span><span class="n">verticalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layerTable_tw</span><span class="o">.</span><span class="n">setShowGrid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Material&quot;</span><span class="p">,</span> <span class="s2">&quot;Thickness&quot;</span><span class="p">,</span> <span class="s2">&quot;Units&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="s2">&quot;Azimuthal&quot;</span><span class="p">,</span> <span class="s2">&quot;Options&quot;</span><span class="p">,</span> <span class="s2">&quot;Move&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">debugger</span><span class="o">.</span><span class="n">state</span><span class="p">():</span>
            <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Print&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layerTable_tw</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layerTable_tw</span><span class="o">.</span><span class="n">setColumnCount</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">headers</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layerTable_tw</span><span class="o">.</span><span class="n">setHorizontalHeaderLabels</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerTable_tw</span><span class="o">.</span><span class="n">horizontalHeader</span><span class="p">()</span>
        <span class="c1"># Material </span>
        <span class="n">header</span><span class="o">.</span><span class="n">setSectionResizeMode</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">QHeaderView</span><span class="o">.</span><span class="n">Stretch</span><span class="p">)</span>
        <span class="c1"># Thickness and units </span>
        <span class="n">header</span><span class="o">.</span><span class="n">setSectionResizeMode</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">QHeaderView</span><span class="o">.</span><span class="n">ResizeToContents</span><span class="p">)</span>
        <span class="n">header</span><span class="o">.</span><span class="n">setSectionResizeMode</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">QHeaderView</span><span class="o">.</span><span class="n">ResizeToContents</span><span class="p">)</span>
        <span class="c1"># HKL</span>
        <span class="n">header</span><span class="o">.</span><span class="n">setSectionResizeMode</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">QHeaderView</span><span class="o">.</span><span class="n">ResizeToContents</span><span class="p">)</span>
        <span class="n">header</span><span class="o">.</span><span class="n">setSectionResizeMode</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">QHeaderView</span><span class="o">.</span><span class="n">ResizeToContents</span><span class="p">)</span>
        <span class="n">header</span><span class="o">.</span><span class="n">setSectionResizeMode</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="n">QHeaderView</span><span class="o">.</span><span class="n">ResizeToContents</span><span class="p">)</span>
        <span class="c1"># Azimuthal</span>
        <span class="n">header</span><span class="o">.</span><span class="n">setSectionResizeMode</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="n">QHeaderView</span><span class="o">.</span><span class="n">ResizeToContents</span><span class="p">)</span>
        <span class="c1"># Options</span>
        <span class="n">header</span><span class="o">.</span><span class="n">setSectionResizeMode</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="n">QHeaderView</span><span class="o">.</span><span class="n">ResizeToContents</span><span class="p">)</span>
        <span class="c1"># Move</span>
        <span class="n">header</span><span class="o">.</span><span class="n">setSectionResizeMode</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="n">QHeaderView</span><span class="o">.</span><span class="n">ResizeToContents</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;Print&quot;</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
            <span class="c1"># Print</span>
            <span class="n">header</span><span class="o">.</span><span class="n">setSectionResizeMode</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="n">QHeaderView</span><span class="o">.</span><span class="n">ResizeToContents</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redrawLayerTable</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">layerTable_tw</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.deleteLayer">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.deleteLayer">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">deleteLayer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">layer</span><span class="p">,</span><span class="n">layerIndex</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle a delete layer button press.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : any</span>
<span class="sd">            A dummy variable</span>
<span class="sd">        layer : layer object</span>
<span class="sd">            the layer to be deleted</span>
<span class="sd">        layerIndex : int</span>
<span class="sd">            index of the layer to be deleted</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">layerIndex</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">layerIndex</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">layer</span><span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="o">.</span><span class="n">isTensor</span><span class="p">():</span>
            <span class="c1">#  Only allow scalar materials as the superstrate</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;New superstrate material must be a scalar dielectric&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1"># Delete the layer</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">layerIndex</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generateLayerSettings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span><span class="o">=</span><span class="kc">True</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.moveLayerUp">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.moveLayerUp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">moveLayerUp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">layer</span><span class="p">,</span><span class="n">layerIndex</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Move a layer up (sequence number gets smaller by 1).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : any</span>
<span class="sd">            A dummy variable</span>
<span class="sd">        layer : layer object</span>
<span class="sd">            the layer to be deleted</span>
<span class="sd">        layerIndex : int</span>
<span class="sd">            index of the layer to be deleted</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">layerIndex</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">layerIndex</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">layer</span><span class="o">.</span><span class="n">isTensor</span><span class="p">():</span>
            <span class="c1">#  Only allow scalar materials as the superstrate</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;New superstrate material must be a scalar dielectric&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">layerIndex</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">layerIndex</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">layerIndex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generateLayerSettings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span><span class="o">=</span><span class="kc">True</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.moveLayerDown">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.moveLayerDown">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">moveLayerDown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">layer</span><span class="p">,</span><span class="n">layerIndex</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Move a layer down (sequence number gets larger by 1).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : any</span>
<span class="sd">            A dummy variable</span>
<span class="sd">        layer : layer object</span>
<span class="sd">            the layer to be deleted</span>
<span class="sd">        layerIndex : int</span>
<span class="sd">            index of the layer to be deleted</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">last</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">layerIndex</span> <span class="o">&gt;=</span> <span class="n">last</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">layerIndex</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">layerIndex</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">new</span><span class="p">]</span><span class="o">.</span><span class="n">isTensor</span><span class="p">():</span>
            <span class="c1">#  Only allow scalar materials as the superstrate</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;New superstrate material must be a scalar dielectric&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">layerIndex</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">layerIndex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generateLayerSettings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span><span class="o">=</span><span class="kc">True</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.createToolBarMoveUpButton">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.createToolBarMoveUpButton">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">createToolBarMoveUpButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">layer</span><span class="p">,</span><span class="n">layerIndex</span><span class="p">,</span><span class="n">nLayers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the move up button as part of the layer toolbar.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        layer : layer object</span>
<span class="sd">            the layer to be deleted</span>
<span class="sd">        layerIndex : int</span>
<span class="sd">            index of the layer to be deleted</span>
<span class="sd">        nLayers : int</span>
<span class="sd">            The number of layers</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">moveUpButton</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">()</span>
        <span class="n">moveUpButton</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">style</span><span class="p">()</span><span class="o">.</span><span class="n">standardIcon</span><span class="p">(</span><span class="n">QStyle</span><span class="o">.</span><span class="n">SP_ArrowUp</span><span class="p">))</span>
        <span class="n">moveUpButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">moveLayerUp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">layer</span><span class="p">,</span><span class="n">layerIndex</span><span class="p">))</span>
        <span class="n">moveUpButton</span><span class="o">.</span><span class="n">setFixedSize</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">moveUpButton</span><span class="o">.</span><span class="n">setIconSize</span><span class="p">(</span><span class="n">QSize</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
        <span class="n">moveUpButton</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;border: none;&quot;</span><span class="p">)</span>
        <span class="n">moveUpButton</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Move this layer up the list of layers&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">moveUpButton</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.createToolBarMoveDownButton">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.createToolBarMoveDownButton">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">createToolBarMoveDownButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">layer</span><span class="p">,</span><span class="n">layerIndex</span><span class="p">,</span><span class="n">nLayers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the move down button as part of the layer toolbar.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        layer : layer object</span>
<span class="sd">            the layer to be deleted</span>
<span class="sd">        layerIndex : int</span>
<span class="sd">            index of the layer to be deleted</span>
<span class="sd">        nLayers : int</span>
<span class="sd">            The number of layers</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">moveDownButton</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">()</span>
        <span class="n">moveDownButton</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">style</span><span class="p">()</span><span class="o">.</span><span class="n">standardIcon</span><span class="p">(</span><span class="n">QStyle</span><span class="o">.</span><span class="n">SP_ArrowDown</span><span class="p">))</span>
        <span class="n">moveDownButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">moveLayerDown</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">layer</span><span class="p">,</span><span class="n">layerIndex</span><span class="p">))</span>
        <span class="n">moveDownButton</span><span class="o">.</span><span class="n">setFixedSize</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">moveDownButton</span><span class="o">.</span><span class="n">setIconSize</span><span class="p">(</span><span class="n">QSize</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
        <span class="n">moveDownButton</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;border: none;&quot;</span><span class="p">)</span>
        <span class="n">moveDownButton</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Move this layer down the list of layers&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">moveDownButton</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.createToolBarDeleteButton">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.createToolBarDeleteButton">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">createToolBarDeleteButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">layer</span><span class="p">,</span><span class="n">layerIndex</span><span class="p">,</span><span class="n">nLayers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the delete button as part of the layer toolbar.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        layer : layer object</span>
<span class="sd">            the layer to be deleted</span>
<span class="sd">        layerIndex : int</span>
<span class="sd">            index of the layer to be deleted</span>
<span class="sd">        nLayers : int</span>
<span class="sd">            The number of layers</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">deleteButton</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">()</span>
        <span class="n">deleteButton</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">style</span><span class="p">()</span><span class="o">.</span><span class="n">standardIcon</span><span class="p">(</span><span class="n">QStyle</span><span class="o">.</span><span class="n">SP_DialogCloseButton</span><span class="p">))</span>
        <span class="n">deleteButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">deleteLayer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">layer</span><span class="p">,</span><span class="n">layerIndex</span><span class="p">))</span>
        <span class="n">deleteButton</span><span class="o">.</span><span class="n">setFixedSize</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">deleteButton</span><span class="o">.</span><span class="n">setIconSize</span><span class="p">(</span><span class="n">QSize</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
        <span class="n">deleteButton</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;border: none;&quot;</span><span class="p">)</span>
        <span class="n">deleteButton</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Delete this layer&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">deleteButton</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.createToolBar">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.createToolBar">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">createToolBar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">layer</span><span class="p">,</span><span class="n">layerIndex</span><span class="p">,</span><span class="n">nLayers</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the tool bar used for the material layer.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        layer : a layer object</span>
<span class="sd">            Layer is the layer concerned.</span>
<span class="sd">        layerIndex : int</span>
<span class="sd">            Its index in the list.</span>
<span class="sd">        nLayers : int</span>
<span class="sd">            The number of layers in the list.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">nLayers</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
        <span class="n">frame_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">frame_layout</span><span class="p">)</span>
        <span class="c1"># Create the buttons in different routines because of the lambda function usage</span>
        <span class="n">moveUpButton</span>   <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">createToolBarMoveUpButton</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span><span class="n">layerIndex</span><span class="p">,</span><span class="n">nLayers</span><span class="p">)</span>
        <span class="n">moveDownButton</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">createToolBarMoveDownButton</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span><span class="n">layerIndex</span><span class="p">,</span><span class="n">nLayers</span><span class="p">)</span>
        <span class="n">deleteButton</span>   <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">createToolBarDeleteButton</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span><span class="n">layerIndex</span><span class="p">,</span><span class="n">nLayers</span><span class="p">)</span>
        <span class="n">nextIndex</span> <span class="o">=</span> <span class="n">layerIndex</span><span class="o">+</span><span class="mi">1</span>
        <span class="c1"># disable any buttons that are irrelevant to the layer</span>
        <span class="k">if</span> <span class="n">layerIndex</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">moveUpButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">layerIndex</span> <span class="o">==</span> <span class="n">nLayers</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">moveDownButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">layerIndex</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">nextIndex</span><span class="p">]</span><span class="o">.</span><span class="n">isTensor</span><span class="p">():</span>
            <span class="n">moveDownButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">deleteButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">layerIndex</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">layer</span><span class="o">.</span><span class="n">isTensor</span><span class="p">():</span>
            <span class="n">moveUpButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Add the buttons to the frame and return the frame</span>
        <span class="n">frame_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">moveUpButton</span><span class="p">)</span>
        <span class="n">frame_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">moveDownButton</span><span class="p">)</span>
        <span class="n">frame_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">deleteButton</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">frame</span></div>

        
<div class="viewcode-block" id="SingleCrystalScenarioTab.newLayerWidget">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.newLayerWidget">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">newLayerWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create and return a new layer widget as a QComboBox.</span>

<span class="sd">        Returns a QComboBox widget configured for creating a new layer in a graphical user interface.</span>
<span class="sd">        The combo box is initialized with a default item for creating a new layer, followed by any existing layer names.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        QComboBox</span>
<span class="sd">            A QComboBox widget configured with an initial item for creating a new layer and any additional existing material layer names.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - The first item in the combo box is a placeholder for creating a new layer, indicated by &quot;New layer...&quot;.</span>
<span class="sd">        - The combo box is connected to the `on_newLayer_cb_activated` method, which should handle the action performed upon selecting an item from the combo box.</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">newLayer_cb</span> <span class="o">=</span> <span class="n">QComboBox</span><span class="p">()</span>
        <span class="n">newLayer_cb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Create a new layer&quot;</span><span class="p">)</span>
        <span class="n">materialNames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;New layer...&quot;</span><span class="p">]</span>
        <span class="n">materialNames</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materialNames</span>
        <span class="n">newLayer_cb</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="n">materialNames</span><span class="p">)</span>
        <span class="n">newLayer_cb</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">newLayer_cb</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_newLayer_cb_activated</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newLayer_cb</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.on_layerTable_itemChanged">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.on_layerTable_itemChanged">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_layerTable_itemChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">item</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle a change to the layer table.</span>

<span class="sd">        An empty routine as changes are handled by other routines</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        item : the item changed</span>
<span class="sd">            The item which has changed</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;on_layerTable_itemChanged: &quot;</span><span class="p">,</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.on_newLayer_cb_activated">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.on_newLayer_cb_activated">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_newLayer_cb_activated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle a new layer button click.</span>

<span class="sd">        Based on the index chosen a new material is created and added to the list of layers.</span>
<span class="sd">        The settings dictionary is updated and a refresh is forced.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int</span>
<span class="sd">            The index of the entry in the combobox</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># Subtract 1 from the index because the widget thinks the list includes &#39;New layer...&#39; at the start</span>
        <span class="n">newMaterialName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">materialNames</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;manual&quot;</span> <span class="ow">in</span> <span class="n">newMaterialName</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">newMaterial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMaterialFromDataBase</span><span class="p">(</span><span class="n">newMaterialName</span><span class="p">)</span>
        <span class="n">hkl</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">newMaterial</span><span class="o">.</span><span class="n">isTensor</span><span class="p">():</span>
            <span class="n">hkl</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">new_layer</span> <span class="o">=</span> <span class="n">SingleCrystalLayer</span><span class="p">(</span><span class="n">newMaterial</span><span class="p">,</span><span class="n">hkl</span><span class="o">=</span><span class="n">hkl</span><span class="p">,</span><span class="n">azimuthal</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">thickness</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">thicknessUnit</span><span class="o">=</span><span class="s2">&quot;um&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_layer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generateLayerSettings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.on_print_button_clicked">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.on_print_button_clicked">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_print_button_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">layer</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print the permittivity for the layer.</span>

<span class="sd">        The print button is only visible if in debug mode.</span>
<span class="sd">        The permittivity is printed to a csv file with a name containing the material involved.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : any</span>
<span class="sd">            A dummy parameter</span>
<span class="sd">        layer : a layer object</span>
<span class="sd">            The layer object for which a print of the permittivity has been requested</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">material</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">getMaterial</span><span class="p">()</span>
        <span class="n">permittivityObject</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">getPermittivityObject</span><span class="p">()</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">+=</span> <span class="s2">&quot;_permittivity.csv&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Printing permittivity information to&quot;</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
        <span class="n">permittivityObject</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">2000.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="n">file</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.on_option_cb_activated">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.on_option_cb_activated">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_option_cb_activated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="p">,</span><span class="n">layer</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Activate the incoherence option combob.</span>

<span class="sd">        - The layer&#39;s incoherent options are changed</span>
<span class="sd">        - The number of calculations requested is updated</span>
<span class="sd">        - The settings dictionary is regenerated</span>
<span class="sd">        - A refresh is requested</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int</span>
<span class="sd">            The index of the incoherent option combobox</span>
<span class="sd">        layer : a layer object</span>
<span class="sd">            The layer which will have its incoherent property changed</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on_incoherence_cb_activated&quot;</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span><span class="n">layer</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
        <span class="n">option</span> <span class="o">=</span> <span class="n">incoherentOptions</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">setIncoherentOption</span><span class="p">(</span><span class="n">option</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_noCalculationsRequired</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generateLayerSettings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.on_film_thickness_sb_changed">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.on_film_thickness_sb_changed">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_film_thickness_sb_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">layer</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle film thickness spin box change.</span>

<span class="sd">        - The thickness of the film in this layer is changed</span>
<span class="sd">        - The settings dictionary is regenerated</span>
<span class="sd">        - A refresh is requested</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The thickness of the film in the current thickness units</span>
<span class="sd">        layer : a layer object</span>
<span class="sd">            The layer which will have its thickness changed</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on_film_thickness_sb_changed&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">layer</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">setThickness</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generateLayerSettings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.on_thickness_units_cb_activated">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.on_thickness_units_cb_activated">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_thickness_units_cb_activated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">layer</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the activation of a thickness unit option in a combo box.</span>

<span class="sd">        - the thickness unit of this layer is changed</span>
<span class="sd">        - the settings dictionary is updated</span>
<span class="sd">        - a refresh is requested</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int</span>
<span class="sd">            The index of the selected thickness unit in the combo box.</span>
<span class="sd">        layer : a layer object</span>
<span class="sd">            The layer object whose thickness unit is to be updated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Start:: on_thickness_units_cb_activated&quot;</span><span class="p">,</span><span class="n">index</span><span class="p">,</span><span class="n">layer</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="n">thickness_units</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">setThicknessUnit</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generateLayerSettings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.on_azimuthal_angle_sb_changed">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.on_azimuthal_angle_sb_changed">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_azimuthal_angle_sb_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">layer</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle azimuthal spin box change.</span>

<span class="sd">        - The azimuthal angle of a layer is changed to the value given.</span>
<span class="sd">        - The laboratory frame information is updated</span>
<span class="sd">        - The settings dictionary is refreshed </span>
<span class="sd">        - A refresh of the GUI is requested</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The azimuthal angle in degress</span>
<span class="sd">        layer : a layer object</span>
<span class="sd">             The layer whose azimuthal angle has changed</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on_azimuthal_angl_sb_changed&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">layer</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">setAzimuthal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">changeLabFrameInfo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generateLayerSettings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.on_hkl_sb_changed">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.on_hkl_sb_changed">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_hkl_sb_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">hkorl</span><span class="p">,</span><span class="n">layer</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle a change in h, k, or l.</span>

<span class="sd">        The h, k and l parameters determine the surface of the film</span>
<span class="sd">        - determine the value of h, k or l</span>
<span class="sd">        - set the layer&#39;s surface</span>
<span class="sd">        - generate the settings dictionary</span>
<span class="sd">        - flag that a refresh is necessary</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : int</span>
<span class="sd">            The value of h, k or l</span>
<span class="sd">        hkorl : int</span>
<span class="sd">            A int 0, 1 or 2 representing &#39;h&#39;, &#39;k&#39;, or &#39;l&#39;</span>
<span class="sd">        layer :  a layer object</span>
<span class="sd">            The layer whose surface is to be changed</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;on_hkl_sb_changed&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">hkl</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">getHKL</span><span class="p">()</span>
        <span class="n">hkl</span><span class="p">[</span><span class="n">hkorl</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">setHKL</span><span class="p">(</span><span class="n">hkl</span><span class="p">)</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">changeLabFrameInfo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generateLayerSettings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.generateLayerSettings">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.generateLayerSettings">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">generateLayerSettings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate the settings dictionary for every layer.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            A list of dictionary settings for each layer.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;generateLayerSettings&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer material names&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer hkls&quot;</span><span class="p">]</span>            <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer azimuthals&quot;</span><span class="p">]</span>      <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer thicknesses&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer thickness units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer dielectric flags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer incoherent options&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer material names&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">getMaterial</span><span class="p">()</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer hkls&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">getHKL</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer azimuthals&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">getAzimuthal</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer thicknesses&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">getThickness</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer thickness units&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">getThicknessUnit</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer dielectric flags&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">isDielectric</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer incoherent options&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">getIncoherentOption</span><span class="p">())</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.setMaterialNames">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.setMaterialNames">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setMaterialNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set and append a material name to the list of material names.</span>

<span class="sd">        This function retrieves the current list of material names from the database using</span>
<span class="sd">        `self.DataBase.getSheetNames()`, appends &#39;Dielectric layer&#39; to the list, and returns the updated list.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            The list of material names including the appended default &#39;Dielectric layer&#39;.</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="c1"># Get the list of material names from the database</span>
        <span class="n">materialNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DataBase</span><span class="o">.</span><span class="n">getSheetNames</span><span class="p">()</span>
        <span class="n">materialNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Dielectric layer&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">materialNames</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.printLayerSettings">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.printLayerSettings">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">printLayerSettings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print the settings related to the layers.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        message : str</span>
<span class="sd">            Message to be printed before the layer settings.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This function prints the settings associated with layers, including material names, HKL values (Miller indices for the crystallographic planes), azimuthal angles, thicknesses with their units, flags indicating whether the layer is dielectric, and options for incoherent scattering, if applicable.</span>

<span class="sd">        This function does not return any value. It is primarily used for debugging or informative purposes to quickly display the current configuration of layer settings within a class that has `settings` as an attribute storing these properties.</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer material names&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer hkls&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer azimuthals&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer thicknesses&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer thickness units&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer dielectric flags&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer incoherent options&quot;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">()</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.settings2Layers">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.settings2Layers">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">settings2Layers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read the layer settings and generate a list of layers.</span>

<span class="sd">        This method reads all the entries in the settings dictionary</span>
<span class="sd">        to create a list of layers</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            A list of layers generated from the layer settings.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;settings2Layers&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materialNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setMaterialNames</span><span class="p">()</span>
        <span class="c1"># Process the settings information and append each layer to the list</span>
        <span class="k">for</span>  <span class="n">name</span><span class="p">,</span> <span class="n">hkl</span><span class="p">,</span> <span class="n">azimuthal</span><span class="p">,</span> <span class="n">thickness</span><span class="p">,</span> <span class="n">thicknessUnit</span><span class="p">,</span> <span class="n">dielectricFlag</span><span class="p">,</span> <span class="n">incoherentOption</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer material names&quot;</span><span class="p">],</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer hkls&quot;</span><span class="p">],</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer azimuthals&quot;</span><span class="p">],</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer thicknesses&quot;</span><span class="p">],</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer thickness units&quot;</span><span class="p">],</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer dielectric flags&quot;</span><span class="p">],</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Layer incoherent options&quot;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">materialNames</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error material &quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot; not available &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">materialNames</span><span class="p">)</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;air&quot;</span>
            <span class="n">material</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMaterialFromDataBase</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SingleCrystalLayer</span><span class="p">(</span><span class="n">material</span><span class="p">,</span><span class="n">hkl</span><span class="o">=</span><span class="n">hkl</span><span class="p">,</span><span class="n">azimuthal</span><span class="o">=</span><span class="n">azimuthal</span><span class="p">,</span>
                                     <span class="n">thickness</span><span class="o">=</span><span class="n">thickness</span><span class="p">,</span><span class="n">thicknessUnit</span><span class="o">=</span><span class="n">thicknessUnit</span><span class="p">,</span>
                                     <span class="n">incoherentOption</span><span class="o">=</span><span class="n">incoherentOption</span><span class="p">,</span><span class="n">dielectricFlag</span><span class="o">=</span><span class="n">dielectricFlag</span><span class="p">))</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.getMaterialFromDataBase">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.getMaterialFromDataBase">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">getMaterialFromDataBase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">permittivity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the given material from the database.</span>

<span class="sd">        - If name is &#39;DielectricLayer&#39; then a material is defined from the crystal permittivity of the DFT information</span>
<span class="sd">        - If name is &#39;Material defined manually&#39; the the permittivity parameter is used</span>
<span class="sd">        - Otherwise the name is used to get the material from the database</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the material. It can also be &#39;Dielectric layer&#39; or &#39;Material defined manually&#39;.</span>
<span class="sd">        permittivity : float</span>
<span class="sd">            The permittivity of a &#39;Defined manually material&#39; material.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Dielectric layer&quot;</span><span class="p">:</span>
            <span class="c1"># Create the dielectric material</span>
            <span class="n">crystalPermittivityObject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">getCrystalPermittivityObject</span><span class="p">()</span>
            <span class="n">material</span> <span class="o">=</span> <span class="n">Materials</span><span class="o">.</span><span class="n">External</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">permittivityObject</span><span class="o">=</span><span class="n">crystalPermittivityObject</span><span class="p">,</span><span class="n">cell</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cell</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Material defined manually&quot;</span><span class="p">:</span>
            <span class="n">material</span> <span class="o">=</span> <span class="n">Materials</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="s2">&quot;Material defined manually&quot;</span><span class="p">,</span><span class="n">permittivity</span><span class="o">=</span><span class="n">permittivity</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Get the material from the data base</span>
            <span class="c1"># set the units for frequency to Hz for all materials</span>
            <span class="n">material</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DataBase</span><span class="o">.</span><span class="n">getMaterial</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">material</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.getDielectricLayerIndex">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.getDielectricLayerIndex">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">getDielectricLayerIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the index of the dielectric layer in the list of layers.</span>

<span class="sd">        - Sorts through the list of layers and reports the index of the first layer that came from the provided DFT calculation</span>
<span class="sd">        - If there is no such layer then the value None is returned</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int or None</span>
<span class="sd">            The index of the dielectric layer in the list.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">layer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">isDielectric</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dielectricLayer</span> <span class="o">=</span> <span class="n">layer</span>
                <span class="k">return</span> <span class="n">index</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.on_layer_button_clicked">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.on_layer_button_clicked">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_layer_button_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">layer</span><span class="p">,</span><span class="n">layerIndex</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle a click on the show layer widget.</span>

<span class="sd">        A new window is shown with additional information about material in the layer.</span>
<span class="sd">        For materials with a 3x3 tensor permittivity the window shows the relationship between the laboratory and crystal coordinates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : any</span>
<span class="sd">            A dummy variable</span>
<span class="sd">        layer : a layer object</span>
<span class="sd">            A layer object</span>
<span class="sd">        layerIndex : int</span>
<span class="sd">            The index of the layer object in the list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create the dialog box with all the information on the layer, work on a copy of the layer</span>
        <span class="k">if</span> <span class="n">layerIndex</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Superstrate layer&quot;</span>
        <span class="k">elif</span> <span class="n">layerIndex</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Substrate layer&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Device layer &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">layerIndex</span><span class="p">)</span>
        <span class="n">showLayerWindow</span> <span class="o">=</span> <span class="n">ShowLayerWindow</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">layer</span><span class="p">),</span><span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="n">debugger</span><span class="o">.</span><span class="n">state</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">showLayerWindow</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
            <span class="c1"># The &#39;Ok&#39; button was pressed</span>
            <span class="c1"># get the new Layer and replace the old one</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">layerIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">showLayerWindow</span><span class="o">.</span><span class="n">getLayer</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generateLayerSettings</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.globalAzimuthalWidget">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.globalAzimuthalWidget">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">globalAzimuthalWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a global azimuthal angle widget.</span>

<span class="sd">        This widget is shown in the main single crystal scenario tab.</span>
<span class="sd">        Any change in this angle affects all layers.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_azimuthal_angle_sb</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_azimuthal_angle_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Define the global azimuthal angle for all layers (rotation of the crystal about the lab Z-axis).</span><span class="se">\n</span><span class="s2">The orientation of the crystal layers in the laboratory frame is shown in the edit layers window&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_azimuthal_angle_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span><span class="mi">360</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_azimuthal_angle_sb</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_azimuthal_angle_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Global azimuthal angle&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_azimuthal_angle_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_global_azimuthal_angle_sb_changed</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Global azimuthal angle&quot;</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Define the global azimuthal angle for all layers (rotation of the layers about the lab Z-axis).</span><span class="se">\n</span><span class="s2">The orientation of the crystal layers in the laboratory frame is shown in the edit layers window&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">label</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">global_azimuthal_angle_sb</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.angleOfIncidenceWidget">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.angleOfIncidenceWidget">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">angleOfIncidenceWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an angle of incidence widget.</span>

<span class="sd">        This widget is used in the layer table widget to control the azimuthal angle of a single layer.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle_of_incidence_sb</span> <span class="o">=</span> <span class="n">QDoubleSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle_of_incidence_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Define the angle of incidence, (normal incidence is 0 degrees)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle_of_incidence_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">90</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle_of_incidence_sb</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle_of_incidence_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Angle of incidence&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle_of_incidence_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_angle_of_incidence_sb_changed</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Angle of incidence&quot;</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Define the angle of incidence, (normal incidence is 0 degrees).&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">label</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">angle_of_incidence_sb</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.partialIncoherenceWidget">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.partialIncoherenceWidget">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">partialIncoherenceWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a partial incoherence widget.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hbox</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">percentage_partial_incoherence_sb</span> <span class="o">=</span> <span class="n">QSpinBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">percentage_partial_incoherence_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Define the maximum percentage changes in the slab geometric parameters (thickness, alpha, beta and gamma euler angles) and the angle of incidence</span><span class="se">\n</span><span class="s2">For thickness it is a percentage of the required thickness.  For angles it is a percentage of 90 degrees</span><span class="se">\n</span><span class="s2">If the value of the percentage incoherence is zero, no incoherence is calculated&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">percentage_partial_incoherence_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">percentage_partial_incoherence_sb</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">percentage_partial_incoherence_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Percentage partial incoherence&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">percentage_partial_incoherence_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_percentage_partial_incoherence_sb_changed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partially_incoherent_samples_sb</span> <span class="o">=</span> <span class="n">QSpinBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partially_incoherent_samples_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Define the number of samples to be used in the calculation of an incoherent spectrum.</span><span class="se">\n</span><span class="s2">A large number of samples will take a long time but will give smoother results.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partially_incoherent_samples_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partially_incoherent_samples_sb</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partially_incoherent_samples_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Partially incoherent samples&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partially_incoherent_samples_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_partially_incoherent_samples_sb_changed</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">percentage_partial_incoherence_sb</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">partially_incoherent_samples_sb</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Partial incoherence (percentage &amp; samples)&quot;</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Define the percentage partial incoherence and the number of samples to be used in the calculation of an incoherent spectrum.</span><span class="se">\n</span><span class="s2">The percentage reflects changes in the slab geometric parameters (thickness, alpha, beta and gamma euler angles) and the angle of incidence.</span><span class="se">\n</span><span class="s2">For thickness it is a percentage of the required thickness.  For angles it is a percentage of 90 degrees.</span><span class="se">\n</span><span class="s2">A large number of samples will take a long time but will give smoother results.</span><span class="se">\n</span><span class="s2">If the value of the percentage incoherence is zero, no incoherence is calculated&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">label</span><span class="p">,</span><span class="n">hbox</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.smoothingWidget">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.smoothingWidget">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">smoothingWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a smoothing widget used by the partial incoherence method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hbox</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partially_incoherent_kernel_sb</span> <span class="o">=</span> <span class="n">QSpinBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partially_incoherent_kernel_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1001</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partially_incoherent_kernel_sb</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partially_incoherent_kernel_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Filter kernel size&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partially_incoherent_kernel_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_partially_incoherent_kernel_sb_changed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partially_incoherent_kernel_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Define the kernel size for the smoothing of incoherent spectra (must be an odd number)</span><span class="se">\n</span><span class="s2">If the kernel size is less than 3, no smoothing is done.</span><span class="se">\n</span><span class="s2">The larger the number, the smoother the spectrum but beware of too much smoothing.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partially_incoherent_polynomial_sb</span> <span class="o">=</span> <span class="n">QSpinBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partially_incoherent_polynomial_sb</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Define the maximum degree of polynomial to be used in the smoothing filter&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partially_incoherent_polynomial_sb</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partially_incoherent_polynomial_sb</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partially_incoherent_polynomial_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Filter polynomial size&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partially_incoherent_polynomial_sb</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_partially_incoherent_polynomial_sb_changed</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">partially_incoherent_kernel_sb</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">partially_incoherent_polynomial_sb</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Smoothing filter (kernel &amp; polynomial size)&quot;</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Define the kernel size for the smoothing of incoherent spectra (must be an odd number)</span><span class="se">\n</span><span class="s2">If the kernel size is less than 3, no smoothing is done.</span><span class="se">\n</span><span class="s2">The larger the number, the smoother the spectrum but beware of too much smoothing.</span><span class="se">\n</span><span class="s2">Also defines the polynomial size for the fitting of the points in the kernel&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">label</span><span class="p">,</span><span class="n">hbox</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.openDB_button_clicked">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.openDB_button_clicked">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">openDB_button_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Open a new materials&#39; database.</span>

<span class="sd">        After the database is opened a refresh is requested.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;Start:: openDB_button_clicked&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openDataBase</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.on_partially_incoherent_kernel_sb_changed">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.on_partially_incoherent_kernel_sb_changed">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_partially_incoherent_kernel_sb_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the change in the partially incoherent kernel spinbox value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : int or float</span>
<span class="sd">            The new value of the partially incoherent kernel spinbox.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;on_partially_incoherent_kernel_sb_changed&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Filter kernel size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.on_partially_incoherent_polynomial_sb_changed">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.on_partially_incoherent_polynomial_sb_changed">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_partially_incoherent_polynomial_sb_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle changes to the partially incoherent polynomial spinbox value.</span>

<span class="sd">        This method updates the relevant setting based on the new value and marks</span>
<span class="sd">        the need for refreshment. It also logs the change using the debugger.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : int</span>
<span class="sd">            The new value for the partially incoherent polynomial spinbox.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;on_partially_incoherent_polynomial_sb_changed&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Filter polynomial size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.on_partially_incoherent_samples_sb_changed">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.on_partially_incoherent_samples_sb_changed">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_partially_incoherent_samples_sb_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the change in partially incoherent samples setting.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : int or float</span>
<span class="sd">            The new value for the partially incoherent samples setting.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;on_partially_incoherent_samples_sb_changed&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Partially incoherent samples&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noCalculationsRequired</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.on_percentage_partial_incoherence_sb_changed">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.on_percentage_partial_incoherence_sb_changed">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_percentage_partial_incoherence_sb_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle changes in percentage partial incoherence spinner box value.</span>

<span class="sd">        This method updates the &#39;Percentage partial incoherence&#39; setting based on the new value provided by the relevant spinner box. It marks that a refresh is required and logs the change using the configured debugger.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : int or float</span>
<span class="sd">            The new value from the percentage partial incoherence spinner box.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;on_percentage_partial_incoherence_sb_changed&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Percentage partial incoherence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.on_global_azimuthal_angle_sb_changed">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.on_global_azimuthal_angle_sb_changed">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_global_azimuthal_angle_sb_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the change in global azimuthal angle setting.</span>

<span class="sd">        This method updates the &#39;Global azimuthal angle&#39; in the settings </span>
<span class="sd">        based on the given value and marks a refresh as required.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : float</span>
<span class="sd">            The new value for the global azimuthal angle to be set.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;on_global_azimuthal_angl_sb_changed&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Global azimuthal angle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.on_angle_of_incidence_sb_changed">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.on_angle_of_incidence_sb_changed">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_angle_of_incidence_sb_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the &#39;Angle of incidence&#39; setting and mark a refresh as required upon a change in the angle of incidence spinbox value.</span>

<span class="sd">        A refresh is requested</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : int or float</span>
<span class="sd">            The new value of the angle of incidence from the spinbox.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;on_angle_of_incidence_sb_changed&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Angle of incidence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.refresh">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.refresh">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Refresh the current state, optionally forcing a refresh.</span>

<span class="sd">        This method updates the current state based on various settings and conditions. It checks</span>
<span class="sd">        if a refresh is required or if a forceful refresh is requested. It then updates several</span>
<span class="sd">        settings, including material database, layer settings, calculation requirements, UI elements states,</span>
<span class="sd">        and more to reflect the current state. It also processes UI events to ensure the UI is responsive</span>
<span class="sd">        during the update.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        force : bool, optional</span>
<span class="sd">            A flag to force the refresh even if it&#39;s not required. Default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;Start:: refresh, force =&quot;</span><span class="p">,</span> <span class="n">force</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force</span> <span class="p">:</span>
            <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;Finished:: refreshing widget aborted&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span><span class="p">,</span><span class="n">force</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1"># Check to see if there is a new reader, if there is set up the cell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">reader</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1">#</span>
        <span class="c1"># Determine the exponent_threshold to be used by GTM</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="s2">&quot;Linux&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">mainTab</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Compatibility mode&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exponent_threshold</span> <span class="o">=</span> <span class="mi">11000</span>
        <span class="k">elif</span> <span class="s2">&quot;Windows&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">mainTab</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Compatibility mode&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exponent_threshold</span> <span class="o">=</span> <span class="mi">700</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exponent_threshold</span> <span class="o">=</span> <span class="mi">11000</span>
        <span class="c1">#</span>
        <span class="c1"># Block signals during refresh</span>
        <span class="c1">#</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">findChildren</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
            <span class="n">w</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Initialise the cell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">get_unit_cell</span><span class="p">()</span>
        <span class="c1"># Open database and get materials</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Materials database&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DataBase</span><span class="o">.</span><span class="n">getFileName</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DataBase</span> <span class="o">=</span> <span class="n">MaterialsDataBase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Materials database&quot;</span><span class="p">],</span><span class="n">debug</span><span class="o">=</span><span class="n">debugger</span><span class="o">.</span><span class="n">state</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Materials database&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DataBase</span><span class="o">.</span><span class="n">getFileName</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database_le</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Materials database&quot;</span><span class="p">])</span>
            <span class="c1"># Update the possible  material names from the database</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">materialNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setMaterialNames</span><span class="p">()</span>
        <span class="c1"># Generate the layers from the settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings2Layers</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generateLayerSettings</span><span class="p">()</span>
        <span class="c1"># Force recalculation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculationRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Change any greyed out items</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">greyed_out</span><span class="p">()</span>
        <span class="c1">#</span>
        <span class="c1"># Now refresh values that need updating</span>
        <span class="c1">#</span>
        <span class="c1"># Check the mode </span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_cb</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">],</span> <span class="n">Qt</span><span class="o">.</span><span class="n">MatchFixedString</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_cb</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="c1"># Work out how many calculations are going to be performed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_noCalculationsRequired</span><span class="p">()</span>
        <span class="c1"># Update the Legend widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">legend_le</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">])</span>
        <span class="c1"># Update angle widgets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_azimuthal_angle_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Global azimuthal angle&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle_of_incidence_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Angle of incidence&quot;</span><span class="p">])</span>
        <span class="c1"># For partial incoherent case, set percentage variation of angles and thickness and the number of samples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">percentage_partial_incoherence_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Percentage partial incoherence&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partially_incoherent_samples_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Partially incoherent samples&quot;</span><span class="p">])</span>
        <span class="c1"># For partial incoherent case, set the smoothing parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partially_incoherent_kernel_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Filter kernel size&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partially_incoherent_polynomial_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Filter polynomial size&quot;</span><span class="p">])</span>
        <span class="c1">#</span>
        <span class="c1"># Unblock signals after refresh</span>
        <span class="c1">#</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">findChildren</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
            <span class="n">w</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Redraw the layer information widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redrawLayerTable</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
            <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;Finished:: refresh, force =&quot;</span><span class="p">,</span> <span class="n">force</span><span class="p">)</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.set_noCalculationsRequired">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.set_noCalculationsRequired">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_noCalculationsRequired</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine the number of calculations required.</span>

<span class="sd">        The routine first works out the number of layers needing phase averaging,</span>
<span class="sd">        then it looks at the number of partial incoherent calculations being performed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># First see how many layers are using phase averaging</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_average_incoherent_layers</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">getIncoherentOption</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Incoherent (phase averaging)&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">number_of_average_incoherent_layers</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># First see how many layers are using phase averaging</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_average_incoherent_layers</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">number_of_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Number of average incoherence samples&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">noCalculationsRequired</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">number_of_samples</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_average_incoherent_layers</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">noCalculationsRequired</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># Now see if partial incoherence is being used</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Percentage partial incoherence&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">noCalculationsRequired</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Partially incoherent samples&quot;</span><span class="p">]</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.on_mode_cb_activated">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.on_mode_cb_activated">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_mode_cb_activated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the activation of the mode combo box in the GUI.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int</span>
<span class="sd">            The index of the selected mode in the combo box. This controls what mode the system will use. </span>
<span class="sd">            Index 0 corresponds to the &#39;Transfer matrix&#39; mode, while index 1 corresponds to the &#39;Scattering matrix&#39; mode.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This function performs several operations based on the selected mode:</span>
<span class="sd">        - Sets the mode in the settings to either &#39;Transfer matrix&#39; or &#39;Scattering matrix&#39;.</span>
<span class="sd">        - If &#39;Scattering matrix&#39; mode is selected (index 1), it goes through all layers and changes any layer with the incoherent option set to &#39;Incoherent (intensity)&#39; to be &#39;Coherent&#39;.</span>
<span class="sd">        - Invokes set_noCalculationsRequired to indicate that new calculations are necessary based on the changed settings.</span>
<span class="sd">        - Calls generateLayerSettings to update the layer settings according to the new mode.</span>
<span class="sd">        - Forces a refresh of the display to reflect any changes.</span>
<span class="sd">        - Sets a flag indicating that a refresh is required.</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;Start:: on_mode_cb_activated&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Transfer matrix&quot;</span>
        <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Scattering matrix&quot;</span>
            <span class="c1"># If any layers are using intensity incoherence move them to coherent</span>
            <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
                <span class="n">incoherentOption</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">getIncoherentOption</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">incoherentOption</span> <span class="o">==</span> <span class="s2">&quot;Incoherent (intensity)&quot;</span><span class="p">:</span>
                    <span class="n">layer</span><span class="o">.</span><span class="n">setIncoherentOption</span><span class="p">(</span><span class="s2">&quot;Coherent&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_noCalculationsRequired</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generateLayerSettings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;Mode changed to &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">])</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;Finished:: on_mode_cb_activated&quot;</span><span class="p">)</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.average_incoherent_calculator">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.average_incoherent_calculator">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">average_incoherent_calculator</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span>
                            <span class="n">layers</span><span class="p">,</span>
                            <span class="n">mode</span><span class="p">,</span>
                            <span class="n">theta</span><span class="p">,</span>
                            <span class="n">phi</span><span class="p">,</span>
                            <span class="n">psi</span><span class="p">,</span>
                            <span class="n">angleOfIncidence</span><span class="p">,</span>
                            <span class="n">exponent_threshold</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the incoherent component of light reflectance and transmission by averaging over the phase shift.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        layers : a list of layers</span>
<span class="sd">            A list of layers</span>
<span class="sd">        mode : str</span>
<span class="sd">            Specifies either &#39;Transfer matrix&#39; or &#39;Scattering matrix&#39;</span>
<span class="sd">        theta : float</span>
<span class="sd">            The angle theta</span>
<span class="sd">        phi : float</span>
<span class="sd">            The angle phi</span>
<span class="sd">        psi : float</span>
<span class="sd">            The angle psi</span>
<span class="sd">        angleOfIncidence : float</span>
<span class="sd">            The angle incidence</span>
<span class="sd">        exponent_threshold: float</span>
<span class="sd">            The exponent threshold</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A tuple of lists or nd.arrays</span>
<span class="sd">            - p_reflectance</span>
<span class="sd">            - s_reflectance</span>
<span class="sd">            - p_transmittance</span>
<span class="sd">            - s_transmittance</span>
<span class="sd">            - p_absorbtance</span>
<span class="sd">            - s_absorbtance</span>
<span class="sd">            - epsilon</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;Start:: partially_incoherent_calculator&quot;</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Zero the arrays we will need</span>
        <span class="c1">#</span>
        <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vs_cm1</span><span class="p">)</span>
        <span class="n">av_p_reflectance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> 
        <span class="n">av_s_reflectance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> 
        <span class="n">av_p_transmittance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> 
        <span class="n">av_s_transmittance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> 
        <span class="n">av_s_absorbtance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> 
        <span class="n">av_p_absorbtance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> 
        <span class="n">av_epsilon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">size</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cdouble</span><span class="p">)</span>
        <span class="c1"># Work out which of the layers is the crystal dielectric</span>
        <span class="n">averageList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">getIncoherentOption</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Incoherent (phase averaging)&quot;</span><span class="p">:</span>
                <span class="n">averageList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Calculate the list of phase shift combinations from the number of samples</span>
        <span class="c1">#</span>
        <span class="n">frac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Percentage average incoherence&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">100.0</span>
        <span class="n">number_of_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Number of average incoherence samples&quot;</span><span class="p">]</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="p">[</span><span class="n">frac</span> <span class="o">*</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">s</span> <span class="o">/</span> <span class="n">number_of_samples</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_samples</span><span class="p">)]</span>
        <span class="n">betas</span> <span class="o">=</span> <span class="n">product</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">averageList</span><span class="p">))</span>
        <span class="c1"># loop over the combination of phases that are possible</span>
        <span class="k">for</span> <span class="n">beta</span> <span class="ow">in</span> <span class="n">betas</span><span class="p">:</span>
            <span class="c1"># set the phase shift for each layer</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">layer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">averageList</span><span class="p">):</span>
                <span class="n">layer</span><span class="o">.</span><span class="n">setPhaseShift</span><span class="p">(</span><span class="n">beta</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="p">(</span> <span class="n">p_reflectance</span><span class="p">,</span> 
            <span class="n">s_reflectance</span><span class="p">,</span> 
            <span class="n">p_transmittance</span><span class="p">,</span> 
            <span class="n">s_transmittance</span><span class="p">,</span> 
            <span class="n">s_absorbtance</span><span class="p">,</span> 
            <span class="n">p_absorbtance</span><span class="p">,</span> 
            <span class="n">epsilon</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coherent_calculator</span><span class="p">(</span>
                                       <span class="n">layers</span><span class="p">,</span>
                                       <span class="n">mode</span><span class="p">,</span>
                                       <span class="n">theta</span><span class="p">,</span>
                                       <span class="n">phi</span><span class="p">,</span>
                                       <span class="n">psi</span><span class="p">,</span>
                                       <span class="n">angleOfIncidence</span><span class="p">,</span>
                                       <span class="n">exponent_threshold</span><span class="p">)</span>
            <span class="n">av_p_reflectance</span>   <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_reflectance</span><span class="p">)</span>   <span class="o">/</span> <span class="n">number_of_samples</span>
            <span class="n">av_s_reflectance</span>   <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">s_reflectance</span><span class="p">)</span>   <span class="o">/</span> <span class="n">number_of_samples</span>
            <span class="n">av_p_transmittance</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_transmittance</span><span class="p">)</span> <span class="o">/</span> <span class="n">number_of_samples</span>
            <span class="n">av_s_transmittance</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">s_transmittance</span><span class="p">)</span> <span class="o">/</span> <span class="n">number_of_samples</span>
            <span class="n">av_s_absorbtance</span>   <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_absorbtance</span><span class="p">)</span>   <span class="o">/</span> <span class="n">number_of_samples</span>
            <span class="n">av_p_absorbtance</span>   <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">s_absorbtance</span><span class="p">)</span>   <span class="o">/</span> <span class="n">number_of_samples</span>
            <span class="n">av_epsilon</span>         <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">epsilon</span><span class="p">)</span>         <span class="o">/</span> <span class="n">number_of_samples</span>
        <span class="k">return</span> <span class="p">(</span>  <span class="n">av_p_reflectance</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">av_s_reflectance</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">av_p_transmittance</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">av_s_transmittance</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">av_p_absorbtance</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">av_s_absorbtance</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">av_epsilon</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="p">)</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.partially_incoherent_calculator">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.partially_incoherent_calculator">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">partially_incoherent_calculator</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span>
                            <span class="n">layers</span><span class="p">,</span>
                            <span class="n">mode</span><span class="p">,</span>
                            <span class="n">theta</span><span class="p">,</span>
                            <span class="n">phi</span><span class="p">,</span>
                            <span class="n">psi</span><span class="p">,</span>
                            <span class="n">angleOfIncidence</span><span class="p">,</span>
                            <span class="n">exponent_threshold</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the incoherent component of light reflectance and transmission by sampling the path length in the incident medium.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        layers : a list of layers</span>
<span class="sd">            A list of layers</span>
<span class="sd">        mode : str</span>
<span class="sd">            Specifies either &#39;Transfer matrix&#39; or &#39;Scattering matrix&#39;</span>
<span class="sd">        theta : float</span>
<span class="sd">            The angle theta</span>
<span class="sd">        phi : float</span>
<span class="sd">            The angle phi</span>
<span class="sd">        psi : float</span>
<span class="sd">            The angle psi</span>
<span class="sd">        angleOfIncidence : float</span>
<span class="sd">            The angle incidence</span>
<span class="sd">        exponent_threshold: float</span>
<span class="sd">            The exponent threshold</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A tuple of lists or nd.arrays</span>
<span class="sd">            - p_reflectance</span>
<span class="sd">            - s_reflectance</span>
<span class="sd">            - p_transmittance</span>
<span class="sd">            - s_transmittance</span>
<span class="sd">            - p_absorbtance</span>
<span class="sd">            - s_absorbtance</span>
<span class="sd">            - epsilon</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;Start:: partially_incoherent_calculator&quot;</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Zero the arrays we will need</span>
        <span class="c1">#</span>
        <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vs_cm1</span><span class="p">)</span>
        <span class="n">av_p_reflectance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> 
        <span class="n">av_s_reflectance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> 
        <span class="n">av_p_transmittance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> 
        <span class="n">av_s_transmittance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> 
        <span class="n">av_s_absorbtance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> 
        <span class="n">av_p_absorbtance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> 
        <span class="n">av_epsilon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">size</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cdouble</span><span class="p">)</span>
        <span class="c1"># Work out which of the layers is the crystal dielectric</span>
        <span class="n">crystalLayer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">isDielectric</span><span class="p">():</span>
                <span class="n">crystalLayer</span> <span class="o">=</span> <span class="n">layer</span>
        <span class="c1">#</span>
        <span class="c1"># Loop over the number of samples requred</span>
        <span class="c1">#</span>
        <span class="n">crystalDepth</span> <span class="o">=</span> <span class="n">crystalLayer</span><span class="o">.</span><span class="n">getThickness</span><span class="p">()</span>
        <span class="n">keepCrystalDepth</span> <span class="o">=</span> <span class="n">crystalDepth</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">crystalDepth</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">theta</span>
        <span class="n">p</span>  <span class="o">=</span> <span class="n">phi</span>
        <span class="n">q</span>  <span class="o">=</span> <span class="n">psi</span>
        <span class="n">a</span>  <span class="o">=</span> <span class="n">angleOfIncidence</span>
        <span class="n">fractionalIncoherence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Percentage partial incoherence&quot;</span><span class="p">]</span><span class="o">/</span><span class="mf">100.0</span>
        <span class="k">for</span> <span class="n">_s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Partially incoherent samples&quot;</span><span class="p">]):</span>
            <span class="n">crystalDepth</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">d</span><span class="o">*</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">())</span><span class="o">*</span><span class="n">fractionalIncoherence</span>
            <span class="n">crystalLayer</span><span class="o">.</span><span class="n">setThickness</span><span class="p">(</span><span class="n">crystalDepth</span><span class="p">)</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span><span class="o">*</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">())</span><span class="o">*</span><span class="n">fractionalIncoherence</span>
            <span class="n">phi</span>   <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span><span class="o">*</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">())</span><span class="o">*</span><span class="n">fractionalIncoherence</span>
            <span class="n">psi</span> <span class="o">=</span> <span class="n">q</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span><span class="o">*</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">())</span><span class="o">*</span><span class="n">fractionalIncoherence</span>
            <span class="n">angleOfIncidence</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span><span class="o">*</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">())</span><span class="o">*</span><span class="n">fractionalIncoherence</span>
            <span class="p">(</span> <span class="n">p_reflectance</span><span class="p">,</span> 
            <span class="n">s_reflectance</span><span class="p">,</span> 
            <span class="n">p_transmittance</span><span class="p">,</span> 
            <span class="n">s_transmittance</span><span class="p">,</span> 
            <span class="n">s_absorbtance</span><span class="p">,</span> 
            <span class="n">p_absorbtance</span><span class="p">,</span> 
            <span class="n">epsilon</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coherent_calculator</span><span class="p">(</span>
                                       <span class="n">layers</span><span class="p">,</span>
                                       <span class="n">mode</span><span class="p">,</span>
                                       <span class="n">theta</span><span class="p">,</span>
                                       <span class="n">phi</span><span class="p">,</span>
                                       <span class="n">psi</span><span class="p">,</span>
                                       <span class="n">angleOfIncidence</span><span class="p">,</span>
                                       <span class="n">exponent_threshold</span><span class="p">)</span>
            <span class="n">av_p_reflectance</span>   <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_reflectance</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Partially incoherent samples&quot;</span><span class="p">]</span>
            <span class="n">av_s_reflectance</span>   <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">s_reflectance</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Partially incoherent samples&quot;</span><span class="p">]</span>
            <span class="n">av_p_transmittance</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_transmittance</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Partially incoherent samples&quot;</span><span class="p">]</span>
            <span class="n">av_s_transmittance</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">s_transmittance</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Partially incoherent samples&quot;</span><span class="p">]</span>
            <span class="n">av_s_absorbtance</span>   <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_absorbtance</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Partially incoherent samples&quot;</span><span class="p">]</span>
            <span class="n">av_p_absorbtance</span>   <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">s_absorbtance</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Partially incoherent samples&quot;</span><span class="p">]</span>
            <span class="n">av_epsilon</span>         <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">epsilon</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Partially incoherent samples&quot;</span><span class="p">]</span>
        <span class="n">crystalLayer</span><span class="o">.</span><span class="n">setThickness</span><span class="p">(</span><span class="n">keepCrystalDepth</span><span class="p">)</span>
        <span class="c1"># Only apply the smoothing filter if the kernel is larger than 2</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Filter kernel size&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Filter polynomial size&quot;</span><span class="p">]</span>
            <span class="n">av_p_reflectance</span>   <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">savgol_filter</span><span class="p">(</span><span class="n">av_p_reflectance</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span>
            <span class="n">av_p_transmittance</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">savgol_filter</span><span class="p">(</span><span class="n">av_p_transmittance</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span>
            <span class="n">av_p_absorbtance</span>   <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">savgol_filter</span><span class="p">(</span><span class="n">av_p_absorbtance</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span>
            <span class="n">av_s_reflectance</span>   <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">savgol_filter</span><span class="p">(</span><span class="n">av_s_reflectance</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span>
            <span class="n">av_s_transmittance</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">savgol_filter</span><span class="p">(</span><span class="n">av_s_transmittance</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span>
            <span class="n">av_s_absorbtance</span>   <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">savgol_filter</span><span class="p">(</span><span class="n">av_s_absorbtance</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>  <span class="n">av_p_reflectance</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">av_s_reflectance</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">av_p_transmittance</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">av_s_transmittance</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">av_p_absorbtance</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">av_s_absorbtance</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">av_epsilon</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="p">)</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.coherent_calculator">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.coherent_calculator">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">coherent_calculator</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span>
                            <span class="n">layers</span><span class="p">,</span>
                            <span class="n">mode</span><span class="p">,</span>
                            <span class="n">theta</span><span class="p">,</span>
                            <span class="n">phi</span><span class="p">,</span>
                            <span class="n">psi</span><span class="p">,</span>
                            <span class="n">angleOfIncidence</span><span class="p">,</span>
                            <span class="n">exponent_threshold</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the coherent component of light reflectance and transmission.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        layers : a list of layers</span>
<span class="sd">            A list of layers</span>
<span class="sd">        mode : str</span>
<span class="sd">            Specifies either &#39;Transfer matrix&#39; or &#39;Scattering matrix&#39;</span>
<span class="sd">        theta : float</span>
<span class="sd">            The angle theta</span>
<span class="sd">        phi : float</span>
<span class="sd">            The angle phi</span>
<span class="sd">        psi : float</span>
<span class="sd">            The angle psi</span>
<span class="sd">        angleOfIncidence : float</span>
<span class="sd">            The angle incidence</span>
<span class="sd">        exponent_threshold: float</span>
<span class="sd">            The exponent threshold</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A tuple of lists or nd.arrays</span>
<span class="sd">            - p_reflectance</span>
<span class="sd">            - s_reflectance</span>
<span class="sd">            - p_transmittance</span>
<span class="sd">            - s_transmittance</span>
<span class="sd">            - p_absorbtance</span>
<span class="sd">            - s_absorbtance</span>
<span class="sd">            - epsilon</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;Entering the coherent_calculator function&quot;</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Initialise the partial function to pass through to the pool</span>
        <span class="c1">#</span>
        <span class="n">partial_function</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">solve_single_crystal_equations</span><span class="p">,</span>
                                       <span class="n">layers</span><span class="p">,</span>
                                       <span class="n">mode</span><span class="p">,</span>
                                       <span class="n">theta</span><span class="p">,</span>
                                       <span class="n">phi</span><span class="p">,</span>
                                       <span class="n">psi</span><span class="p">,</span>
                                       <span class="n">angleOfIncidence</span><span class="p">,</span>
                                       <span class="n">exponent_threshold</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># About to call</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;About to calculate single crystal scenario using pool&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">pool</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">startPool</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="n">partial_function</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_cm1</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">progressbars_update</span><span class="p">()</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
        <span class="c1"># Initialise result variables</span>
        <span class="n">p_reflectance</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">s_reflectance</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">p_transmittance</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">s_transmittance</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">p_absorbtance</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">s_absorbtance</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;About to extract results for single crystal scenario&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span><span class="p">,</span><span class="n">_r</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">_t</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">eps</span><span class="p">,</span><span class="n">errors</span><span class="p">,</span><span class="n">largest_exponent</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Transfer matrix&quot;</span> <span class="ow">and</span> <span class="n">errors</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning exponential overflow occured at frequency&quot;</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">errors</span><span class="p">,</span><span class="n">largest_exponent</span><span class="p">)</span>
            <span class="n">p_reflectance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">s_reflectance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">R</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">p_transmittance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">s_transmittance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">p_absorbtance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">s_absorbtance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">R</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">R</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">epsilon</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;Finished the coherent_calculator function&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span> <span class="n">p_reflectance</span><span class="p">,</span> <span class="n">s_reflectance</span><span class="p">,</span> <span class="n">p_transmittance</span><span class="p">,</span> <span class="n">s_transmittance</span><span class="p">,</span> <span class="n">p_absorbtance</span><span class="p">,</span> <span class="n">s_absorbtance</span><span class="p">,</span> <span class="n">epsilon</span> <span class="p">)</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.calculate">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.calculate">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">calculate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vs_cm1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform simulation for calculating various properties such as reflectance, transmittance, and absorbance for a given set of material layers and configurations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vs_cm1 : list or ndarray</span>
<span class="sd">            List or array of wavenumbers (in cm^-1) for which the simulation is to be run.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This method updates the object&#39;s state by calculating and setting various optical properties (reflectance, transmittance, absorbtance) based on the input wavenumbers, layer configurations, and other settings such as the angle of incidence. It requires that settings, frequencies, and other parameters be previously defined and valid. The method also makes use of different calculator objects depending on the coherence conditions and partial incoherence percentage. It handles conditions such as missing program, file reader, or filename settings by aborting the calculations and logging appropriate messages through a `debugger`.</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;Start:: calculate - number of frequencies&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">vs_cm1</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculationRequired</span><span class="p">:</span>
            <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;Finished:: calculate aborted because calculationRequired false&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vs_cm1</span> <span class="o">=</span> <span class="n">vs_cm1</span>
        <span class="c1"># Assemble the mainTab settings</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">mainTab</span><span class="o">.</span><span class="n">settings</span>
        <span class="n">program</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Program&quot;</span><span class="p">]</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">mainTab</span><span class="o">.</span><span class="n">getFullFileName</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;Finished:: Calculate aborting - no reader&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">program</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;Finished:: Calculate aborting - no program&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;Finished:: Calculate aborting - no file&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1"># Make sure the filter kernel size is odd, if not make it so and update the GUI</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Filter kernel size&quot;</span><span class="p">]</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Filter kernel size&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">partially_incoherent_kernel_sb</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Filter kernel size&quot;</span><span class="p">])</span>
        <span class="c1"># Assemble the settingsTab settings</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notebook</span><span class="o">.</span><span class="n">settingsTab</span><span class="o">.</span><span class="n">settings</span>
        <span class="c1"># The euler angles are set to zero, apart from the global azimuthal angle</span>
        <span class="c1"># the rotation of each layer is now handled by the layer class.</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="c1"># global azimuthal angle in radians</span>
        <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Global azimuthal angle&quot;</span><span class="p">])</span>
        <span class="c1"># Set the angle of incidence in radians</span>
        <span class="n">angleOfIncidence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Angle of incidence&quot;</span><span class="p">])</span>
        <span class="c1"># Tell each layer to calculate the euler matrix for rotation to the lab frame</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">layer</span><span class="o">.</span><span class="n">isTensor</span><span class="p">():</span>
                <span class="n">hkl</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">getHKL</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">hkl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">hkl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">hkl</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">QMessageBox</span><span class="o">.</span><span class="n">about</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;Unable to calculate surface for scenario </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;Legend&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, hkl=[0,0,0]&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="n">layer</span><span class="o">.</span><span class="n">calculate_euler_matrix</span><span class="p">()</span>
        <span class="c1"># Define the mode of calculation transfer or scattering matrix</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Mode&quot;</span><span class="p">]</span>
        <span class="c1"># See if the partially incoherent method will be used or the average incoherent</span>
        <span class="c1"># A different calculator is selected depending on the settings</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Percentage partial incoherence&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">calculator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partially_incoherent_calculator</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_average_incoherent_layers</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">calculator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">average_incoherent_calculator</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">calculator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coherent_calculator</span>
        <span class="c1"># Pass the exponent threshold</span>
        <span class="n">exponent_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exponent_threshold</span>
        <span class="c1"># Call the relevant calculator</span>
        <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_reflectance</span><span class="p">,</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">s_reflectance</span><span class="p">,</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">p_transmittance</span><span class="p">,</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">s_transmittance</span><span class="p">,</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">p_absorbtance</span><span class="p">,</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">s_absorbtance</span><span class="p">,</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span> <span class="o">=</span> <span class="n">calculator</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">,</span>
                                    <span class="n">mode</span><span class="p">,</span>
                                    <span class="n">theta</span><span class="p">,</span>
                                    <span class="n">phi</span><span class="p">,</span>
                                    <span class="n">psi</span><span class="p">,</span>
                                    <span class="n">angleOfIncidence</span><span class="p">,</span>
                                    <span class="n">exponent_threshold</span><span class="p">)</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;Finished:: calculate - number of frequencies&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">vs_cm1</span><span class="p">))</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.get_result">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.get_result">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vs_cm1</span><span class="p">,</span> <span class="n">plot_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a particular result.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vs_cm1 : a list of floats</span>
<span class="sd">            The frequencies</span>
<span class="sd">        plot_type : str</span>
<span class="sd">            The data needed for plotting one of:</span>
<span class="sd">            - &#39;Crystal Reflectance (P polarisation)&#39;</span>
<span class="sd">            - &#39;Crystal Reflectance (S polarisation)&#39;</span>
<span class="sd">            - &#39;Crystal Transmittance (P polarisation)&#39;</span>
<span class="sd">            - &#39;Crystal Transmittance (S polarisation)&#39;</span>
<span class="sd">            - &#39;Crystal Absorbtance (P polarisation)&#39;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of floats</span>
<span class="sd">            The results to be plotted</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;Start:: get_result&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">vs_cm1</span><span class="p">),</span><span class="n">plot_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_results</span><span class="p">(</span><span class="n">vs_cm1</span><span class="p">)</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;Finished:: get_result&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">vs_cm1</span><span class="p">),</span><span class="n">plot_type</span><span class="p">)</span>
        <span class="k">return</span><span class="p">{</span> <span class="s2">&quot;Crystal Reflectance (P polarisation)&quot;</span>  <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_reflectance</span><span class="p">,</span>
                <span class="s2">&quot;Crystal Reflectance (S polarisation)&quot;</span>  <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_reflectance</span><span class="p">,</span>
                <span class="s2">&quot;Crystal Transmittance (P polarisation)&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_transmittance</span><span class="p">,</span>
                <span class="s2">&quot;Crystal Transmittance (S polarisation)&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_transmittance</span><span class="p">,</span>
                <span class="s2">&quot;Crystal Absorbtance (P polarisation)&quot;</span>  <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_absorbtance</span><span class="p">,</span>
                <span class="s2">&quot;Crystal Absorbtance (S polarisation)&quot;</span>  <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_absorbtance</span><span class="p">,</span>
        <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">plot_type</span><span class="p">)</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.get_results">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.get_results">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vs_cm1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the results of the single crystal calculation.</span>

<span class="sd">        If a refresh has been requested it is performed before the calculate method is called.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vs_cm1 : a list of floats</span>
<span class="sd">            The frequencies in cm-1</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;Start:: get_results&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">vs_cm1</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vs_cm1</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vs_cm1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vs_cm1</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_cm1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">vs_cm1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_cm1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">vs_cm1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">:</span>
            <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;get_results recalculating&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">vs_cm1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;get_results no need for recalculation&quot;</span><span class="p">)</span>
            <span class="c1">#self.notebook.progressbars_update(increment=len(vs_cm1))</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;Finished:: get_results&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">vs_cm1</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">refreshRequired</span><span class="p">)</span>
        <span class="k">return</span></div>


<div class="viewcode-block" id="SingleCrystalScenarioTab.greyed_out">
<a class="viewcode-back" href="../../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html#PDielec.GUI.SingleCrystalScenarioTab.SingleCrystalScenarioTab.greyed_out">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">greyed_out</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Have a look through the settings and see if we need to grey anything out.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># At the moment it appears there is nothing to do.</span>
        <span class="n">debugger</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Legend&quot;</span><span class="p">],</span><span class="s2">&quot;Finished:: greyed_out&quot;</span><span class="p">)</span>
        <span class="k">return</span></div>
</div>


</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, John Kendrick and Andrew Burnett
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../../_static/documentation_options.js?v=0b13d40c"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>