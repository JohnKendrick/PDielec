<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <!-- Generated with Sphinx 7.1.2 and Furo 2024.01.29 -->
        <title>PDielec.vibanalysis - PDielec: John Kendrick &amp; Andrew Burnett</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=92fd9be5" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../_static/table_styling.css?v=a1a2a898" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=2e0a580d" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">PDielec: John Kendrick & Andrew Burnett</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">PDielec: John Kendrick & Andrew Burnett</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Software</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pdgui.html">PDGui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software.html">Other Software Components</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Theory</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../theory_powder.html">Theory for Light Scattering from Powders</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../theory_single_crystal.html">Theory for Single Crystal Optics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analysis.html">Phonon Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../application_notes_1.html">Applications of Effective Medium Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../application_notes_2.html">Single Crystal Applications</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../autoapi/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../autoapi/PDielec/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of PDielec</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../autoapi/PDielec/GUI/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of PDielec.GUI</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/AnalysisTab/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.AnalysisTab</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/App/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.App</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/FitterTab/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.FitterTab</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/MainTab/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.MainTab</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/NoteBook/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.NoteBook</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/OpenGLWidget/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.OpenGLWidget</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/PlottingTab/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.PlottingTab</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/PowderScenarioTab/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.PowderScenarioTab</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/ScenarioTab/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.ScenarioTab</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/SettingsTab/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.SettingsTab</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/SingleCrystalLayer/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.SingleCrystalLayer</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.SingleCrystalScenarioTab</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/SpreadSheetManager/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.SpreadSheetManager</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/ViewerTab/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GUI.ViewerTab</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/AbinitOutputReader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.AbinitOutputReader</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/Calculator/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.Calculator</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/CastepOutputReader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.CastepOutputReader</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/Constants/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.Constants</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/CrystalOutputReader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.CrystalOutputReader</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/DielectricFunction/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.DielectricFunction</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/ExperimentOutputReader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.ExperimentOutputReader</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/GTMcore/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GTMcore</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/GenericOutputReader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GenericOutputReader</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/GulpOutputReader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.GulpOutputReader</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/HelperRoutines/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.HelperRoutines</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/IO/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.IO</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/Materials/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.Materials</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/Mie/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.Mie</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/PhonopyOutputReader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.PhonopyOutputReader</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/Plotter/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.Plotter</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/QEOutputReader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.QEOutputReader</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/SuperCell/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.SuperCell</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/UnitCell/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.UnitCell</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/Utilities/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.Utilities</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/VaspOutputReader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.VaspOutputReader</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/checkcsv/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.checkcsv</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/checkexcel/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.checkexcel</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/graphdatagenerator/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.graphdatagenerator</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/p1reader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.p1reader</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/p2cif/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.p2cif</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/pdcompare/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.pdcompare</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/pdgui/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.pdgui</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/pdmake/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.pdmake</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/pickled_reader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.pickled_reader</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/preader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.preader</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/vibanalysis/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.vibanalysis</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../autoapi/PDielec/pdgui/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.pdgui</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../autoapi/PDielec/preader/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.preader</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../autoapi/PDielec/pdmake/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">PDielec.pdmake</span></code></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../zreferences.html">References</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for PDielec.vibanalysis</h1><div class="highlight"><pre>
<span></span><span class="ch">#! /usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;vibAnalysis is a Python tool written by Filipe Teixeira the original is available on</span>
<span class="sd">github at https://github.com/teixeirafilipe/vibAnalysis.</span>

<span class="sd">The package uses the Vibrational Mode Decomoposition method to describe the normal modes of a molecule.</span>
<span class="sd">It has been modified to interface directly with PDielec package and to treat periodic systems at the phonon gamma point.  </span>
<span class="sd">An example of the use of the modified program are give below; ::</span>

<span class="sd">   vibanalysis --autosel phonon.castep</span>

<span class="sd">The modified program creates a PDielec reader for the phonon.castep file, and uses the reader to provide</span>
<span class="sd">all the data required by the vibAnalysis.  </span>
<span class="sd">All of the options available to the original code are available to this modified version.</span>
<span class="sd">Full details of the options available can be viewed at https://github.com/teixeirafilipe/vibAnalysis.</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="c1">##########################################################################</span>
<span class="c1">#                                                                        #</span>
<span class="c1"># Program: va.py   Version 1.2.2            Date: 18/07/2019             #</span>
<span class="c1">#                                                                        #</span>
<span class="c1"># A varied set of tools to analyse vibrational modes in terms of         #</span>
<span class="c1"># localized internal coordinates.                                        #</span>
<span class="c1">#                                                                        #</span>
<span class="c1"># (c) Filipe Teixeira, 2017-2019                                         #</span>
<span class="c1">#                                                                        #</span>
<span class="c1">##########################################################################</span>
<span class="c1">#</span>
<span class="c1"># Modified by John Kendrick to make it compatible with PDielec</span>
<span class="c1"># Original file is va.py.original</span>
<span class="c1">#</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">reload</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sklearn</span> <span class="k">as</span> <span class="nn">skl</span>
<span class="kn">import</span> <span class="nn">sklearn.linear_model</span> <span class="k">as</span> <span class="nn">sklm</span>
<span class="kn">import</span> <span class="nn">sklearn.metrics</span> <span class="k">as</span> <span class="nn">skmt</span>


<div class="viewcode-block" id="InitialiseVaOpts"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.InitialiseVaOpts">[docs]</a><span class="k">def</span> <span class="nf">InitialiseVaOpts</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define default options for the Vibanalysis package&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">Opts</span>
    <span class="k">global</span> <span class="n">Symbols</span>
    <span class="k">global</span> <span class="n">Masses</span>
    <span class="k">global</span> <span class="n">Radii</span>
    <span class="c1"># General Options</span>
    <span class="n">Opts</span><span class="o">=</span><span class="p">{}</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;isLinear&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;isTState&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;cut&quot;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;cutval&quot;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.1</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;delta&quot;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.01</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;tol&quot;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.2</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doOuts&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doTors&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doMWD&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doMWS&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doAutoSel&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doVMP&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doVMLD&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doVMBLD&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doVMARD&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;PDIELEC&quot;</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;aniMode&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;anic&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;oopp&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
    <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;oopTol&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">5.0</span><span class="p">)</span>
    <span class="c1"># General Data</span>
    <span class="n">Bohr2Ang</span><span class="o">=</span><span class="mf">0.5291772</span>
    <span class="n">Symbols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;h&quot;</span><span class="p">,</span><span class="s2">&quot;he&quot;</span><span class="p">,</span><span class="s2">&quot;li&quot;</span><span class="p">,</span><span class="s2">&quot;be&quot;</span><span class="p">,</span><span class="s2">&quot;b&quot;</span><span class="p">,</span><span class="s2">&quot;c&quot;</span><span class="p">,</span><span class="s2">&quot;n&quot;</span><span class="p">,</span><span class="s2">&quot;o&quot;</span><span class="p">,</span><span class="s2">&quot;f&quot;</span><span class="p">,</span><span class="s2">&quot;ne&quot;</span><span class="p">,</span>
<span class="s2">&quot;na&quot;</span><span class="p">,</span><span class="s2">&quot;mg&quot;</span><span class="p">,</span><span class="s2">&quot;al&quot;</span><span class="p">,</span><span class="s2">&quot;si&quot;</span><span class="p">,</span><span class="s2">&quot;p&quot;</span><span class="p">,</span><span class="s2">&quot;s&quot;</span><span class="p">,</span><span class="s2">&quot;cl&quot;</span><span class="p">,</span><span class="s2">&quot;ar&quot;</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span><span class="s2">&quot;ca&quot;</span><span class="p">,</span><span class="s2">&quot;sc&quot;</span><span class="p">,</span>
<span class="s2">&quot;ti&quot;</span><span class="p">,</span><span class="s2">&quot;v&quot;</span><span class="p">,</span><span class="s2">&quot;cr&quot;</span><span class="p">,</span><span class="s2">&quot;mn&quot;</span><span class="p">,</span><span class="s2">&quot;fe&quot;</span><span class="p">,</span><span class="s2">&quot;co&quot;</span><span class="p">,</span><span class="s2">&quot;ni&quot;</span><span class="p">,</span><span class="s2">&quot;cu&quot;</span><span class="p">,</span><span class="s2">&quot;zn&quot;</span><span class="p">,</span><span class="s2">&quot;ga&quot;</span><span class="p">,</span><span class="s2">&quot;ge&quot;</span><span class="p">,</span>
<span class="s2">&quot;as&quot;</span><span class="p">,</span><span class="s2">&quot;se&quot;</span><span class="p">,</span><span class="s2">&quot;br&quot;</span><span class="p">,</span><span class="s2">&quot;kr&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">,</span> <span class="s2">&quot;sr&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;zr&quot;</span><span class="p">,</span> <span class="s2">&quot;nb&quot;</span><span class="p">,</span> <span class="s2">&quot;mo&quot;</span><span class="p">,</span> 
<span class="s2">&quot;tc&quot;</span><span class="p">,</span><span class="s2">&quot;ru&quot;</span><span class="p">,</span> <span class="s2">&quot;rh&quot;</span><span class="p">,</span> <span class="s2">&quot;pd&quot;</span><span class="p">,</span> <span class="s2">&quot;ag&quot;</span><span class="p">,</span> <span class="s2">&quot;cd&quot;</span><span class="p">,</span> <span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="s2">&quot;sn&quot;</span><span class="p">,</span> <span class="s2">&quot;sb&quot;</span><span class="p">,</span> <span class="s2">&quot;te&quot;</span><span class="p">,</span>
<span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;xe&quot;</span><span class="p">,</span> <span class="s2">&quot;cs&quot;</span><span class="p">,</span> <span class="s2">&quot;ba&quot;</span><span class="p">,</span> <span class="s2">&quot;la&quot;</span><span class="p">,</span> <span class="s2">&quot;ce&quot;</span><span class="p">,</span> <span class="s2">&quot;pr&quot;</span><span class="p">,</span> <span class="s2">&quot;nd&quot;</span><span class="p">,</span> <span class="s2">&quot;pm&quot;</span><span class="p">,</span> <span class="s2">&quot;sm&quot;</span><span class="p">,</span> 
<span class="s2">&quot;eu&quot;</span><span class="p">,</span> <span class="s2">&quot;gd&quot;</span><span class="p">,</span> <span class="s2">&quot;tb&quot;</span><span class="p">,</span> <span class="s2">&quot;dy&quot;</span><span class="p">,</span> <span class="s2">&quot;ho&quot;</span><span class="p">,</span> <span class="s2">&quot;er&quot;</span><span class="p">,</span> <span class="s2">&quot;tm&quot;</span><span class="p">,</span> <span class="s2">&quot;yb&quot;</span><span class="p">,</span> <span class="s2">&quot;lu&quot;</span><span class="p">,</span>
<span class="s2">&quot;hf&quot;</span><span class="p">,</span> <span class="s2">&quot;ta&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;re&quot;</span><span class="p">,</span> <span class="s2">&quot;os&quot;</span><span class="p">,</span> <span class="s2">&quot;ir&quot;</span><span class="p">,</span> <span class="s2">&quot;pt&quot;</span><span class="p">,</span> <span class="s2">&quot;au&quot;</span><span class="p">,</span> <span class="s2">&quot;hg&quot;</span><span class="p">,</span> <span class="s2">&quot;tl&quot;</span><span class="p">,</span> <span class="s2">&quot;pb&quot;</span><span class="p">,</span> <span class="s2">&quot;bi&quot;</span><span class="p">]</span>

    <span class="n">Masses</span><span class="o">=</span><span class="p">[</span><span class="mf">1.007825</span><span class="p">,</span> <span class="mf">4.002602</span><span class="p">,</span> <span class="mf">6.94</span><span class="p">,</span> <span class="mf">9.0121831</span><span class="p">,</span> <span class="mf">10.81</span><span class="p">,</span> <span class="mf">12.0000</span><span class="p">,</span> <span class="mf">14.007</span><span class="p">,</span> <span class="mf">15.9949159</span><span class="p">,</span> <span class="mf">18.998403163</span><span class="p">,</span> <span class="mf">20.1797</span><span class="p">,</span> <span class="mf">22.98976928</span><span class="p">,</span> <span class="mf">24.305</span><span class="p">,</span> <span class="mf">26.9815385</span><span class="p">,</span> <span class="mf">28.085</span><span class="p">,</span> <span class="mf">30.973761998</span><span class="p">,</span> <span class="mf">32.06</span><span class="p">,</span> <span class="mf">35.45</span><span class="p">,</span> <span class="mf">39.948</span><span class="p">,</span> <span class="mf">39.0983</span><span class="p">,</span> <span class="mf">40.078</span><span class="p">,</span> <span class="mf">44.955908</span><span class="p">,</span> <span class="mf">47.867</span><span class="p">,</span> <span class="mf">50.9415</span><span class="p">,</span> <span class="mf">51.9961</span><span class="p">,</span> <span class="mf">54.938044</span><span class="p">,</span> <span class="mf">55.845</span><span class="p">,</span> <span class="mf">58.933194</span><span class="p">,</span> <span class="mf">58.6934</span><span class="p">,</span> <span class="mf">63.546</span><span class="p">,</span> <span class="mf">65.38</span><span class="p">,</span> <span class="mf">69.723</span><span class="p">,</span> <span class="mf">72.63</span><span class="p">,</span> <span class="mf">74.921595</span><span class="p">,</span> <span class="mf">78.971</span><span class="p">,</span> <span class="mf">79.904</span><span class="p">,</span> <span class="mf">83.798</span><span class="p">,</span> <span class="mf">85.4678</span><span class="p">,</span> <span class="mf">87.62</span><span class="p">,</span> <span class="mf">88.90584</span><span class="p">,</span> <span class="mf">91.224</span><span class="p">,</span> <span class="mf">92.90637</span><span class="p">,</span> <span class="mf">95.95</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mf">101.07</span><span class="p">,</span> <span class="mf">102.9055</span><span class="p">,</span> <span class="mf">106.42</span><span class="p">,</span> <span class="mf">107.8682</span><span class="p">,</span> <span class="mf">112.414</span><span class="p">,</span> <span class="mf">114.818</span><span class="p">,</span> <span class="mf">118.71</span><span class="p">,</span> <span class="mf">121.76</span><span class="p">,</span> <span class="mf">127.6</span><span class="p">,</span> <span class="mf">126.90447</span><span class="p">,</span> <span class="mf">131.293</span><span class="p">,</span> <span class="mf">132.90545196</span><span class="p">,</span> <span class="mf">137.327</span><span class="p">,</span> <span class="mf">138.90547</span><span class="p">,</span> <span class="mf">140.116</span><span class="p">,</span> <span class="mf">140.90766</span><span class="p">,</span> <span class="mf">144.242</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mf">150.36</span><span class="p">,</span> <span class="mf">151.964</span><span class="p">,</span> <span class="mf">157.25</span><span class="p">,</span> <span class="mf">158.92535</span><span class="p">,</span> <span class="mf">162.5</span><span class="p">,</span> <span class="mf">164.93033</span><span class="p">,</span> <span class="mf">167.259</span><span class="p">,</span> <span class="mf">168.93422</span><span class="p">,</span> <span class="mf">173.054</span><span class="p">,</span> <span class="mf">174.9668</span><span class="p">,</span> <span class="mf">178.49</span><span class="p">,</span> <span class="mf">180.94788</span><span class="p">,</span> <span class="mf">183.84</span><span class="p">,</span> <span class="mf">186.207</span><span class="p">,</span> <span class="mf">190.23</span><span class="p">,</span> <span class="mf">192.217</span><span class="p">,</span> <span class="mf">195.084</span><span class="p">,</span> <span class="mf">196.966569</span><span class="p">,</span> <span class="mf">200.592</span><span class="p">,</span> <span class="mf">204.38</span><span class="p">,</span> <span class="mf">207.2</span><span class="p">,</span> <span class="mf">208.9804</span><span class="p">]</span>

    <span class="n">Radii</span><span class="o">=</span><span class="p">[</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.9</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mf">1.9</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">2.7</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.9</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.9</span><span class="p">,</span> <span class="mf">1.9</span><span class="p">,</span> <span class="mf">1.9</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">]</span>

    <span class="c1">#balancing parameters</span>
    <span class="n">sangles</span><span class="o">=</span><span class="mf">1.0</span>
    <span class="n">souts</span><span class="o">=</span><span class="mf">1.0</span>
    <span class="n">storsions</span><span class="o">=</span><span class="mf">1.0</span></div>
<span class="c1">## Object Classes ##</span>

<div class="viewcode-block" id="Atom"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.Atom">[docs]</a><span class="k">class</span> <span class="nc">Atom</span><span class="p">:</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">symbol</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">mass</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mass</span><span class="o">=</span><span class="n">mass</span>
                <span class="k">if</span><span class="p">(</span><span class="n">mass</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
                        <span class="n">mass</span><span class="o">=</span><span class="n">Masses</span><span class="p">[</span><span class="n">Symbols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">symbol</span><span class="o">.</span><span class="n">lower</span><span class="p">())]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<div class="viewcode-block" id="Atom.punch"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.Atom.punch">[docs]</a>        <span class="k">def</span> <span class="nf">punch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">o</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">symbol</span><span class="si">:</span><span class="s2">2s</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mass</span><span class="si">:</span><span class="s2">8.4f</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                        <span class="n">o</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">%+16.4f</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">return</span><span class="p">(</span><span class="n">o</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="Vibration"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.Vibration">[docs]</a><span class="k">class</span> <span class="nc">Vibration</span><span class="p">:</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">ndegs</span><span class="p">,</span><span class="n">adv</span><span class="o">=</span><span class="p">[],</span><span class="n">ir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">raman</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">sym</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">adv</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">displacements</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ndegs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">displacements</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">adv</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">intIR</span><span class="o">=</span><span class="n">ir</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">intRaman</span><span class="o">=</span><span class="n">raman</span>
                <span class="c1"># these are just the coefficients, make</span>
                <span class="c1"># sure the list of ICs does not change during</span>
                <span class="c1"># the run of the program !!!</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">=</span><span class="p">{}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">VMP</span><span class="o">=</span><span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">VMLD</span><span class="o">=</span><span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">VMARD</span><span class="o">=</span><span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="o">=</span><span class="n">sym</span>
<div class="viewcode-block" id="Vibration.editDisplacements"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.Vibration.editDisplacements">[docs]</a>        <span class="k">def</span> <span class="nf">editDisplacements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>
                <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">displacements</span><span class="p">)):</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warnning: New displacements do not conform to previous.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">displacements</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">)</span></div>
<div class="viewcode-block" id="Vibration.editIntensity"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.Vibration.editIntensity">[docs]</a>        <span class="k">def</span> <span class="nf">editIntensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="s2">&quot;IR&quot;</span><span class="p">):</span>
                <span class="k">if</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;IR&quot;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">intIR</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;RAMAN&quot;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">intRaman</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span></div>
<div class="viewcode-block" id="Vibration.addVMP"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.Vibration.addVMP">[docs]</a>        <span class="k">def</span> <span class="nf">addVMP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vmp</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;VMP&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vmp</span><span class="p">)</span></div>
<div class="viewcode-block" id="Vibration.addVMLD"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.Vibration.addVMLD">[docs]</a>        <span class="k">def</span> <span class="nf">addVMLD</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">coefs</span><span class="p">,</span><span class="n">r2</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">exvar</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;VMLD&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;VMLD_R2&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">r2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;VMLD_EV&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">exvar</span></div>
<div class="viewcode-block" id="Vibration.addVMBLD"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.Vibration.addVMBLD">[docs]</a>        <span class="k">def</span> <span class="nf">addVMBLD</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">coefs</span><span class="p">,</span><span class="n">r2</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">exvar</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;VMBLD&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;VMBLD_R2&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">r2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;VMBLD_EV&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">exvar</span></div>
<div class="viewcode-block" id="Vibration.addVMARD"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.Vibration.addVMARD">[docs]</a>        <span class="k">def</span> <span class="nf">addVMARD</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">coefs</span><span class="p">,</span><span class="n">r2</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">exvar</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;VMARD&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;VMARD_R2&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">r2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;VMARD_EV&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">exvar</span></div>
<div class="viewcode-block" id="Vibration.string"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.Vibration.string">[docs]</a>        <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">o</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
                <span class="c1">#jk if(n&gt;0):</span>
                <span class="k">if</span><span class="p">(</span><span class="n">n</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">):</span>
                        <span class="n">o</span><span class="o">=</span><span class="s2">&quot;Mode </span><span class="si">%3d</span><span class="s2">: </span><span class="si">%8.2f</span><span class="s2"> cm-1 &quot;</span><span class="o">%</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                        <span class="n">o</span><span class="o">=</span><span class="s2">&quot;Mode at </span><span class="si">%8.2f</span><span class="s2"> cm-1 &quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">!=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
                        <span class="n">o</span> <span class="o">+=</span> <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2">) &quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intIR</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">o</span> <span class="o">+=</span> <span class="s2">&quot;(IR: </span><span class="si">%5.1f</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intIR</span><span class="p">)</span>
                <span class="k">if</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">intIR</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span><span class="ow">and</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intRaman</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">)):</span>
                        <span class="n">o</span> <span class="o">+=</span> <span class="s2">&quot;(Raman: </span><span class="si">%5.1f</span><span class="s2">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intRaman</span><span class="p">)</span>
                <span class="k">if</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">intIR</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">)</span><span class="ow">and</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intRaman</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">)):</span>
                        <span class="n">o</span> <span class="o">+=</span> <span class="s2">&quot;,Raman: </span><span class="si">%5.1f</span><span class="s2">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intRaman</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intRaman</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">o</span> <span class="o">+=</span> <span class="s2">&quot;)&quot;</span>
                <span class="k">return</span> <span class="n">o</span></div></div>

<div class="viewcode-block" id="System"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.System">[docs]</a><span class="k">class</span> <span class="nc">System</span><span class="p">:</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="o">=</span><span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">geo</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">natoms</span><span class="o">=</span><span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span><span class="o">=</span><span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vibrations</span><span class="o">=</span><span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">intcoords</span><span class="o">=</span><span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ADM</span><span class="o">=</span><span class="kc">None</span>
<div class="viewcode-block" id="System.punch"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.System.punch">[docs]</a>        <span class="k">def</span> <span class="nf">punch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">o</span><span class="o">=</span><span class="s2">&quot;System Data:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">o</span> <span class="o">+=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of atoms = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">natoms</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">o</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Atoms, Masses and Positions:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                        <span class="n">o</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a</span><span class="o">.</span><span class="n">punch</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="k">return</span><span class="p">(</span><span class="n">o</span><span class="p">)</span></div>
<div class="viewcode-block" id="System.addAtom"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.System.addAtom">[docs]</a>        <span class="k">def</span> <span class="nf">addAtom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">symbol</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">mass</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Atom</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">mass</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">natoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span></div>
<div class="viewcode-block" id="System.addVibration"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.System.addVibration">[docs]</a>        <span class="k">def</span> <span class="nf">addVibration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">frequency</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vibrations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Vibration</span><span class="p">(</span><span class="n">frequency</span><span class="p">,</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">natoms</span><span class="p">))</span></div>
<div class="viewcode-block" id="System.addVibIntensity"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.System.addVibIntensity">[docs]</a>        <span class="k">def</span> <span class="nf">addVibIntensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">idx</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;IR&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vibrations</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">editIntensity</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">kind</span><span class="p">)</span></div>
<div class="viewcode-block" id="System.addVibSymmetry"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.System.addVibSymmetry">[docs]</a>        <span class="k">def</span> <span class="nf">addVibSymmetry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">idx</span><span class="p">,</span><span class="n">sym</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vibrations</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">symmetry</span><span class="o">=</span><span class="n">sym</span></div>
<div class="viewcode-block" id="System.addDisplacements"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.System.addDisplacements">[docs]</a>        <span class="k">def</span> <span class="nf">addDisplacements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">idx</span><span class="p">,</span><span class="n">displacements</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vibrations</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">editDisplacements</span><span class="p">(</span><span class="n">displacements</span><span class="p">)</span></div>
<div class="viewcode-block" id="System.makeADM"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.System.makeADM">[docs]</a>        <span class="k">def</span> <span class="nf">makeADM</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ADM</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">natoms</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vibrations</span><span class="p">)))</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vibrations</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ADM</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vibrations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">displacements</span></div>
<div class="viewcode-block" id="System.checkADM"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.System.checkADM">[docs]</a>        <span class="k">def</span> <span class="nf">checkADM</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;Check orthogonalyty of the ADM&quot;&quot;&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">makeADM</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ADM</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                        <span class="n">norm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ADM</span><span class="p">[:,</span><span class="n">n</span><span class="p">])</span>
                        <span class="c1">#print(&quot;Norm of Vibrational Mode %d is %8.6f&quot;%(n+1,norm))</span>
                        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ADM</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                                <span class="n">c</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ADM</span><span class="p">[:,</span><span class="n">n</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">ADM</span><span class="p">[:,</span><span class="n">m</span><span class="p">])</span></div>
                                <span class="c1">#print(&quot;Cross between Mode %d and Mode %d is: %8.6f&quot;%(n+1,m+1,c))</span>
<div class="viewcode-block" id="System.makeGeo"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.System.makeGeo">[docs]</a>        <span class="k">def</span> <span class="nf">makeGeo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">geo</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">natoms</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">natoms</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">geo</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">r</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">symbol</span><span class="p">)</span></div>
<div class="viewcode-block" id="System.tripleMass"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.System.tripleMass">[docs]</a>        <span class="k">def</span> <span class="nf">tripleMass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">o</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">natoms</span><span class="p">)</span>
                <span class="n">n</span><span class="o">=</span><span class="mi">0</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">natoms</span><span class="p">):</span>
                        <span class="c1">#print(&quot; %d %2s %5.2f %10.6f %10.6f %10.6f&quot;%(i+1,self.atoms[i].symbol,self.atoms[i].mass,self.atoms[i].r[0],self.atoms[i].r[1],self.atoms[i].r[2]))</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                                <span class="n">o</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">mass</span>
                                <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">return</span> <span class="n">o</span></div>
<div class="viewcode-block" id="System.massWeightS"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.System.massWeightS">[docs]</a>        <span class="k">def</span> <span class="nf">massWeightS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">mass</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tripleMass</span><span class="p">())</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">mass</span></div>
<div class="viewcode-block" id="System.normalizeS"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.System.normalizeS">[docs]</a>        <span class="k">def</span> <span class="nf">normalizeS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span></div>
                <span class="c1">#self.S *= Opts[&quot;delta&quot;] #do we need this?</span>
<div class="viewcode-block" id="System.massWeightVibrations"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.System.massWeightVibrations">[docs]</a>        <span class="k">def</span> <span class="nf">massWeightVibrations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">mass</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tripleMass</span><span class="p">())</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vibrations</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vibrations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">displacements</span> <span class="o">*=</span> <span class="n">mass</span></div>
<div class="viewcode-block" id="System.normalizeVibrations"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.System.normalizeVibrations">[docs]</a>        <span class="k">def</span> <span class="nf">normalizeVibrations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vibrations</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vibrations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">displacements</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vibrations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">displacements</span><span class="p">)</span></div>
<div class="viewcode-block" id="System.removeVibrations"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.System.removeVibrations">[docs]</a>        <span class="k">def</span> <span class="nf">removeVibrations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">elst</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">))):</span>
                <span class="n">idx</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vibrations</span><span class="p">)):</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">elst</span><span class="p">):</span>
                                <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vibrations</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vibrations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">]</span></div>
<div class="viewcode-block" id="System.sortVibrations"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.System.sortVibrations">[docs]</a>        <span class="k">def</span> <span class="nf">sortVibrations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vibrations</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vibrations</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div></div>

<span class="c1">## Input-Output Functions ##</span>

<div class="viewcode-block" id="readMopac2016"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.readMopac2016">[docs]</a><span class="k">def</span> <span class="nf">readMopac2016</span><span class="p">(</span><span class="n">ifn</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Opens a MOPAC2016 output file ifn and returns A System object.</span>
<span class="sd">        Depending on Linear and Transition, freqs and modes will be</span>
<span class="sd">        pruned out of the translational and rotational components.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">ifn</span><span class="p">)</span>
        <span class="n">data</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">o</span><span class="o">=</span><span class="n">System</span><span class="p">()</span>
        <span class="c1"># read geometry (in angs) and atomic symbols, get masses from internal lib</span>
        <span class="n">natoms</span><span class="o">=-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                <span class="k">if</span><span class="p">(</span><span class="s2">&quot;Empirical Formula:&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                        <span class="n">natoms</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
                        <span class="k">break</span>
        <span class="k">if</span><span class="p">(</span><span class="n">natoms</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Could not read MOPAC output: no empirical formula!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;ORIENTATION OF MOLECULE IN FORCE CALCULATION&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="o">+</span><span class="n">natoms</span><span class="p">):</span>
                                <span class="n">l</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                                <span class="n">o</span><span class="o">.</span><span class="n">addAtom</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]))),</span><span class="n">Masses</span><span class="p">[</span><span class="n">Symbols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())])</span>
                        <span class="k">break</span>
        <span class="c1"># read frequency list and displacements</span>
        <span class="n">istart</span><span class="o">=-</span><span class="mi">1</span>
        <span class="n">iend</span><span class="o">=-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                <span class="k">if</span><span class="p">(</span><span class="s2">&quot; NORMAL COORDINATE ANALYSIS&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                        <span class="n">istart</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span>
                <span class="k">if</span><span class="p">(</span><span class="s2">&quot;MASS-WEIGHTED COORDINATE ANALYSIS&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                        <span class="n">iend</span><span class="o">=</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span>
                        <span class="k">break</span>
        <span class="k">if</span><span class="p">((</span><span class="n">istart</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="ow">or</span><span class="p">(</span><span class="n">iend</span><span class="o">&lt;</span><span class="n">istart</span><span class="p">)):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Could not read MOPAC output: invalid format for normal coordinate analysis.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">tfreq</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">tir</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">tsym</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">tdisp</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">n</span><span class="o">=</span><span class="n">istart</span>
        <span class="n">curr</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">last</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">while</span><span class="p">(</span><span class="n">n</span><span class="o">&lt;</span><span class="n">iend</span><span class="p">):</span>
                <span class="k">if</span><span class="p">(</span><span class="s2">&quot;Root No.&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">]):</span>
                        <span class="n">curr</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">-</span><span class="mi">2</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">curr</span><span class="p">):</span>
                                <span class="n">tdisp</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                        <span class="c1">#reading symmetries</span>
                        <span class="n">n</span> <span class="o">+=</span> <span class="mi">2</span>
                        <span class="n">l</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">),</span><span class="mi">2</span><span class="p">):</span>
                                <span class="n">tsym</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="c1">#reading frequencies</span>
                        <span class="n">n</span> <span class="o">+=</span> <span class="mi">2</span>
                        <span class="n">l</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
                                <span class="n">tfreq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                        <span class="c1">#reading displacements</span>
                        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">natoms</span><span class="p">):</span>
                                <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">l</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
                                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">last</span><span class="p">,</span><span class="n">last</span><span class="o">+</span><span class="n">curr</span><span class="p">):</span>
                                        <span class="n">tdisp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="n">last</span><span class="p">])</span>
                        <span class="n">last</span> <span class="o">+=</span> <span class="n">curr</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># read T-DIPOLE as sorrrugate for IR intensities</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                <span class="k">if</span><span class="p">(</span><span class="s2">&quot;T-DIPOLE&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                        <span class="n">tir</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="c1"># assemble output System</span>
        <span class="n">putir</span><span class="o">=</span><span class="kc">True</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tir</span><span class="p">)</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">tfreq</span><span class="p">)):</span>
                <span class="c1">#logging.warning(&quot;IR intensities nor found.&quot;)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warnning: Could not read IR intensities.&quot;</span><span class="p">)</span>
                <span class="n">putir</span><span class="o">=</span><span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span>  <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tfreq</span><span class="p">)):</span>
                <span class="k">if</span><span class="p">(</span><span class="n">putir</span><span class="p">):</span>
                        <span class="n">o</span><span class="o">.</span><span class="n">vibrations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Vibration</span><span class="p">(</span><span class="n">tfreq</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">3</span><span class="o">*</span><span class="n">natoms</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">tdisp</span><span class="p">[</span><span class="n">i</span><span class="p">]))),</span><span class="n">ir</span><span class="o">=</span><span class="n">tir</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">sym</span><span class="o">=</span><span class="n">tsym</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                        <span class="n">o</span><span class="o">.</span><span class="n">vibrations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Vibration</span><span class="p">(</span><span class="n">tfreq</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">3</span><span class="o">*</span><span class="n">natoms</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">tdisp</span><span class="p">[</span><span class="n">i</span><span class="p">]))),</span><span class="n">sym</span><span class="o">=</span><span class="n">tsym</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">o</span></div>


<div class="viewcode-block" id="readHess"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.readHess">[docs]</a><span class="k">def</span> <span class="nf">readHess</span><span class="p">(</span><span class="n">ifn</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Opens Orca Hess file ifn and returns A System object.</span>
<span class="sd">        Depending on Linear and Transition, freqs and modes will be</span>
<span class="sd">        pruned out of the translational and rotational components.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">ifn</span><span class="p">)</span>
        <span class="n">data</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">o</span><span class="o">=</span><span class="n">System</span><span class="p">()</span>
        <span class="c1"># read masses, geometry (in angs) and atomic symbols</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;$atoms&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                        <span class="n">natoms</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="n">natoms</span><span class="p">):</span>
                                <span class="n">l</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                                <span class="n">o</span><span class="o">.</span><span class="n">addAtom</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">])))</span><span class="o">*</span><span class="n">Bohr2Ang</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="k">break</span>
        <span class="c1"># read frequency list</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;$vibrational_frequencies&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                        <span class="n">nfreqs</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="n">nfreqs</span><span class="p">):</span>
                                <span class="n">o</span><span class="o">.</span><span class="n">addVibration</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="k">break</span>
        <span class="c1"># read normal mode displacements</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;$normal_modes&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                        <span class="n">ndegs</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">ipos</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span>
                        <span class="k">break</span>
        <span class="n">modes</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ndegs</span><span class="p">,</span><span class="n">ndegs</span><span class="p">))</span>
        <span class="c1">#count number of cols on first line</span>
        <span class="n">incr</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">ipos</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">nils</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ndegs</span><span class="o">/</span><span class="n">incr</span><span class="p">)</span>
        <span class="n">nrem</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">ndegs</span><span class="p">,</span><span class="n">incr</span><span class="p">)</span>
        <span class="c1">#epos=ipos+((ndegs+1)*nils)+1 #old versions of Orca?</span>
        <span class="n">epos</span><span class="o">=</span><span class="n">ipos</span><span class="o">+</span><span class="p">((</span><span class="n">ndegs</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">nils</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nrem</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span> <span class="n">epos</span><span class="o">+=</span> <span class="p">(</span><span class="n">ndegs</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">icol</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">ecol</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">nread</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ipos</span><span class="p">,</span><span class="n">epos</span><span class="p">,</span><span class="n">ndegs</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">icol</span><span class="o">=</span><span class="n">ecol</span>
                <span class="n">ecol</span><span class="o">=</span><span class="n">icol</span><span class="o">+</span><span class="n">incr</span>
                <span class="n">nread</span><span class="o">+=</span><span class="mi">1</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">nread</span><span class="o">&gt;</span><span class="n">nils</span><span class="p">):</span> <span class="n">ecol</span><span class="o">=</span><span class="n">ndegs</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">l</span><span class="o">=</span><span class="mi">0</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="n">ndegs</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                        <span class="n">line</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
                        <span class="n">modes</span><span class="p">[</span><span class="n">l</span><span class="p">,</span><span class="n">icol</span><span class="p">:</span><span class="n">ecol</span><span class="p">]</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">line</span><span class="p">))</span>
                        <span class="n">l</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndegs</span><span class="p">):</span>
                <span class="n">o</span><span class="o">.</span><span class="n">addDisplacements</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">modes</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
        <span class="c1"># read IR intensities</span>
        <span class="n">found</span><span class="o">=</span><span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;$ir_spectrum&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                        <span class="n">nfreqs</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nfreqs</span><span class="p">):</span>
                                <span class="n">o</span><span class="o">.</span><span class="n">addVibIntensity</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]),</span><span class="s2">&quot;IR&quot;</span><span class="p">)</span>
                        <span class="n">found</span><span class="o">=</span><span class="kc">True</span>
                        <span class="k">break</span>
        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">found</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warnning: IR intensities not found.&quot;</span><span class="p">)</span>
        <span class="c1"># read Raman intensities</span>
        <span class="n">found</span><span class="o">=</span><span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;$raman_spectrum&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                        <span class="n">nfreqs</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nfreqs</span><span class="p">):</span>
                                <span class="n">o</span><span class="o">.</span><span class="n">addVibIntensity</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]),</span><span class="s2">&quot;Raman&quot;</span><span class="p">)</span>
                        <span class="n">found</span><span class="o">=</span><span class="kc">True</span>
                        <span class="k">break</span>
        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">found</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warnning: Raman intensities not found.&quot;</span><span class="p">)</span>
        <span class="c1"># prune rotational and translational modes from freqs, modes, and Ints</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;isLinear&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;isTState&quot;</span><span class="p">]):</span>
                <span class="n">excl</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;isLinear&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;isTState&quot;</span><span class="p">]):</span>
                <span class="n">excl</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
        <span class="k">elif</span><span class="p">((</span><span class="ow">not</span> <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;isLinear&quot;</span><span class="p">])</span> <span class="ow">and</span> <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;isTState&quot;</span><span class="p">]):</span>
                <span class="n">excl</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="n">excl</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">o</span><span class="o">.</span><span class="n">removeVibrations</span><span class="p">(</span><span class="n">excl</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">o</span></div>

<div class="viewcode-block" id="readPDielec"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.readPDielec">[docs]</a><span class="k">def</span> <span class="nf">readPDielec</span><span class="p">(</span><span class="n">ifn</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use PDielec library to read hessian information.</span>
<span class="sd">        only the first 3 modes will be pruned; the translational components.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Open the file use pdielec library</span>
        <span class="kn">import</span> <span class="nn">math</span>

        <span class="kn">from</span> <span class="nn">PDielec</span> <span class="kn">import</span> <span class="n">Calculator</span><span class="p">,</span> <span class="n">Utilities</span>
        <span class="kn">from</span> <span class="nn">PDielec.Constants</span> <span class="kn">import</span> <span class="n">amu</span><span class="p">,</span> <span class="n">average_masses</span>
        <span class="c1"># Use as many defaults as possible</span>
        <span class="c1"># First determine the program used to create the output file</span>
        <span class="n">program</span><span class="p">,</span><span class="n">qmprogram</span> <span class="o">=</span> <span class="n">Utilities</span><span class="o">.</span><span class="n">find_program_from_name</span><span class="p">(</span><span class="n">ifn</span><span class="p">)</span>
        <span class="c1"># Create the reader</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">Utilities</span><span class="o">.</span><span class="n">get_reader</span><span class="p">(</span><span class="n">ifn</span><span class="p">,</span><span class="n">program</span><span class="p">,</span><span class="n">qmprogram</span><span class="p">)</span>
        <span class="c1"># Assume that projection is going to be used</span>
        <span class="n">reader</span><span class="o">.</span><span class="n">eckart</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">reader</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Perform the reading</span>
        <span class="n">reader</span><span class="o">.</span><span class="n">read_output</span><span class="p">()</span>
        <span class="c1"># Force average masses for the calculation</span>
        <span class="n">mass_dictionary</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">reader</span><span class="o">.</span><span class="n">change_masses</span><span class="p">(</span><span class="n">average_masses</span><span class="p">,</span> <span class="n">mass_dictionary</span><span class="p">)</span>
        <span class="n">born_charges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">born_charges</span><span class="p">)</span>
        <span class="c1"># Get the mass weighted normal modes and the unweighted normal modes</span>
        <span class="n">mass_weighted_normal_modes</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">calculate_mass_weighted_normal_modes</span><span class="p">()</span>
        <span class="c1"># The masses might have changed in the calculation of the mass weighted normal modes</span>
        <span class="n">masses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">masses</span><span class="p">)</span> <span class="o">*</span> <span class="n">amu</span>
        <span class="n">normal_modes</span> <span class="o">=</span> <span class="n">Calculator</span><span class="o">.</span><span class="n">normal_modes</span><span class="p">(</span><span class="n">masses</span><span class="p">,</span> <span class="n">mass_weighted_normal_modes</span><span class="p">)</span>
        <span class="c1"># Calculate the oscillator strengths</span>
        <span class="n">oscillator_strengths</span> <span class="o">=</span> <span class="n">Calculator</span><span class="o">.</span><span class="n">oscillator_strengths</span><span class="p">(</span><span class="n">normal_modes</span><span class="p">,</span> <span class="n">born_charges</span><span class="p">)</span>
        <span class="n">frequencies_cm1</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">frequencies</span>
        <span class="n">frequencies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frequencies_cm1</span><span class="p">)</span>
        <span class="c1"># if the frequency is less than 5 cm-1 assume that the oscillator strength is zero</span>
        <span class="k">for</span> <span class="n">imode</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frequencies</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">f</span> <span class="o">&lt;</span> <span class="mf">5.0</span><span class="p">:</span>
                <span class="n">oscillator_strengths</span><span class="p">[</span><span class="n">imode</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="c1"># calculate the intensities from the trace of the oscillator strengths</span>
        <span class="n">intensities</span> <span class="o">=</span> <span class="n">Calculator</span><span class="o">.</span><span class="n">infrared_intensities</span><span class="p">(</span><span class="n">oscillator_strengths</span><span class="p">)</span>
        <span class="c1"># get masses, geometry (in angs) and atomic symbols</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">get_unit_cell</span><span class="p">()</span>
        <span class="c1"># We need to see if we can generate whole molecules using translational symmetry</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="mf">1.1</span>      <span class="c1"># Scaling factor for covalent radii</span>
        <span class="n">tolerance</span>  <span class="o">=</span> <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;tol&quot;</span><span class="p">]</span>  <span class="c1"># Tolerance in bonding</span>
        <span class="n">new_cell</span><span class="p">,</span><span class="n">natoms</span><span class="p">,</span><span class="n">original_atomic_order</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">calculate_molecular_contents</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bonding tolerance&quot;</span><span class="p">,</span><span class="n">tolerance</span><span class="p">,</span><span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of molecules&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">new_cell</span><span class="o">.</span><span class="n">molecules</span><span class="p">),</span><span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="c1"># Reorder the normal mode atoms so that the mass weighted normal modes order </span>
        <span class="c1"># agrees with the ordering in the cell_of_molecules cell</span>
        <span class="n">nmodes</span><span class="p">,</span><span class="n">nions</span><span class="p">,</span><span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">normal_modes</span><span class="p">)</span>
        <span class="n">new_normal_modes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span><span class="n">nmodes</span><span class="p">,</span><span class="mi">3</span><span class="o">*</span><span class="n">nions</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">new_mass_weighted_normal_modes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="p">(</span><span class="n">nmodes</span><span class="p">,</span><span class="mi">3</span><span class="o">*</span><span class="n">nions</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">masses</span> <span class="o">=</span> <span class="n">new_cell</span><span class="o">.</span><span class="n">get_atomic_masses</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">imode</span><span class="p">,</span><span class="n">mode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mass_weighted_normal_modes</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">old_index</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">original_atomic_order</span><span class="p">):</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">index</span><span class="o">*</span><span class="mi">3</span>
                <span class="n">new_mass_weighted_normal_modes</span><span class="p">[</span><span class="n">imode</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="n">old_index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">new_mass_weighted_normal_modes</span><span class="p">[</span><span class="n">imode</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="n">old_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">new_mass_weighted_normal_modes</span><span class="p">[</span><span class="n">imode</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="n">old_index</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">new_normal_modes</span><span class="p">[</span><span class="n">imode</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_mass_weighted_normal_modes</span><span class="p">[</span><span class="n">imode</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">masses</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
                <span class="n">new_normal_modes</span><span class="p">[</span><span class="n">imode</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_mass_weighted_normal_modes</span><span class="p">[</span><span class="n">imode</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">masses</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
                <span class="n">new_normal_modes</span><span class="p">[</span><span class="n">imode</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_mass_weighted_normal_modes</span><span class="p">[</span><span class="n">imode</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">masses</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>

        <span class="c1">#</span>
        <span class="c1"># OK - now we can start the interface to VibAnalysis</span>
        <span class="c1">#</span>
        <span class="n">o</span><span class="o">=</span><span class="n">System</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">el</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">new_cell</span><span class="o">.</span><span class="n">element_names</span><span class="p">,</span><span class="n">new_cell</span><span class="o">.</span><span class="n">atomic_masses</span><span class="p">,</span> <span class="n">new_cell</span><span class="o">.</span><span class="n">xyz_coordinates</span><span class="p">):</span>
            <span class="c1"># print(&#39;Adding atom &#39;,el.lower(),c,m)</span>
            <span class="n">o</span><span class="o">.</span><span class="n">addAtom</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">c</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
        <span class="c1"># get frequency list</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">frequencies</span><span class="p">:</span>
            <span class="c1"># print(&#39;Adding frequency &#39;,f)</span>
            <span class="n">o</span><span class="o">.</span><span class="n">addVibration</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="c1"># get normal mode displacements</span>
        <span class="n">ndegs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndegs</span><span class="p">):</span>
            <span class="c1"># print(&#39;Adding displacement &#39;,i,new_normal_modes[i])</span>
            <span class="n">o</span><span class="o">.</span><span class="n">addDisplacements</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">new_normal_modes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="c1"># get IR intensities</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">intens</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">intensities</span><span class="p">):</span>
            <span class="c1"># Not sure of the units expected here</span>
            <span class="c1"># The units from PDielec should be Debye^2/Angs^2/amu</span>
            <span class="c1"># Multiplying by 4225.6 should give Absorption in L/mole/cm2 </span>
            <span class="c1"># I am doing this because otherwise there are lots of zero intensities in the output</span>
            <span class="c1"># print(&#39;Adding IR intensity &#39;,i,4255.6*intens)</span>
            <span class="n">o</span><span class="o">.</span><span class="n">addVibIntensity</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mf">4255.6</span><span class="o">*</span><span class="n">intens</span><span class="p">,</span><span class="s2">&quot;IR&quot;</span><span class="p">)</span>
        <span class="c1"># no Raman intensities</span>
        <span class="c1"># prune translational modes from freqs, modes, and Ints</span>
        <span class="c1">#JK excl=list(range(3))</span>
        <span class="c1">#JK o.removeVibrations(excl)</span>
        <span class="k">return</span> <span class="n">o</span></div>

<div class="viewcode-block" id="readG09log"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.readG09log">[docs]</a><span class="k">def</span> <span class="nf">readG09log</span><span class="p">(</span><span class="n">ifn</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Opens Gaussian09 log file ifn and returns a System object with</span>
<span class="sd">        information regarding the system and vibrations.</span>
<span class="sd">        Depending on Linear and Transition, freqs and modes will be</span>
<span class="sd">        pruned out of the translational and rotational components.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">o</span><span class="o">=</span><span class="n">System</span><span class="p">()</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Opening Gaussian log file: </span><span class="si">{</span><span class="n">ifn</span><span class="si">:</span><span class="s2">s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">ifn</span><span class="p">)</span>
        <span class="n">data</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c1"># get number of atoms</span>
        <span class="n">natoms</span><span class="o">=-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                <span class="k">if</span><span class="p">(</span><span class="s2">&quot;NAtoms=&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                        <span class="n">natoms</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expecting </span><span class="si">{</span><span class="n">natoms</span><span class="si">}</span><span class="s2"> atoms from reading line </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">break</span>
        <span class="n">symbols</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">mass</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">natoms</span><span class="p">)</span>
        <span class="n">geo</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">natoms</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">p</span><span class="o">=</span><span class="mi">0</span>
        <span class="c1">#read (last) geometry in standard orientation</span>
        <span class="n">istart</span><span class="o">=-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                <span class="k">if</span><span class="p">(</span><span class="s2">&quot;Standard orientation:&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                        <span class="n">istart</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">5</span>
        <span class="k">if</span><span class="p">(</span><span class="n">istart</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">istart</span><span class="p">,</span><span class="n">istart</span><span class="o">+</span><span class="n">natoms</span><span class="p">):</span>
                        <span class="n">l</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="n">o</span><span class="o">.</span><span class="n">addAtom</span><span class="p">(</span><span class="n">Symbols</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">l</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:])))</span>
        <span class="c1">#read masses</span>
        <span class="n">istart</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                <span class="k">if</span><span class="p">(</span><span class="s2">&quot;- Thermochemistry -&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                        <span class="n">istart</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span>
                        <span class="k">break</span>
        <span class="k">if</span><span class="p">(</span><span class="n">istart</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">istart</span><span class="p">,</span><span class="n">istart</span><span class="o">+</span><span class="n">natoms</span><span class="p">):</span>
                        <span class="n">l</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="n">o</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mass</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Cannot read geometry!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># read vibrational frequencies, modes, IR and Raman Intensities</span>
        <span class="n">nfreqs</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">freqs</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">irInt</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">raInt</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">sym</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">modes</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="o">*</span><span class="n">natoms</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                <span class="n">mstart</span><span class="o">=-</span><span class="mi">1</span>
                <span class="k">if</span><span class="p">(</span><span class="s2">&quot;Frequencies -- &quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                        <span class="c1"># read symmetries</span>
                        <span class="n">l</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
                                <span class="n">sym</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                        <span class="n">l</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">:]</span>
                        <span class="n">freqsInRow</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
                                <span class="n">freqs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">9</span><span class="p">):</span>
                                <span class="k">if</span><span class="p">(</span><span class="s2">&quot;Atom&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                                        <span class="n">mstart</span><span class="o">=</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span>
                                        <span class="k">break</span>
                                <span class="k">if</span><span class="p">(</span><span class="s2">&quot;IR Inten    --&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                                        <span class="n">l</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">:]</span>
                                        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
                                                <span class="n">irInt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
                                <span class="k">if</span><span class="p">(</span><span class="s2">&quot;Raman Activ --&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                                        <span class="n">l</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">:]</span>
                                        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
                                                <span class="n">raInt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
                        <span class="n">lmodes</span><span class="o">=</span><span class="p">[]</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">freqsInRow</span><span class="p">):</span>
                                <span class="n">lmodes</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mstart</span><span class="p">,</span><span class="n">mstart</span><span class="o">+</span><span class="n">natoms</span><span class="p">):</span>
                                <span class="n">p</span><span class="o">=</span><span class="mi">0</span>
                                <span class="n">l</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">:]))</span>
                                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">freqsInRow</span><span class="p">):</span>
                                        <span class="n">lmodes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="n">p</span><span class="p">])</span> <span class="c1">#dx</span>
                                        <span class="n">p</span> <span class="o">+=</span> <span class="mi">1</span>
                                        <span class="n">lmodes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="n">p</span><span class="p">])</span> <span class="c1">#dy</span>
                                        <span class="n">p</span> <span class="o">+=</span> <span class="mi">1</span>
                                        <span class="n">lmodes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="n">p</span><span class="p">])</span> <span class="c1">#dz</span>
                        <span class="n">lmodes</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lmodes</span><span class="p">))</span>
                        <span class="n">modes</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">modes</span><span class="p">,</span><span class="n">lmodes</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">irInt</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warnning: IR intensities not found.&quot;</span><span class="p">)</span>
                <span class="n">irInt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">))</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">raInt</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Could not find Raman Intensities.&quot;</span><span class="p">)</span>
                <span class="c1">#print(&quot;Warnning: Raman intensities not found.&quot;)</span>
                <span class="n">raInt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">))</span>
        <span class="c1"># send information to System:</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">)):</span>
                <span class="n">o</span><span class="o">.</span><span class="n">vibrations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Vibration</span><span class="p">(</span><span class="n">freqs</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="mi">3</span><span class="o">*</span><span class="n">natoms</span><span class="p">,</span><span class="n">modes</span><span class="p">[:,</span><span class="n">n</span><span class="p">],</span> <span class="n">irInt</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">raInt</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">sym</span><span class="p">[</span><span class="n">n</span><span class="p">]))</span>
        <span class="c1"># normalize normal modes</span>
        <span class="c1">#for i in range(np.shape(modes)[1]):</span>
        <span class="c1">#        modes[:,i]=modes[:,i]/np.linalg.norm(modes[:,i])</span>
        <span class="k">return</span> <span class="n">o</span></div>

<div class="viewcode-block" id="readUserIC"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.readUserIC">[docs]</a><span class="k">def</span> <span class="nf">readUserIC</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reads additional internal coordinates defined by the user&quot;&quot;&quot;</span>
        <span class="n">o</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">udata</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">udata</span><span class="p">:</span>
                <span class="k">if</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span>
                        <span class="k">continue</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
                        <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                        <span class="n">l</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;B&quot;</span><span class="p">):</span>
                                <span class="n">o</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">elif</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;A&quot;</span><span class="p">):</span>
                                <span class="n">o</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">elif</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;O&quot;</span><span class="p">):</span>
                                <span class="n">o</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">elif</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;T&quot;</span><span class="p">):</span>
                                <span class="n">o</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                                <span class="k">continue</span>
        <span class="k">return</span><span class="p">(</span><span class="n">o</span><span class="p">)</span></div>

<div class="viewcode-block" id="modeStr"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.modeStr">[docs]</a><span class="k">def</span> <span class="nf">modeStr</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span><span class="n">symbs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a formatted string describing mode&quot;&quot;&quot;</span>
        <span class="n">o</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span> <span class="c1"># bond</span>
                <span class="n">o</span><span class="o">=</span><span class="s2">&quot;BOND </span><span class="si">%s%d</span><span class="s2"> </span><span class="si">%s%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">symbs</span><span class="p">[</span><span class="n">mode</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span><span class="n">mode</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">symbs</span><span class="p">[</span><span class="n">mode</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span><span class="n">mode</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span> <span class="c1"># ANGLE</span>
                <span class="n">o</span><span class="o">=</span><span class="s2">&quot;ANGLE </span><span class="si">%s%d</span><span class="s2"> </span><span class="si">%s%d</span><span class="s2"> </span><span class="si">%s%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">symbs</span><span class="p">[</span><span class="n">mode</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span><span class="n">mode</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">symbs</span><span class="p">[</span><span class="n">mode</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span><span class="n">mode</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">symbs</span><span class="p">[</span><span class="n">mode</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span><span class="n">mode</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">3</span><span class="p">):</span> <span class="c1"># OUT OF PLANE</span>
                <span class="n">o</span><span class="o">=</span><span class="s2">&quot;OUT </span><span class="si">%s%d</span><span class="s2"> </span><span class="si">%s%d</span><span class="s2"> </span><span class="si">%s%d</span><span class="s2"> </span><span class="si">%s%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">symbs</span><span class="p">[</span><span class="n">mode</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span><span class="n">mode</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">symbs</span><span class="p">[</span><span class="n">mode</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span><span class="n">mode</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">symbs</span><span class="p">[</span><span class="n">mode</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span><span class="n">mode</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">symbs</span><span class="p">[</span><span class="n">mode</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span><span class="n">mode</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">4</span><span class="p">):</span> <span class="c1"># TORSION</span>
                <span class="n">o</span><span class="o">=</span><span class="s2">&quot;TORSION </span><span class="si">%s%d</span><span class="s2"> </span><span class="si">%s%d</span><span class="s2"> </span><span class="si">%s%d</span><span class="s2"> </span><span class="si">%s%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">symbs</span><span class="p">[</span><span class="n">mode</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span><span class="n">mode</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">symbs</span><span class="p">[</span><span class="n">mode</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span><span class="n">mode</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">symbs</span><span class="p">[</span><span class="n">mode</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span><span class="n">mode</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">symbs</span><span class="p">[</span><span class="n">mode</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span><span class="n">mode</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">o</span><span class="p">)</span></div>

<div class="viewcode-block" id="punchIC"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.punchIC">[docs]</a><span class="k">def</span> <span class="nf">punchIC</span><span class="p">(</span><span class="n">o</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Punches a list of internal coordinates and their</span>
<span class="sd">        meassured values to file o</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">o</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">List of Internal Coordinates and their values</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">intcoords</span><span class="p">)):</span>
                <span class="n">desc</span><span class="o">=</span><span class="n">modeStr</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">intcoords</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">s</span><span class="o">.</span><span class="n">symbol</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">intcoords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span> <span class="c1">#bond</span>
                        <span class="n">val</span><span class="o">=</span><span class="n">bondLength</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">geo</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">intcoords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">intcoords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span> <span class="c1">#angle</span>
                        <span class="n">val</span><span class="o">=</span><span class="n">angleAmp</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">geo</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">intcoords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">intcoords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">3</span><span class="p">):</span> <span class="c1"># out</span>
                        <span class="n">val</span><span class="o">=</span><span class="n">oopAmp</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">geo</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">intcoords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">intcoords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">4</span><span class="p">):</span> <span class="c1"># TORS</span>
                        <span class="n">val</span><span class="o">=</span><span class="n">torsionAmp</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">geo</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">intcoords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">o</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">%4d</span><span class="s2"> </span><span class="si">%-25s</span><span class="s2"> </span><span class="si">%8.3f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">desc</span><span class="p">,</span><span class="n">val</span><span class="p">))</span>
        <span class="n">o</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="animateMode"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.animateMode">[docs]</a><span class="k">def</span> <span class="nf">animateMode</span><span class="p">(</span><span class="n">tfn</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">nsteps</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">damp</span><span class="o">=</span><span class="mf">0.33</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Displaces geo over vibrational displacement m and punches a xyz file tfn&quot;&quot;&quot;</span>
        <span class="n">natoms</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
        <span class="n">tf</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">tfn</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">v</span><span class="o">=</span><span class="n">damp</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">nsteps</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsteps</span><span class="p">):</span>
                <span class="n">g</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">vibrations</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">.</span><span class="n">displacements</span><span class="p">)</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">%d</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> Generated by vibAnalysis d=</span><span class="si">%7.4f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">natoms</span><span class="p">,</span><span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]))</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">natoms</span><span class="p">):</span>
                        <span class="n">tf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">%3s</span><span class="s2"> </span><span class="si">%10.6f</span><span class="s2"> </span><span class="si">%10.6f</span><span class="s2"> </span><span class="si">%10.6f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">symbol</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">g</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="p">],</span><span class="n">g</span><span class="p">[(</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">g</span><span class="p">[(</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="animateIC"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.animateIC">[docs]</a><span class="k">def</span> <span class="nf">animateIC</span><span class="p">(</span><span class="n">tfn</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">nsteps</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">damp</span><span class="o">=</span><span class="mf">0.33</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Displaces geo over internal coordinate m and punches a xyz file tfn&quot;&quot;&quot;</span>
        <span class="n">natoms</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
        <span class="n">tf</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">tfn</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">v</span><span class="o">=</span><span class="n">damp</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">nsteps</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsteps</span><span class="p">):</span>
                <span class="n">g</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="o">.</span><span class="n">S</span><span class="p">[:,</span><span class="n">m</span><span class="p">])</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">%d</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> Generated by vibAnalysis d=</span><span class="si">%7.4f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">natoms</span><span class="p">,</span><span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]))</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">natoms</span><span class="p">):</span>
                        <span class="n">tf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">%3s</span><span class="s2"> </span><span class="si">%10.6f</span><span class="s2"> </span><span class="si">%10.6f</span><span class="s2"> </span><span class="si">%10.6f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">symbol</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">g</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="p">],</span><span class="n">g</span><span class="p">[(</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">g</span><span class="p">[(</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="printResults"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.printResults">[docs]</a><span class="k">def</span> <span class="nf">printResults</span><span class="p">(</span><span class="n">o</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prints the results of the analysis stored in system s onto file o&quot;&quot;&quot;</span>
        <span class="n">lanalysis</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;VMP&quot;</span><span class="p">,</span><span class="s2">&quot;VMLD&quot;</span><span class="p">,</span><span class="s2">&quot;VMBLD&quot;</span><span class="p">,</span><span class="s2">&quot;VMARD&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">lanalysis</span><span class="p">:</span>
                <span class="k">if</span><span class="p">(</span><span class="n">a</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">vibrations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="o">==</span><span class="s2">&quot;VMP&quot;</span><span class="p">):</span>
                                <span class="n">o</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">*** Vibrational Mode Projection (VMP) ***</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">elif</span><span class="p">(</span><span class="n">a</span><span class="o">==</span><span class="s2">&quot;VMLD&quot;</span><span class="p">):</span>
                                <span class="n">o</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">*** Vibrational Mode Linear Decomposition (VMLD) ***</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">elif</span><span class="p">(</span><span class="n">a</span><span class="o">==</span><span class="s2">&quot;VMBLD&quot;</span><span class="p">):</span>
                                <span class="n">o</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">*** Vibrational Mode Bayesian Linear Decomposition (VMBLD) ***</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">elif</span><span class="p">(</span><span class="n">a</span><span class="o">==</span><span class="s2">&quot;VMARD&quot;</span><span class="p">):</span>
                                <span class="n">o</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">*** Vibrational Mode Automatic Relevance Determination (VMARD) ***</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="c1">#jk n=1</span>
                        <span class="n">n</span><span class="o">=</span><span class="mi">0</span>
                        <span class="k">for</span> <span class="n">vib</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">vibrations</span><span class="p">:</span>
                                <span class="n">o</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">vib</span><span class="o">.</span><span class="n">string</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="c1">#calculate weights</span>
                                <span class="n">w</span><span class="o">=</span><span class="n">vib</span><span class="o">.</span><span class="n">analysis</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vib</span><span class="o">.</span><span class="n">analysis</span><span class="p">[</span><span class="n">a</span><span class="p">]))</span>
                                <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">cut</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1"># cut = all</span>
                                <span class="k">if</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;cut&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">):</span>
                                        <span class="n">cut</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">vibrations</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">10.0</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">intcoords</span><span class="p">))</span>
                                <span class="k">elif</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;cut&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;val&quot;</span><span class="p">):</span>
                                        <span class="n">cut</span> <span class="o">=</span> <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;cutval&quot;</span><span class="p">]</span>
                                <span class="k">elif</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;cut&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;q1&quot;</span><span class="p">):</span>
                                        <span class="n">cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="mi">75</span><span class="p">)</span>
                                <span class="k">elif</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;cut&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;d9&quot;</span><span class="p">):</span>
                                        <span class="n">cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="mi">90</span><span class="p">)</span>
                                <span class="n">widx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">w</span><span class="p">)))</span>
                                <span class="n">widx</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
                                <span class="n">gw</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                                <span class="n">gwr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                                <span class="n">natts</span><span class="o">=</span><span class="mi">0</span>
                                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">widx</span><span class="p">:</span>
                                        <span class="n">gw</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">intcoords</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                                        <span class="k">if</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">&gt;=</span><span class="n">cut</span><span class="p">):</span>
                                                <span class="n">gwr</span><span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">intcoords</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                                                <span class="n">natts</span> <span class="o">+=</span> <span class="mi">1</span>
                                                <span class="n">o</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">%+8.4f</span><span class="s2"> (</span><span class="si">%5.1f%%</span><span class="s2">) </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">vib</span><span class="o">.</span><span class="n">analysis</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">j</span><span class="p">],</span>
                                                <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="n">modeStr</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">intcoords</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">s</span><span class="o">.</span><span class="n">symbol</span><span class="p">)))</span>
                                <span class="k">if</span><span class="p">(</span><span class="n">natts</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
                                        <span class="n">o</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; Mode too disperse!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                                        <span class="n">o</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; Largest Contribution: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                                        <span class="n">j</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
                                        <span class="n">o</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">%+8.4f</span><span class="s2"> (</span><span class="si">%5.1f%%</span><span class="s2">) </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">vib</span><span class="o">.</span><span class="n">analysis</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span>
                                        <span class="n">modeStr</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">intcoords</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">s</span><span class="o">.</span><span class="n">symbol</span><span class="p">)))</span>
                                <span class="k">else</span><span class="p">:</span>
                                        <span class="n">gwr</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">=</span><span class="n">gwr</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gwr</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                                <span class="n">o</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; Shown Composition:  </span><span class="si">%5.1f%%</span><span class="s2"> BOND, </span><span class="si">%5.1f%%</span><span class="s2"> ANGLE, </span><span class="si">%5.1f%%</span><span class="s2"> OUT, </span><span class="si">%5.1f%%</span><span class="s2"> TOR</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="nb">tuple</span><span class="p">(</span><span class="mf">100.0</span><span class="o">*</span><span class="p">(</span><span class="n">gwr</span><span class="p">[</span><span class="mi">1</span><span class="p">:])))</span>
                                <span class="n">o</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; Total Composition:  </span><span class="si">%5.1f%%</span><span class="s2"> BOND, </span><span class="si">%5.1f%%</span><span class="s2"> ANGLE, </span><span class="si">%5.1f%%</span><span class="s2"> OUT, </span><span class="si">%5.1f%%</span><span class="s2"> TOR</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="nb">tuple</span><span class="p">(</span><span class="mf">100.0</span><span class="o">*</span><span class="n">gw</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
                                <span class="k">if</span><span class="p">(</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;VMLD&quot;</span><span class="p">,</span><span class="s2">&quot;VMBLD&quot;</span><span class="p">,</span><span class="s2">&quot;VMARD&quot;</span><span class="p">]):</span> <span class="c1">#punch additional info</span>
                                        <span class="n">o</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; R**2 = </span><span class="si">%6.4f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">vib</span><span class="o">.</span><span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_R2&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">a</span><span class="p">)]))</span>
                                        <span class="n">o</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; Explained Variance = </span><span class="si">%5.1f</span><span class="s2"> </span><span class="si">%%</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">vib</span><span class="o">.</span><span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_EV&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span><span class="o">*</span><span class="mf">100.0</span><span class="p">))</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="o">==</span><span class="s2">&quot;VMP&quot;</span><span class="p">):</span>
                                <span class="n">o</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*** End of Vibrational Mode Projection (VMP) ***</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">elif</span><span class="p">(</span><span class="n">a</span><span class="o">==</span><span class="s2">&quot;VMLD&quot;</span><span class="p">):</span>
                                <span class="n">o</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*** End of Vibrational Mode Linear Decomposition (VMLD) ***</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">elif</span><span class="p">(</span><span class="n">a</span><span class="o">==</span><span class="s2">&quot;VMBLD&quot;</span><span class="p">):</span>
                                <span class="n">o</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*** End of Vibrational Mode Bayesian Linear Decomposition (VMBLD) ***</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">elif</span><span class="p">(</span><span class="n">a</span><span class="o">==</span><span class="s2">&quot;VMARD&quot;</span><span class="p">):</span>
                                <span class="n">o</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*** End of Vibrational Mode Automatic Relevance Determination (VMARD) ***</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<span class="c1">## Support Functions ##</span>

<div class="viewcode-block" id="bondLength"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.bondLength">[docs]</a><span class="k">def</span> <span class="nf">bondLength</span><span class="p">(</span><span class="n">geo</span><span class="p">,</span><span class="n">bl</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns distance between atoms bl[1] and bl[0]</span>
<span class="sd">        (numbering starts at 0) in geometry geo</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">geo</span><span class="p">[</span><span class="n">bl</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">-</span><span class="n">geo</span><span class="p">[</span><span class="n">bl</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span></div>

<div class="viewcode-block" id="angleAmp"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.angleAmp">[docs]</a><span class="k">def</span> <span class="nf">angleAmp</span><span class="p">(</span><span class="n">geo</span><span class="p">,</span><span class="n">al</span><span class="p">,</span><span class="n">deg</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns amplitude (optnialy in degs) for the valence angle formed by</span>
<span class="sd">        the atoms in al, with al[1] being the apex (numbering starts at 0).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r01</span><span class="o">=</span><span class="n">geo</span><span class="p">[</span><span class="n">al</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">-</span><span class="n">geo</span><span class="p">[</span><span class="n">al</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">r21</span><span class="o">=</span><span class="n">geo</span><span class="p">[</span><span class="n">al</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">-</span><span class="n">geo</span><span class="p">[</span><span class="n">al</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;Vectors for angle </span><span class="si">{</span><span class="n">al</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">al</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">al</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">:</span>
<span class="s2">        R01 = </span><span class="si">{</span><span class="n">r01</span><span class="si">}</span><span class="s2"> (norm: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r01</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">        R21 = </span><span class="si">{</span><span class="n">r21</span><span class="si">}</span><span class="s2"> (norm: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r21</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">        R01 (dot) R02 = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">r01</span><span class="p">,</span><span class="n">r21</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">r01</span><span class="o">=</span><span class="n">r01</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r01</span><span class="p">)</span>
        <span class="n">r21</span><span class="o">=</span><span class="n">r21</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r21</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;Normalized vectors for angle </span><span class="si">{</span><span class="n">al</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">al</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">al</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">:</span>
<span class="s2">        R01 = </span><span class="si">{</span><span class="n">r01</span><span class="si">}</span><span class="s2"> (norm: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r01</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">        R21 = </span><span class="si">{</span><span class="n">r21</span><span class="si">}</span><span class="s2"> (norm: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r21</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">        R01 (dot) R02 = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">r01</span><span class="p">,</span><span class="n">r21</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">phi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">r01</span><span class="p">,</span><span class="n">r21</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">12</span><span class="p">))</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Angle between atoms </span><span class="si">{</span><span class="n">al</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">al</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">al</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="si">:</span><span class="s2">7.2f</span><span class="si">}</span><span class="s2"> degs.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">deg</span><span class="p">):</span>
                <span class="n">phi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">phi</span></div>

<div class="viewcode-block" id="oopAmp"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.oopAmp">[docs]</a><span class="k">def</span> <span class="nf">oopAmp</span><span class="p">(</span><span class="n">geo</span><span class="p">,</span><span class="n">al</span><span class="p">,</span><span class="n">deg</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns amplitude (optnialy in degs) for the out-of-plane angle formed by</span>
<span class="sd">        the atoms in al, with al[1] being the central atom (numbering starts at 0).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r1</span><span class="o">=</span><span class="n">geo</span><span class="p">[</span><span class="n">al</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">-</span><span class="n">geo</span><span class="p">[</span><span class="n">al</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">r2</span><span class="o">=</span><span class="n">geo</span><span class="p">[</span><span class="n">al</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">-</span><span class="n">geo</span><span class="p">[</span><span class="n">al</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">r3</span><span class="o">=</span><span class="n">geo</span><span class="p">[</span><span class="n">al</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">-</span><span class="n">geo</span><span class="p">[</span><span class="n">al</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">r1</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span>
        <span class="n">r2</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span>
        <span class="n">r3</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r3</span><span class="p">)</span>
        <span class="n">n1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span><span class="n">r2</span><span class="p">)</span>
        <span class="n">n2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">r3</span><span class="p">,</span><span class="n">r2</span><span class="p">)</span>
        <span class="n">atmp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n2</span><span class="p">))</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;Normalized vectors for OOP angle </span><span class="si">{</span><span class="n">al</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">al</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">al</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">al</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">:</span>
<span class="s2">        R1 = </span><span class="si">{</span><span class="n">r1</span><span class="si">}</span><span class="s2"> (norm: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">        R2 = </span><span class="si">{</span><span class="n">r2</span><span class="si">}</span><span class="s2"> (norm: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">        R3 = </span><span class="si">{</span><span class="n">r3</span><span class="si">}</span><span class="s2"> (norm: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r3</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">        N1 = </span><span class="si">{</span><span class="n">n1</span><span class="si">}</span><span class="s2"> (norm: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">        N2 = </span><span class="si">{</span><span class="n">n2</span><span class="si">}</span><span class="s2"> (norm: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span>
<span class="s2">        N1 (dot) N2 = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">atmp</span><span class="o">&gt;</span><span class="mf">1.0</span><span class="p">):</span>
                <span class="n">phi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">atmp</span><span class="o">&lt;-</span><span class="mf">1.0</span><span class="p">):</span>
                <span class="n">phi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="n">phi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">atmp</span><span class="p">)</span>
        <span class="c1"># r1 is normal to the reference plane, so</span>
        <span class="c1"># project n1 and n2 onto the reference plane</span>
        <span class="n">n1p</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">r1</span><span class="p">)</span><span class="o">*</span><span class="n">r1</span><span class="p">)</span>
        <span class="n">n2p</span> <span class="o">=</span> <span class="n">n2</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span><span class="n">r1</span><span class="p">)</span><span class="o">*</span><span class="n">r1</span><span class="p">)</span>
        <span class="n">nc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">n1p</span><span class="p">,</span><span class="n">n2p</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span><span class="n">r1</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.0</span><span class="p">):</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">-</span><span class="n">phi</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;Amplitude for OOP angle </span><span class="si">{</span><span class="n">al</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">al</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">al</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">al</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="si">:</span><span class="s2">+7.2f</span><span class="si">}</span><span class="s2"> degs.</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">deg</span><span class="p">):</span>
                <span class="n">phi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">phi</span></div>

<div class="viewcode-block" id="torsionAmp"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.torsionAmp">[docs]</a><span class="k">def</span> <span class="nf">torsionAmp</span><span class="p">(</span><span class="n">geo</span><span class="p">,</span><span class="n">al</span><span class="p">,</span><span class="n">deg</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns amplitude (optnialy in degs) for the 0-1-2-3 torsion angle formed by</span>
<span class="sd">        the atoms in al, with al[1] and al[2] defining the central bond</span>
<span class="sd">        (numbering starts at 0).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r1</span><span class="o">=</span><span class="n">geo</span><span class="p">[</span><span class="n">al</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">-</span><span class="n">geo</span><span class="p">[</span><span class="n">al</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">r2</span><span class="o">=</span><span class="n">geo</span><span class="p">[</span><span class="n">al</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">-</span><span class="n">geo</span><span class="p">[</span><span class="n">al</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">r3</span><span class="o">=</span><span class="n">geo</span><span class="p">[</span><span class="n">al</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">-</span><span class="n">geo</span><span class="p">[</span><span class="n">al</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
        <span class="n">r1</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span>
        <span class="n">r2</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span>
        <span class="n">r3</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r3</span><span class="p">)</span>
        <span class="n">n1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span><span class="n">r2</span><span class="p">)</span>
        <span class="n">n2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">r3</span><span class="p">,</span><span class="n">r2</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1.0e-3</span><span class="p">):</span>
                <span class="c1"># possible hazard for linear bonds!!!</span>
                <span class="k">return</span> <span class="mf">0.0</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1.0e-3</span><span class="p">):</span>
                <span class="k">return</span> <span class="mf">0.0</span>
        <span class="n">n1</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
        <span class="n">n2</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span>
        <span class="n">atmp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n2</span><span class="p">))</span>
        <span class="k">if</span><span class="p">(</span><span class="n">atmp</span><span class="o">&gt;</span><span class="mf">1.0</span><span class="p">):</span>
                <span class="n">phi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">atmp</span><span class="o">&lt;-</span><span class="mf">1.0</span><span class="p">):</span>
                <span class="n">phi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="n">phi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">atmp</span><span class="p">)</span>
        <span class="c1"># r2 is normal to the reference plane, so</span>
        <span class="c1"># project on n1 and n2 onto the reference plane</span>
        <span class="n">n1p</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">r2</span><span class="p">)</span><span class="o">*</span><span class="n">r2</span><span class="p">)</span>
        <span class="n">n2p</span> <span class="o">=</span> <span class="n">n2</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span><span class="n">r2</span><span class="p">)</span><span class="o">*</span><span class="n">r2</span><span class="p">)</span>
        <span class="n">nc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">n1p</span><span class="p">,</span><span class="n">n2p</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span><span class="n">r1</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.0</span><span class="p">):</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">-</span><span class="n">phi</span>
        <span class="k">if</span><span class="p">(</span><span class="n">deg</span><span class="p">):</span>
                <span class="n">phi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">phi</span></div>

<div class="viewcode-block" id="makeIC"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.makeIC">[docs]</a><span class="k">def</span> <span class="nf">makeIC</span><span class="p">(</span><span class="n">o</span><span class="p">,</span><span class="n">useric</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Automatically identifies internal coordinates using</span>
<span class="sd">        connectivity deduced from covalent radii and generates</span>
<span class="sd">        Wilson&#39;s S matrix for the specified geometry</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">## Parameters from Global Opts</span>
        <span class="n">delta</span><span class="o">=</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;delta&quot;</span><span class="p">]</span>
        <span class="n">tol</span><span class="o">=</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;tol&quot;</span><span class="p">]</span>
        <span class="n">o</span><span class="o">.</span><span class="n">makeGeo</span><span class="p">()</span>
        <span class="n">geo</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">geo</span><span class="p">)</span>
        <span class="n">o</span><span class="o">.</span><span class="n">intcoords</span><span class="o">=</span><span class="p">[]</span> <span class="c1"># each coord is a tuple of 5 ints: coord type + 4 atom idxs</span>
        <span class="n">natoms</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">natoms</span>
        <span class="n">ageo</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">copy</span><span class="p">(),(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">geo</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>
        <span class="c1"># temporary lists</span>
        <span class="n">valence</span><span class="o">=</span><span class="p">[]</span> <span class="c1">#store number of bonds for each atom</span>
        <span class="n">centred</span><span class="o">=</span><span class="p">[]</span> <span class="c1">#store number angles this atoms is the centre of</span>
        <span class="n">coordination</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">natoms</span><span class="p">):</span>
                <span class="n">coordination</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
                <span class="n">valence</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">centred</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">lbonds</span><span class="o">=</span><span class="p">[]</span>  <span class="c1">#indexes for bonds</span>
        <span class="n">vbonds</span><span class="o">=</span><span class="p">[]</span>  <span class="c1">#lenghts for bonds</span>
        <span class="n">langles</span><span class="o">=</span><span class="p">[]</span> <span class="c1">#indexes for angles</span>
        <span class="n">vangles</span><span class="o">=</span><span class="p">[]</span> <span class="c1">#amplitude of angles</span>
        <span class="n">loop</span><span class="o">=</span><span class="p">[]</span>    <span class="c1">#indexes of out of plane </span>
        <span class="n">voop</span><span class="o">=</span><span class="p">[]</span>    <span class="c1">#amplitudes for out of plane</span>
        <span class="n">ltors</span><span class="o">=</span><span class="p">[]</span>   <span class="c1">#indexes for torsions</span>
        <span class="n">vtors</span><span class="o">=</span><span class="p">[]</span>   <span class="c1">#amplitudes for torsions</span>
        <span class="c1"># add user-defined ICs</span>
        <span class="k">if</span><span class="p">(</span><span class="n">useric</span><span class="o">!=</span><span class="p">[]):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">useric</span><span class="p">)):</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">useric</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
                                <span class="n">lbonds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">useric</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
                                <span class="n">valence</span><span class="p">[</span><span class="n">useric</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">valence</span><span class="p">[</span><span class="n">useric</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">coordination</span><span class="p">[</span><span class="n">useric</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">useric</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                                <span class="n">coordination</span><span class="p">[</span><span class="n">useric</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">useric</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">elif</span><span class="p">(</span><span class="n">useric</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
                                <span class="n">langles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">useric</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
                        <span class="k">elif</span><span class="p">(</span><span class="n">useric</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">3</span><span class="p">):</span>
                                <span class="n">loop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">useric</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
                        <span class="k">elif</span><span class="p">(</span><span class="n">useric</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">4</span><span class="p">):</span>
                                <span class="n">ltors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">useric</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
        <span class="c1"># search for bonds</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">natoms</span><span class="p">):</span>
                <span class="n">r1</span><span class="o">=</span><span class="n">Radii</span><span class="p">[</span><span class="n">Symbols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">symbol</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">natoms</span><span class="p">):</span>
                        <span class="n">rl</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">tol</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">r1</span><span class="o">+</span><span class="n">Radii</span><span class="p">[</span><span class="n">Symbols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">symbol</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())])</span>
                        <span class="k">if</span> <span class="p">((</span><span class="n">bondLength</span><span class="p">(</span><span class="n">geo</span><span class="p">,[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span><span class="o">&lt;</span><span class="n">rl</span><span class="p">)</span><span class="ow">and</span><span class="p">([</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lbonds</span><span class="p">)):</span>
                                <span class="n">lbonds</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>
                                <span class="n">valence</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">valence</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="n">coordination</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                                <span class="n">coordination</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="c1">#find triatomic angles between atomic bonds</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lbonds</span><span class="p">)):</span>
                <span class="n">set1</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="n">lbonds</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">lbonds</span><span class="p">)):</span>
                        <span class="n">set2</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="n">lbonds</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">set1</span><span class="o">&amp;</span><span class="n">set2</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
                                <span class="n">tmp</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">set1</span><span class="o">^</span><span class="n">set2</span><span class="p">)</span>
                                <span class="n">tmp</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                                <span class="n">common</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">set1</span><span class="o">&amp;</span><span class="n">set2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                                <span class="n">candidate</span><span class="o">=</span><span class="p">[</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">common</span><span class="p">,</span><span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                                <span class="n">centred</span><span class="p">[</span><span class="n">common</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="k">if</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doAutoSel&quot;</span><span class="p">]):</span>
                                        <span class="k">if</span><span class="p">((</span><span class="n">candidate</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">langles</span><span class="p">)</span><span class="ow">and</span><span class="p">(</span><span class="n">centred</span><span class="p">[</span><span class="n">common</span><span class="p">]</span><span class="o">&lt;</span><span class="n">valence</span><span class="p">[</span><span class="n">common</span><span class="p">])):</span>
                                                <span class="n">langles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span>
                                <span class="k">elif</span><span class="p">(</span><span class="n">candidate</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">langles</span><span class="p">):</span>
                                        <span class="n">langles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span>
        <span class="c1">#find dihedrals (torsions) and out-of-plane (outs)</span>
        <span class="c1">#exclude if any of the angles is larger than 179 degs</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">langles</span><span class="p">)):</span>
                <span class="k">if</span><span class="p">(</span><span class="n">angleAmp</span><span class="p">(</span><span class="n">geo</span><span class="p">,</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">179.0</span><span class="p">):</span>
                        <span class="k">continue</span>
                <span class="n">set1</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">langles</span><span class="p">)):</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">angleAmp</span><span class="p">(</span><span class="n">geo</span><span class="p">,</span><span class="n">langles</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">179.0</span><span class="p">):</span>
                                <span class="k">continue</span>
                        <span class="n">set2</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="n">langles</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">set1</span><span class="o">&amp;</span><span class="n">set2</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
                                <span class="n">tmp</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">set1</span><span class="o">^</span><span class="n">set2</span><span class="p">)</span> <span class="c1"># non-common atoms</span>
                                <span class="n">tmp2</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">set1</span><span class="o">&amp;</span><span class="n">set2</span><span class="p">)</span><span class="c1"># common atoms</span>
                                <span class="k">if</span><span class="p">(</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">langles</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span> <span class="c1"># out-of-plane </span>
                                        <span class="n">a2</span><span class="o">=</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="c1">#reference</span>
                                        <span class="n">tmplst</span><span class="o">=</span><span class="n">tmp</span><span class="o">+</span><span class="n">tmp2</span>
                                        <span class="n">tmplst</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">tmplst</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a2</span><span class="p">))</span> <span class="c1">#remove the common</span>
                                        <span class="n">tmplst</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                                        <span class="n">a1</span><span class="o">=</span><span class="n">tmplst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                        <span class="n">a3</span><span class="o">=</span><span class="n">tmplst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                        <span class="n">a4</span><span class="o">=</span><span class="n">tmplst</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                                        <span class="k">if</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doOuts&quot;</span><span class="p">]):</span>
                                                <span class="c1">#check if none of the involved angles are 180</span>
                                                <span class="k">if</span><span class="p">((</span><span class="n">angleAmp</span><span class="p">(</span><span class="n">geo</span><span class="p">,[</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">a3</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">179.0</span><span class="p">)</span><span class="ow">and</span>
                                                   <span class="p">(</span><span class="n">angleAmp</span><span class="p">(</span><span class="n">geo</span><span class="p">,[</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">a4</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">179.0</span><span class="p">)</span><span class="ow">and</span>
                                                         <span class="p">(</span><span class="n">angleAmp</span><span class="p">(</span><span class="n">geo</span><span class="p">,[</span><span class="n">a3</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">a4</span><span class="p">],</span><span class="kc">True</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">179.0</span><span class="p">)):</span>
                                                        <span class="k">if</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;oopp&quot;</span><span class="p">]):</span>
                                                                <span class="n">teta</span><span class="o">=</span><span class="n">oopAmp</span><span class="p">(</span><span class="n">geo</span><span class="p">,[</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">a3</span><span class="p">,</span><span class="n">a4</span><span class="p">])</span>
                                                                <span class="k">if</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">teta</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">&lt;</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;oopTol&quot;</span><span class="p">])</span><span class="ow">and</span><span class="p">([</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">a3</span><span class="p">,</span><span class="n">a4</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">loop</span><span class="p">)):</span>
                                                                        <span class="n">loop</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">a3</span><span class="p">,</span><span class="n">a4</span><span class="p">])</span>
                                                        <span class="k">elif</span><span class="p">([</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">a3</span><span class="p">,</span><span class="n">a4</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">loop</span><span class="p">):</span>
                                                                <span class="n">loop</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">a3</span><span class="p">,</span><span class="n">a4</span><span class="p">])</span>
                                <span class="c1"># now the torsions...</span>
                                <span class="k">else</span><span class="p">:</span>
                                        <span class="n">candidate</span><span class="o">=</span><span class="p">[]</span>
                                        <span class="k">if</span><span class="p">((</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">langles</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="ow">and</span><span class="p">(</span><span class="n">langles</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])):</span>
                                                <span class="n">candidate</span><span class="o">=</span><span class="p">[</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">langles</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">langles</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span>
                                        <span class="k">elif</span><span class="p">((</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">langles</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="ow">and</span><span class="p">(</span><span class="n">langles</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">])):</span>
                                                <span class="n">candidate</span><span class="o">=</span><span class="p">[</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">langles</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">langles</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span>
                                        <span class="k">elif</span><span class="p">((</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">langles</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span><span class="ow">and</span><span class="p">(</span><span class="n">langles</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])):</span>
                                                <span class="n">candidate</span><span class="o">=</span><span class="p">[</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">langles</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">langles</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                                        <span class="k">elif</span><span class="p">((</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">langles</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span><span class="ow">and</span><span class="p">(</span><span class="n">langles</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">])):</span>
                                                <span class="n">candidate</span><span class="o">=</span><span class="p">[</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">langles</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">langles</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                                        <span class="k">if</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doAutoSel&quot;</span><span class="p">]):</span>
                                                <span class="k">if</span><span class="p">((</span><span class="n">candidate</span><span class="o">!=</span><span class="p">[])</span><span class="ow">and</span><span class="p">(</span><span class="n">candidate</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">ltors</span><span class="p">])):</span>
                                                        <span class="k">if</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doTors&quot;</span><span class="p">]):</span>
                                                                <span class="n">ltors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span>
                                        <span class="k">elif</span><span class="p">(</span><span class="n">candidate</span><span class="o">!=</span><span class="p">[]):</span>
                                                <span class="k">if</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doTors&quot;</span><span class="p">]):</span>
                                                        <span class="n">ltors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span>
        <span class="c1">#calc S for bonds</span>
        <span class="n">o</span><span class="o">.</span><span class="n">S</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="o">*</span><span class="n">natoms</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">lbonds</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">langles</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">ltors</span><span class="p">)))</span>
        <span class="n">o</span><span class="o">.</span><span class="n">intcoords</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">n</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lbonds</span><span class="p">)):</span>
                <span class="n">o</span><span class="o">.</span><span class="n">intcoords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">lbonds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> 
                <span class="n">sb</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">geo</span><span class="p">))</span>
                <span class="n">b0</span><span class="o">=</span><span class="n">bondLength</span><span class="p">(</span><span class="n">geo</span><span class="p">,</span><span class="n">lbonds</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">vbonds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b0</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">geo</span><span class="p">,</span><span class="mi">0</span><span class="p">)):</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                                <span class="n">gp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">geo</span><span class="p">)</span>
                                <span class="n">gp</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">+=</span><span class="n">delta</span>
                                <span class="n">b1</span><span class="o">=</span><span class="n">bondLength</span><span class="p">(</span><span class="n">gp</span><span class="p">,</span><span class="n">lbonds</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                                <span class="n">sb</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">b1</span><span class="o">-</span><span class="n">b0</span><span class="p">)</span><span class="o">/</span><span class="n">delta</span>
                <span class="n">o</span><span class="o">.</span><span class="n">S</span><span class="p">[:,</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sb</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">sb</span><span class="p">)))</span>
                <span class="n">n</span><span class="o">+=</span><span class="mi">1</span>
        <span class="c1"># calc S for angles</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">langles</span><span class="p">)):</span>
                <span class="n">o</span><span class="o">.</span><span class="n">intcoords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">sb</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">geo</span><span class="p">))</span>
                <span class="n">phi0</span><span class="o">=</span><span class="n">angleAmp</span><span class="p">(</span><span class="n">geo</span><span class="p">,</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">vangles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">phi0</span><span class="p">))</span>
                <span class="k">if</span><span class="p">(</span><span class="n">phi0</span><span class="o">&gt;</span><span class="mf">178.0</span><span class="p">):</span> <span class="c1">#linear bend</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]]:</span>
                                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                                        <span class="n">gp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">geo</span><span class="p">)</span>
                                        <span class="n">gp</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">+=</span> <span class="n">delta</span> <span class="c1">#(5.0*delta)</span>
                                        <span class="n">phi1</span><span class="o">=</span><span class="n">angleAmp</span><span class="p">(</span><span class="n">gp</span><span class="p">,</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                                        <span class="n">sb</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">phi1</span><span class="o">-</span><span class="n">phi0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]]:</span>
                                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                                        <span class="n">gp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">geo</span><span class="p">)</span>
                                        <span class="n">gp</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">+=</span><span class="n">delta</span><span class="c1">#*(np.sin(phi0))**2</span>
                                        <span class="n">phi1</span><span class="o">=</span><span class="n">angleAmp</span><span class="p">(</span><span class="n">gp</span><span class="p">,</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                                        <span class="n">sb</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">phi1</span><span class="o">-</span><span class="n">phi0</span><span class="p">)</span><span class="o">/</span><span class="n">delta</span>
                <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]]:</span>
                                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                                        <span class="n">gp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">geo</span><span class="p">)</span>
                                        <span class="n">gp</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">+=</span> <span class="n">delta</span><span class="c1">#*(np.sin(phi0))**2</span>
                                        <span class="n">phi1</span><span class="o">=</span><span class="n">angleAmp</span><span class="p">(</span><span class="n">gp</span><span class="p">,</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                                        <span class="n">sb</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">phi1</span><span class="o">-</span><span class="n">phi0</span><span class="p">)</span><span class="o">/</span><span class="n">delta</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]]:</span>
                                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                                        <span class="n">gp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">geo</span><span class="p">)</span>
                                        <span class="n">gp</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">+=</span><span class="n">delta</span><span class="c1">#*(np.sin(phi0))**2</span>
                                        <span class="n">phi1</span><span class="o">=</span><span class="n">angleAmp</span><span class="p">(</span><span class="n">gp</span><span class="p">,</span><span class="n">langles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                                        <span class="n">sb</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">phi1</span><span class="o">-</span><span class="n">phi0</span><span class="p">)</span><span class="o">/</span><span class="n">delta</span>
                <span class="c1">#Scaling of the central displacement is recommended to</span>
                <span class="c1">#deal with linear bends</span>
                <span class="n">o</span><span class="o">.</span><span class="n">S</span><span class="p">[:,</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sb</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">sb</span><span class="p">)))</span>
                <span class="n">n</span><span class="o">+=</span><span class="mi">1</span>
        <span class="c1"># calc S for outs</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loop</span><span class="p">)):</span>
                <span class="n">o</span><span class="o">.</span><span class="n">intcoords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="n">loop</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">sb</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">geo</span><span class="p">))</span>
                <span class="n">teta0</span><span class="o">=</span><span class="n">oopAmp</span><span class="p">(</span><span class="n">geo</span><span class="p">,</span><span class="n">loop</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">voop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">teta0</span><span class="p">))</span>
                <span class="c1">#find how many atoms participate in only one bond</span>
                <span class="n">aToMove</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">loop</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                        <span class="n">nb</span><span class="o">=</span><span class="mi">0</span>
                        <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">lbonds</span><span class="p">:</span>
                                <span class="k">if</span><span class="p">(</span><span class="n">j</span> <span class="ow">in</span> <span class="n">bond</span><span class="p">):</span> <span class="n">nb</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">nb</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span> <span class="n">aToMove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                <span class="c1">#if that fails, find which atom(s) has(ve) the least number of bonds</span>
                <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aToMove</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
                        <span class="n">rec</span><span class="o">=</span><span class="mi">100</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">loop</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                                <span class="n">nb</span><span class="o">=</span><span class="mi">0</span>
                                <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">lbonds</span><span class="p">:</span>
                                        <span class="k">if</span><span class="p">(</span><span class="n">j</span> <span class="ow">in</span> <span class="n">bond</span><span class="p">):</span> <span class="n">nb</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="k">if</span><span class="p">(</span><span class="n">nb</span><span class="o">==</span><span class="n">rec</span><span class="p">):</span>
                                        <span class="n">aToMove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                                <span class="k">if</span><span class="p">(</span><span class="n">nb</span><span class="o">&lt;</span><span class="n">rec</span><span class="p">):</span>
                                        <span class="n">rec</span><span class="o">=</span><span class="n">nb</span>
                                        <span class="n">aToMove</span><span class="o">=</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">aToMove</span><span class="p">:</span> <span class="c1"># move only atoms participating in one bond</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                                <span class="n">gp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">geo</span><span class="p">)</span>
                                <span class="n">gp</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">+=</span> <span class="n">delta</span>
                                <span class="n">teta1</span><span class="o">=</span><span class="n">oopAmp</span><span class="p">(</span><span class="n">gp</span><span class="p">,</span><span class="n">loop</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                                <span class="n">sb</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">teta1</span><span class="o">-</span><span class="n">teta0</span><span class="p">)</span><span class="o">/</span><span class="n">delta</span>
                <span class="n">o</span><span class="o">.</span><span class="n">S</span><span class="p">[:,</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sb</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">sb</span><span class="p">)))</span>
                <span class="n">n</span><span class="o">+=</span><span class="mi">1</span>
        <span class="c1"># calc S for torsions</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ltors</span><span class="p">)):</span>
                <span class="n">sb</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">geo</span><span class="p">))</span>
                <span class="n">teta0</span><span class="o">=</span><span class="n">torsionAmp</span><span class="p">(</span><span class="n">geo</span><span class="p">,</span><span class="n">ltors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">vtors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">teta0</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ltors</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]]:</span> <span class="c1"># these two define the angle between planes</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                                <span class="n">gp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">geo</span><span class="p">)</span>
                                <span class="n">gp</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">+=</span> <span class="n">delta</span>
                                <span class="n">teta1</span><span class="o">=</span><span class="n">torsionAmp</span><span class="p">(</span><span class="n">gp</span><span class="p">,</span><span class="n">ltors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                                <span class="c1"># account for torsion going across 0 or above 360</span>
                                <span class="k">if</span><span class="p">((</span><span class="n">teta0</span><span class="o">&lt;</span><span class="mf">0.2</span><span class="p">)</span><span class="ow">and</span><span class="p">(</span><span class="n">teta1</span><span class="o">&gt;</span><span class="mf">5.0</span><span class="p">)):</span>
                                        <span class="n">teta1</span> <span class="o">-=</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                                <span class="k">if</span><span class="p">((</span><span class="n">teta1</span><span class="o">&lt;</span><span class="mf">0.2</span><span class="p">)</span><span class="ow">and</span><span class="p">(</span><span class="n">teta0</span><span class="o">&gt;</span><span class="mf">5.0</span><span class="p">)):</span>
                                        <span class="n">teta1</span> <span class="o">-=</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                                <span class="n">sb</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">teta1</span><span class="o">-</span><span class="n">teta0</span><span class="p">)</span><span class="o">/</span><span class="n">delta</span>
                <span class="n">o</span><span class="o">.</span><span class="n">intcoords</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="n">ltors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">o</span><span class="o">.</span><span class="n">S</span><span class="p">[:,</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sb</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">sb</span><span class="p">)))</span>
                <span class="n">n</span><span class="o">+=</span><span class="mi">1</span>
        <span class="c1">#clean-up S</span>
        <span class="n">o</span><span class="o">.</span><span class="n">S</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">S</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">n</span><span class="p">]</span></div>

<span class="c1">## Analysis Functions ##</span>

<div class="viewcode-block" id="VMP"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.VMP">[docs]</a><span class="k">def</span> <span class="nf">VMP</span><span class="p">(</span><span class="n">of</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Performs a simple projection of the normal modes</span>
<span class="sd">        over the internal coordinates S stored in system s. Other inputs:</span>
<span class="sd">        - of: handle for the output file (for logging)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Starting: Normal Mode Projection</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">intcoords</span><span class="p">)</span><span class="o">&gt;</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">vibrations</span><span class="p">)):</span>
                <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; More internal coordinates than frequencies, expect</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; some (possibly unwanted) redundancy in the results</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">vibrations</span><span class="p">)):</span>
                <span class="n">o</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">intcoords</span><span class="p">)):</span>
                        <span class="n">o</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">S</span><span class="p">[:,</span><span class="n">j</span><span class="p">],</span><span class="n">s</span><span class="o">.</span><span class="n">ADM</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">S</span><span class="p">[:,</span><span class="n">j</span><span class="p">]))</span>
                <span class="n">s</span><span class="o">.</span><span class="n">vibrations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">addVMP</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Ending: Normal Mode Projection</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VMLD"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.VMLD">[docs]</a><span class="k">def</span> <span class="nf">VMLD</span><span class="p">(</span><span class="n">of</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Performs a Linear Decomposition of the vibrational modes</span>
<span class="sd">        over the internal coordinates stored in the system s.</span>
<span class="sd">        Inputs:</span>
<span class="sd">        - of: handle for the output file</span>
<span class="sd">        - s:  the system</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Starting: Vibrational Mode Linear Decomposition</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">intcoords</span><span class="p">)</span><span class="o">&gt;</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">vibrations</span><span class="p">)):</span>
                <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; More internal coordinates than frequencies, expect</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; some (possibly unwanted) redundancy in the results</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">vibrations</span><span class="p">)):</span>
                <span class="n">o</span><span class="o">=</span><span class="p">[]</span>
                <span class="n">regressor</span><span class="o">=</span><span class="n">sklm</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">()</span>
                <span class="n">regressor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">S</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">ADM</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
                <span class="n">r2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ADM</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span><span class="n">regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">S</span><span class="p">))[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
                <span class="n">exvar</span><span class="o">=</span><span class="n">skmt</span><span class="o">.</span><span class="n">explained_variance_score</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ADM</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span><span class="n">regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">S</span><span class="p">))</span>
                <span class="n">s</span><span class="o">.</span><span class="n">vibrations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">addVMLD</span><span class="p">(</span><span class="n">regressor</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">exvar</span><span class="p">)</span>
        <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Ending: Vibrational Mode Linear Decomposition</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VMBLD"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.VMBLD">[docs]</a><span class="k">def</span> <span class="nf">VMBLD</span><span class="p">(</span><span class="n">of</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Performs a Linear Decomposition of the vibrational modes</span>
<span class="sd">        over the internal coordinates stored in the system s using Bayesian </span>
<span class="sd">        Ridge Regression.</span>
<span class="sd">        Inputs:</span>
<span class="sd">        - of: handle for the output file</span>
<span class="sd">        - s:  the system</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Starting: Vibrational Mode Bayesian Linear Decomposition</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">intcoords</span><span class="p">)</span><span class="o">&gt;</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">vibrations</span><span class="p">)):</span>
                <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; More internal coordinates than frequencies, expect</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; some (possibly unwanted) redundancy in the results</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">vibrations</span><span class="p">)):</span>
                <span class="n">o</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">if</span> <span class="n">skl</span><span class="o">.</span><span class="n">__version__</span> <span class="o">&gt;=</span> <span class="nb">str</span><span class="p">(</span><span class="mf">1.3</span><span class="p">):</span>
                    <span class="n">regressor</span><span class="o">=</span><span class="n">sklm</span><span class="o">.</span><span class="n">BayesianRidge</span><span class="p">(</span><span class="n">compute_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">regressor</span><span class="o">=</span><span class="n">sklm</span><span class="o">.</span><span class="n">BayesianRidge</span><span class="p">(</span><span class="n">compute_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">n_iter</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
                <span class="n">regressor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">S</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">ADM</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
                <span class="n">r2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ADM</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span><span class="n">regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">S</span><span class="p">))[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
                <span class="n">exvar</span><span class="o">=</span><span class="n">skmt</span><span class="o">.</span><span class="n">explained_variance_score</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ADM</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span><span class="n">regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">S</span><span class="p">))</span>
                <span class="n">s</span><span class="o">.</span><span class="n">vibrations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">addVMBLD</span><span class="p">(</span><span class="n">regressor</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">exvar</span><span class="p">)</span>
        <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Ending: Vibrational Mode Bayesian Linear Decomposition</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VMARD"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.VMARD">[docs]</a><span class="k">def</span> <span class="nf">VMARD</span><span class="p">(</span><span class="n">of</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Performs a Linear Decomposition of the vibrational modes</span>
<span class="sd">        using Bayesian regression with Automatic Relevance Determination</span>
<span class="sd">        over the internal coordinates stored in the system s.</span>
<span class="sd">        Inputs:</span>
<span class="sd">        - of: handle for the output file</span>
<span class="sd">        - s:  the system</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Starting: Vibrational Mode Automatic Relevance Determination</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">intcoords</span><span class="p">)</span><span class="o">&gt;</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">vibrations</span><span class="p">)):</span>
                <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; More internal coordinates than frequencies, expect</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; some (possibly unwanted) redundancy in the results</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">vibrations</span><span class="p">)):</span>
                <span class="n">o</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">if</span> <span class="n">skl</span><span class="o">.</span><span class="n">__version__</span> <span class="o">&gt;=</span> <span class="nb">str</span><span class="p">(</span><span class="mf">1.3</span><span class="p">):</span>
                    <span class="n">regressor</span><span class="o">=</span><span class="n">sklm</span><span class="o">.</span><span class="n">ARDRegression</span><span class="p">(</span><span class="n">compute_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">regressor</span><span class="o">=</span><span class="n">sklm</span><span class="o">.</span><span class="n">ARDRegression</span><span class="p">(</span><span class="n">compute_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">n_iter</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
                <span class="n">regressor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">S</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">ADM</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
                <span class="n">r2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ADM</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span><span class="n">regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">S</span><span class="p">))[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
                <span class="n">exvar</span><span class="o">=</span><span class="n">skmt</span><span class="o">.</span><span class="n">explained_variance_score</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ADM</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span><span class="n">regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">S</span><span class="p">))</span>
                <span class="n">s</span><span class="o">.</span><span class="n">vibrations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">addVMARD</span><span class="p">(</span><span class="n">regressor</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">exvar</span><span class="p">)</span>
        <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Ending: Vibrational Mode Automatic Relevance Determination</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../autoapi/PDielec/vibanalysis/index.html#PDielec.vibanalysis.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="c1">## Main executable ##</span>
        <span class="c1"># Force a reset of the options</span>
        <span class="k">global</span> <span class="n">Opts</span>
        <span class="k">global</span> <span class="n">Symbols</span>
        <span class="k">global</span> <span class="n">Masses</span>
        <span class="k">global</span> <span class="n">Radii</span>
        <span class="n">InitialiseVaOpts</span><span class="p">()</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
        <span class="n">reload</span><span class="p">(</span><span class="n">logging</span><span class="p">)</span>
        <span class="c1"># Set flags and filenames</span>
        <span class="n">Linear</span><span class="o">=</span><span class="kc">False</span> <span class="c1"># if true, internal coords will be 3N-5m instead of 3N-6</span>
        <span class="n">Transition</span><span class="o">=</span><span class="kc">False</span> <span class="c1">#if true, get the first mode and exclude the next 6 (or 5)</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Usage: </span><span class="si">%s</span><span class="s2"> [ Commands ] [ Options ] inputFile</span>

<span class="s2">Commands:</span>
<span class="s2"> --vmp     Perform Vibrational Mode Decomposition analysis.</span>
<span class="s2"> --novmp   Don&#39;t perform Vibrational Mode Decomposition (default).</span>
<span class="s2"> --vmld    Perform Vibrational Mode Linear Decomposition analysis.</span>
<span class="s2"> --novmld  Don&#39;t perform Vibrational Mode Linear Decomposition (default).</span>
<span class="s2"> --vmbld   Perform Vibrational Mode Bayesian Linear Decomposition analysis.</span>
<span class="s2"> --novmbld Don&#39;t perform Vibrational Mode Bayesian Linear Decomposition (default).</span>
<span class="s2"> --vmard   Perform Vibrational Mode ARD Decomposition analysis (default).</span>
<span class="s2"> --novmard Don&#39;t perform Vibrational Mode ARD Decomposition analysis.</span>

<span class="s2">Options:</span>
<span class="s2"> --linear         System is linear (3N-5 vibrational modes expected).</span>
<span class="s2"> --ts             System is a transition state </span>
<span class="s2">                  (first vibrational mode included as reaction coordinate).</span>
<span class="s2"> --mwd            Use mass-weighted vibrational displacements (default).</span>
<span class="s2"> --nomwd          Don&#39;t use mass-weighted vibrational displacements.</span>
<span class="s2"> --mws            Use mass-weighted internal coordinate displacements.</span>
<span class="s2"> --nomws          Don&#39;t use mass-weighted internal coordinate displacements (default).</span>
<span class="s2"> --noouts         Don not generate out-of-plane internal coordinates</span>
<span class="s2"> --notors         Don not generate torsion internal coordinates</span>
<span class="s2"> --strictplanes   Restrict out-of-plane bending to co-planar atoms (default)</span>
<span class="s2"> --nostrictplanes Out-of-plane coordinates generated for all eligible 4 atom sets</span>
<span class="s2"> --ooptol f.ff    Tolerance (in degrees) for --strictplanes.</span>
<span class="s2"> --autosel        Automatic selection of internal coordinates.</span>
<span class="s2"> --addic FILE     Read additional or user-defined internal coordinates from</span>
<span class="s2">                  file FILE.</span>
<span class="s2"> --cut XX         Set the cutoff for presenting contributions:</span>
<span class="s2">                  &#39;auto&#39; - Automatic selection (default)</span>
<span class="s2">                  &#39;all&#39;  - All contributions are listed.</span>
<span class="s2">                  &#39;d9&#39;   - Always lists the top 90</span><span class="si">%%</span><span class="s2"> most important contributions</span>
<span class="s2">                  &#39;q1&#39;   - Always lists the top 25</span><span class="si">%%</span><span class="s2"> most important contributions</span>
<span class="s2">                  X      - List only contributions with relative weight above X</span><span class="si">%%</span>
<span class="s2"> --delta f.ff     Use this value for the discete computation of S.</span>
<span class="s2"> --tol XX         Tolerance (in </span><span class="si">%%</span><span class="s2">) for determination of atomic connectivity.</span>
<span class="s2"> --input XX       Input format, and their expected sufixes:</span>
<span class="s2">                  &#39;hess&#39;      - Orca .hess file (default).</span>
<span class="s2">                  &#39;g09&#39;       - Gaussian09 output (log) file.</span>
<span class="s2">                  &#39;mopac&#39;     - MOPAC 2016 output (out) file.</span>
<span class="s2">                  &#39;mopac2016&#39; - MOPAC 2016 output (out) file.</span>
<span class="s2"> --vm XX          Animate vibrational mode XX </span>
<span class="s2"> --ic XX          Animate internal coordinate XX </span>

<span class="s2"> Format for additional coordinates (--addic):</span>
<span class="s2"> - Plain text file (extension is not relevant, but .ic is recommended)</span>
<span class="s2"> - Lines Containing a hash (#) are ignored as comments</span>
<span class="s2"> - One internal coordinate per line, as a tuple of characters and numbers:</span>
<span class="s2">   - First Entry: B A O, or T, for bond, angle, out-of-plane or torsion, respectively</span>
<span class="s2">         - Following entries: the indexes of the atoms involved, starting with 1.</span>
<span class="s2">   - For B, you must define 2 atoms</span>
<span class="s2">   - For A, you must define 3 atoms, the second being the apex of the angle</span>
<span class="s2">   - For O, you must define 4 atoms, the second being the central atom</span>
<span class="s2">   - For T, you must define 4 atoms, the first and last being the extreme of the torsion</span>
<span class="s2">  Examples:</span>
<span class="s2">    B 1 2   -&gt; Bond between atoms 1 and 2</span>
<span class="s2">    A 1 4 3 -&gt; Angle formed betweem 4-1 and 4-3</span>

<span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">arg</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">n</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">inic</span><span class="o">=</span><span class="kc">False</span>
        <span class="n">invm</span><span class="o">=</span><span class="kc">False</span>
        <span class="n">debug</span><span class="o">=</span><span class="kc">False</span>
        <span class="n">ofn</span><span class="o">=</span><span class="s2">&quot;va.out&quot;</span>
        <span class="n">useric</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">while</span><span class="p">(</span><span class="n">n</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)):</span>
                <span class="k">if</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--linear&quot;</span><span class="p">):</span>
                        <span class="n">inic</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">invm</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;isLinear&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--ts&quot;</span><span class="p">):</span>
                        <span class="n">inic</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">invm</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;isTState&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--mwd&quot;</span><span class="p">):</span>
                        <span class="n">inic</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">invm</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doMWD&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--nomwd&quot;</span><span class="p">):</span>
                        <span class="n">inic</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">invm</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doMWD&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--debug&quot;</span><span class="p">):</span>
                        <span class="n">debug</span><span class="o">=</span><span class="kc">True</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--mws&quot;</span><span class="p">):</span>
                        <span class="n">inic</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">invm</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doMWS&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--nomws&quot;</span><span class="p">):</span>
                        <span class="n">inic</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">invm</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doMWS&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--autosel&quot;</span><span class="p">):</span>
                        <span class="n">inic</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">invm</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doAutoSel&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--noouts&quot;</span><span class="p">):</span>
                        <span class="n">inic</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">invm</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doOuts&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--strictplanes&quot;</span><span class="p">):</span>
                        <span class="n">inic</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">invm</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;oopp&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--nostrictplanes&quot;</span><span class="p">):</span>
                        <span class="n">inic</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">invm</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;oopp&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--notors&quot;</span><span class="p">):</span>
                        <span class="n">inic</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">invm</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doTors&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--addic&quot;</span><span class="p">):</span>
                        <span class="n">useric</span><span class="o">=</span><span class="n">readUserIC</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--cut&quot;</span><span class="p">):</span>
                        <span class="n">inic</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">invm</span><span class="o">=</span><span class="kc">False</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;auto&quot;</span><span class="p">):</span>
                                <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;cut&quot;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span>
                        <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;d9&quot;</span><span class="p">):</span>
                                <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;cut&quot;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;d9&quot;</span>
                        <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;q1&quot;</span><span class="p">):</span>
                                <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;cut&quot;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;q1&quot;</span>
                        <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
                                <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;cut&quot;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;all&quot;</span>
                        <span class="k">else</span><span class="p">:</span>
                                <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;cut&quot;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;val&quot;</span>
                                <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;cutval&quot;</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">100.0</span>
                        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--delta&quot;</span><span class="p">):</span>
                        <span class="n">inic</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">invm</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;delta&quot;</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--ooptol&quot;</span><span class="p">):</span>
                        <span class="n">inic</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">invm</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;oopTol&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--tol&quot;</span><span class="p">):</span>
                        <span class="n">inic</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">invm</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;tol&quot;</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">100.0</span>
                        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--input&quot;</span><span class="p">):</span>
                        <span class="n">inic</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">invm</span><span class="o">=</span><span class="kc">False</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;hess&quot;</span><span class="p">):</span>
                                <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;OrcaHess&quot;</span>
                        <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;g09&quot;</span><span class="p">):</span>
                                <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;G09OUT&quot;</span>
                        <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;mopac&quot;</span> <span class="ow">or</span> <span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;mopac2016&quot;</span><span class="p">):</span>
                                <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;MOPAC2016&quot;</span>
                        <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;pdielec&quot;</span> <span class="ow">or</span> <span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;PDielec&quot;</span><span class="p">):</span>
                                <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;PDIELEC&quot;</span>
                        <span class="k">else</span><span class="p">:</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Input format not implemented!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--vm&quot;</span><span class="p">):</span>
                        <span class="n">inic</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">invm</span><span class="o">=</span><span class="kc">True</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--ic&quot;</span><span class="p">):</span>
                        <span class="n">inic</span><span class="o">=</span><span class="kc">True</span>
                        <span class="n">invm</span><span class="o">=</span><span class="kc">False</span>
                <span class="c1">## commands ##</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--vmp&quot;</span><span class="p">):</span>
                        <span class="n">inic</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">invm</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doVMP&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--novmp&quot;</span><span class="p">):</span>
                        <span class="n">inic</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">invm</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doVMP&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--vmld&quot;</span><span class="p">):</span>
                        <span class="n">inic</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">invm</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doVMLD&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--novmld&quot;</span><span class="p">):</span>
                        <span class="n">inic</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">invm</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doVMLD&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--vmbld&quot;</span><span class="p">):</span>
                        <span class="n">inic</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">invm</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doVMBLD&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--novmbld&quot;</span><span class="p">):</span>
                        <span class="n">inic</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">invm</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doVMBLD&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--vmard&quot;</span><span class="p">):</span>
                        <span class="n">inic</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">invm</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doVMARD&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;--novmard&quot;</span><span class="p">):</span>
                        <span class="n">inic</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">invm</span><span class="o">=</span><span class="kc">False</span>
                        <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doVMARD&quot;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">inic</span><span class="p">):</span>
                        <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;anic&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]))</span>
                <span class="k">elif</span><span class="p">(</span><span class="n">invm</span><span class="p">):</span>
                        <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;aniMode&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">n</span><span class="p">]))</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">ifn</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1">#Create name/basename for output file</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;OrcaHess&quot;</span><span class="p">):</span>
                <span class="n">ofn</span><span class="o">=</span><span class="n">ifn</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;G09OUT&quot;</span><span class="p">):</span>
                <span class="n">ofn</span><span class="o">=</span><span class="n">ifn</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;MOPAC2016&quot;</span><span class="p">):</span>
                <span class="n">ofn</span><span class="o">=</span><span class="n">ifn</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;PDIELEC&quot;</span><span class="p">):</span>
                <span class="n">ofn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">ifn</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span><span class="p">(</span><span class="n">debug</span><span class="p">):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">ofn</span><span class="o">+</span><span class="s2">&quot;.debug&quot;</span><span class="p">,</span>
                                    <span class="n">filemode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span>
                                    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(levelname)s</span><span class="s2">:</span><span class="si">%(funcName)s</span><span class="s2">: </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
                                    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(levelname)s</span><span class="s2">:</span><span class="si">%(funcName)s</span><span class="s2">: </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">of</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">ofn</span><span class="o">+</span><span class="s2">&quot;.nma&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;###############################################################</span>
<span class="s2">#                                                             #</span>
<span class="s2">#   vibAnalysis - version 1.2.2                               #</span>
<span class="s2">#   A set of tools to analyse vibrational modes in terms of   #</span>
<span class="s2">#   localized internal coordinates.                           #</span>
<span class="s2">#                                                             #</span>
<span class="s2">#   (c) Filipe Teixeira, 2017-2019                            #</span>
<span class="s2">#   filipe _dot_ teixeira _at_ fc _dot_ up _dot_ pt           #</span>
<span class="s2">#                                                             #</span>
<span class="s2">###############################################################</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="c1"># Read Geometry, Masses, Frequencies and Vibrational Mode Displacements</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;OrcaHess&quot;</span><span class="p">):</span>
                <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Opening Hess file: </span><span class="si">%s</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ifn</span><span class="p">))</span>
                <span class="n">system</span><span class="o">=</span><span class="n">readHess</span><span class="p">(</span><span class="n">ifn</span><span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;G09OUT&quot;</span><span class="p">):</span>
                <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Opening Gaussian09 output file: </span><span class="si">%s</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ifn</span><span class="p">))</span>
                <span class="n">system</span><span class="o">=</span><span class="n">readG09log</span><span class="p">(</span><span class="n">ifn</span><span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;MOPAC2016&quot;</span><span class="p">):</span>
                <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Opening MOPAC 2016 output file: </span><span class="si">%s</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ifn</span><span class="p">))</span>
                <span class="n">system</span><span class="o">=</span><span class="n">readMopac2016</span><span class="p">(</span><span class="n">ifn</span><span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;PDIELEC&quot;</span><span class="p">):</span>
                <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Opening using PDielec library : </span><span class="si">%s</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ifn</span><span class="p">))</span>
                <span class="n">system</span><span class="o">=</span><span class="n">readPDielec</span><span class="p">(</span><span class="n">ifn</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">punch</span><span class="p">())</span>
        <span class="c1">## If MW, mass-weight the normal modes</span>
        <span class="c1"># Orca&#39;s hess is not mass-weighted, but normalized</span>
        <span class="c1"># Gaussian&#39;s log is not mass-weighted, but normalized</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doMWD&quot;</span><span class="p">]):</span>
                <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Mass-weighting the atomic displacements...</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1">#OLD</span>
                <span class="n">system</span><span class="o">.</span><span class="n">massWeightVibrations</span><span class="p">()</span>
                <span class="n">system</span><span class="o">.</span><span class="n">normalizeVibrations</span><span class="p">()</span>
        <span class="c1">#jk system.sortVibrations()</span>
        <span class="n">system</span><span class="o">.</span><span class="n">makeADM</span><span class="p">()</span>
        <span class="n">system</span><span class="o">.</span><span class="n">checkADM</span><span class="p">()</span>
        <span class="c1"># Generate quasi-redundant internal coordinated</span>
        <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generating Internal Coordinates...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">makeIC</span><span class="p">(</span><span class="n">system</span><span class="p">,</span><span class="n">useric</span><span class="p">)</span>
        <span class="c1"># normalize S</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doMWS&quot;</span><span class="p">]):</span>
                <span class="n">system</span><span class="o">.</span><span class="n">massWeightS</span><span class="p">()</span>
        <span class="n">system</span><span class="o">.</span><span class="n">normalizeS</span><span class="p">()</span>
        <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Internal Coordinates Generated: </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">intcoords</span><span class="p">)))</span>
        <span class="c1"># print list of internal coordinates</span>
        <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">This is the list of Internal Coordinates generated for</span>
<span class="s2">this run. Please use these indexes if you whish to animate</span>
<span class="s2">any one of these coordinates. If you added some user-defined</span>
<span class="s2">coordinates, please be sure to re-run this program with the</span>
<span class="s2">same added coordinates.</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">punchIC</span><span class="p">(</span><span class="n">of</span><span class="p">,</span><span class="n">system</span><span class="p">)</span>
        <span class="c1">## Animate modes?</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;aniMode&quot;</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
                <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;aniMode&quot;</span><span class="p">]:</span>
                        <span class="n">tfn</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.v</span><span class="si">%03d</span><span class="s2">.xyz&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ofn</span><span class="p">,</span><span class="n">mode</span><span class="p">)</span>
                        <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Animating mode </span><span class="si">%d</span><span class="s2"> to file: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span><span class="n">tfn</span><span class="p">))</span>
                        <span class="n">animateMode</span><span class="p">(</span><span class="n">tfn</span><span class="p">,</span><span class="n">system</span><span class="p">,</span><span class="n">mode</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;anic&quot;</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
                <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">icidx</span> <span class="ow">in</span> <span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;anic&quot;</span><span class="p">]:</span>
                        <span class="n">tfn</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.i</span><span class="si">%03d</span><span class="s2">.xyz&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ofn</span><span class="p">,</span><span class="n">icidx</span><span class="p">)</span>
                        <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Animating internal coordinate </span><span class="si">%d</span><span class="s2"> to file: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">icidx</span><span class="p">,</span><span class="n">tfn</span><span class="p">))</span>
                        <span class="n">animateIC</span><span class="p">(</span><span class="n">tfn</span><span class="p">,</span><span class="n">system</span><span class="p">,</span><span class="n">icidx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">of</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1">## Do the analysis</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doVMP&quot;</span><span class="p">]):</span>
                <span class="n">VMP</span><span class="p">(</span><span class="n">of</span><span class="p">,</span><span class="n">system</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doVMLD&quot;</span><span class="p">]):</span>
                <span class="n">VMLD</span><span class="p">(</span><span class="n">of</span><span class="p">,</span><span class="n">system</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doVMBLD&quot;</span><span class="p">]):</span>
                <span class="n">VMBLD</span><span class="p">(</span><span class="n">of</span><span class="p">,</span><span class="n">system</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Opts</span><span class="p">[</span><span class="s2">&quot;doVMARD&quot;</span><span class="p">]):</span>
                <span class="n">VMARD</span><span class="p">(</span><span class="n">of</span><span class="p">,</span><span class="n">system</span><span class="p">)</span>
        <span class="c1">## Print the final analysis</span>
        <span class="n">printResults</span><span class="p">(</span><span class="n">of</span><span class="p">,</span><span class="n">system</span><span class="p">)</span>
        <span class="c1">## Clean up</span>
        <span class="n">of</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<span class="k">if</span><span class="p">(</span><span class="vm">__name__</span><span class="o">==</span><span class="s2">&quot;__main__&quot;</span><span class="p">):</span>
        <span class="n">main</span><span class="p">()</span>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, John Kendrick and Andrew Burnett
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=37b3a9b0"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/scripts/furo.js?v=32e29ea5"></script>
    </body>
</html>