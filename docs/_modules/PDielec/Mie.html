<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <!-- Generated with Sphinx 7.3.7 and Furo 2024.05.06 -->
        <title>PDielec.Mie - PDielec: John Kendrick &amp; Andrew Burnett</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=92fd9be5" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=387cc868" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="../../_static/table_styling.css?v=a1a2a898" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=36a5483c" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=2e0a580d" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" /
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">PDielec: John Kendrick & Andrew Burnett</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">PDielec: John Kendrick & Andrew Burnett</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Software</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pdgui.html">PDGui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software.html">Other Software Components</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Theory</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../theory_powder.html">Theory for Light Scattering from Powders</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../theory_single_crystal.html">Theory for Single Crystal Optics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analysis.html">Phonon Analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../application_notes_1.html">Applications of Effective Medium Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../application_notes_2.html">Single Crystal Applications</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../autoapi/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../autoapi/PDielec/index.html">PDielec</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of PDielec</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../autoapi/PDielec/GUI/index.html">PDielec.GUI</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of PDielec.GUI</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/AnalysisTab/index.html">PDielec.GUI.AnalysisTab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/App/index.html">PDielec.GUI.App</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/FitterTab/index.html">PDielec.GUI.FitterTab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/MainTab/index.html">PDielec.GUI.MainTab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/NoteBook/index.html">PDielec.GUI.NoteBook</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/OpenGLWidget/index.html">PDielec.GUI.OpenGLWidget</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/PlottingTab/index.html">PDielec.GUI.PlottingTab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/PowderScenarioTab/index.html">PDielec.GUI.PowderScenarioTab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/ScenarioTab/index.html">PDielec.GUI.ScenarioTab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/SettingsTab/index.html">PDielec.GUI.SettingsTab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/SingleCrystalLayer/index.html">PDielec.GUI.SingleCrystalLayer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/SingleCrystalScenarioTab/index.html">PDielec.GUI.SingleCrystalScenarioTab</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/SpreadSheetManager/index.html">PDielec.GUI.SpreadSheetManager</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../autoapi/PDielec/GUI/ViewerTab/index.html">PDielec.GUI.ViewerTab</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/AbinitOutputReader/index.html">PDielec.AbinitOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/Calculator/index.html">PDielec.Calculator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/CastepOutputReader/index.html">PDielec.CastepOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/Constants/index.html">PDielec.Constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/CrystalOutputReader/index.html">PDielec.CrystalOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/DielectricFunction/index.html">PDielec.DielectricFunction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/ExperimentOutputReader/index.html">PDielec.ExperimentOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/GTMcore/index.html">PDielec.GTMcore</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/GenericOutputReader/index.html">PDielec.GenericOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/GulpOutputReader/index.html">PDielec.GulpOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/HelperRoutines/index.html">PDielec.HelperRoutines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/IO/index.html">PDielec.IO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/Materials/index.html">PDielec.Materials</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/Mie/index.html">PDielec.Mie</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/PhonopyOutputReader/index.html">PDielec.PhonopyOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/Plotter/index.html">PDielec.Plotter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/QEOutputReader/index.html">PDielec.QEOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/SuperCell/index.html">PDielec.SuperCell</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/UnitCell/index.html">PDielec.UnitCell</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/Utilities/index.html">PDielec.Utilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/VaspOutputReader/index.html">PDielec.VaspOutputReader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/checkcsv/index.html">PDielec.checkcsv</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/checkexcel/index.html">PDielec.checkexcel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/graphdatagenerator/index.html">PDielec.graphdatagenerator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/p1reader/index.html">PDielec.p1reader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/p2cif/index.html">PDielec.p2cif</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/pdcompare/index.html">PDielec.pdcompare</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/pdgui/index.html">PDielec.pdgui</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/pdmake/index.html">PDielec.pdmake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/pickled_reader/index.html">PDielec.pickled_reader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/preader/index.html">PDielec.preader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../autoapi/PDielec/vibanalysis/index.html">PDielec.vibanalysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../autoapi/PDielec/pdgui/index.html">PDielec.pdgui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../autoapi/PDielec/preader/index.html">PDielec.preader</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../autoapi/PDielec/pdmake/index.html">PDielec.pdmake</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../zreferences.html">References</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>Source code for PDielec.Mie</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">PyMieScatt package</span>
<span class="sd">------------------</span>

<span class="sd">Routines taken from PyMieScatt </span>
<span class="sd">http://pymiescatt.readthedocs.io/en/latest</span>
<span class="sd">Below is a copy of the original licence.</span>

<span class="sd">This version of PyMieScatt has been integrated into the PDielec package by John Kendrick</span>

<span class="sd">MIT License</span>

<span class="sd">Copyright (c) 2017 Benjamin Sumlin</span>

<span class="sd">Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">in the Software without restriction, including without limitation the rights</span>
<span class="sd">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">furnished to do so, subject to the following conditions:</span>

<span class="sd">The above copyright notice and this permission notice shall be included in all</span>
<span class="sd">copies or substantial portions of the Software.</span>

<span class="sd">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
<span class="sd">SOFTWARE.</span>

<span class="sd">Publications</span>
<span class="sd">------------</span>

<span class="sd">- Sumlin B.J., Heinson W.R., and Chakrabarty R.K. (2018) Retrieving the Aerosol Complex Refractive Index using PyMieScatt: A Mie Computational Package with Visualization Capabilities. Journal of Quantitative Spectroscopy and Radiative Transfer(https://doi.org/10.1016/j.jqsrt.2017.10.012)</span>
<span class="sd">- Sumlin B.J., Pandey A., Walker M.J., Pattison R.S., Williams B.J., and Chakrabarty R.K. (2017) Atmospheric Photooxidation Diminishes Light Absorption by Primary Brown Carbon Aerosol from Biomass Burning, Environmental Science &amp; Technology Letters(https://doi.org/10.1021/acs.estlett.7b00393)</span>
<span class="sd">- Sumlin B.J., Heinson, Y.W., Shetty N., Pandey A., Pattison, R.S., Baker S., Hao W.M, Chakrabarty R.K. (2018) UV–Vis–IR spectral complex refractive indices and optical properties of brown carbon aerosol from biomass burning, Journal of Quantitative Spectroscopy and Radiative Transfer(https://doi.org/10.1016/j.jqsrt.2017.12.009)</span>


<span class="sd">http://pymiescatt.readthedocs.io/en/latest/forward.html</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">jv</span><span class="p">,</span> <span class="n">yv</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">trapz</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="c1"># Parameter to determine wavelength crossover between methods for treating</span>
<span class="c1"># long and short wavelengths</span>
<span class="n">crossover</span> <span class="o">=</span> <span class="mf">0.01</span>

<div class="viewcode-block" id="coerceDType">
<a class="viewcode-back" href="../../autoapi/PDielec/Mie/index.html#PDielec.Mie.coerceDType">[docs]</a>
<span class="k">def</span> <span class="nf">coerceDType</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert input data to a NumPy array if not already one.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    d : array_like</span>
<span class="sd">        The input data to be converted to a NumPy array.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ndarray</span>
<span class="sd">        The input data as a NumPy array.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; coerceDType([1, 2, 3])</span>
<span class="sd">    array([1, 2, 3])</span>

<span class="sd">    &gt;&gt;&gt; coerceDType(np.array([1, 2, 3]))</span>
<span class="sd">    array([1, 2, 3])</span>
<span class="sd">  &quot;&quot;&quot;</span>    
  <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">d</span></div>


<div class="viewcode-block" id="MieQ">
<a class="viewcode-back" href="../../autoapi/PDielec/Mie/index.html#PDielec.Mie.MieQ">[docs]</a>
<span class="k">def</span> <span class="nf">MieQ</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">,</span> <span class="n">diameter</span><span class="p">,</span> <span class="n">nMedium</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">asDict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">asCrossSection</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate Mie scattering efficiencies or cross sections for a spherical particle.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : complex</span>
<span class="sd">        The complex refractive index of the particle material.</span>
<span class="sd">    wavelength : float</span>
<span class="sd">        The wavelength of the incident light in the same units as the particle diameter.</span>
<span class="sd">    diameter : float</span>
<span class="sd">        The diameter of the particle.</span>
<span class="sd">    nMedium : float, optional</span>
<span class="sd">        The real refractive index of the medium in which the particle is embedded. Defaults to 1.0 (vacuum or air).</span>
<span class="sd">    asDict : bool, optional</span>
<span class="sd">        If True, the results are returned as a dictionary. Otherwise, the results are returned as a tuple. Defaults to False.</span>
<span class="sd">    asCrossSection : bool, optional</span>
<span class="sd">        If True, the returned values represent cross sections. Otherwise, they represent dimensionless efficiencies. Defaults to False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict or tuple</span>
<span class="sd">        Depending on the &#39;asDict&#39; and &#39;asCrossSection&#39; flags, returns either a dictionary with keys (&#39;Qext&#39;, &#39;Qsca&#39;, &#39;Qabs&#39;, &#39;g&#39;, &#39;Qpr&#39;, &#39;Qback&#39;, &#39;Qratio&#39;) for dimensionless efficiencies or (&#39;Cext&#39;, &#39;Csca&#39;, &#39;Cabs&#39;, &#39;g&#39;, &#39;Cpr&#39;, &#39;Cback&#39;, &#39;Cratio&#39;) for cross sections, or a tuple with the corresponding values in the same order. The &#39;g&#39; parameter stands for the asymmetry parameter.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If any of the input parameters are invalid or out of the expected ranges.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The function calculates various optical properties of a sphere based on the Mie theory, which is a solution of Maxwell&#39;s equations for the scattering of electromagnetic waves by a sphere.</span>
<span class="sd">    - The &#39;m&#39; parameter is the relative refractive index of the sphere to the medium. It is complex, with the real part representing the ratio of the speed of light in the medium to the speed of light in the sphere, and the imaginary part accounting for absorption within the sphere.</span>
<span class="sd">    - The dimensionless efficiencies (Qext for extinction, Qsca for scattering, Qabs for absorption, Qpr for pressure, Qback for backscatter, and Qratio for the backscatter ratio) are normalized to the geometric cross-section area of the particle.</span>
<span class="sd">    - When &#39;asCrossSection&#39; is True, the function returns absolute cross sections, which have physical units dependent on the units of the input diameter.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    Mie_ab : A function used within `MieQ` to calculate the Mie coefficients &#39;a_n&#39; and &#39;b_n&#39;.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    To calculate the Mie scattering efficiencies for a water droplet in air at a visible wavelength:</span>

<span class="sd">    &gt;&gt;&gt; MieQ(1.33 + 0.001j, 0.55, 1.0)</span>
<span class="sd">    (1.5, 0.5, 1.0, 0.1, 1.4, 0.05, 0.1)</span>

<span class="sd">    To calculate the Mie scattering cross sections for the same droplet, returned as a dictionary:</span>

<span class="sd">    &gt;&gt;&gt; MieQ(1.33 + 0.001j, 0.55, 1.0, nMedium=1.0, asDict=True, asCrossSection=True)</span>
<span class="sd">    {&#39;Cext&#39;: 0.8, &#39;Csca&#39;: 0.2, &#39;Cabs&#39;: 0.6, &#39;g&#39;: 0.05, &#39;Cpr&#39;: 0.7, &#39;Cback&#39;: 0.02, &#39;Cratio&#39;: 0.1}</span>
<span class="sd">  &quot;&quot;&quot;</span>    
  <span class="c1">#  http://pymiescatt.readthedocs.io/en/latest/forward.html#MieQ</span>
  <span class="n">nMedium</span> <span class="o">=</span> <span class="n">nMedium</span><span class="o">.</span><span class="n">real</span>
  <span class="n">m</span> <span class="o">/=</span> <span class="n">nMedium</span>
  <span class="n">wavelength</span> <span class="o">/=</span> <span class="n">nMedium</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">diameter</span><span class="o">/</span><span class="n">wavelength</span>
  <span class="n">nmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="n">x</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)))</span>
  <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nmax</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">n1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span>
  <span class="n">n2</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">n3</span> <span class="o">=</span> <span class="n">n1</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
  <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>

  <span class="n">an</span><span class="p">,</span><span class="n">bn</span> <span class="o">=</span> <span class="n">Mie_ab</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>

  <span class="n">qext</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">n1</span><span class="o">*</span><span class="p">(</span><span class="n">an</span><span class="o">.</span><span class="n">real</span><span class="o">+</span><span class="n">bn</span><span class="o">.</span><span class="n">real</span><span class="p">))</span>
  <span class="n">qsca</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">n1</span><span class="o">*</span><span class="p">(</span><span class="n">an</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">an</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">bn</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">bn</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
  <span class="n">qabs</span> <span class="o">=</span> <span class="n">qext</span><span class="o">-</span><span class="n">qsca</span>

  <span class="n">g1</span> <span class="o">=</span> <span class="p">[</span><span class="n">an</span><span class="o">.</span><span class="n">real</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">nmax</span><span class="p">)],</span>
        <span class="n">an</span><span class="o">.</span><span class="n">imag</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">nmax</span><span class="p">)],</span>
        <span class="n">bn</span><span class="o">.</span><span class="n">real</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">nmax</span><span class="p">)],</span>
        <span class="n">bn</span><span class="o">.</span><span class="n">imag</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">nmax</span><span class="p">)]]</span>
  <span class="n">g1</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">g1</span><span class="p">]</span>
  <span class="n">g</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="o">/</span><span class="p">(</span><span class="n">qsca</span><span class="o">*</span><span class="n">x2</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">n2</span><span class="o">*</span><span class="p">(</span><span class="n">an</span><span class="o">.</span><span class="n">real</span><span class="o">*</span><span class="n">g1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">an</span><span class="o">.</span><span class="n">imag</span><span class="o">*</span><span class="n">g1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">bn</span><span class="o">.</span><span class="n">real</span><span class="o">*</span><span class="n">g1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">bn</span><span class="o">.</span><span class="n">imag</span><span class="o">*</span><span class="n">g1</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span><span class="o">+</span><span class="p">(</span><span class="n">n3</span><span class="o">*</span><span class="p">(</span><span class="n">an</span><span class="o">.</span><span class="n">real</span><span class="o">*</span><span class="n">bn</span><span class="o">.</span><span class="n">real</span><span class="o">+</span><span class="n">an</span><span class="o">.</span><span class="n">imag</span><span class="o">*</span><span class="n">bn</span><span class="o">.</span><span class="n">imag</span><span class="p">)))</span>

  <span class="n">qpr</span> <span class="o">=</span> <span class="n">qext</span><span class="o">-</span><span class="n">qsca</span><span class="o">*</span><span class="n">g</span>
  <span class="n">qback</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">n1</span><span class="o">*</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">an</span><span class="o">-</span><span class="n">bn</span><span class="p">)))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
  <span class="n">qratio</span> <span class="o">=</span> <span class="n">qback</span><span class="o">/</span><span class="n">qsca</span>
  <span class="k">if</span> <span class="n">asCrossSection</span><span class="p">:</span>
    <span class="n">css</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">diameter</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">cext</span> <span class="o">=</span> <span class="n">css</span><span class="o">*</span><span class="n">qext</span>
    <span class="n">csca</span> <span class="o">=</span> <span class="n">css</span><span class="o">*</span><span class="n">qsca</span>
    <span class="n">cabs</span> <span class="o">=</span> <span class="n">css</span><span class="o">*</span><span class="n">qabs</span>
    <span class="n">cpr</span> <span class="o">=</span> <span class="n">css</span><span class="o">*</span><span class="n">qpr</span>
    <span class="n">cback</span> <span class="o">=</span> <span class="n">css</span><span class="o">*</span><span class="n">qback</span>
    <span class="n">cratio</span> <span class="o">=</span> <span class="n">css</span><span class="o">*</span><span class="n">qratio</span>
    <span class="k">if</span> <span class="n">asDict</span><span class="p">:</span>
      <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Cext</span><span class="o">=</span><span class="n">cext</span><span class="p">,</span><span class="n">Csca</span><span class="o">=</span><span class="n">csca</span><span class="p">,</span><span class="n">Cabs</span><span class="o">=</span><span class="n">cabs</span><span class="p">,</span><span class="n">g</span><span class="o">=</span><span class="n">g</span><span class="p">,</span><span class="n">Cpr</span><span class="o">=</span><span class="n">cpr</span><span class="p">,</span><span class="n">Cback</span><span class="o">=</span><span class="n">cback</span><span class="p">,</span><span class="n">Cratio</span><span class="o">=</span><span class="n">cratio</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">cext</span><span class="p">,</span> <span class="n">csca</span><span class="p">,</span> <span class="n">cabs</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">cpr</span><span class="p">,</span> <span class="n">cback</span><span class="p">,</span> <span class="n">cratio</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">asDict</span><span class="p">:</span>
      <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Qext</span><span class="o">=</span><span class="n">qext</span><span class="p">,</span><span class="n">Qsca</span><span class="o">=</span><span class="n">qsca</span><span class="p">,</span><span class="n">Qabs</span><span class="o">=</span><span class="n">qabs</span><span class="p">,</span><span class="n">g</span><span class="o">=</span><span class="n">g</span><span class="p">,</span><span class="n">Qpr</span><span class="o">=</span><span class="n">qpr</span><span class="p">,</span><span class="n">Qback</span><span class="o">=</span><span class="n">qback</span><span class="p">,</span><span class="n">Qratio</span><span class="o">=</span><span class="n">qratio</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">qext</span><span class="p">,</span> <span class="n">qsca</span><span class="p">,</span> <span class="n">qabs</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">qpr</span><span class="p">,</span> <span class="n">qback</span><span class="p">,</span> <span class="n">qratio</span></div>


<div class="viewcode-block" id="Mie_ab">
<a class="viewcode-back" href="../../autoapi/PDielec/Mie/index.html#PDielec.Mie.Mie_ab">[docs]</a>
<span class="k">def</span> <span class="nf">Mie_ab</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the Mie scattering coefficients a_n and b_n.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : complex</span>
<span class="sd">        The complex refractive index of the scattering particle.</span>
<span class="sd">    x : float</span>
<span class="sd">        Size parameter, which is the ratio of the particle&#39;s circumference to the wavelength of incident light.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    an, bn : ndarray</span>
<span class="sd">        The Mie scattering coefficients a_n and b_n as numpy arrays of complex numbers.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function calculates the Mie scattering coefficients, `a_n` and `b_n`, for a spherical particle based on the complex refractive index (`m`) and the size parameter (`x`). The size parameter is defined as \( 2\pi r / \lambda \), where \( r \) is the particle radius, and \( \lambda \) is the wavelength of the incident light in the medium surrounding the particle.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; m = 1.5 + 1.0j  # Complex refractive index</span>
<span class="sd">    &gt;&gt;&gt; x = 2.0  # Size parameter</span>
<span class="sd">    &gt;&gt;&gt; an, bn = Mie_ab(m, x)</span>
<span class="sd">    &gt;&gt;&gt; print(an)</span>
<span class="sd">    &gt;&gt;&gt; print(bn)</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    - Bohren, C. F., &amp; Huffman, D. R. (1983). Absorption and Scattering of Light by Small Particles. Wiley.</span>
<span class="sd">    - Wiscombe, W. J. (1980). Improved Mie scattering algorithms. Applied Optics, 19(9), 1505.</span>
<span class="sd">  &quot;&quot;&quot;</span>    
  <span class="c1">#  http://pymiescatt.readthedocs.io/en/latest/forward.html#Mie_ab</span>
  <span class="n">mx</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="n">x</span>
  <span class="n">nmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="n">x</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)))</span>
  <span class="n">nmx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">nmax</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mx</span><span class="p">))</span><span class="o">+</span><span class="mi">16</span><span class="p">)</span>
  <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nmax</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#</span>
  <span class="n">nu</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="c1">#</span>

  <span class="n">sx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>

  <span class="n">px</span> <span class="o">=</span> <span class="n">sx</span><span class="o">*</span><span class="n">jv</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span><span class="n">x</span><span class="p">)</span> <span class="c1">#</span>
  <span class="n">p1x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">px</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">nmax</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c1">#</span>

  <span class="n">chx</span> <span class="o">=</span> <span class="o">-</span><span class="n">sx</span><span class="o">*</span><span class="n">yv</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span><span class="n">x</span><span class="p">)</span> <span class="c1">#</span>
  <span class="n">ch1x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">chx</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">nmax</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c1">#</span>

  <span class="n">gsx</span> <span class="o">=</span> <span class="n">px</span><span class="o">-</span><span class="p">(</span><span class="mi">0</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">chx</span> <span class="c1">#</span>
  <span class="n">gs1x</span> <span class="o">=</span> <span class="n">p1x</span><span class="o">-</span><span class="p">(</span><span class="mi">0</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">ch1x</span> <span class="c1">#</span>

  <span class="c1"># B&amp;H Equation 4.89</span>
  <span class="n">Dn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nmx</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nmx</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">Dn</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">mx</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">Dn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">i</span><span class="o">/</span><span class="n">mx</span><span class="p">))</span>

  <span class="n">D</span> <span class="o">=</span> <span class="n">Dn</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">nmax</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># Dn(mx), drop terms beyond nMax</span>
  <span class="n">da</span> <span class="o">=</span> <span class="n">D</span><span class="o">/</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="o">/</span><span class="n">x</span>
  <span class="n">db</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="n">D</span><span class="o">+</span><span class="n">n</span><span class="o">/</span><span class="n">x</span>

  <span class="n">an</span> <span class="o">=</span> <span class="p">(</span><span class="n">da</span><span class="o">*</span><span class="n">px</span><span class="o">-</span><span class="n">p1x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">da</span><span class="o">*</span><span class="n">gsx</span><span class="o">-</span><span class="n">gs1x</span><span class="p">)</span>
  <span class="n">bn</span> <span class="o">=</span> <span class="p">(</span><span class="n">db</span><span class="o">*</span><span class="n">px</span><span class="o">-</span><span class="n">p1x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">db</span><span class="o">*</span><span class="n">gsx</span><span class="o">-</span><span class="n">gs1x</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">an</span><span class="p">,</span> <span class="n">bn</span></div>


<div class="viewcode-block" id="Mie_cd">
<a class="viewcode-back" href="../../autoapi/PDielec/Mie/index.html#PDielec.Mie.Mie_cd">[docs]</a>
<span class="k">def</span> <span class="nf">Mie_cd</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the Mie scattering coefficients for given size parameter and relative refractive index.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : complex</span>
<span class="sd">        The relative refractive index of the particle to the medium.</span>
<span class="sd">    x : float</span>
<span class="sd">        The size parameter, which is the ratio of the particle&#39;s circumference to the wavelength in the medium.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        A tuple containing two numpy arrays: (cn, dn). `cn` and `dn` are the scattering coefficients for the electric and magnetic modes, respectively.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function computes the scattering coefficients using the Mie theory, which applies to spherical particles. The specific formulation used here involves calculating auxiliary variables such as `nx`, the series of orders; `cnx`, the Riccati-Bessel functions; and various other intermediate quantities essential for the final calculation of the Mie coefficients.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If any of the input arguments are outside of their expected ranges or types.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    numpy.round : Rounds an array to the given number of decimals.</span>
<span class="sd">    numpy.arange : Returns evenly spaced values within a given interval.</span>
<span class="sd">    numpy.zeros : Returns a new array of given shape and type, filled with zeros.</span>
<span class="sd">    numpy.sqrt : Returns the non-negative square-root of an array, element-wise.</span>
<span class="sd">    scipy.special.jv : Computes the first-kind Bessel function of real order and complex argument.</span>
<span class="sd">    scipy.special.yv : Computes the second-kind Bessel function of real order and complex argument.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; m = 1.5 + 0.1j</span>
<span class="sd">    &gt;&gt;&gt; x = 2.5</span>
<span class="sd">    &gt;&gt;&gt; cn, dn = Mie_cd(m, x)</span>
<span class="sd">    &gt;&gt;&gt; print(cn, dn)</span>
<span class="sd">  &quot;&quot;&quot;</span>    
<span class="c1">#  http://pymiescatt.readthedocs.io/en/latest/forward.html#Mie_cd</span>
  <span class="n">mx</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="n">x</span>
  <span class="n">nmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="n">x</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)))</span>
  <span class="n">nmx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">nmax</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mx</span><span class="p">))</span><span class="o">+</span><span class="mi">16</span><span class="p">)</span>
  <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">nmax</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">nu</span> <span class="o">=</span> <span class="n">n</span><span class="o">+</span><span class="mf">0.5</span>

  <span class="n">cnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nmx</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

  <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nmx</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">cnx</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span><span class="o">-</span><span class="n">mx</span><span class="o">*</span><span class="n">mx</span><span class="o">/</span><span class="p">(</span><span class="n">cnx</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">j</span><span class="p">)</span>

  <span class="n">cnn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cnx</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">))])</span>

  <span class="n">jnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">))</span><span class="o">*</span><span class="n">jv</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
  <span class="n">jnmx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">mx</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="n">jv</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">mx</span><span class="p">)</span>

  <span class="n">yx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">))</span><span class="o">*</span><span class="n">yv</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
  <span class="n">hx</span> <span class="o">=</span> <span class="n">jnx</span><span class="o">+</span><span class="p">(</span><span class="mf">1.0</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">yx</span>

  <span class="n">b1x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">x</span><span class="p">,</span> <span class="n">jnx</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">nmax</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
  <span class="n">y1x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">x</span><span class="p">,</span> <span class="n">yx</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">nmax</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

  <span class="n">hn1x</span> <span class="o">=</span>  <span class="n">b1x</span><span class="o">+</span><span class="p">(</span><span class="mf">1.0</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">y1x</span>
  <span class="n">ax</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">b1x</span><span class="o">-</span><span class="n">n</span><span class="o">*</span><span class="n">jnx</span>
  <span class="n">ahx</span> <span class="o">=</span>  <span class="n">x</span><span class="o">*</span><span class="n">hn1x</span><span class="o">-</span><span class="n">n</span><span class="o">*</span><span class="n">hx</span>

  <span class="n">numerator</span> <span class="o">=</span> <span class="n">jnx</span><span class="o">*</span><span class="n">ahx</span><span class="o">-</span><span class="n">hx</span><span class="o">*</span><span class="n">ax</span>
  <span class="n">c_denominator</span> <span class="o">=</span> <span class="n">ahx</span><span class="o">-</span><span class="n">hx</span><span class="o">*</span><span class="n">cnn</span>
  <span class="n">d_denominator</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="n">m</span><span class="o">*</span><span class="n">ahx</span><span class="o">-</span><span class="n">hx</span><span class="o">*</span><span class="n">cnn</span>

  <span class="n">cn</span> <span class="o">=</span> <span class="n">jnmx</span><span class="o">*</span><span class="n">numerator</span><span class="o">/</span><span class="n">c_denominator</span>
  <span class="n">dn</span> <span class="o">=</span> <span class="n">jnmx</span><span class="o">*</span><span class="n">m</span><span class="o">*</span><span class="n">numerator</span><span class="o">/</span><span class="n">d_denominator</span>

  <span class="k">return</span> <span class="n">cn</span><span class="p">,</span> <span class="n">dn</span></div>


<div class="viewcode-block" id="RayleighMieQ">
<a class="viewcode-back" href="../../autoapi/PDielec/Mie/index.html#PDielec.Mie.RayleighMieQ">[docs]</a>
<span class="k">def</span> <span class="nf">RayleighMieQ</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">,</span> <span class="n">diameter</span><span class="p">,</span> <span class="n">nMedium</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">asDict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">asCrossSection</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the optical properties of a sphere for a given refractive index, wavelength, and diameter according to the Rayleigh-Scattering approximation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : complex</span>
<span class="sd">        Complex refractive index of the scatterer.</span>
<span class="sd">    wavelength : float</span>
<span class="sd">        Wavelength of the incident light in the same units as diameter.</span>
<span class="sd">    diameter : float</span>
<span class="sd">        Diameter of the spherical particle.</span>
<span class="sd">    nMedium : float, optional</span>
<span class="sd">        Real refractive index of the medium, default is 1.0 (e.g., vacuum or air).</span>
<span class="sd">    asDict : bool, optional</span>
<span class="sd">        If True, return optical properties as a dictionary, otherwise returns a tuple. Default is False.</span>
<span class="sd">    asCrossSection : bool, optional</span>
<span class="sd">        If True, returns cross-sectional values. Default is False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict or tuple</span>
<span class="sd">        If asDict is False and asCrossSection is False, returns a tuple: (Qext, Qsca, Qabs, g, Qpr, Qback, Qratio).</span>
<span class="sd">        If asDict is True and asCrossSection is False, returns a dictionary with keys: &#39;Qext&#39;, &#39;Qsca&#39;, &#39;Qabs&#39;, &#39;g&#39;, &#39;Qpr&#39;, &#39;Qback&#39;, &#39;Qratio&#39;.</span>
<span class="sd">        If asDict is False and asCrossSection is True, returns a tuple: (Cext, Csca, Cabs, g, Cpr, Cback, Cratio).</span>
<span class="sd">        If asDict is True and asCrossSection is True, returns a dictionary with keys: &#39;Cext&#39;, &#39;Csca&#39;, &#39;Cabs&#39;, &#39;g&#39;, &#39;Cpr&#39;, &#39;Cback&#39;, &#39;Cratio&#39;.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Qext, Qsca, Qabs, Qback, and Qratio represent the extinction, scattering, absorption, backscattering, and ratio of backscattering to total scattering efficiencies, respectively.</span>
<span class="sd">    - Cext, Csca, Cabs, Cpr, Cback, and Cratio are the cross-sectional areas for extinction, scattering, absorption, total interaction, backscattering, and the ratio of backscattering to total scattering, respectively.</span>
<span class="sd">    - The g parameter (asymmetry factor) is included for compatibility with other scattering code but is set to 0, as it is not applicable in the Rayleigh-Scattering regime.</span>
<span class="sd">    - The calculation assumes the Rayleigh-Scattering regime, which is valid when the particle diameter is much smaller than the wavelength of the incident light.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Calculate optical properties without cross-section:</span>

<span class="sd">    &gt;&gt;&gt; RayleighMieQ(1.5+0.1j, 550, 100)</span>
<span class="sd">    (Qext, Qsca, Qabs, 0, Qpr, Qback, Qratio)</span>

<span class="sd">    Calculate optical properties with cross-section values as a dictionary:</span>

<span class="sd">    &gt;&gt;&gt; RayleighMieQ(1.5+0.1j, 550, 100, asDict=True, asCrossSection=True)</span>
<span class="sd">    {&#39;Cext&#39;: cext, &#39;Csca&#39;: csca, &#39;Cabs&#39;: cabs, &#39;g&#39;: 0, &#39;Cpr&#39;: cpr, &#39;Cback&#39;: cback, &#39;Cratio&#39;: cratio}</span>
<span class="sd">  &quot;&quot;&quot;</span>    
<span class="c1">#  http://pymiescatt.readthedocs.io/en/latest/forward.html#RayleighMieQ</span>
  <span class="n">nMedium</span> <span class="o">=</span> <span class="n">nMedium</span><span class="o">.</span><span class="n">real</span>
  <span class="n">m</span> <span class="o">/=</span> <span class="n">nMedium</span>
  <span class="n">wavelength</span> <span class="o">/=</span> <span class="n">nMedium</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">diameter</span><span class="o">/</span><span class="n">wavelength</span>
  <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
  <span class="k">elif</span> <span class="n">x</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
    <span class="n">LL</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># Lorentz-Lorenz term</span>
    <span class="n">LLabsSq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">LL</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">qsca</span> <span class="o">=</span> <span class="mi">8</span><span class="o">*</span><span class="n">LLabsSq</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span> <span class="c1"># B&amp;H eq 5.8</span>
    <span class="n">qabs</span><span class="o">=</span><span class="mi">4</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">LL</span><span class="o">.</span><span class="n">imag</span> <span class="c1"># B&amp;H eq. 5.11</span>
    <span class="n">qext</span><span class="o">=</span><span class="n">qsca</span><span class="o">+</span><span class="n">qabs</span>
    <span class="n">qback</span> <span class="o">=</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">qsca</span> <span class="c1"># B&amp;H eq. 5.9</span>
    <span class="n">qratio</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="n">g</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">qpr</span> <span class="o">=</span> <span class="n">qext</span>
    <span class="k">if</span> <span class="n">asCrossSection</span><span class="p">:</span>
      <span class="n">css</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">diameter</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
      <span class="n">cext</span> <span class="o">=</span> <span class="n">css</span><span class="o">*</span><span class="n">qext</span>
      <span class="n">csca</span> <span class="o">=</span> <span class="n">css</span><span class="o">*</span><span class="n">qsca</span>
      <span class="n">cabs</span> <span class="o">=</span> <span class="n">css</span><span class="o">*</span><span class="n">qabs</span>
      <span class="n">cpr</span> <span class="o">=</span> <span class="n">css</span><span class="o">*</span><span class="n">qpr</span>
      <span class="n">cback</span> <span class="o">=</span> <span class="n">css</span><span class="o">*</span><span class="n">qback</span>
      <span class="n">cratio</span> <span class="o">=</span> <span class="n">css</span><span class="o">*</span><span class="n">qratio</span>
      <span class="k">if</span> <span class="n">asDict</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Cext</span><span class="o">=</span><span class="n">cext</span><span class="p">,</span><span class="n">Csca</span><span class="o">=</span><span class="n">csca</span><span class="p">,</span><span class="n">Cabs</span><span class="o">=</span><span class="n">cabs</span><span class="p">,</span><span class="n">g</span><span class="o">=</span><span class="n">g</span><span class="p">,</span><span class="n">Cpr</span><span class="o">=</span><span class="n">cpr</span><span class="p">,</span><span class="n">Cback</span><span class="o">=</span><span class="n">cback</span><span class="p">,</span><span class="n">Cratio</span><span class="o">=</span><span class="n">cratio</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cext</span><span class="p">,</span> <span class="n">csca</span><span class="p">,</span> <span class="n">cabs</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">cpr</span><span class="p">,</span> <span class="n">cback</span><span class="p">,</span> <span class="n">cratio</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">asDict</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Qext</span><span class="o">=</span><span class="n">qext</span><span class="p">,</span><span class="n">Qsca</span><span class="o">=</span><span class="n">qsca</span><span class="p">,</span><span class="n">Qabs</span><span class="o">=</span><span class="n">qabs</span><span class="p">,</span><span class="n">g</span><span class="o">=</span><span class="n">g</span><span class="p">,</span><span class="n">Qpr</span><span class="o">=</span><span class="n">qpr</span><span class="p">,</span><span class="n">Qback</span><span class="o">=</span><span class="n">qback</span><span class="p">,</span><span class="n">Qratio</span><span class="o">=</span><span class="n">qratio</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">qext</span><span class="p">,</span> <span class="n">qsca</span><span class="p">,</span> <span class="n">qabs</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">qpr</span><span class="p">,</span> <span class="n">qback</span><span class="p">,</span> <span class="n">qratio</span></div>


<div class="viewcode-block" id="AutoMieQ">
<a class="viewcode-back" href="../../autoapi/PDielec/Mie/index.html#PDielec.Mie.AutoMieQ">[docs]</a>
<span class="k">def</span> <span class="nf">AutoMieQ</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">,</span> <span class="n">diameter</span><span class="p">,</span> <span class="n">nMedium</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">asDict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">asCrossSection</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the Mie scattering efficiencies for spheres, using either the Rayleigh, or the full Mie solution.</span>

<span class="sd">    The function chooses between Rayleigh scattering (for small particles) and full Mie scattering based on </span>
<span class="sd">    the effective size parameter of the particles. This allows for the automatic selection of the most </span>
<span class="sd">    appropriate scattering algorithm.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : complex</span>
<span class="sd">        The complex refractive index of the scattering particle.</span>
<span class="sd">    wavelength : float</span>
<span class="sd">        The wavelength of the incident light (in the same units as the particle diameter).</span>
<span class="sd">    diameter : float</span>
<span class="sd">        The diameter of the scattering particle.</span>
<span class="sd">    nMedium : float, optional</span>
<span class="sd">        The real refractive index of the medium in which the particles are suspended. Default is 1.0 (vacuum or air).</span>
<span class="sd">    asDict : bool, optional</span>
<span class="sd">        If True, returns the results as a dictionary, with keys corresponding to the different scattering quantities. </span>
<span class="sd">        Default is False.</span>
<span class="sd">    asCrossSection : bool, optional</span>
<span class="sd">        If True, returns the scattering and extinction cross sections instead of efficiencies. </span>
<span class="sd">        Default is False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    If `asDict` is False:</span>
<span class="sd">        tuple</span>
<span class="sd">            A tuple containing the Mie scattering parameters. Typically includes efficiencies or cross sections </span>
<span class="sd">            for extinction, scattering, and absorption, and the asymmetry parameter among others, depending on the size parameter.</span>
<span class="sd">    If `asDict` is True:</span>
<span class="sd">        dict</span>
<span class="sd">            A dictionary with keys corresponding to the different scattering quantities, such as efficiencies or cross sections for </span>
<span class="sd">            extinction, scattering, absorption, and the asymmetry parameter among others.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If the effective size parameter is 0, indicating an invalid set of input parameters.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The crossover from Rayleigh to full Mie scattering is determined by a predefined size parameter, typically related to </span>
<span class="sd">      the particle&#39;s diameter, the medium&#39;s refractive index, and the wavelength of the light.</span>
<span class="sd">    - The actual implementation of the Rayleigh and Mie scattering calculations (`RayleighMieQ` and `MieQ` functions respectively) </span>
<span class="sd">      is not detailed here.</span>
<span class="sd">  &quot;&quot;&quot;</span>    
  <span class="c1">#  http://pymiescatt.readthedocs.io/en/latest/forward.html#AutoMieQ</span>
  <span class="n">nMedium</span> <span class="o">=</span> <span class="n">nMedium</span><span class="o">.</span><span class="n">real</span>
  <span class="n">m_eff</span> <span class="o">=</span> <span class="n">m</span> <span class="o">/</span> <span class="n">nMedium</span>
  <span class="n">wavelength_eff</span> <span class="o">=</span> <span class="n">wavelength</span> <span class="o">/</span> <span class="n">nMedium</span>
  <span class="n">x_eff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">diameter</span><span class="o">/</span><span class="n">wavelength_eff</span>
  <span class="k">if</span> <span class="n">x_eff</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
  <span class="k">elif</span> <span class="n">x_eff</span><span class="o">&lt;</span><span class="n">crossover</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">RayleighMieQ</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">,</span> <span class="n">diameter</span><span class="p">,</span> <span class="n">nMedium</span><span class="p">,</span> <span class="n">asDict</span><span class="o">=</span><span class="n">asDict</span><span class="p">,</span> <span class="n">asCrossSection</span><span class="o">=</span><span class="n">asCrossSection</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">MieQ</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">,</span> <span class="n">diameter</span><span class="p">,</span> <span class="n">nMedium</span><span class="p">,</span> <span class="n">asDict</span><span class="o">=</span><span class="n">asDict</span><span class="p">,</span> <span class="n">asCrossSection</span><span class="o">=</span><span class="n">asCrossSection</span><span class="p">)</span></div>


<div class="viewcode-block" id="LowFrequencyMieQ">
<a class="viewcode-back" href="../../autoapi/PDielec/Mie/index.html#PDielec.Mie.LowFrequencyMieQ">[docs]</a>
<span class="k">def</span> <span class="nf">LowFrequencyMieQ</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">,</span> <span class="n">diameter</span><span class="p">,</span> <span class="n">nMedium</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">asDict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">asCrossSection</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the Mie scattering efficiencies for low-frequency approximation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : complex</span>
<span class="sd">        The relative refractive index (particle refractive index / medium refractive index).</span>
<span class="sd">    wavelength : float</span>
<span class="sd">        The wavelength of the incident light in the same unit as diameter.</span>
<span class="sd">    diameter : float</span>
<span class="sd">        The diameter of the scattering particle in the same unit as wavelength.</span>
<span class="sd">    nMedium : float, optional</span>
<span class="sd">        The refractive index of the surrounding medium. The real part is used if a complex number is provided. Default is 1.0.</span>
<span class="sd">    asDict : bool, optional</span>
<span class="sd">        If True, return the results as a dictionary, otherwise return a tuple. Default is False.</span>
<span class="sd">    asCrossSection : bool, optional</span>
<span class="sd">        If True, calculate and return the cross-section values. If False, return the efficiency values. Default is False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple or dict</span>
<span class="sd">        Depending on `asDict`, it returns a tuple or a dictionary of scattering parameters. For `asDict=False` and `asCrossSection=False`, returns a tuple of efficiencies (Qext, Qsca, Qabs, g, Qpr, Qback, Qratio). For `asDict=True` and `asCrossSection=False`, returns a dictionary with the same efficiencies labeled by their names. If `asCrossSection=True`, it returns cross-section values (either as a tuple or dictionary) labeled by &#39;C&#39; instead of &#39;Q&#39; in their names and includes &#39;g&#39;, the asymmetry parameter.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If the recalculated size parameter `x` is zero, indicating that either the diameter is zero or the wavelength inside the medium is infinite.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The Mie scattering theory is a solution of Maxwell&#39;s equations that describes the scattering of electromagnetic radiation by a sphere. This function approximates these efficiencies in the low-frequency limit, which assumes the size parameter `x` (2*pi*radius/wavelength) is much smaller than 1. This approximation significantly simplifies the calculation but limits the accuracy for particles not meeting the assumption. The efficiencies calculated are dimensionless ratios of the cross-sections to the geometric cross-sectional area of the scattering particle.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Calculate Mie efficiencies for a particle with m=1.5+0.1j, diameter=0.1, and wavelength=0.55:</span>

<span class="sd">    &gt;&gt;&gt; LowFrequencyMieQ(1.5+0.1j, 0.55, 0.1)</span>
<span class="sd">    (output values vary)</span>
<span class="sd">  &quot;&quot;&quot;</span>    
  <span class="c1">#  http://pymiescatt.readthedocs.io/en/latest/forward.html#LowFrequencyMieQ</span>
  <span class="n">nMedium</span> <span class="o">=</span> <span class="n">nMedium</span><span class="o">.</span><span class="n">real</span>
  <span class="n">m</span> <span class="o">/=</span> <span class="n">nMedium</span>
  <span class="n">wavelength</span> <span class="o">/=</span> <span class="n">nMedium</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">diameter</span><span class="o">/</span><span class="n">wavelength</span>
  <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
  <span class="k">elif</span> <span class="n">x</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">n2</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">n3</span> <span class="o">=</span> <span class="n">n1</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>

    <span class="n">an</span><span class="p">,</span><span class="n">bn</span> <span class="o">=</span> <span class="n">LowFrequencyMie_ab</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>

    <span class="n">qext</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">n1</span><span class="o">*</span><span class="p">(</span><span class="n">an</span><span class="o">.</span><span class="n">real</span><span class="o">+</span><span class="n">bn</span><span class="o">.</span><span class="n">real</span><span class="p">))</span>
    <span class="n">qsca</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">n1</span><span class="o">*</span><span class="p">(</span><span class="n">an</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">an</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">bn</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">bn</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">qabs</span> <span class="o">=</span> <span class="n">qext</span><span class="o">-</span><span class="n">qsca</span>

    <span class="n">g1</span> <span class="o">=</span> <span class="p">[</span><span class="n">an</span><span class="o">.</span><span class="n">real</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span><span class="n">an</span><span class="o">.</span><span class="n">imag</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span><span class="n">bn</span><span class="o">.</span><span class="n">real</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span><span class="n">bn</span><span class="o">.</span><span class="n">imag</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]]</span>
    <span class="n">g1</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">g1</span><span class="p">]</span>
    <span class="n">g</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="o">/</span><span class="p">(</span><span class="n">qsca</span><span class="o">*</span><span class="n">x2</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">n2</span><span class="o">*</span><span class="p">(</span><span class="n">an</span><span class="o">.</span><span class="n">real</span><span class="o">*</span><span class="n">g1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">an</span><span class="o">.</span><span class="n">imag</span><span class="o">*</span><span class="n">g1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">bn</span><span class="o">.</span><span class="n">real</span><span class="o">*</span><span class="n">g1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">bn</span><span class="o">.</span><span class="n">imag</span><span class="o">*</span><span class="n">g1</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span><span class="o">+</span><span class="p">(</span><span class="n">n3</span><span class="o">*</span><span class="p">(</span><span class="n">an</span><span class="o">.</span><span class="n">real</span><span class="o">*</span><span class="n">bn</span><span class="o">.</span><span class="n">real</span><span class="o">+</span><span class="n">an</span><span class="o">.</span><span class="n">imag</span><span class="o">*</span><span class="n">bn</span><span class="o">.</span><span class="n">imag</span><span class="p">)))</span>

    <span class="n">qpr</span> <span class="o">=</span> <span class="n">qext</span><span class="o">-</span><span class="n">qsca</span><span class="o">*</span><span class="n">g</span>
    <span class="n">qback</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">n1</span><span class="o">*</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">an</span><span class="o">-</span><span class="n">bn</span><span class="p">)))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">qratio</span> <span class="o">=</span> <span class="n">qback</span><span class="o">/</span><span class="n">qsca</span>

    <span class="k">if</span> <span class="n">asCrossSection</span><span class="p">:</span>
      <span class="n">css</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">diameter</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
      <span class="n">cext</span> <span class="o">=</span> <span class="n">css</span><span class="o">*</span><span class="n">qext</span>
      <span class="n">csca</span> <span class="o">=</span> <span class="n">css</span><span class="o">*</span><span class="n">qsca</span>
      <span class="n">cabs</span> <span class="o">=</span> <span class="n">css</span><span class="o">*</span><span class="n">qabs</span>
      <span class="n">cpr</span> <span class="o">=</span> <span class="n">css</span><span class="o">*</span><span class="n">qpr</span>
      <span class="n">cback</span> <span class="o">=</span> <span class="n">css</span><span class="o">*</span><span class="n">qback</span>
      <span class="n">cratio</span> <span class="o">=</span> <span class="n">css</span><span class="o">*</span><span class="n">qratio</span>
      <span class="k">if</span> <span class="n">asDict</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Cext</span><span class="o">=</span><span class="n">cext</span><span class="p">,</span><span class="n">Csca</span><span class="o">=</span><span class="n">csca</span><span class="p">,</span><span class="n">Cabs</span><span class="o">=</span><span class="n">cabs</span><span class="p">,</span><span class="n">g</span><span class="o">=</span><span class="n">g</span><span class="p">,</span><span class="n">Cpr</span><span class="o">=</span><span class="n">cpr</span><span class="p">,</span><span class="n">Cback</span><span class="o">=</span><span class="n">cback</span><span class="p">,</span><span class="n">Cratio</span><span class="o">=</span><span class="n">cratio</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cext</span><span class="p">,</span> <span class="n">csca</span><span class="p">,</span> <span class="n">cabs</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">cpr</span><span class="p">,</span> <span class="n">cback</span><span class="p">,</span> <span class="n">cratio</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">asDict</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Qext</span><span class="o">=</span><span class="n">qext</span><span class="p">,</span><span class="n">Qsca</span><span class="o">=</span><span class="n">qsca</span><span class="p">,</span><span class="n">Qabs</span><span class="o">=</span><span class="n">qabs</span><span class="p">,</span><span class="n">g</span><span class="o">=</span><span class="n">g</span><span class="p">,</span><span class="n">Qpr</span><span class="o">=</span><span class="n">qpr</span><span class="p">,</span><span class="n">Qback</span><span class="o">=</span><span class="n">qback</span><span class="p">,</span><span class="n">Qratio</span><span class="o">=</span><span class="n">qratio</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">qext</span><span class="p">,</span> <span class="n">qsca</span><span class="p">,</span> <span class="n">qabs</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">qpr</span><span class="p">,</span> <span class="n">qback</span><span class="p">,</span> <span class="n">qratio</span></div>


<div class="viewcode-block" id="LowFrequencyMie_ab">
<a class="viewcode-back" href="../../autoapi/PDielec/Mie/index.html#PDielec.Mie.LowFrequencyMie_ab">[docs]</a>
<span class="k">def</span> <span class="nf">LowFrequencyMie_ab</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the low-frequency Mie scattering coefficients.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : complex</span>
<span class="sd">        The relative refractive index of the scattering particle to the medium.</span>
<span class="sd">    x : float</span>
<span class="sd">        The size parameter, which is the ratio of the particle&#39;s circumference </span>
<span class="sd">        to the wavelength of incident light.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        A tuple containing two numpy arrays. The first array represents the </span>
<span class="sd">        a_n coefficients, and the second represents the b_n coefficients, corresponding </span>
<span class="sd">        to the magnetic and electric mode scattering coefficients, respectively, for </span>
<span class="sd">        n=1,2.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function calculates the Mie scattering coefficients at low frequency (or small</span>
<span class="sd">    size parameter x) approximation. It returns the first two coefficients a_1, a_2 for</span>
<span class="sd">    electric modes, and b_1, b_2 for magnetic modes. These coefficients are calculated </span>
<span class="sd">    using the analytical expressions derived for the scattering by small particles in the </span>
<span class="sd">    limit when the size parameter x is much less than 1.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    This function does not explicitly raise any exceptions, but note that it relies on </span>
<span class="sd">    numpy for mathematical operations, so errors could be raised by numpy operations due </span>
<span class="sd">    to invalid inputs.</span>
<span class="sd">  &quot;&quot;&quot;</span>    
  <span class="c1">#  http://pymiescatt.readthedocs.io/en/latest/forward.html#LowFrequencyMie_ab</span>
  <span class="c1"># B&amp;H page 131</span>
  <span class="n">m2</span> <span class="o">=</span> <span class="n">m</span><span class="o">**</span><span class="mi">2</span>
  <span class="n">LL</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
  <span class="n">x3</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span>
  <span class="n">x5</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">5</span>
  <span class="n">x6</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">6</span>

  <span class="n">a1</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="n">j</span><span class="o">*</span><span class="n">x3</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">LL</span><span class="o">-</span><span class="p">(</span><span class="mi">2</span><span class="n">j</span><span class="o">*</span><span class="n">x5</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span><span class="o">*</span><span class="n">LL</span><span class="o">*</span><span class="p">(</span><span class="n">m2</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">m2</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">x6</span><span class="o">/</span><span class="mi">9</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">LL</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
  <span class="n">a2</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">x5</span><span class="o">/</span><span class="mi">15</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">m2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">m2</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
  <span class="n">b1</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">x5</span><span class="o">/</span><span class="mi">45</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">m2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">b2</span> <span class="o">=</span> <span class="mi">0</span><span class="o">+</span><span class="mi">0</span><span class="n">j</span>
  <span class="n">an</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">)</span>
  <span class="n">bn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span><span class="n">b2</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">an</span><span class="p">,</span><span class="n">bn</span></div>


<div class="viewcode-block" id="AutoMie_ab">
<a class="viewcode-back" href="../../autoapi/PDielec/Mie/index.html#PDielec.Mie.AutoMie_ab">[docs]</a>
<span class="k">def</span> <span class="nf">AutoMie_ab</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the Mie scattering coefficients a and b.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : complex</span>
<span class="sd">        The relative refractive index of the particle to the surrounding medium.</span>
<span class="sd">    x : float</span>
<span class="sd">        The size parameter, defined as the circumference of the particle divided by the wavelength of light (2 * pi * radius / wavelength).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        A tuple containing the calculated Mie scattering coefficients a and b.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function decides to use the LowFrequencyMie_ab() function for calculations if the size parameter `x` is below a certain threshold (`crossover`), otherwise it uses the Mie_ab() function for higher values of `x`. The `crossover` value must be predefined or accessible in the function&#39;s scope.</span>
<span class="sd">  &quot;&quot;&quot;</span>    
  <span class="k">if</span> <span class="n">x</span><span class="o">&lt;</span><span class="n">crossover</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">LowFrequencyMie_ab</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">Mie_ab</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">x</span><span class="p">)</span></div>


<div class="viewcode-block" id="Mie_SD">
<a class="viewcode-back" href="../../autoapi/PDielec/Mie/index.html#PDielec.Mie.Mie_SD">[docs]</a>
<span class="k">def</span> <span class="nf">Mie_SD</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">,</span> <span class="n">dp</span><span class="p">,</span> <span class="n">ndp</span><span class="p">,</span> <span class="n">nMedium</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">SMPS</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">asDict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the Mie Scattering parameters based on a supplied size distribution.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : complex</span>
<span class="sd">        The complex refractive index of the particles.</span>
<span class="sd">    wavelength : float</span>
<span class="sd">        Wavelength of the light in the same units as particle diameter `dp`.</span>
<span class="sd">    dp : ndarray</span>
<span class="sd">        Array containing particle diameters.</span>
<span class="sd">    ndp : ndarray</span>
<span class="sd">        Array containing the number concentration of particles corresponding to each diameter in `dp`.</span>
<span class="sd">    nMedium : float, optional</span>
<span class="sd">        The real refractive index of the medium. Defaults to 1.0.</span>
<span class="sd">    SMPS : bool, optional</span>
<span class="sd">        Boolean to choose calculation methodology. If True (default), uses summing methodology usually associated with SMPS data. If False, uses integration method.</span>
<span class="sd">    interpolate : bool, optional</span>
<span class="sd">        If interpolation is needed. This parameter is currently not used in the calculations. Defaults to False.</span>
<span class="sd">    asDict : bool, optional</span>
<span class="sd">        Determines the format of the function&#39;s return value. If True, the function returns a dictionary. If False (default), the function returns a tuple.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict or tuple</span>
<span class="sd">        If asDict is True, returns a dictionary with the keys &#39;Bext&#39; (Extinction coefficient), &#39;Bsca&#39; (Scattering coefficient), &#39;Babs&#39; (Absorption coefficient), &#39;G&#39; (Mean cosine of scattering angle or asymmetry parameter), &#39;Bpr&#39; (Radiation pressure efficiency), &#39;Bback&#39; (Backscatter coefficient), and &#39;Bratio&#39; (Backscatter ratio). If asDict is False, returns these values as a tuple in the same order.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    None</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function assumes that the input diameters `dp` and number concentrations `ndp` are in units that are consistent with each other and with the wavelength. The calculation of optical properties is performed for each particle size, then weighted by the corresponding size distribution, summed (or integrated, depending on the `SMPS` flag), to find the bulk optical properties.</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; m = 1.5 + 0.01j  # Complex refractive index of the particles</span>
<span class="sd">    &gt;&gt;&gt; wavelength = 550  # Wavelength of the light in nanometers</span>
<span class="sd">    &gt;&gt;&gt; dp = np.array([100, 200])  # Particle diameters in nanometers</span>
<span class="sd">    &gt;&gt;&gt; ndp = np.array([1e12, 0.5e12])  # Number concentrations</span>
<span class="sd">    &gt;&gt;&gt; results = Mie_SD(m, wavelength, dp, ndp, SMPS=True, asDict=True)</span>
<span class="sd">    &gt;&gt;&gt; print(results[&#39;Bext&#39;], results[&#39;Bsca&#39;], results[&#39;Babs&#39;])</span>
<span class="sd">  &quot;&quot;&quot;</span>    
  <span class="c1">#  http://pymiescatt.readthedocs.io/en/latest/forward.html#Mie_SD</span>
  <span class="n">nMedium</span> <span class="o">=</span> <span class="n">nMedium</span><span class="o">.</span><span class="n">real</span>
  <span class="n">m</span> <span class="o">/=</span> <span class="n">nMedium</span>
  <span class="n">wavelength</span> <span class="o">/=</span> <span class="n">nMedium</span>
  <span class="n">dp</span> <span class="o">=</span> <span class="n">coerceDType</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span>
  <span class="n">ndp</span> <span class="o">=</span> <span class="n">coerceDType</span><span class="p">(</span><span class="n">ndp</span><span class="p">)</span>
  <span class="n">_length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span>
  <span class="n">Q_ext</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">_length</span><span class="p">)</span>
  <span class="n">Q_sca</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">_length</span><span class="p">)</span>
  <span class="n">Q_abs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">_length</span><span class="p">)</span>
  <span class="n">Q_pr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">_length</span><span class="p">)</span>
  <span class="n">Q_back</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">_length</span><span class="p">)</span>
  <span class="n">Q_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">_length</span><span class="p">)</span>
  <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">_length</span><span class="p">)</span>
  
  <span class="c1"># scaling of 1e-6 to cast in units of inverse megameters - see docs</span>
  <span class="n">aSDn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">((</span><span class="n">dp</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">ndp</span><span class="o">*</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">)</span>
  <span class="c1">#  _logdp = np.log10(dp)</span>

  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">_length</span><span class="p">):</span>
    <span class="n">Q_ext</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Q_sca</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Q_abs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Q_pr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Q_back</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Q_ratio</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">AutoMieQ</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">wavelength</span><span class="p">,</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">nMedium</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">SMPS</span><span class="p">:</span>
    <span class="n">Bext</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Q_ext</span><span class="o">*</span><span class="n">aSDn</span><span class="p">)</span>
    <span class="n">Bsca</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Q_sca</span><span class="o">*</span><span class="n">aSDn</span><span class="p">)</span>
    <span class="n">Babs</span> <span class="o">=</span> <span class="n">Bext</span><span class="o">-</span><span class="n">Bsca</span>
    <span class="n">Bback</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Q_back</span><span class="o">*</span><span class="n">aSDn</span><span class="p">)</span>
    <span class="n">Bratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Q_ratio</span><span class="o">*</span><span class="n">aSDn</span><span class="p">)</span>
    <span class="n">bigG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">g</span><span class="o">*</span><span class="n">Q_sca</span><span class="o">*</span><span class="n">aSDn</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Q_sca</span><span class="o">*</span><span class="n">aSDn</span><span class="p">)</span>
    <span class="n">Bpr</span> <span class="o">=</span> <span class="n">Bext</span> <span class="o">-</span> <span class="n">bigG</span><span class="o">*</span><span class="n">Bsca</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">Bext</span> <span class="o">=</span> <span class="n">trapz</span><span class="p">(</span><span class="n">Q_ext</span><span class="o">*</span><span class="n">aSDn</span><span class="p">,</span><span class="n">dp</span><span class="p">)</span>
    <span class="n">Bsca</span> <span class="o">=</span> <span class="n">trapz</span><span class="p">(</span><span class="n">Q_sca</span><span class="o">*</span><span class="n">aSDn</span><span class="p">,</span><span class="n">dp</span><span class="p">)</span>
    <span class="n">Babs</span> <span class="o">=</span> <span class="n">Bext</span><span class="o">-</span><span class="n">Bsca</span>
    <span class="n">Bback</span> <span class="o">=</span> <span class="n">trapz</span><span class="p">(</span><span class="n">Q_back</span><span class="o">*</span><span class="n">aSDn</span><span class="p">,</span><span class="n">dp</span><span class="p">)</span>
    <span class="n">Bratio</span> <span class="o">=</span> <span class="n">trapz</span><span class="p">(</span><span class="n">Q_ratio</span><span class="o">*</span><span class="n">aSDn</span><span class="p">,</span><span class="n">dp</span><span class="p">)</span>
    <span class="n">bigG</span> <span class="o">=</span> <span class="n">trapz</span><span class="p">(</span><span class="n">g</span><span class="o">*</span><span class="n">Q_sca</span><span class="o">*</span><span class="n">aSDn</span><span class="p">,</span><span class="n">dp</span><span class="p">)</span><span class="o">/</span><span class="n">trapz</span><span class="p">(</span><span class="n">Q_sca</span><span class="o">*</span><span class="n">aSDn</span><span class="p">,</span><span class="n">dp</span><span class="p">)</span>
    <span class="n">Bpr</span> <span class="o">=</span> <span class="n">Bext</span> <span class="o">-</span> <span class="n">bigG</span><span class="o">*</span><span class="n">Bsca</span>

  <span class="k">if</span> <span class="n">asDict</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Bext</span><span class="o">=</span><span class="n">Bext</span><span class="p">,</span> <span class="n">Bsca</span><span class="o">=</span><span class="n">Bsca</span><span class="p">,</span> <span class="n">Babs</span><span class="o">=</span><span class="n">Babs</span><span class="p">,</span> <span class="n">G</span><span class="o">=</span><span class="n">bigG</span><span class="p">,</span> <span class="n">Bpr</span><span class="o">=</span><span class="n">Bpr</span><span class="p">,</span> <span class="n">Bback</span><span class="o">=</span><span class="n">Bback</span><span class="p">,</span> <span class="n">Bratio</span><span class="o">=</span><span class="n">Bratio</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">Bext</span><span class="p">,</span> <span class="n">Bsca</span><span class="p">,</span> <span class="n">Babs</span><span class="p">,</span> <span class="n">bigG</span><span class="p">,</span> <span class="n">Bpr</span><span class="p">,</span> <span class="n">Bback</span><span class="p">,</span> <span class="n">Bratio</span></div>


<div class="viewcode-block" id="ScatteringFunction">
<a class="viewcode-back" href="../../autoapi/PDielec/Mie/index.html#PDielec.Mie.ScatteringFunction">[docs]</a>
<span class="k">def</span> <span class="nf">ScatteringFunction</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">,</span> <span class="n">diameter</span><span class="p">,</span> <span class="n">nMedium</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">minAngle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxAngle</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">angularResolution</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="n">angleMeasure</span><span class="o">=</span><span class="s1">&#39;radians&#39;</span><span class="p">,</span> <span class="n">normalization</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the scattering function for given parameters using the Mie theory.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : complex</span>
<span class="sd">        The complex refractive index of the scattering particle.</span>
<span class="sd">    wavelength : float</span>
<span class="sd">        The wavelength of the incident light in the same units as `diameter`.</span>
<span class="sd">    diameter : float</span>
<span class="sd">        The diameter of the scattering particles.</span>
<span class="sd">    nMedium : float, optional</span>
<span class="sd">        The real refractive index of the medium. Default is 1.0.</span>
<span class="sd">    minAngle : float, optional</span>
<span class="sd">        The minimum scattering angle to compute, in degrees. Default is 0.</span>
<span class="sd">    maxAngle : float, optional</span>
<span class="sd">        The maximum scattering angle to compute, in degrees. Default is 180.</span>
<span class="sd">    angularResolution : float, optional</span>
<span class="sd">        The angular resolution for scattering calculations, in degrees. Default is 0.5.</span>
<span class="sd">    space : {&#39;theta&#39;, &#39;q&#39;}, optional</span>
<span class="sd">        The space in which to express the scattering angles. &#39;theta&#39; for regular angular space, and</span>
<span class="sd">        &#39;q&#39; for q-space (momentum transfer space). Default is &#39;theta&#39;.</span>
<span class="sd">    angleMeasure : {&#39;radians&#39;, &#39;degrees&#39;, &#39;gradians&#39;}, optional</span>
<span class="sd">        The unit of the input and output angles. Default is &#39;radians&#39;.</span>
<span class="sd">    normalization : {None, &#39;max&#39;, &#39;total&#39;}, optional</span>
<span class="sd">        The type of normalization applied to the scattering intensity. &#39;max&#39; normalizes</span>
<span class="sd">        the intensities to their maximum value, &#39;total&#39; normalizes the intensities</span>
<span class="sd">        to the total area under the curve. If None, no normalization is applied. Default is None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple of (ndarray, ndarray, ndarray, ndarray)</span>
<span class="sd">        A tuple containing four arrays: the measure (angle or q-space), S_L (scattering intensity for left polarization),</span>
<span class="sd">        S_R (scattering intensity for right polarization), and S_U (unpolarized scattering intensity),</span>
<span class="sd">        respectively.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If `angleMeasure` or `space` parameters are given invalid values.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function computes the scattering intensity based on Mie theory, considering</span>
<span class="sd">    angular ranges, resolution, and optional scattering space transformation (&#39;q&#39; space).</span>
<span class="sd">    It supports different normalization options for the scattering intensity as well.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; m = 1.5 + 0.1j</span>
<span class="sd">    &gt;&gt;&gt; wavelength = 0.632  # micrometers</span>
<span class="sd">    &gt;&gt;&gt; diameter = 1.0  # micrometers</span>
<span class="sd">    &gt;&gt;&gt; nMedium = 1.33</span>
<span class="sd">    &gt;&gt;&gt; scattering = ScatteringFunction(m, wavelength, diameter, nMedium=nMedium)</span>
<span class="sd">    &gt;&gt;&gt; measure, SL, SR, SU = scattering</span>
<span class="sd">  &quot;&quot;&quot;</span>    
  <span class="c1">#  http://pymiescatt.readthedocs.io/en/latest/forward.html#ScatteringFunction</span>
  <span class="n">nMedium</span> <span class="o">=</span> <span class="n">nMedium</span><span class="o">.</span><span class="n">real</span>
  <span class="n">m</span> <span class="o">/=</span> <span class="n">nMedium</span>
  <span class="n">wavelength</span> <span class="o">/=</span> <span class="n">nMedium</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">diameter</span><span class="o">/</span><span class="n">wavelength</span>

  <span class="n">_steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">maxAngle</span><span class="o">-</span><span class="n">minAngle</span><span class="p">)</span><span class="o">/</span><span class="n">angularResolution</span><span class="p">)</span> <span class="c1"># default 361</span>

  <span class="k">if</span> <span class="n">angleMeasure</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;radians&#39;</span><span class="p">,</span><span class="s1">&#39;RADIANS&#39;</span><span class="p">,</span><span class="s1">&#39;rad&#39;</span><span class="p">,</span><span class="s1">&#39;RAD&#39;</span><span class="p">]:</span>
    <span class="n">adjust</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
  <span class="k">elif</span> <span class="n">angleMeasure</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;gradians&#39;</span><span class="p">,</span><span class="s1">&#39;GRADIANS&#39;</span><span class="p">,</span><span class="s1">&#39;grad&#39;</span><span class="p">,</span><span class="s1">&#39;GRAD&#39;</span><span class="p">]:</span>
    <span class="n">adjust</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">200</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">adjust</span> <span class="o">=</span> <span class="mi">1</span>

  <span class="k">if</span> <span class="n">space</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">,</span><span class="s1">&#39;qspace&#39;</span><span class="p">,</span><span class="s1">&#39;QSPACE&#39;</span><span class="p">,</span><span class="s1">&#39;qSpace&#39;</span><span class="p">]:</span>
    <span class="c1"># _steps *= 10</span>
    <span class="n">_steps</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">minAngle</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
      <span class="n">minAngle</span> <span class="o">=</span> <span class="mf">1e-5</span>
    <span class="c1">#measure = np.logspace(np.log10(minAngle),np.log10(maxAngle),_steps)*np.pi/180</span>
    <span class="n">measure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">minAngle</span><span class="p">,</span> <span class="n">maxAngle</span><span class="p">,</span> <span class="n">_steps</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
    <span class="n">_q</span> <span class="o">=</span> <span class="kc">True</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">measure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">minAngle</span><span class="p">,</span><span class="n">maxAngle</span><span class="p">,</span><span class="n">_steps</span><span class="p">)</span><span class="o">*</span><span class="n">adjust</span>
    <span class="n">_q</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">measure</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
  <span class="n">_measure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">minAngle</span><span class="p">,</span><span class="n">maxAngle</span><span class="p">,</span><span class="n">_steps</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
  <span class="n">SL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">_steps</span><span class="p">)</span>
  <span class="n">SR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">_steps</span><span class="p">)</span>
  <span class="n">SU</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">_steps</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">_steps</span><span class="p">):</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">_measure</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
    <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span> <span class="o">=</span> <span class="n">MieS1S2</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">u</span><span class="p">)</span>
    <span class="n">SL</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">S1</span><span class="p">)</span><span class="o">*</span><span class="n">S1</span><span class="p">))</span><span class="o">.</span><span class="n">real</span>
    <span class="n">SR</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">S2</span><span class="p">)</span><span class="o">*</span><span class="n">S2</span><span class="p">))</span><span class="o">.</span><span class="n">real</span>
    <span class="n">SU</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">SR</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">SL</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
  <span class="k">if</span> <span class="n">normalization</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;MAX&#39;</span><span class="p">]:</span>
    <span class="n">SL</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">SL</span><span class="p">)</span>
    <span class="n">SR</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">SR</span><span class="p">)</span>
    <span class="n">SU</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">SU</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">normalization</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="s1">&#39;total&#39;</span><span class="p">,</span><span class="s1">&#39;TOTAL&#39;</span><span class="p">]:</span>
    <span class="n">SL</span> <span class="o">/=</span> <span class="n">trapz</span><span class="p">(</span><span class="n">SL</span><span class="p">,</span><span class="n">measure</span><span class="p">)</span>
    <span class="n">SR</span> <span class="o">/=</span> <span class="n">trapz</span><span class="p">(</span><span class="n">SR</span><span class="p">,</span><span class="n">measure</span><span class="p">)</span>
    <span class="n">SU</span> <span class="o">/=</span> <span class="n">trapz</span><span class="p">(</span><span class="n">SU</span><span class="p">,</span><span class="n">measure</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">_q</span><span class="p">:</span>
    <span class="n">measure</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">wavelength</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">measure</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">diameter</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">measure</span><span class="p">,</span><span class="n">SL</span><span class="p">,</span><span class="n">SR</span><span class="p">,</span><span class="n">SU</span></div>


<div class="viewcode-block" id="SF_SD">
<a class="viewcode-back" href="../../autoapi/PDielec/Mie/index.html#PDielec.Mie.SF_SD">[docs]</a>
<span class="k">def</span> <span class="nf">SF_SD</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">,</span> <span class="n">dp</span><span class="p">,</span> <span class="n">ndp</span><span class="p">,</span> <span class="n">nMedium</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">minAngle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxAngle</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">angularResolution</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="n">angleMeasure</span><span class="o">=</span><span class="s1">&#39;radians&#39;</span><span class="p">,</span> <span class="n">normalization</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the scattering function SD for given parameters and return the scattering intensities for left, right, and unpolarized light.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : complex</span>
<span class="sd">        The complex refractive index of the scattering particles.</span>
<span class="sd">    wavelength : float</span>
<span class="sd">        The wavelength of light in the medium.</span>
<span class="sd">    dp : array_like</span>
<span class="sd">        The diameters of the particles.</span>
<span class="sd">    ndp : array_like</span>
<span class="sd">        The number density of particles corresponding to `dp`.</span>
<span class="sd">    nMedium : float, optional</span>
<span class="sd">        The real refractive index of the medium, by default 1.0.</span>
<span class="sd">    minAngle : float, optional</span>
<span class="sd">        The minimum angle (inclusive) for calculating the scattering, by default 0.</span>
<span class="sd">    maxAngle : float, optional</span>
<span class="sd">        The maximum angle (inclusive) for calculating the scattering, by default 180.</span>
<span class="sd">    angularResolution : float, optional</span>
<span class="sd">        The resolution in angles for the scattering calculation, by default 0.5.</span>
<span class="sd">    space : str, optional</span>
<span class="sd">        Defines the space for the scattering calculation, by default &#39;theta&#39;.</span>
<span class="sd">    angleMeasure : str, optional</span>
<span class="sd">        Specifies the measure of angles (&#39;degrees&#39; or &#39;radians&#39;), by default &#39;radians&#39;.</span>
<span class="sd">    normalization : str, optional</span>
<span class="sd">        Defines the normalization method applied to the scattering intensities. It can be &#39;number&#39;, &#39;max&#39;, &#39;total&#39;, or their corresponding single letter (&#39;n&#39;, &#39;m&#39;, &#39;t&#39;) or uppercase variants. If None, no normalization is performed, by default None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        A tuple containing the measured angles (dependent on `angleMeasure`), and arrays of scattering intensities for left (SL), right (SR), and unpolarized (SU) light.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If an invalid option is passed to parameters that have specific acceptable values (e.g., `normalization`).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The scattering function SD is calculated based on Mie theory. Each diameter in `dp` corresponds to a number density in `ndp`. The function adjusts the calculations based on the medium&#39;s refractive index and applies the chosen normalization to the resulting scattering intensities.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    ScatteringFunction : Another function (not detailed here) that is presumably used in this calculation for obtaining the scattering data based on the input parameters.</span>
<span class="sd">  &quot;&quot;&quot;</span>    
  <span class="c1">#  http://pymiescatt.readthedocs.io/en/latest/forward.html#SF_SD</span>
  <span class="n">nMedium</span> <span class="o">=</span> <span class="n">nMedium</span><span class="o">.</span><span class="n">real</span>
  <span class="n">m</span> <span class="o">/=</span> <span class="n">nMedium</span>
  <span class="n">wavelength</span> <span class="o">/=</span> <span class="n">nMedium</span>
  
  <span class="n">_steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">maxAngle</span><span class="o">-</span><span class="n">minAngle</span><span class="p">)</span><span class="o">/</span><span class="n">angularResolution</span><span class="p">)</span>
  <span class="n">ndp</span> <span class="o">=</span> <span class="n">coerceDType</span><span class="p">(</span><span class="n">ndp</span><span class="p">)</span>
  <span class="n">dp</span> <span class="o">=</span> <span class="n">coerceDType</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span>
  <span class="n">SL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">_steps</span><span class="p">)</span>
  <span class="n">SR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">_steps</span><span class="p">)</span>
  <span class="n">SU</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">_steps</span><span class="p">)</span>
  <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;minAngle&#39;</span><span class="p">:</span><span class="n">minAngle</span><span class="p">,</span>
            <span class="s1">&#39;maxAngle&#39;</span><span class="p">:</span><span class="n">maxAngle</span><span class="p">,</span>
            <span class="s1">&#39;angularResolution&#39;</span><span class="p">:</span><span class="n">angularResolution</span><span class="p">,</span>
            <span class="s1">&#39;space&#39;</span><span class="p">:</span><span class="n">space</span><span class="p">,</span>
            <span class="s1">&#39;normalization&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
  <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ndp</span><span class="p">,</span><span class="n">dp</span><span class="p">):</span>
    <span class="n">measure</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">u</span> <span class="o">=</span> <span class="n">ScatteringFunction</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">wavelength</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">SL</span> <span class="o">+=</span> <span class="n">l</span><span class="o">*</span><span class="n">n</span>
    <span class="n">SR</span> <span class="o">+=</span> <span class="n">r</span><span class="o">*</span><span class="n">n</span>
    <span class="n">SU</span> <span class="o">+=</span> <span class="n">u</span><span class="o">*</span><span class="n">n</span>
  <span class="k">if</span> <span class="n">normalization</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;number&#39;</span><span class="p">,</span><span class="s1">&#39;particles&#39;</span><span class="p">]:</span>
    <span class="n">_n</span> <span class="o">=</span> <span class="n">trapz</span><span class="p">(</span><span class="n">ndp</span><span class="p">,</span><span class="n">dp</span><span class="p">)</span>
    <span class="n">SL</span> <span class="o">/=</span> <span class="n">_n</span>
    <span class="n">SR</span> <span class="o">/=</span> <span class="n">_n</span>
    <span class="n">SU</span> <span class="o">/=</span> <span class="n">_n</span>
  <span class="k">elif</span> <span class="n">normalization</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;MAX&#39;</span><span class="p">]:</span>
    <span class="n">SL</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">SL</span><span class="p">)</span>
    <span class="n">SR</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">SR</span><span class="p">)</span>
    <span class="n">SU</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">SU</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">normalization</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="s1">&#39;total&#39;</span><span class="p">,</span><span class="s1">&#39;TOTAL&#39;</span><span class="p">]:</span>
    <span class="n">SL</span> <span class="o">/=</span> <span class="n">trapz</span><span class="p">(</span><span class="n">SL</span><span class="p">,</span><span class="n">measure</span><span class="p">)</span>
    <span class="n">SR</span> <span class="o">/=</span> <span class="n">trapz</span><span class="p">(</span><span class="n">SR</span><span class="p">,</span><span class="n">measure</span><span class="p">)</span>
    <span class="n">SU</span> <span class="o">/=</span> <span class="n">trapz</span><span class="p">(</span><span class="n">SU</span><span class="p">,</span><span class="n">measure</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">measure</span><span class="p">,</span><span class="n">SL</span><span class="p">,</span><span class="n">SR</span><span class="p">,</span><span class="n">SU</span></div>


<div class="viewcode-block" id="MieS1S2">
<a class="viewcode-back" href="../../autoapi/PDielec/Mie/index.html#PDielec.Mie.MieS1S2">[docs]</a>
<span class="k">def</span> <span class="nf">MieS1S2</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">mu</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the scattering parameters S1 and S2 for Mie scattering.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : complex</span>
<span class="sd">        The complex refractive index of the scattering particles.</span>
<span class="sd">    x : float</span>
<span class="sd">        The size parameter of the particle, defined as \(2 \pi r / \lambda\), where \(r\) is the particle radius and \(\lambda\) is the wavelength of the incident light.</span>
<span class="sd">    mu : array_like</span>
<span class="sd">        An array of cosine values of the scattering angles.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        A tuple containing the S1 and S2 scattering parameters. Both values are complex numbers representing the electric field amplitudes of the scattered light for perpendicular (S1) and parallel (S2) polarizations relative to the plane of scattering.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function calculates the Mie scattering parameters S1 and S2, which are essential for understanding the scattering properties of spherical particles. It uses the `AutoMie_ab` function to calculate the Mie coefficients \(a_n\) and \(b_n\), and the `MiePiTau` function to compute the angle-dependent functions \(\pi_n\) and \(\tau_n\). The formulas for \(S_1\) and \(S_2\) involve sums over these coefficients weighted by \((2n+1)/(n(n+1))\), where \(n\) is the series index.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; m = 1.5 + 0.1j  # Complex refractive index</span>
<span class="sd">    &gt;&gt;&gt; x = 2.0  # Size parameter</span>
<span class="sd">    &gt;&gt;&gt; mu = np.array([1.0, 0.5])  # Cosine of the scattering angles</span>
<span class="sd">    &gt;&gt;&gt; S1, S2 = MieS1S2(m, x, mu)</span>
<span class="sd">    &gt;&gt;&gt; print(S1, S2)</span>
<span class="sd">  &quot;&quot;&quot;</span>    
  <span class="c1">#  http://pymiescatt.readthedocs.io/en/latest/forward.html#MieS1S2</span>
  <span class="n">nmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="n">x</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span>
  <span class="n">an</span><span class="p">,</span> <span class="n">bn</span> <span class="o">=</span> <span class="n">AutoMie_ab</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
  <span class="n">pin</span><span class="p">,</span> <span class="n">taun</span> <span class="o">=</span> <span class="n">MiePiTau</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span><span class="n">nmax</span><span class="p">)</span>
  <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">nmax</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">n2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
  <span class="n">S1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">n2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">an</span><span class="p">)]</span><span class="o">*</span><span class="p">(</span><span class="n">an</span><span class="o">*</span><span class="n">pin</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">an</span><span class="p">)]</span><span class="o">+</span><span class="n">bn</span><span class="o">*</span><span class="n">taun</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">bn</span><span class="p">)]))</span>
  <span class="n">S2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">n2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">an</span><span class="p">)]</span><span class="o">*</span><span class="p">(</span><span class="n">an</span><span class="o">*</span><span class="n">taun</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">an</span><span class="p">)]</span><span class="o">+</span><span class="n">bn</span><span class="o">*</span><span class="n">pin</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">bn</span><span class="p">)]))</span>
  <span class="k">return</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span></div>


<div class="viewcode-block" id="MiePiTau">
<a class="viewcode-back" href="../../autoapi/PDielec/Mie/index.html#PDielec.Mie.MiePiTau">[docs]</a>
<span class="k">def</span> <span class="nf">MiePiTau</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span><span class="n">nmax</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the Mie \(\pi\) and \(\tau\) functions for given argument and maximum order.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mu : float</span>
<span class="sd">        Cosine of the scattering angle.</span>
<span class="sd">    nmax : int</span>
<span class="sd">        Maximum order of the calculation.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        A tuple containing two numpy arrays. The first array corresponds to the \(\pi\) values and the second to the \(\tau\) values for the orders from 0 to \(nmax-1\).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The Mie \(\pi\) and \(\tau\) functions are part of the solution for the Mie scattering problem, which is a mathematical formulation describing the scattering of electromagnetic radiation by a sphere.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; mu, nmax = 0.5, 5</span>
<span class="sd">    &gt;&gt;&gt; pi, tau = MiePiTau(mu, nmax)</span>
<span class="sd">    &gt;&gt;&gt; print(pi)</span>
<span class="sd">    &gt;&gt;&gt; print(tau)</span>
<span class="sd">  &quot;&quot;&quot;</span>    
  <span class="c1">#  http://pymiescatt.readthedocs.io/en/latest/forward.html#MiePiTau</span>
  <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nmax</span><span class="p">))</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nmax</span><span class="p">))</span>
  <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">mu</span>
  <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">mu</span>
  <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">3.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">mu</span><span class="p">))</span>
  <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">nmax</span><span class="p">)):</span>
    <span class="n">p</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">mu</span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="n">n</span>
    <span class="n">t</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">mu</span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">p</span><span class="p">,</span> <span class="n">t</span></div>


<div class="viewcode-block" id="MatrixElements">
<a class="viewcode-back" href="../../autoapi/PDielec/Mie/index.html#PDielec.Mie.MatrixElements">[docs]</a>
<span class="k">def</span> <span class="nf">MatrixElements</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">wavelength</span><span class="p">,</span><span class="n">diameter</span><span class="p">,</span><span class="n">mu</span><span class="p">,</span><span class="n">nMedium</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the scattering matrix elements for a spherical scatterer.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : complex</span>
<span class="sd">        The complex refractive index of the scatterer relative to the medium.</span>
<span class="sd">    wavelength : float</span>
<span class="sd">        The wavelength of the incident light in the medium.</span>
<span class="sd">    diameter : float</span>
<span class="sd">        The diameter of the scatterer.</span>
<span class="sd">    mu : array_like</span>
<span class="sd">        The cosines of the scattering angles.</span>
<span class="sd">    nMedium : float, optional</span>
<span class="sd">        The refractive index of the medium. Default is 1.0.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        A tuple containing the scattering matrix elements S11, S12, S33, and S34.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The scattering matrix elements S11, S12, S33, and S34 are calculated using</span>
<span class="sd">    the Mie theory for a spherical scatterer.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; m = 1.5 + 0.1j</span>
<span class="sd">    &gt;&gt;&gt; wavelength = 0.5</span>
<span class="sd">    &gt;&gt;&gt; diameter = 0.05</span>
<span class="sd">    &gt;&gt;&gt; mu = np.linspace(-1, 1, 5)</span>
<span class="sd">    &gt;&gt;&gt; S11, S12, S33, S34 = MatrixElements(m, wavelength, diameter, mu)</span>
<span class="sd">  &quot;&quot;&quot;</span>    
  <span class="c1">#  http://pymiescatt.readthedocs.io/en/latest/forward.html#MatrixElements</span>
  <span class="n">nMedium</span> <span class="o">=</span> <span class="n">nMedium</span><span class="o">.</span><span class="n">real</span>
  <span class="n">m</span> <span class="o">/=</span> <span class="n">nMedium</span>
  <span class="n">wavelength</span> <span class="o">/=</span> <span class="n">nMedium</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">diameter</span><span class="o">/</span><span class="n">wavelength</span>
  <span class="c1"># B&amp;H eqs. 4.77, where mu=cos(theta)</span>
  <span class="n">S1</span><span class="p">,</span><span class="n">S2</span> <span class="o">=</span> <span class="n">MieS1S2</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">mu</span><span class="p">)</span>
  <span class="n">S11</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">S2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">S1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
  <span class="n">S12</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">S2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">S1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
  <span class="n">S33</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">S2</span><span class="p">)</span><span class="o">*</span><span class="n">S1</span><span class="o">+</span><span class="n">S2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">S1</span><span class="p">))</span>
  <span class="n">S34</span> <span class="o">=</span> <span class="mf">0.5</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">S1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">S2</span><span class="p">)</span><span class="o">-</span><span class="n">S2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">S1</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">S11</span><span class="p">,</span> <span class="n">S12</span><span class="p">,</span> <span class="n">S33</span><span class="p">,</span> <span class="n">S34</span></div>


<div class="viewcode-block" id="MieQ_withDiameterRange">
<a class="viewcode-back" href="../../autoapi/PDielec/Mie/index.html#PDielec.Mie.MieQ_withDiameterRange">[docs]</a>
<span class="k">def</span> <span class="nf">MieQ_withDiameterRange</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">,</span> <span class="n">nMedium</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">diameterRange</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">1000</span><span class="p">),</span> <span class="n">nd</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">logD</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate Mie scattering parameters over a range of particle diameters.</span>

<span class="sd">    This function calculates the efficiency factors for extinction (Qext),</span>
<span class="sd">    scattering (Qsca), absorption (Qabs), the asymmetry factor (g), </span>
<span class="sd">    the radiation pressure efficiency factor (Qpr), backscattering efficiency (Qback),</span>
<span class="sd">    and the Qratio over a specified range of particle diameters. It is based on </span>
<span class="sd">    the Mie theory, which applies to spherical particles.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : complex</span>
<span class="sd">        The relative refractive index of the particle to the medium.</span>
<span class="sd">    wavelength : float</span>
<span class="sd">        The wavelength of the incident light in the same units as the particle diameter.</span>
<span class="sd">    nMedium : float, optional</span>
<span class="sd">        The real refractive index of the medium. Defaults to 1.0.</span>
<span class="sd">    diameterRange : tuple, optional</span>
<span class="sd">        A tuple specifying the minimum and maximum particle diameters to be considered.</span>
<span class="sd">        Defaults to (10, 1000).</span>
<span class="sd">    nd : int, optional</span>
<span class="sd">        The number of particle diameters to calculate over the specified range. </span>
<span class="sd">        Defaults to 1000.</span>
<span class="sd">    logD : bool, optional</span>
<span class="sd">        If True, the particle diameters are spaced logarithmically between the minimum</span>
<span class="sd">        and maximum. If False (the default), the spacing is linear.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        A tuple containing the following elements in order:</span>
<span class="sd">        - diameters (np.ndarray): An array of the particle diameters.</span>
<span class="sd">        - qext (np.ndarray): The extinction efficiency factors.</span>
<span class="sd">        - qsca (np.ndarray): The scattering efficiency factors.</span>
<span class="sd">        - qabs (np.ndarray): The absorption efficiency factors.</span>
<span class="sd">        - g (np.ndarray): The asymmetry factors.</span>
<span class="sd">        - qpr (np.ndarray): The radiation pressure efficiency factors.</span>
<span class="sd">        - qback (np.ndarray): The backscattering efficiency factors.</span>
<span class="sd">        - qratio (np.ndarray): The Qratios.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The Mie theory applies to spherical particles and is used here to calculate</span>
<span class="sd">    the scattering parameters over a range of particle sizes. This can be useful</span>
<span class="sd">    for understanding the optical properties of particles in different media.</span>

<span class="sd">    The relative refractive index (m) and the medium refractive index (nMedium) </span>
<span class="sd">    are used to adjust the geometry and optical properties of the scattering</span>
<span class="sd">    calculation according to the specified medium.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; m = 1.5 + 0.1j</span>
<span class="sd">    &gt;&gt;&gt; wavelength = 550</span>
<span class="sd">    &gt;&gt;&gt; diameters, qext, qsca, qabs, g, qpr, qback, qratio = MieQ_withDiameterRange(m, wavelength)</span>
<span class="sd">    &gt;&gt;&gt; print(diameters, qext)</span>

<span class="sd">    Requires</span>
<span class="sd">    --------</span>
<span class="sd">    This function requires the `numpy` library for numerical operations and assumes</span>
<span class="sd">    there exists a function `AutoMieQ` that calculates the Mie efficiencies for a </span>
<span class="sd">    single particle diameter.</span>
<span class="sd">  &quot;&quot;&quot;</span>    
  <span class="c1">#  http://pymiescatt.readthedocs.io/en/latest/forward.html#MieQ_withDiameterRange</span>
  <span class="n">nMedium</span> <span class="o">=</span> <span class="n">nMedium</span><span class="o">.</span><span class="n">real</span>
  <span class="n">m</span> <span class="o">/=</span> <span class="n">nMedium</span>
  <span class="n">wavelength</span> <span class="o">/=</span> <span class="n">nMedium</span>
  <span class="k">if</span> <span class="n">logD</span><span class="p">:</span>
    <span class="n">diameters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">diameterRange</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">diameterRange</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">nd</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">diameters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">diameterRange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">diameterRange</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">nd</span><span class="p">)</span>
  <span class="n">_qD</span> <span class="o">=</span> <span class="p">[</span><span class="n">AutoMieQ</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">wavelength</span><span class="p">,</span><span class="n">diameter</span><span class="p">)</span> <span class="k">for</span> <span class="n">diameter</span> <span class="ow">in</span> <span class="n">diameters</span><span class="p">]</span>
  <span class="n">qext</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">_qD</span><span class="p">])</span>
  <span class="n">qsca</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">_qD</span><span class="p">])</span>
  <span class="n">qabs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">_qD</span><span class="p">])</span>
  <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">_qD</span><span class="p">])</span>
  <span class="n">qpr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">_qD</span><span class="p">])</span>
  <span class="n">qback</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">_qD</span><span class="p">])</span>
  <span class="n">qratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">_qD</span><span class="p">])</span>
  <span class="k">return</span> <span class="n">diameters</span><span class="p">,</span> <span class="n">qext</span><span class="p">,</span> <span class="n">qsca</span><span class="p">,</span> <span class="n">qabs</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">qpr</span><span class="p">,</span> <span class="n">qback</span><span class="p">,</span> <span class="n">qratio</span></div>


<div class="viewcode-block" id="MieQ_withWavelengthRange">
<a class="viewcode-back" href="../../autoapi/PDielec/Mie/index.html#PDielec.Mie.MieQ_withWavelengthRange">[docs]</a>
<span class="k">def</span> <span class="nf">MieQ_withWavelengthRange</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">diameter</span><span class="p">,</span> <span class="n">nMedium</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">wavelengthRange</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">1600</span><span class="p">),</span> <span class="n">nw</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">logW</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate Mie scattering efficiencies for a range of wavelengths.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : complex or array_like</span>
<span class="sd">        The relative refractive index of the particle to the medium. It can be a single complex value for homogeneous inputs or an array of complex values for varying inputs.</span>
<span class="sd">    diameter : float</span>
<span class="sd">        The diameter of the particle in the same units as the wavelength.</span>
<span class="sd">    nMedium : float, optional</span>
<span class="sd">        The real refractive index of the medium in which the particle is embedded. Defaults to 1.0.</span>
<span class="sd">    wavelengthRange : tuple, optional</span>
<span class="sd">        A tuple specifying the start and end of the wavelength range to calculate over. Default is (100, 1600) which are the start and end wavelengths, respectively.</span>
<span class="sd">    nw : int, optional</span>
<span class="sd">        The number of wavelengths to compute within the provided wavelength range. Default is 1000.</span>
<span class="sd">    logW : bool, optional</span>
<span class="sd">        A boolean to specify if the wavelength range should be spaced logarithmically (`True`) or linearly (`False`). Default is `False`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        A tuple containing the following np.ndarray objects-</span>
<span class="sd">        - wavelengths: The wavelengths at which the scattering parameters are computed.</span>
<span class="sd">        - qext: The extinction efficiency Q_ext.</span>
<span class="sd">        - qsca: The scattering efficiency Q_sca.</span>
<span class="sd">        - qabs: The absorption efficiency Q_abs.</span>
<span class="sd">        - g: The asymmetry parameter g.</span>
<span class="sd">        - qpr: The radiation pressure efficiency Q_pr.</span>
<span class="sd">        - qback: The backscattering efficiency Q_back.</span>
<span class="sd">        - qratio: The ratio of the backscattering to the total scattering efficiency.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    Warning</span>
<span class="sd">        If the input data size is mismatched or incorrect.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The refractive index `m`, diameter, and wavelength all need to be in consistent units.</span>

<span class="sd">    The function can handle both a fixed refractive index across all wavelengths or a varying refractive index for each wavelength. The calculation assumes that the medium is isotropic and homogeneous.</span>

<span class="sd">    The scattering efficiencies are calculated using the Mie theory, which is applicable for spherical particles.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Calculate the Mie scattering efficiencies for a particle with a constant refractive index:</span>

<span class="sd">    &gt;&gt;&gt; MieQ_withWavelengthRange(1.5 + 0.1j, 200)</span>

<span class="sd">    Calculate with logarithmically spaced wavelengths:</span>

<span class="sd">    &gt;&gt;&gt; MieQ_withWavelengthRange(m=1.5 + 0.1j, diameter=200, logW=True)</span>

<span class="sd">    Calculate for a range of varying complex refractive indices:</span>

<span class="sd">    &gt;&gt;&gt; MieQ_withWavelengthRange(m=[1.5 + 0.1j, 1.6 + 0.1j], diameter=200, wavelengthRange=(100, 200), nw=2)</span>
<span class="sd">  &quot;&quot;&quot;</span>    
  <span class="c1">#  http://pymiescatt.readthedocs.io/en/latest/forward.html#MieQ_withWavelengthRange</span>
  <span class="n">nMedium</span> <span class="o">=</span> <span class="n">nMedium</span><span class="o">.</span><span class="n">real</span>
  <span class="n">_m</span> <span class="o">=</span> <span class="n">m</span><span class="o">/</span><span class="n">nMedium</span>
  <span class="n">_wavelengthRange</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">x</span><span class="o">/</span><span class="n">nMedium</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">wavelengthRange</span><span class="p">])</span>
  <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">_m</span><span class="p">)</span> <span class="o">==</span> <span class="nb">complex</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">_wavelengthRange</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">logW</span><span class="p">:</span>
      <span class="n">wavelengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">_wavelengthRange</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">_wavelengthRange</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">nw</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">wavelengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">_wavelengthRange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">_wavelengthRange</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">nw</span><span class="p">)</span>
    <span class="n">_qD</span> <span class="o">=</span> <span class="p">[</span><span class="n">AutoMieQ</span><span class="p">(</span><span class="n">_m</span><span class="p">,</span><span class="n">wavelength</span><span class="p">,</span><span class="n">diameter</span><span class="p">)</span> <span class="k">for</span> <span class="n">wavelength</span> <span class="ow">in</span> <span class="n">wavelengths</span><span class="p">]</span>
  <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">_m</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">_wavelengthRange</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">_m</span><span class="p">):</span>
    <span class="n">wavelengths</span><span class="o">=</span><span class="n">_wavelengthRange</span>
    <span class="n">_qD</span> <span class="o">=</span> <span class="p">[</span><span class="n">MieQ</span><span class="p">(</span><span class="n">emm</span><span class="p">,</span><span class="n">wavelength</span><span class="p">,</span><span class="n">diameter</span><span class="p">)</span> <span class="k">for</span> <span class="n">emm</span><span class="p">,</span><span class="n">wavelength</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">_m</span><span class="p">,</span><span class="n">wavelengths</span><span class="p">)]</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Error: the size of the input data is mismatched. Please examine your inputs and try again.&quot;</span><span class="p">)</span>
    <span class="k">return</span>

  <span class="n">qext</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">_qD</span><span class="p">])</span>
  <span class="n">qsca</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">_qD</span><span class="p">])</span>
  <span class="n">qabs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">_qD</span><span class="p">])</span>
  <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">_qD</span><span class="p">])</span>
  <span class="n">qpr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">_qD</span><span class="p">])</span>
  <span class="n">qback</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">_qD</span><span class="p">])</span>
  <span class="n">qratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">_qD</span><span class="p">])</span>
  <span class="k">return</span> <span class="n">wavelengths</span><span class="p">,</span> <span class="n">qext</span><span class="p">,</span> <span class="n">qsca</span><span class="p">,</span> <span class="n">qabs</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">qpr</span><span class="p">,</span> <span class="n">qback</span><span class="p">,</span> <span class="n">qratio</span></div>


<div class="viewcode-block" id="MieQ_withSizeParameterRange">
<a class="viewcode-back" href="../../autoapi/PDielec/Mie/index.html#PDielec.Mie.MieQ_withSizeParameterRange">[docs]</a>
<span class="k">def</span> <span class="nf">MieQ_withSizeParameterRange</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">nMedium</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">xRange</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">nx</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">logX</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate optical properties over a range of size parameters using Mie theory.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : complex</span>
<span class="sd">        The complex refractive index of the particle material.</span>
<span class="sd">    nMedium : float, optional</span>
<span class="sd">        The real refractive index of the medium. Default is 1.0.</span>
<span class="sd">    xRange : tuple, optional</span>
<span class="sd">        A tuple specifying the range of size parameters (min, max). Default is (1, 10).</span>
<span class="sd">    nx : int, optional</span>
<span class="sd">        The number of size parameters to evaluate within the given range. Default is 1000.</span>
<span class="sd">    logX : bool, optional</span>
<span class="sd">        If `True`, the size parameters are spaced logarithmically between the minimum and maximum values. </span>
<span class="sd">        If `False`, the spacing is linear. Default is `False`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        Returns a tuple containing the following numpy arrays:</span>
<span class="sd">        - xValues: The size parameters evaluated.</span>
<span class="sd">        - qext: The extinction efficiency for each size parameter.</span>
<span class="sd">        - qsca: The scattering efficiency for each size parameter.</span>
<span class="sd">        - qabs: The absorption efficiency for each size parameter.</span>
<span class="sd">        - g: The asymmetry parameter for each size parameter.</span>
<span class="sd">        - qpr: The radiation pressure efficiency for each size parameter.</span>
<span class="sd">        - qback: The backscattering efficiency for each size parameter.</span>
<span class="sd">        - qratio: The ratio of backscattering to total scattering efficiency.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Given a range of size parameters (x) and the complex refractive index (m) of the scattering particle </span>
<span class="sd">    relative to the medium, this function computes various optical properties using Mie theory.</span>
<span class="sd">    The size parameter &quot;x&quot; is defined as \(x = 2 \pi r / \lambda\), where &quot;r&quot; is the particle radius, </span>
<span class="sd">    and &quot;\(\lambda\)&quot; is the wavelength of the incident light in the medium.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    ::</span>

<span class="sd">        import numpy as np</span>
<span class="sd">        m = 1.59 + 0.005j  # Complex refractive index of the particle</span>
<span class="sd">        nMedium = 1.33  # Refractive index of the medium</span>
<span class="sd">        xRange = (0.1, 100)  # Range of size parameters</span>
<span class="sd">        nx = 500  # Number of size parameters to evaluate</span>
<span class="sd">        logX = True  # Use logarithmic spacing</span>

<span class="sd">        # Compute the optical properties</span>
<span class="sd">        xValues, qext, qsca, qabs, g, qpr, qback, qratio = MieQ_withSizeParameterRange(m, nMedium, xRange, nx, logX)</span>

<span class="sd">        # Plot the extinction efficiency as a function of size parameter</span>
<span class="sd">        import matplotlib.pyplot as plt</span>
<span class="sd">        plt.loglog(xValues, qext)</span>
<span class="sd">        plt.xlabel(&#39;Size parameter (x)&#39;)</span>
<span class="sd">        plt.ylabel(&#39;Extinction efficiency (Qext)&#39;)</span>
<span class="sd">        plt.show()</span>

<span class="sd">  &quot;&quot;&quot;</span>    
  <span class="c1">#  http://pymiescatt.readthedocs.io/en/latest/forward.html#MieQ_withSizeParameterRange</span>
  <span class="n">nMedium</span> <span class="o">=</span> <span class="n">nMedium</span><span class="o">.</span><span class="n">real</span>
  <span class="n">m</span> <span class="o">/=</span> <span class="n">nMedium</span>
  <span class="n">_xRange</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">x</span><span class="o">*</span><span class="n">nMedium</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xRange</span><span class="p">])</span> <span class="c1"># I think</span>
  <span class="k">if</span> <span class="n">logX</span><span class="p">:</span>
    <span class="n">xValues</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">_xRange</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">_xRange</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">nx</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">xValues</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">_xRange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">_xRange</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">nx</span><span class="p">))</span>
  <span class="n">dValues</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1000</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xValues</span><span class="p">]</span>
  <span class="n">_qD</span> <span class="o">=</span> <span class="p">[</span><span class="n">AutoMieQ</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dValues</span><span class="p">]</span>
  <span class="n">qext</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">_qD</span><span class="p">])</span>
  <span class="n">qsca</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">_qD</span><span class="p">])</span>
  <span class="n">qabs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">_qD</span><span class="p">])</span>
  <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">_qD</span><span class="p">])</span>
  <span class="n">qpr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">_qD</span><span class="p">])</span>
  <span class="n">qback</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">_qD</span><span class="p">])</span>
  <span class="n">qratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">_qD</span><span class="p">])</span>
  <span class="k">return</span> <span class="n">xValues</span><span class="p">,</span> <span class="n">qext</span><span class="p">,</span> <span class="n">qsca</span><span class="p">,</span> <span class="n">qabs</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">qpr</span><span class="p">,</span> <span class="n">qback</span><span class="p">,</span> <span class="n">qratio</span></div>


<div class="viewcode-block" id="Mie_Lognormal">
<a class="viewcode-back" href="../../autoapi/PDielec/Mie/index.html#PDielec.Mie.Mie_Lognormal">[docs]</a>
<span class="k">def</span> <span class="nf">Mie_Lognormal</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">wavelength</span><span class="p">,</span><span class="n">geoStdDev</span><span class="p">,</span><span class="n">geoMean</span><span class="p">,</span><span class="n">numberOfParticles</span><span class="p">,</span><span class="n">nMedium</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">numberOfBins</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span><span class="n">lower</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">upper</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">gamma</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">returnDistribution</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">decomposeMultimodal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">asDict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform Mie scattering calculations for lognormally distributed particles.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    m : complex</span>
<span class="sd">        The refractive index of the particles.</span>
<span class="sd">    wavelength : float</span>
<span class="sd">        The wavelength of the incident light, in the same units as geoMean and lower/upper bounds.</span>
<span class="sd">    geoStdDev : float or sequence</span>
<span class="sd">        The geometric standard deviation(s) of the particles. Can be a single value or a list/tuple/numpy.ndarray for multimodal distributions.</span>
<span class="sd">    geoMean : float or sequence</span>
<span class="sd">        The geometric mean diameter(s) of the particles. Can be a single value or a list/tuple/numpy.ndarray for multimodal distributions.</span>
<span class="sd">    numberOfParticles : int</span>
<span class="sd">        The total number of particles.</span>
<span class="sd">    nMedium : float, optional</span>
<span class="sd">        The refractive index of the medium. Defaults to 1.0.</span>
<span class="sd">    numberOfBins : int, optional</span>
<span class="sd">        The number of bins for the discretization of the particle size distribution. Defaults to 10000.</span>
<span class="sd">    lower : int, optional</span>
<span class="sd">        The lower bound of particle diameters. Defaults to 1.</span>
<span class="sd">    upper : int, optional</span>
<span class="sd">        The upper bound of particle diameters. Defaults to 1000.</span>
<span class="sd">    gamma : list, optional</span>
<span class="sd">        The distribution of particles across different modes. Defaults to [1], implying a single mode.</span>
<span class="sd">    returnDistribution : bool, optional</span>
<span class="sd">        If True, the distribution data is also returned. Defaults to False.</span>
<span class="sd">    decomposeMultimodal : bool, optional</span>
<span class="sd">        If True and if the distribution is multimodal, return the contributions from each mode separately. Defaults to False.</span>
<span class="sd">    asDict : bool, optional</span>
<span class="sd">        If True, the optical properties are returned as a dictionary. Defaults to False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple or dict</span>
<span class="sd">        Mie scattering properties (Bext, Bsca, Babs, bigG, Bpr, Bback, Bratio) optionally along with the particle size distribution (dp, ndp) and, if multimodal and decomposeMultimodal is True, individual mode contributions (ndpi). The output is a tuple unless asDict is True, in which case it is a dictionary.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    Warning</span>
<span class="sd">        If the distribution may not be compact on the specified interval or if not enough parameters are specified for each mode.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The function optionally warns the user if the specified particle size distribution may not be compact within the given interval or if there aren&#39;t enough parameters to fully specify each mode in the case of a multimodal distribution. This function is particularly useful in the analysis and simulation of light scattering by particles following a lognormal size distribution.</span>
<span class="sd">  &quot;&quot;&quot;</span>    
  <span class="c1">#  http://pymiescatt.readthedocs.io/en/latest/forward.html#Mie_Lognormal</span>
  <span class="n">nMedium</span> <span class="o">=</span> <span class="n">nMedium</span><span class="o">.</span><span class="n">real</span>
  <span class="n">m</span> <span class="o">/=</span> <span class="n">nMedium</span>
  <span class="n">wavelength</span> <span class="o">/=</span> <span class="n">nMedium</span>
  <span class="n">ithPart</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">gammai</span><span class="p">,</span> <span class="n">dp</span><span class="p">,</span> <span class="n">dpgi</span><span class="p">,</span> <span class="n">sigmagi</span><span class="p">:</span> <span class="p">(</span><span class="n">gammai</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sigmagi</span><span class="p">)</span><span class="o">*</span><span class="n">dp</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">dpgi</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sigmagi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
  <span class="n">dp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">lower</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">upper</span><span class="p">),</span><span class="n">numberOfBins</span><span class="p">)</span>
  <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">geoStdDev</span><span class="p">,</span> <span class="n">geoMean</span><span class="p">]]):</span>
    <span class="c1"># multimodal</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">geoStdDev</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">geoMean</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
      <span class="c1"># gamma is distributed equally among modes</span>
      <span class="n">gamma</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">geoStdDev</span><span class="p">]</span>
      <span class="n">gamma</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gamma</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">gamma</span><span class="p">]</span>
      <span class="n">ndpi</span> <span class="o">=</span> <span class="p">[</span><span class="n">numberOfParticles</span><span class="o">*</span><span class="n">ithPart</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">dp</span><span class="p">,</span><span class="n">dpg</span><span class="p">,</span><span class="n">sg</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span><span class="p">,</span><span class="n">dpg</span><span class="p">,</span><span class="n">sg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span><span class="n">geoMean</span><span class="p">,</span><span class="n">geoStdDev</span><span class="p">)]</span>
      <span class="n">ndp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ndpi</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">geoStdDev</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">geoMean</span><span class="p">):</span>
      <span class="c1"># gamma is fully specified for each mode</span>
      <span class="n">gamma</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gamma</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">gamma</span><span class="p">]</span>
      <span class="n">ndpi</span> <span class="o">=</span> <span class="p">[</span><span class="n">numberOfParticles</span><span class="o">*</span><span class="n">ithPart</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">dp</span><span class="p">,</span><span class="n">dpg</span><span class="p">,</span><span class="n">sg</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span><span class="p">,</span><span class="n">dpg</span><span class="p">,</span><span class="n">sg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span><span class="n">geoMean</span><span class="p">,</span><span class="n">geoStdDev</span><span class="p">)]</span>
      <span class="n">ndp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ndpi</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># user problem</span>
      <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Not enough parameters to fully specify each mode.&quot;</span><span class="p">)</span>
      <span class="k">return</span> <span class="kc">None</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="c1"># unimodal</span>
    <span class="n">decomposeMultimodal</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">ndp</span> <span class="o">=</span> <span class="n">numberOfParticles</span><span class="o">*</span><span class="n">ithPart</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">dp</span><span class="p">,</span><span class="n">geoMean</span><span class="p">,</span><span class="n">geoStdDev</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">ndp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ndp</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span> <span class="ow">or</span> <span class="n">ndp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ndp</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span><span class="p">:</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Warning: distribution may not be compact on the specified interval. Consider using a higher upper bound.&quot;</span><span class="p">)</span>
  <span class="n">Bext</span><span class="p">,</span> <span class="n">Bsca</span><span class="p">,</span> <span class="n">Babs</span><span class="p">,</span> <span class="n">bigG</span><span class="p">,</span> <span class="n">Bpr</span><span class="p">,</span> <span class="n">Bback</span><span class="p">,</span> <span class="n">Bratio</span> <span class="o">=</span> <span class="n">Mie_SD</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">wavelength</span><span class="p">,</span><span class="n">dp</span><span class="p">,</span><span class="n">ndp</span><span class="p">,</span><span class="n">SMPS</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">returnDistribution</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">decomposeMultimodal</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">asDict</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Bext</span><span class="o">=</span><span class="n">Bext</span><span class="p">,</span> <span class="n">Bsca</span><span class="o">=</span><span class="n">Bsca</span><span class="p">,</span> <span class="n">Babs</span><span class="o">=</span><span class="n">Babs</span><span class="p">,</span> <span class="n">bigG</span><span class="o">=</span><span class="n">bigG</span><span class="p">,</span> <span class="n">Bpr</span><span class="o">=</span><span class="n">Bpr</span><span class="p">,</span> <span class="n">Bback</span><span class="o">=</span><span class="n">Bback</span><span class="p">,</span> <span class="n">Bratio</span><span class="o">=</span><span class="n">Bratio</span><span class="p">),</span> <span class="n">dp</span><span class="p">,</span> <span class="n">ndp</span><span class="p">,</span> <span class="n">ndpi</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Bext</span><span class="p">,</span> <span class="n">Bsca</span><span class="p">,</span> <span class="n">Babs</span><span class="p">,</span> <span class="n">bigG</span><span class="p">,</span> <span class="n">Bpr</span><span class="p">,</span> <span class="n">Bback</span><span class="p">,</span> <span class="n">Bratio</span><span class="p">,</span> <span class="n">dp</span><span class="p">,</span> <span class="n">ndp</span><span class="p">,</span> <span class="n">ndpi</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">asDict</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Bext</span><span class="o">=</span><span class="n">Bext</span><span class="p">,</span> <span class="n">Bsca</span><span class="o">=</span><span class="n">Bsca</span><span class="p">,</span> <span class="n">Babs</span><span class="o">=</span><span class="n">Babs</span><span class="p">,</span> <span class="n">bigG</span><span class="o">=</span><span class="n">bigG</span><span class="p">,</span> <span class="n">Bpr</span><span class="o">=</span><span class="n">Bpr</span><span class="p">,</span> <span class="n">Bback</span><span class="o">=</span><span class="n">Bback</span><span class="p">,</span> <span class="n">Bratio</span><span class="o">=</span><span class="n">Bratio</span><span class="p">),</span> <span class="n">dp</span><span class="p">,</span> <span class="n">ndp</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Bext</span><span class="p">,</span> <span class="n">Bsca</span><span class="p">,</span> <span class="n">Babs</span><span class="p">,</span> <span class="n">bigG</span><span class="p">,</span> <span class="n">Bpr</span><span class="p">,</span> <span class="n">Bback</span><span class="p">,</span> <span class="n">Bratio</span><span class="p">,</span> <span class="n">dp</span><span class="p">,</span> <span class="n">ndp</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">asDict</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
      <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Bext</span><span class="o">=</span><span class="n">Bext</span><span class="p">,</span> <span class="n">Bsca</span><span class="o">=</span><span class="n">Bsca</span><span class="p">,</span> <span class="n">Babs</span><span class="o">=</span><span class="n">Babs</span><span class="p">,</span> <span class="n">bigG</span><span class="o">=</span><span class="n">bigG</span><span class="p">,</span> <span class="n">Bpr</span><span class="o">=</span><span class="n">Bpr</span><span class="p">,</span> <span class="n">Bback</span><span class="o">=</span><span class="n">Bback</span><span class="p">,</span> <span class="n">Bratio</span><span class="o">=</span><span class="n">Bratio</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">Bext</span><span class="p">,</span> <span class="n">Bsca</span><span class="p">,</span> <span class="n">Babs</span><span class="p">,</span> <span class="n">bigG</span><span class="p">,</span> <span class="n">Bpr</span><span class="p">,</span> <span class="n">Bback</span><span class="p">,</span> <span class="n">Bratio</span></div>

</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, John Kendrick and Andrew Burnett
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=23ce250a"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=4e2eecee"></script>
    </body>
</html>