# Examples/Phonopy/Crystal
## Phonopy - CRYSTAL calculation on Na2(SO4)2

Create a crystal.o file as a copy of the output file from an optimised CRYSTAL run followed by a frequency calculation.   
If the output file has a different name then use the phonopy option ```-c this_is_the_name```
Create a TEMPLATE file (be careful with the shrink factor, this needs to be appropriate for the supercell):

&nbsp;

```
BASISSET
POB-DZVP
TOLINTEG
8 8 8 8 16
DFT
PBE-D3
CHUNKS
200
END
SCFDIR
EXCHSIZE
15000000
BIPOSIZE
15000000
SHRINK
0 0
7 6 5
FMIXING
40
MAXCYCLE
190
```

## Create super cells
In this calculation we are only interested in the gamma point, so we will be using a 'supercell' of 1,1,1.

```
phonopy --crystal -d --dim"1 1 1"
```

For CRYSTAL23 there is an ENDGEOM statement in each .d12 file that needs to be removed manually.

## Create directories and move files into them

```
for f in supercell-\*.d12; 
do
  g = ${g/.d12/} 
  mkdir -p Supercells/$g 
  mv \$g.\* Supercells/$g 
  ( cd Supercells/$g; ln -s supercell*.ext fort34)
done
```

## Submit jobs

```
for i in supercell-\* do
  runcrystal $i 8
done
```

## Create the force sets

```
phonopy --crystal -f Supercells/supercell-0*/*.log
```

## Create the BORN file

```
phonopy-crystal-born > BORN
```

## Create the dynamical matrix at the gamma point
```
phonopy --dim="1 1 1" --qpoints="0 0 0" --writedm
```
This command creates two files, phonopy.yaml and qpoints.yaml.  
phonopy.yaml contains information about the structure and qpoints.yaml contains the dynamical matrix.

## Run pdgui
```
pdgui phonopy crystal.o --qmprogram crystal
```

 | File               | Description                                                    |
 | ------------------ | -------------------------------------------------------------- |
 | crystal.o          | The output of a CRYSTAL optimisation and frequency calculation |
 | Na2SO42.d12        | CRYSTAL input file, used to generate crystal.o                 |
 | BORN.DAT           | CRYSTAL output file                                            |
 | supercell.d12      | Supercell instructions to CRYSTAL, generated by Phonopy        |
 | supercell.ext      | Perturbed super-cell structure generated by Phonopy            |
 | phonopy_disp.yaml  | Phonopy displacement information                               |
 | FORCE_SETS         | Phonopy output file                                            |
 | phonopy.yaml       | Phonopy output file (required by PDielec)                      |
 | qpoints.yaml       | Phonopy output file (required by PDielec)                      |
 | BORN               | Phonopy output file                                            |
 | TEMPLATE           | Template used by Phonopy to generate CRYSTAL input             |

[Back](..)
